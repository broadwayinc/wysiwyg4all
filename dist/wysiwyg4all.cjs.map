{"version":3,"file":"wysiwyg4all.cjs","mappings":"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","sources":["webpack://wysiwyg4all/webpack/bootstrap","webpack://wysiwyg4all/webpack/runtime/define property getters","webpack://wysiwyg4all/webpack/runtime/hasOwnProperty shorthand","webpack://wysiwyg4all/webpack/runtime/make namespace object","webpack://wysiwyg4all/./node_modules/colormangle/colormangle.js","webpack://wysiwyg4all/./selectors.js","webpack://wysiwyg4all/./util.js","webpack://wysiwyg4all/./wysiwyg4all.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const colorNames = {\n    aliceblue: \"#f0f8ff\",\n    antiquewhite: \"#faebd7\",\n    aqua: \"#00ffff\",\n    aquamarine: \"#7fffd4\",\n    azure: \"#f0ffff\",\n    beige: \"#f5f5dc\",\n    bisque: \"#ffe4c4\",\n    black: \"#000000\",\n    blanchedalmond: \"#ffebcd\",\n    blue: \"#0000ff\",\n    blueviolet: \"#8a2be2\",\n    brown: \"#a52a2a\",\n    burlywood: \"#deb887\",\n    cadetblue: \"#5f9ea0\",\n    chartreuse: \"#7fff00\",\n    chocolate: \"#d2691e\",\n    coral: \"#ff7f50\",\n    cornflowerblue: \"#6495ed\",\n    cornsilk: \"#fff8dc\",\n    crimson: \"#dc143c\",\n    cyan: \"#00ffff\",\n    darkblue: \"#00008b\",\n    darkcyan: \"#008b8b\",\n    darkgoldenrod: \"#b8860b\",\n    darkgray: \"#a9a9a9\",\n    darkgreen: \"#006400\",\n    darkgrey: \"#a9a9a9\",\n    darkkhaki: \"#bdb76b\",\n    darkmagenta: \"#8b008b\",\n    darkolivegreen: \"#556b2f\",\n    darkorange: \"#ff8c00\",\n    darkorchid: \"#9932cc\",\n    darkred: \"#8b0000\",\n    darksalmon: \"#e9967a\",\n    darkseagreen: \"#8fbc8f\",\n    darkslateblue: \"#483d8b\",\n    darkslategray: \"#2f4f4f\",\n    darkslategrey: \"#2f4f4f\",\n    darkturquoise: \"#00ced1\",\n    darkviolet: \"#9400d3\",\n    deeppink: \"#ff1493\",\n    deepskyblue: \"#00bfff\",\n    dimgray: \"#696969\",\n    dimgrey: \"#696969\",\n    dodgerblue: \"#1e90ff\",\n    firebrick: \"#b22222\",\n    floralwhite: \"#fffaf0\",\n    forestgreen: \"#228b22\",\n    fuchsia: \"#ff00ff\",\n    gainsboro: \"#dcdcdc\",\n    ghostwhite: \"#f8f8ff\",\n    goldenrod: \"#daa520\",\n    gold: \"#ffd700\",\n    gray: \"#808080\",\n    green: \"#008000\",\n    greenyellow: \"#adff2f\",\n    grey: \"#808080\",\n    honeydew: \"#f0fff0\",\n    hotpink: \"#ff69b4\",\n    indianred: \"#cd5c5c\",\n    indigo: \"#4b0082\",\n    ivory: \"#fffff0\",\n    khaki: \"#f0e68c\",\n    lavenderblush: \"#fff0f5\",\n    lavender: \"#e6e6fa\",\n    lawngreen: \"#7cfc00\",\n    lemonchiffon: \"#fffacd\",\n    lightblue: \"#add8e6\",\n    lightcoral: \"#f08080\",\n    lightcyan: \"#e0ffff\",\n    lightgoldenrodyellow: \"#fafad2\",\n    lightgray: \"#d3d3d3\",\n    lightgreen: \"#90ee90\",\n    lightgrey: \"#d3d3d3\",\n    lightpink: \"#ffb6c1\",\n    lightsalmon: \"#ffa07a\",\n    lightseagreen: \"#20b2aa\",\n    lightskyblue: \"#87cefa\",\n    lightslategray: \"#778899\",\n    lightslategrey: \"#778899\",\n    lightsteelblue: \"#b0c4de\",\n    lightyellow: \"#ffffe0\",\n    lime: \"#00ff00\",\n    limegreen: \"#32cd32\",\n    linen: \"#faf0e6\",\n    magenta: \"#ff00ff\",\n    maroon: \"#800000\",\n    mediumaquamarine: \"#66cdaa\",\n    mediumblue: \"#0000cd\",\n    mediumorchid: \"#ba55d3\",\n    mediumpurple: \"#9370db\",\n    mediumseagreen: \"#3cb371\",\n    mediumslateblue: \"#7b68ee\",\n    mediumspringgreen: \"#00fa9a\",\n    mediumturquoise: \"#48d1cc\",\n    mediumvioletred: \"#c71585\",\n    midnightblue: \"#191970\",\n    mintcream: \"#f5fffa\",\n    mistyrose: \"#ffe4e1\",\n    moccasin: \"#ffe4b5\",\n    navajowhite: \"#ffdead\",\n    navy: \"#000080\",\n    oldlace: \"#fdf5e6\",\n    olive: \"#808000\",\n    olivedrab: \"#6b8e23\",\n    orange: \"#ffa500\",\n    orangered: \"#ff4500\",\n    orchid: \"#da70d6\",\n    palegoldenrod: \"#eee8aa\",\n    palegreen: \"#98fb98\",\n    paleturquoise: \"#afeeee\",\n    palevioletred: \"#db7093\",\n    papayawhip: \"#ffefd5\",\n    peachpuff: \"#ffdab9\",\n    peru: \"#cd853f\",\n    pink: \"#ffc0cb\",\n    plum: \"#dda0dd\",\n    powderblue: \"#b0e0e6\",\n    purple: \"#800080\",\n    rebeccapurple: \"#663399\",\n    red: \"#ff0000\",\n    rosybrown: \"#bc8f8f\",\n    royalblue: \"#4169e1\",\n    saddlebrown: \"#8b4513\",\n    salmon: \"#fa8072\",\n    sandybrown: \"#f4a460\",\n    seagreen: \"#2e8b57\",\n    seashell: \"#fff5ee\",\n    sienna: \"#a0522d\",\n    silver: \"#c0c0c0\",\n    skyblue: \"#87ceeb\",\n    slateblue: \"#6a5acd\",\n    slategray: \"#708090\",\n    slategrey: \"#708090\",\n    snow: \"#fffafa\",\n    springgreen: \"#00ff7f\",\n    steelblue: \"#4682b4\",\n    tan: \"#d2b48c\",\n    teal: \"#008080\",\n    thistle: \"#d8bfd8\",\n    tomato: \"#ff6347\",\n    turquoise: \"#40e0d0\",\n    violet: \"#ee82ee\",\n    wheat: \"#f5deb3\",\n    white: \"#ffffff\",\n    whitesmoke: \"#f5f5f5\",\n    yellow: \"#ffff00\",\n    yellowgreen: \"#9acd32\",\n};\n\nclass ColorMangle {\n    /**\n     * @param {string} [color='#4848db'] - Argument string can be either color name string or any type of HTML color codes (hex, rgb, hsl).\n     */\n    constructor(color = '#4848db', fineTuned = true) {\n        this.fineTuned = fineTuned;\n\n        let format = this._colorType(color);\n        this.type = format.type;\n        this.color = format.color;\n    }\n\n    _colorType(color = this.color, throwErr = true) {\n        let chkType, type;\n\n        try {\n            if (!color)\n                throw 'invalid color';\n\n            if (typeof color === 'object' && color.string)\n                color = color.string;\n\n            if (typeof color === 'string')\n                color = color.toLowerCase();\n            else\n                throw 'invalid color';\n\n            if (color === this.color)\n                return { type: this.type, color: this.color };\n\n            if (colorNames[color])\n                return { type: 'hex', color: colorNames[color] };\n\n            chkType = color.match(/^(rgba?|rgb?|hsla?|#)/g);\n\n            if (Array.isArray(chkType)) {\n\n                if (chkType[0] === '#') {\n\n                    if (color.length === 4)\n                        // convert shorthand hex\n                        color = color[0] + color[1] + color[1] + color[2] + color[2] + color[3] + color[3];\n\n                    if (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(color))\n                        // is valid hex\n                        type = 'hex';\n\n                    else\n                        throw 'invalid hex';\n\n                } else if (color[color.length - 1] === ')')\n                    // hex, rgb, rgba, hsl, hsla\n                    type = chkType[0];\n\n                return { type, color };\n\n            }\n\n        } catch (err) {\n            if (throwErr)\n                throw err + ':' + color;\n        }\n\n        return {};\n    }\n\n    _extractDigit(color_arg = this.color) {\n        let { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type === 'hex')\n            color = this.rgba(1, color).string;\n\n        const value = [];\n\n        for (const i of color.match(/\\d+(\\.\\d+)?/g))\n            value.push(parseFloat(i));\n\n        if (value.length < 4) value.push(1);\n\n        return value;\n    }\n\n    /**\n     * @return {number} - Retrieves color alpha value (range 0 ~ 1)\n     */\n    getAlpha(color_arg = this.color) {\n        let extract = this._extractDigit(color_arg);\n        return extract ? extract[3] || 1 : 1;\n    }\n\n    /**\n     * Generates color scheme object.\n     * @typedef {Object} colorScheme\n     * @property {string} --alert\n     * @property {string} --alert-text\n     * @property {string} --analogous\n     * @property {string} --analogous-text\n     * @property {string} --background\n     * @property {string} --background-focus\n     * @property {string} --background-focus-text\n     * @property {string} --background-text\n     * @property {string} --background-text_focus\n     * @property {string} --button\n     * @property {string} --button-text\n     * @property {string} --complementary\n     * @property {string} --complementary-text\n     * @property {string} --content\n     * @property {string} --content-focus\n     * @property {string} --content-focus-text\n     * @property {string} --content-text\n     * @property {string} --content-text_focus\n     * @property {string} --focus\n     * @property {string} --focus-text\n     * @property {string} --placeholder\n     * @property {string} --saturate\n     * @property {string} --saturate-text\n     * @property {string} --success\n     * @property {string} --success-text\n     * @property {string} --text-button\n     * @param {string} [color=this.color] - Focus color for color scheme\n     * @param {boolean} [darkMode=false] - Dark mode when true\n     * @return {colorScheme} - { [&lt;CSS Variable names&gt;] : &lt;string | HTML color string&gt; }\n     */\n    colorScheme(color = this.color, darkMode = false) {\n\n        let opacity = {\n            text: { black: 0.88, white: 1 },\n            // soft: { black: 0.66, white: 0.88 },\n            placeholder: { black: 0.44, white: 0.55 },\n            // transparent: { black: 0.22, white: 0.33 },\n            // shade: { black: 0.066, white: 0.11 },\n            // shadow: { black: 0.033, white: 0.066 }\n        };\n\n        let template = {\n            '--background': darkMode ? '#121212' : '#f7f7f7',\n            '--content': darkMode ? '#2b2b2b' : '#ffffff',\n            // '--toolbar': darkMode ? '#2b2b2b' : '#ffffff'\n        };\n\n        let focusOriginal;\n        let focusSat;\n        let content_isHighLuminance = this.isHighLuminance(template['--content']);\n        let focus = (() => {\n            if (color && typeof color === 'object') {\n                if (color['--button']) {\n                    focusOriginal = color['--button'];\n                    return focusOriginal;\n                }\n                for (let key of color)\n                    if (key.includes('focus')) {\n                        focusOriginal = color[key];\n                        return focusOriginal;\n                    }\n            }\n\n            focusOriginal = color;\n            focusSat = this.matchLuminance(color, template['--content'], content_isHighLuminance ? 1.5 : 4.5);\n            return darkMode ? focusSat : color;\n        })();\n\n        let compDir = 1;\n        let analogous = (() => {\n            let deg = 30;\n            let analogous = this.analogous(focusOriginal, deg);\n            let focusHSL = this.hsla(1, focusOriginal).h;\n            let an1HSL = this.hsla(1, analogous[0]).h;\n            let an2HSL = this.hsla(1, analogous[1]).h;\n\n            if (focusHSL + deg > 360)\n                an1HSL = an1HSL + 360;\n            if (focusHSL - deg < 0)\n                an2HSL = 360 - an2HSL;\n\n            if (Math.abs(focusHSL - an1HSL) > Math.abs(focusHSL - an2HSL)) {\n                compDir = -1;\n                return analogous[1];\n            }\n\n            return analogous[0];\n        })();\n\n        let complementary = this.matchLuminance(this.complementary(focus, 60 * compDir), template['--background'], 3.1);\n        let fixedValue = {\n            // '--shadow': 'rgba(0, 0, 0, 0.033)',\n            // '--shade': 'rgba(0, 0, 0, 0.066)',\n            // '--transparent': 'rgba(0, 0, 0, 0.22)',\n            '--placeholder': darkMode ? 'rgba(255, 255, 255, 0.55)' : 'rgba(0, 0, 0, 0.44)'\n        };\n\n        let darkModeAnalogous = darkMode ? this.matchLuminance(analogous, template['--background'], 4.5) : analogous;\n        let analogousNude = this.matchLuminance(analogous, template['--background'], 4.5);\n\n        for (let k in template) {\n            template[k + '-text'] = this.textColor(opacity.text, template[k]);\n            template[k + '-focus'] = k.includes('--background') ? darkModeAnalogous : focus;\n            template[k + '-text_focus'] = k.includes('--background') ? analogousNude : this.matchLuminance(darkMode ? focus : focusSat, template[k], 1.66);\n            template[k + '-focus-text'] = this.textColor(1, k.includes('--background') ? darkModeAnalogous : focus);\n        }\n\n        template['--focus'] = focusOriginal;\n        template['--focus-text'] = this.textColor(1, focusOriginal);\n        template['--saturate'] = focusSat;\n        template['--saturate-text'] = this.textColor(1, focusSat);\n\n        Object.assign(template, {\n            '--complementary': complementary,\n            '--complementary-text': this.textColor(1, complementary),\n            '--analogous': analogous,\n            '--analogous-text': this.textColor(1, analogous),\n            '--alert': 'tomato',\n            // '--alert-text': 'white',\n            '--success': 'limegreen',\n            // '--success-text': 'black',\n            '--button': focus,\n            '--text-button': darkMode ? this.matchLuminance(focusSat, template[\"--content\"], 7) : this.contrastRatio(template[\"--content\"], focusSat) < 4.5 ? \"inherit\" : focusSat,\n            '--button-text': this.textColor(1, focus)\n        });\n\n        // for (let k in template) {\n        //     if (!template[k] || template[k] === \"\")\n        //         continue;\n\n        //     let highLum = this.isHighLuminance(template[k]);\n        //     for (let op of ['soft', 'placeholder', 'transparent', 'shadow', 'shade']) {\n\n        //         template[k + '_' + op] = this.rgba(opacity[op][highLum ? 'white' : 'black'], template[k]).string;\n        //     }\n        // }\n\n        // template['--button-border'] = (() => {\n        //     let focus_isHighLuminance = this.isHighLuminance(focus);\n        //     let border = this.matchLuminance(this.adjustLuminance(-1, template['--button']), template['--button'], 1.15, -1, focus_isHighLuminance ? 'luminance' : 'brightness');\n        //     return focus_isHighLuminance ? this.rgba(0.5, border).string : border;\n        // })();\n\n        if (color && typeof color === 'object') {\n            for (let key of color)\n                if (key[0] !== '-')\n                    throw 'invalid color scheme';\n            Object.assign(template, color);\n        }\n\n        let unordered = Object.assign(template, fixedValue);\n        return Object.keys(unordered).sort().reduce(\n            (obj, key) => {\n                obj[key] = unordered[key];\n                return obj;\n            },\n            {}\n        );\n    }\n\n    /**\n     * Match luminance of target_color with base color\n     * @param {string} target_color - Target color\n     * @param {string} [color_arg=this.color] - Base color\n     * @param {number} [target_ratio] - Set contrast ratio difference\n     * @param {number} [direction] - Adjust direction. Adjust to darker luminance when -1. Brighter when 1, otherwise auto.\n     * @param {string} [method] - Luminance adjustment mode: 'brightness | luminance | saturation'\n     * @return {string} - HTML color string\n     */\n    matchLuminance(target_color, color_arg = this.color, target_ratio, direction, method) {\n        let { color } = this._colorType(color_arg);\n        let target = this._colorType(target_color).color;\n\n        if (target_ratio) {\n            let adj = target;\n            let m = this.contrastRatio(adj, color);\n            if (m < target_ratio) {\n                let dir = direction || this.isHighLuminance(color) ? -1 : 1;\n                let count = 100;\n                while (m < target_ratio && count--) {\n                    let adj_set;\n\n                    switch (method) {\n                        case 'brightness':\n                            adj_set = this.adjustBrightness(1 * dir, adj);\n                            break;\n                        case 'luminance':\n                            adj_set = this.adjustLuminance(1 * dir, adj);\n                            break;\n                        default:\n                            adj_set = this.adjustBrightness(1 * dir, { legacy: true, color: adj });\n                    }\n\n                    if (adj === adj_set)\n                        break;\n                    adj = adj_set;\n\n                    m = this.contrastRatio(adj, color);\n                }\n            }\n            return this.hex(adj);\n        } else {\n            let main_lum = this._luminance(color);\n            let lum = this._luminance(target);\n\n            if (Math.abs(lum - main_lum) < 0.01)\n                return target;\n\n            let adj = this.hex(target);\n\n            let dir = (lum, main_lum) => {\n                return lum < main_lum ? 1 : -1;\n            };\n\n            let currDir = dir(lum, main_lum);\n            while (Math.abs(lum - main_lum) > 0.01 && currDir === dir(lum, main_lum)) {\n                let adj_set;\n                switch (method) {\n                    case 'saturation':\n                        adj_set = this.adjustBrightness(currDir, { color: adj, legacy: true });\n                        break;\n                    case 'luminance':\n                        adj_set = this.adjustLuminance(currDir, adj);\n                        break;\n                    default:\n                        adj_set = this.adjustBrightness(currDir, adj);\n                }\n                let lum_pre = this._luminance(adj_set);\n                if (lum_pre === lum || currDir !== dir(lum_pre, main_lum))\n                    break;\n                lum = lum_pre;\n                adj = adj_set;\n            }\n            return this.hex(adj);\n        }\n    }\n\n    /**\n     * Generate analogous color\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {number} [deg=30] - Amount of hue separation\n     * @return {Array} - 2 analogous color is returned. [&lt;hsla color&gt;, ... ]\n     */\n    analogous(color_arg = this.color, deg = 30) {\n        let { color } = this._colorType(color_arg);\n\n        let spin = (h, v) => {\n            let val = h + v;\n            return val < 0 ? 360 + val : val > 360 ? val - 360 : val;\n        };\n\n        let hsl = this.hsla(this.getAlpha(color), color);\n        let plus = 'hsla(' + spin(hsl.h, deg) + ', ' + hsl.s + '%, ' + hsl.l + '%, ' + hsl.a + ')';\n        let minus = 'hsla(' + spin(hsl.h, -deg) + ', ' + hsl.s + '%, ' + hsl.l + '%, ' + hsl.a + ')';\n\n        return [this.matchLuminance(plus, color), this.matchLuminance(minus, color)];\n    }\n\n    /**\n     * Generate complementary color\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {number} [add=0] - Add or subtract hue from complementary color\n     * @return {string} - HEX color string\n     */\n    complementary(color_arg = this.color, add = 0) {\n        let { color } = this._colorType(color_arg);\n\n        let hsl = this.hsla(this.getAlpha(color), color);\n\n        if (hsl.h < 180)\n            hsl.h += 180;\n        else\n            hsl.h -= 180;\n\n        hsl.h += add;\n        hsl.h = hsl.h > 360 ? hsl.h - 360 : hsl.h < 0 ? 360 - hsl.h : hsl.h;\n\n        return this.hex(this._toString(hsl));\n    }\n\n    /**\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {boolean} [fineTuned=false] - Custom Color space is applied when true\n     * @return {boolean} - True if color has high luminance\n     */\n    isHighLuminance(color_arg = this.color, fineTuned = this.fineTuned) {\n        const { r, g, b } = this.rgba(1, this._colorType(color_arg).color);\n\n        let yiq =\n            fineTuned ?\n                ((r * (299 - 64)) + (g * (587 * 1.25)) + (b * 114)) / 1000 : // Fine tuned\n                ((r * 299) + (g * 587) + (b * 114)) / 1000; // Standard color space formula\n\n        // Web standard of color space threshold is 128\n        return (yiq >= (fineTuned ? 188 : 128));\n    }\n\n    _luminance(color_arg = this.color) {\n        let rgb = this.rgba(1, color_arg);\n        let a = [rgb.r, rgb.g, rgb.b].map(function (v) {\n            v /= 255;\n            return v <= 0.03928\n                ? v / 12.92\n                : Math.pow((v + 0.055) / 1.055, 2.4);\n        });\n\n        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;\n    }\n\n    _toString(col) {\n        let numberOrNot = (n, def = 100) => {\n            return typeof n === 'number' ? n : def;\n        };\n        if (typeof col === 'string')\n            return col;\n\n        if (col.hasOwnProperty('h'))\n            return 'hsla(' + (col.h || 0) + ', ' + numberOrNot(col.s) + '%, ' + numberOrNot(col.l) + '%, ' + numberOrNot(col.a, 1) + ')';\n\n        if (col.hasOwnProperty('r'))\n            return 'rgba(' + numberOrNot(col.r) + ', ' + numberOrNot(col.g) + ', ' + numberOrNot(col.b) + ', ' + numberOrNot(col.a, 1) + ')';\n        throw col;\n    }\n\n    /**\n     * Returns contrast ratio between the given color.\n     * Useful to determine if the given color is suitable for text with the constructed color as a background.\n     * @param {string} color_arg1 - Color string you want to compare luminance ratio.\n     * @param {string} [color_arg2=this.color] - Color string you want to compare with color_arg1\n     * @return {number} - Contrast ratio\n     */\n    contrastRatio(color_arg1, color_arg2 = this.color) {\n        let lum1 = this._luminance(color_arg2) + 0.05;\n        let lum2 = this._luminance(color_arg1) + 0.05;\n\n        return lum1 > lum2 ? lum1 / lum2 : lum2 / lum1;\n    }\n\n    /**\n     * Returns suitable text color (Black / White).\n     * @param {(number | Object)} opacity - Can set returning color values opacity.\n     * @param {number} opacity.black - Set returning color values opacity when the result color is black.\n     * @param {number} opacity.white - Set returning color values opacity when the result color is white.\n     * @param {(string|Object)} [option=this.color] - Background color of text\n     * @param {(string|Object)} [option.color=this.color] - Background color of text\n     * @param {(string|Object)} [option.fineTuned=true] - Follows standard color space calculation when false\n     * @return {string | null} - HTML color string\n     */\n    textColor(opacity = 1, option = this.color) {\n\n        if (typeof option === 'string')\n            option = { color: option };\n\n        let { color = this.color, fineTuned = true } = option;\n\n        color = this._colorType(color).color;\n\n        // returns null if color opacity is below 0.5\n        if (this.getAlpha(color) < 0.5)\n            return \"\";\n\n        let blackOpacity, whiteOpacity;\n\n        if (typeof opacity === 'number' && opacity < 1) {\n            blackOpacity = opacity;\n            whiteOpacity = opacity;\n        } else if (opacity && typeof opacity === 'object') {\n            for (let k of ['black', 'white']) {\n                let opa = opacity[k];\n                if (typeof opa === 'number' && opa < 1) {\n                    if (k === 'black')\n                        blackOpacity = opa;\n                    else if (k === 'white')\n                        whiteOpacity = opa;\n                }\n            }\n        }\n\n        const opa = (v) => {\n            if (typeof v === 'number') {\n                if (v < 1 && v > 0) return v;\n                else if (v > 1) return 1;\n                else return 0;\n            } else return 1;\n        };\n\n        if (this.isHighLuminance(color, fineTuned))\n            return blackOpacity ? `rgba(0, 0, 0, ${opa(blackOpacity)})` : 'black';\n\n        return whiteOpacity ? `rgba(255, 255, 255, ${opa(whiteOpacity)})` : 'white';\n    }\n\n    /**\n     * Returns hsla color\n     * @param {number} [opacity] - Set opacity for returning color value.\n     * @param {string} [color_arg=this.color] - Color to convert to hsla string\n     * @return {Object} - { h: &lt;number&gt;, s: &lt;number&gt;, l: &lt;number&gt;, r: &lt;number&gt;, g: &lt;number&gt;, b: &lt;number&gt;, a: &lt;number&gt;, string: &lt;string | rgba color string&gt; }\n     */\n    hsla(opacity, color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        const hsl = (r, g, b) => {\n            r /= 255;\n            g /= 255;\n            b /= 255;\n\n            let c_min = Math.min(r, g, b),\n                c_max = Math.max(r, g, b),\n                delta = c_max - c_min,\n                h = 0,\n                s = 0,\n                l = 0;\n\n            if (delta === 0)\n                h = 0;\n            else if (c_max === r)\n                h = ((g - b) / delta) % 6;\n            else if (c_max === g)\n                h = (b - r) / delta + 2;\n            else\n                h = (r - g) / delta + 4;\n\n            h = Math.round(h * 60);\n\n            if (h < 0) h += 360;\n\n            l = (c_max + c_min) / 2;\n            s = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));\n            s = +(s * 100).toFixed(1);\n            l = +(l * 100).toFixed(1);\n            return { h, s, l };\n        };\n\n        if (type === 'hex') {\n            opacity = typeof opacity === 'number' ? opacity : 1;\n            const rgba = this.rgba(opacity, color);\n            const { r, g, b, a } = rgba;\n            const { h, s, l } = hsl(r, g, b);\n\n            return {\n                r, g, b, a,\n                h: h,\n                s: s,\n                l: l,\n                string: this._toString({ h, s, l, a: opacity })\n            };\n\n        } else {\n\n            const digit = this._extractDigit(color);\n            opacity = typeof opacity === 'number' ? opacity : digit[3] || 1;\n\n            if (type.includes('hsl')) {\n                const { r, g, b, a } = this.rgba(opacity, color);\n\n                return {\n                    r, g, b, a,\n                    h: digit[0],\n                    s: digit[1],\n                    l: digit[2],\n                    string: this._toString({\n                        h: digit[0],\n                        s: digit[1],\n                        l: digit[2],\n                        a\n                    })\n                };\n\n            } else if (type.includes('rgb')) {\n                const value = {\n                    r: digit[0],\n                    g: digit[1],\n                    b: digit[2],\n                    a: opacity\n                };\n                const { h, s, l } = hsl(value.r, value.g, value.b);\n\n                return Object.assign(value, {\n                    r: value.r,\n                    g: value.g,\n                    b: value.b,\n                    h: h,\n                    s: s,\n                    l: l,\n                    a: value.a,\n                    string: this._toString({ h, s, l, a: value.a })\n                });\n\n            }\n        }\n    }\n\n    /**\n     * Returns hex color string\n     * @param {string} [color_arg=this.color] - Color to convert to hex string\n     * @return {string} - HEX color string\n     */\n    hex(color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type.includes('rgb') || type.includes('hsl')) {\n            const rgba = this.rgba(1, color);\n            return '#' + ((1 << 24) + (rgba.r << 16) + (rgba.g << 8) + rgba.b).toString(16).slice(1);\n        }\n\n        return color;\n    }\n\n    /**\n     * Returns rgba color\n     * @param {number} [opacity] - Set opacity of returning color\n     * @param {string} [color_arg=this.color] - Color to convert to rgba string\n     * @return {Object} - { r: &lt;number&gt;, g: &lt;number&gt;, b: &lt;number&gt;, a: &lt;number&gt;, string: &lt;string | HTML color string&gt; }\n     */\n    rgba(opacity, color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type === 'hex') {\n            const hex = color;\n            let rgbObject = { r: null, g: null, b: null };\n            let hexValues = hex.match(/[a-fA-F0-9]{2}/g);\n\n            if (hex.length === 4) {\n                hexValues = hex.match(/[a-fA-F0-9]{1}/g);\n                hexValues = hexValues.map(hex => \"\" + hex + hex);\n            }\n            let count = 0;\n            for (const key in rgbObject) {\n                rgbObject[key] = parseInt(hexValues[count], 16);\n                count++;\n            }\n\n            const opacity_value = typeof opacity === 'number' ? opacity : 1;\n            let { r, g, b } = rgbObject;\n\n            return {\n                ...rgbObject,\n                a: opacity_value,\n                string: this._toString({\n                    r: +r, g: +g, b: +b, a: opacity_value\n                })\n            };\n\n        } else {\n            const digit = this._extractDigit(color);\n            const a = typeof opacity === 'number' ? opacity : digit[3] || 1;\n\n            if (type.includes('rgb')) {\n\n                let value = {\n                    r: digit[0],\n                    g: digit[1],\n                    b: digit[2],\n                    a\n                };\n\n                return Object.assign({\n                    string: this._toString(value)\n                }, value);\n\n            } else if (type.includes('hsl')) {\n\n                let h = digit[0];\n                let s = digit[1];\n                let l = digit[2];\n\n                s /= 100;\n                l /= 100;\n\n                let c = (1 - Math.abs(2 * l - 1)) * s,\n                    x = c * (1 - Math.abs((h / 60) % 2 - 1)),\n                    m = l - c / 2,\n                    r = 0,\n                    g = 0,\n                    b = 0;\n                if (0 <= h && h < 60) {\n                    r = c;\n                    g = x;\n                    b = 0;\n                } else if (60 <= h && h < 120) {\n                    r = x;\n                    g = c;\n                    b = 0;\n                } else if (120 <= h && h < 180) {\n                    r = 0;\n                    g = c;\n                    b = x;\n                } else if (180 <= h && h < 240) {\n                    r = 0;\n                    g = x;\n                    b = c;\n                } else if (240 <= h && h < 300) {\n                    r = x;\n                    g = 0;\n                    b = c;\n                } else if (300 <= h && h < 360) {\n                    r = c;\n                    g = 0;\n                    b = x;\n                }\n                r = Math.round((r + m) * 255);\n                g = Math.round((g + m) * 255);\n                b = Math.round((b + m) * 255);\n\n                return {\n                    r, g, b, a,\n                    string: this._toString({ r, g, b, a })\n                };\n\n            }\n        }\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {(string|Object)} [option=this.color] - Color to adjust || additional option.\n     * @param {(string|Object)} [option.color_arg=this.color] - Color to adjust.\n     * @param {(string|Object)} [option.legacy=false] - Legacy adjust mode. Adjust brightness by saturation and luminance.\n     * @return {string} - Brightness adjusted HTML color string\n     */\n    adjustBrightness(value = 0, option = this.color) {\n        let color_arg, legacy = false;\n        if (typeof option === 'string')\n            color_arg = option || this.color;\n        else {\n            color_arg = option.color || this.color;\n            legacy = option.legacy || false;\n        }\n\n        if (legacy) {\n            let { color } = this._colorType(color_arg);\n            let col = this.hsla(this.getAlpha(color), color);\n\n            let limit = (v, limit = 100) => {\n                return v > limit ? limit : v < 0 ? 0 : v;\n            };\n\n            col.s += ((value > 0 ? (100 - col.s) : col.s) / 100) * value;\n            col.s = limit(col.s);\n            col.l += ((value > 0 ? (100 - col.l) : col.l) / 100) * value;\n            col.l = limit(col.l);\n\n            return this._toString(col);\n        }\n\n        let { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (value === 0)\n            return color;\n\n        const opacity = type === 'hex' ? 1 : this._extractDigit(color)[3] || 1;\n        const rgb = this.rgba(opacity, color);\n\n        let rgbRange = {\n            r: 0 - rgb['r'],\n            g: 0 - rgb['g'],\n            b: 0 - rgb['b']\n        };\n\n        if (value > 0) {\n            Object.keys(rgbRange).map(function (key) {\n                rgbRange[key] = 255 - rgb[key];\n            });\n        }\n\n        ['r', 'g', 'b'].map(function (key) {\n            rgb[key] += parseInt(rgbRange[key] / 100 * Math.abs(value));\n        });\n\n        const result = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';\n\n        if (type === 'hex')\n            return this.hex(result);\n\n        else if (type.includes('rgb'))\n            return this.rgba(rgb.a, result).string;\n\n        else if (type.includes('hsl'))\n            return this.hsla(rgb.a, result).string;\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {string} [color_arg=this.color] - Color to adjust.\n     * @return {string} - Luminance adjusted hsla color string\n     */\n    adjustLuminance(value = 0, color_arg = this.color) {\n        let { color } = this._colorType(color_arg);\n        let col = this.hsla(this.getAlpha(color), color);\n\n        let limit = (v, limit = 100) => {\n            return v > limit ? limit : v < 0 ? 0 : v;\n        };\n\n        col.l += ((value > 0 ? (100 - col.l) : col.l) / 100) * value;\n        col.l = limit(col.l);\n\n        return this._toString(col);\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {string} [color_arg=this.color] - Color to adjust.\n     * @return {string} - Saturation adjusted hsla color string\n     */\n    adjustSaturation(value = 0, color_arg = this.color) {\n        let { color } = this._colorType(color_arg);\n        let col = this.hsla(this.getAlpha(color), color);\n\n        let limit = (v, limit = 100) => {\n            return v > limit ? limit : v < 0 ? 0 : v;\n        };\n\n        col.s += ((value > 0 ? (100 - col.s) : col.s) / 100) * value;\n        col.s = limit(col.s);\n\n        return this._toString(col);\n    }\n}\n\nexport { ColorMangle };","function adjustSelection(\n    target,\n    ceilingElement_query\n) {\n    // Adjusts the selection range in the document\n    // target: { node: [Node], position: [number] }\n    // ceilingElement_query: [string] (CSS selector)\n    // Returns: { startLine: Node, endLine: Node }\n    // If target is null, it will not set the selection range\n    // If ceilingElement_query is null, it will not set the startLine and endLine\n\n    let toArray = (v, allowObject = false) => {\n        if (Array.isArray(v)) return v;\n        else if (\n            (typeof v === \"string\" && v) ||\n            typeof v === \"number\" ||\n            typeof v === \"boolean\" ||\n            (allowObject && typeof v === \"object\")\n        )\n            return [v];\n        else return [];\n    };\n\n    let setRange = !!target;\n\n    let { node = null, position = true } = target || {};\n\n    let sel = window.getSelection();\n    if (!sel) return null;\n\n    let range = null;\n    try {\n        range = sel.getRangeAt(0);\n    } catch (err) {\n        if (setRange) range = document.createRange();\n    }\n\n    if (setRange) {\n        node = toArray(node, true);\n        position = toArray(position, true);\n\n        for (let p of position)\n            if (typeof p !== \"number\" && typeof p !== \"boolean\" && p !== null)\n                throw \"INVALID_POSITION\";\n\n        for (let n of node) {\n            if (!(n instanceof Node) && n !== null) {\n                if (n === false) return;\n                throw \"INVALID_NODE\";\n            }\n        }\n\n        const setTarget = (node, position) => {\n            if (node instanceof Node) {\n                if (node.nodeType === 1) {\n                    if (typeof position === \"boolean\")\n                        while (position === false ? node.lastChild : node.firstChild)\n                            node = position === false ? node.lastChild : node.firstChild;\n                    else if (typeof position === \"number\") {\n                        let textLength = 0;\n                        nodeCrawler(\n                            (n) => {\n                                if (n.nodeType === 3 && n.textContent.length) {\n                                    let length = n.textContent.length;\n                                    if (\n                                        n.parentNode.getAttribute(\"contenteditable\") === \"false\"\n                                    ) {\n                                        if (position - (textLength + length) >= 0)\n                                            textLength += length;\n                                        else {\n                                            position = length;\n                                            return \"BREAK\";\n                                        }\n                                        return n;\n                                    } else {\n                                        node = n;\n\n                                        if (position - (textLength + length) >= 0) {\n                                            textLength += length;\n                                        } else {\n                                            position -= textLength;\n                                            return \"BREAK\";\n                                        }\n                                    }\n                                }\n                                return n;\n                            },\n                            {\n                                node,\n                            }\n                        );\n                        if (node.nodeType === 1) {\n                            let text = document.createTextNode(\"\\u200B\");\n                            node.insertBefore(text, node.childNodes[0]);\n                            node = text;\n                            position = 0;\n                        }\n                    }\n\n                    if (node.nodeName === \"BR\" && node.parentNode.childNodes.length > 1)\n                        node = node.previousSibling || node;\n                }\n                if (typeof position === \"boolean\")\n                    position = position ? 0 : node.textContent.length;\n                else\n                    position =\n                        position > node.textContent.length\n                            ? node.textContent.length\n                            : position;\n\n                return { node, position };\n            }\n        };\n\n        let doCollapse = false,\n            setEnd,\n            setStart = (() => {\n                node[0] = node[0] === null ? range.startContainer : node[0];\n                position[0] = position[0] === null ? range.startOffset : position[0];\n                return setTarget(node[0], position[0]);\n            })();\n        range.setStart(setStart.node, setStart.position);\n\n        if (position.length > 1)\n            setEnd = setTarget(\n                (node[1] === null ? range.endContainer : node[1]) || node[0],\n                position[1] === null ? range.endOffset : position[1]\n            );\n        else {\n            setEnd = setStart;\n            doCollapse = true;\n        }\n\n        range.setEnd(setEnd.node, setEnd.position);\n\n        if (doCollapse) range.collapse(true);\n\n        sel.removeAllRanges();\n        sel.addRange(range);\n    }\n\n    if (ceilingElement_query && range) {\n        let startLine, endLine;\n        for (let q of ceilingElement_query) {\n            let e =\n                range.endContainer.nodeType === 3\n                    ? range.endContainer.parentNode\n                    : range.endContainer;\n            let s =\n                range.startContainer.nodeType === 3\n                    ? range.startContainer.parentNode\n                    : range.startContainer;\n\n            if (!startLine && s.closest(q))\n                startLine = climbUpToEldestParent(s, s.closest(q));\n            if (!endLine && e.closest(q))\n                endLine = climbUpToEldestParent(e, e.closest(q));\n\n            if (startLine && endLine) break;\n        }\n\n        range.startLine = startLine;\n        range.endLine = endLine;\n    }\n\n    return range;\n}\n\nfunction nodeCrawler(run, option) {\n    const { parentNode, node, startFromEldestChild, startNode } = option;\n    // const options = {\n    //   node: document.getElementById('content'),\n    //   parentNode: document.body,\n    //   startFromEldestChild: true\n    //   startNode: document.getElementById('start') // optional\n    // };\n\n    if (startFromEldestChild && !parentNode)\n        throw new Error(\"Need parentNode to crawl up single child\");\n\n    if (!node || !(node instanceof Node || node?.commonAncestorContainer))\n        throw new Error(\"No node to crawl\");\n\n    let outputNodes = [],\n        nodeIsRange = !!node.commonAncestorContainer,\n        commonContainer = null,\n        parentAnchor;\n\n    if (parentNode && parentNode instanceof Node && parentNode?.nodeType === 1)\n        parentAnchor = parentNode;\n\n    if (nodeIsRange) {\n        commonContainer = node.commonAncestorContainer;\n    } else commonContainer = node;\n\n    commonContainer =\n        commonContainer.nodeType === 3\n            ? commonContainer?.parentNode || commonContainer\n            : commonContainer;\n\n    if (startFromEldestChild)\n        commonContainer = climbUpToEldestParent(\n            commonContainer,\n            parentNode,\n            true\n        );\n\n    if (parentAnchor) {\n        while (\n            commonContainer.nodeType === 3 ||\n            (commonContainer !== parentAnchor &&\n                commonContainer.parentNode &&\n                commonContainer.parentNode !== parentAnchor)\n        )\n            commonContainer = commonContainer.parentNode;\n    }\n\n    /** crawl order below (outputs node on the way)\n     *  If 'BREAK' is returned, the node is not saved in outputNode\n     *\n     *  start   ->  [                   end\n     *                  |               ^ (finish)\n     *                  v               | (outputNode)\n     *              outputNode  ->  outputNode\n     *\n     *  NOTE: Will not crawl when node is textNode\n     */\n\n    if (commonContainer.nodeType === 3) {\n        outputNodes.push(run(commonContainer));\n\n        return { nodes: outputNodes, commonContainer };\n    }\n\n    let id, uniqueId;\n    if (commonContainer.nodeType === 1) {\n        uniqueId =\n            commonContainer.id ||\n            (() => {\n                id = generateId(\"crawl\");\n                commonContainer.id = id;\n                return id;\n            })();\n    }\n\n    let crawl =\n        (startNode instanceof Node ? startNode : null) ||\n        (nodeIsRange ? node.startContainer : commonContainer.childNodes[0]);\n    let endNode = nodeIsRange\n        ? node.endContainer\n        : commonContainer.childNodes[\n        commonContainer.childNodes.length\n            ? commonContainer.childNodes.length - 1\n            : 0\n        ];\n\n    let withInRange = (cwl) => {\n        if (!cwl || !(cwl instanceof Node)) return false;\n        if (cwl.nodeType === 1)\n            return cwl.id !== uniqueId && cwl.parentNode?.closest(\"#\" + uniqueId);\n        else if (cwl.nodeType === 3)\n            return cwl.parentNode && cwl.parentNode?.closest(\"#\" + uniqueId);\n        else return false;\n    };\n    let diving = false;\n    while (withInRange(crawl)) {\n        console.log({ crawl })\n        if (!diving && crawl.nodeType === 1 && crawl.childNodes.length) {\n            // dive down to deepest child's first crawl\n            crawl = crawl.childNodes[0];\n        } else if (crawl) {\n            diving = true;\n            // entering the deepest elements first child.\n\n            if (typeof run === \"function\") crawl = run(crawl);\n            if (crawl === \"BREAK\") break;\n\n            if (withInRange(crawl))\n                outputNodes.push(crawl);\n\n            /**\n             * Climb up the node if the node doesn't have any next siblings\n             * Stop when it hits the commonContainer\n             */\n            if (\n                crawl.nextSibling\n            ) {\n                crawl = crawl.nextSibling;\n            } else if (crawl.parentNode) {\n                if (crawl.parentNode === commonContainer) {\n                    crawl = crawl.nextSibling;\n                    diving = false;\n                }\n                else {\n                    crawl = crawl.parentNode;\n                }\n            }\n            else {\n                break;\n            }\n        }\n    }\n\n    if (id) commonContainer.removeAttribute(\"id\");\n\n    return { node: outputNodes, commonContainer };\n}\n\nfunction generateId(option) {\n    let limit = 12;\n    let prefix = \"\";\n\n    if (typeof option === \"number\") limit = option;\n    else if (typeof option === \"string\") prefix = `${option}_`;\n\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n\n    let text = \"\";\n    for (let i = 0; i < limit - 6; i++)\n        text += possible.charAt(\n            Math.floor(Math.random() * (possible.length - 1))\n        );\n\n    const numb = new Date().getTime().toString().substring(7, 13); // SECOND, MILLISECOND\n\n    return prefix + numb + text;\n}\n\nfunction climbUpToEldestParent(node, wrapper, singleChildParent = false, callback) {\n    callback =\n        callback ||\n        ((n) => {\n            return n;\n        });\n\n    if (!(wrapper instanceof Node) || wrapper?.nodeType === 3)\n        throw new Error(\"invalid wrapper node\");\n\n    let id;\n    let uniqueId =\n        wrapper.id ||\n        (() => {\n            id = generateId(\"eldest\");\n            wrapper.id = id;\n            return id;\n        })();\n    // on single parent mode climb up if parent has only 1 child or 2 child with zero space text\n    function isSingleChildParent(n) {\n        if (!n || n.nodeType === 3) return false;\n\n        let childrenCount = n?.children?.length;\n        return (\n            childrenCount === 0 ||\n            (() => {\n                let sweep = n.childNodes.length;\n                let divCount = 0;\n                let iHaveText = false;\n\n                while (sweep--) {\n                    let s = n.childNodes[sweep];\n\n                    if (\n                        s.nodeType === 3 &&\n                        s.textContent.length > 0 &&\n                        s.textContent !== \"\\u200B\"\n                    )\n                        iHaveText = true;\n                    else if (s.nodeType === 1 && s.nodeName !== \"BR\") divCount++;\n\n                    // if (divCount > 1 || divCount && iHaveText)\n                    if ((divCount > 1 && !iHaveText) || (divCount && iHaveText))\n                        return false;\n                }\n\n                return true;\n            })()\n        );\n    }\n    while (\n        node?.id !== uniqueId &&\n        node.parentNode &&\n        node.parentNode.closest(\"#\" + uniqueId) &&\n        node.parentNode.id !== uniqueId &&\n        (singleChildParent ? isSingleChildParent(node?.parentNode) : true)\n    ) {\n        let cb = callback(node.parentNode);\n\n        if (!cb || cb === \"BREAK\") break;\n\n        node = cb;\n    }\n\n    if (id) wrapper.removeAttribute(\"id\");\n\n    return node;\n}\n\nexport { adjustSelection, nodeCrawler, generateId, climbUpToEldestParent };","const hashtag_regex =\n    /#[\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC\\w-]+(?:\\+[\\w-]+)*/g;\nconst hashtag_stopper_regex =\n    /[^\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC\\w-]/g;\nconst urllink_regex =\n    /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})/gi;\n\nconst regexr = {\n    hashtag: hashtag_regex,\n    hashtag_stopper: hashtag_stopper_regex,\n    urllink: urllink_regex,\n};\n\nfunction generateId(option) {\n    let limit = 12;\n    let prefix = \"\";\n\n    if (typeof option === \"number\") limit = option;\n    else if (typeof option === \"string\") prefix = `${option}_`;\n\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n\n    let text = \"\";\n    for (let i = 0; i < limit - 6; i++)\n        text += possible.charAt(\n            Math.floor(Math.random() * (possible.length - 1))\n        );\n\n    const numb = new Date().getTime().toString().substring(7, 13); // SECOND, MILLISECOND\n\n    return prefix + numb + text;\n}\n\nexport { regexr, generateId };","import { ColorMangle } from \"colormangle\";\nimport { adjustSelection, nodeCrawler, climbUpToEldestParent } from \"./selectors.js\";\nimport { regexr, generateId } from \"./util.js\";\n// Add debouncing for frequent operations like selection changes\nclass Wysiwyg4All {\n  constructor(option) {\n    let {\n      elementId = \"\",\n      editable = true,\n      placeholder = \"\",\n      spellcheck = false,\n      highlightColor = \"teal\",\n      html = \"\",\n      callback,\n      fontSize = {\n        desktop: \"18px\",\n        tablet: \"16px\",\n        phone: \"14px\",\n\n        h1: 4.2,\n        h2: 3.56,\n        h3: 2.92,\n        h4: 2.28,\n        h5: 1.64,\n        h6: 1.15,\n        small: 0.8,\n      },\n      lastLineBlank = false,\n      hashtag = false,\n      urllink = false,\n      logMutation = false,\n      logExecution = false,\n    } = option;\n\n    this.hashtag = hashtag;\n    this.urllink = urllink;\n    this.logMutation = logMutation;\n    this.logExecution = logExecution;\n    this.fontSizeCssVariable = {};\n\n    if (typeof fontSize === \"number\")\n      this.fontSizeCssVariable = {\n        \"--wysiwyg-font-desktop\": `${fontSize}`,\n        \"--wysiwyg-font-tablet\": `${fontSize}`,\n        \"--wysiwyg-font-phone\": `${fontSize}`,\n      };\n    else if (typeof fontSize === \"object\" && Object.keys(fontSize).length) {\n      let hold;\n      let keyArr = [\"desktop\", \"tablet\", \"phone\"];\n\n      for (let k of keyArr) {\n        if (fontSize[k]) {\n          hold = fontSize[k];\n          if (typeof hold === \"number\") hold = `${hold}px`;\n        }\n        this.fontSizeCssVariable[`--wysiwyg-font-${k}`] = `${hold}`;\n      }\n    }\n\n    if (!elementId || typeof elementId !== \"string\")\n      throw new Error(\"The wysiwyg element should have an ID\");\n    elementId = elementId[0] === \"#\" ? elementId.substring(1) : elementId;\n\n    this.html = html;\n    this.elementId = elementId[0] === \"#\" ? elementId.substring(1) : elementId;\n    this.placeholder = placeholder;\n    this.spellcheck = spellcheck;\n    this.lastLineBlank = lastLineBlank;\n\n    if (typeof highlightColor === \"string\")\n      highlightColor = new ColorMangle(highlightColor).color;\n\n    this.colorScheme = highlightColor;\n    this.callback = callback || null;\n\n    this.image_array = [];\n    this.hashtag_array = [];\n    this.urllink_array = [];\n    this.custom_array = [];\n\n    this.blockElement_queryArray = [\n      \"HR\",\n      \"BLOCKQUOTE\",\n      \"UL\",\n      \"OL\",\n      \"._media_\",\n      \"._custom_\",\n    ];\n    this.specialTextElement_queryArray = [\"._hashtag_\", \"._urllink_\"];\n    this.restrictedElement_queryArray = [\"._media_\", \"._custom_\"];\n    this.textAreaElement_queryArray = [\"BLOCKQUOTE\", \"LI\"];\n    this.textBlockElement_queryArray = [\"P\", \"LI\", \"TD\", \"TH\"]; //, \"TD\", \"TH\", '._color', '._small', '._h1`', '._h2', '._h3', '._h4', '._h5', '._h6', '._b', '._i', '._u', '._del'\n    this.ceilingElement_queryArray = [\n      \"UL\",\n      \"OL\",\n      \"BLOCKQUOTE\",\n      `#${elementId}`,\n      \"TD\",\n      \"TH\",\n    ];\n    this.unSelectable_queryArray = [\n      \"._media_\",\n      \"._custom_\",\n      \"._hashtag_\",\n      \"._urllink_\",\n      \"HR\",\n    ];\n    this.styleAllowedElement_queryArray = [\n      \"._color\",\n      `#${elementId}`,\n      \"._hashtag_\",\n      \"._urllink_\",\n      \"TD\",\n      \"TH\",\n    ]; // ALLOWED ELEMENTS FOR STYLE ATTRIBUTE <... style=\"...\">\n    this.alignClass = [\"_alignCenter_\", \"_alignRight_\"];\n\n    this.hashtag_flag = false;\n    this.urllink_flag = false;\n    this.range_backup = null;\n\n    this.commandTracker = {};\n    this.range = null;\n    this.isRangeDirectionForward = true;\n    this.insertTabPending_tabString = \"\";\n    this.removeSandwichedLine_array = [];\n    this.lastKey = null;\n\n    //  setup div\n    this.element = document.getElementById(this.elementId);\n    if (!this.element) throw `element #${this.elementId} is null`;\n\n    this.element.innerHTML = \"\";\n\n    this.cssVariable = new ColorMangle().colorScheme(this.colorScheme);\n    Object.assign(this.cssVariable, this.fontSizeCssVariable);\n\n    for (const v in this.cssVariable)\n      this.element.style.setProperty(v, this.cssVariable[v]);\n\n    this.elementComputedStyle = window.getComputedStyle(this.element);\n    this.defaultFontColor = new ColorMangle(\n      this.cssVariable[\"--content-text\"]\n    ).hex();\n    this.highlightColor = new ColorMangle(\n      this.cssVariable[\"--content-focus\"]\n    ).hex();\n\n    if (!this.element.classList.contains(\"_wysiwyg4all\"))\n      this.element.classList.add(\"_wysiwyg4all\");\n\n    this.setPlaceholder(this.placeholder);\n    this.setSpellcheck(this.spellcheck);\n\n    //  re-adjust min-height depending on padding\n    let paddingB = this.elementComputedStyle.paddingBottom;\n    let paddingT = this.elementComputedStyle.paddingTop;\n    let borderT = this.elementComputedStyle.borderTopWidth;\n    let borderB = this.elementComputedStyle.borderBottomWidth;\n\n    this.element.style.minHeight = `calc(${paddingB} + ${paddingT} + ${borderT} + ${borderB} + 1.6em)`;\n\n    //  command style tag\n    const command = {\n      //  [<targetClassName>, <cssProperty>, [<string: counter tag | class name>]]\n      h1: [\"_h1\", \"fontSize\", [\"_small\", \"_h2\", \"_h3\", \"_h4\", \"_h5\", \"_h6\"]],\n      h2: [\"_h2\", \"fontSize\", [\"_small\", \"_h1\", \"_h3\", \"_h4\", \"_h5\", \"_h6\"]],\n      h3: [\"_h3\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h4\", \"_h5\", \"_h6\"]],\n      h4: [\"_h4\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h3\", \"_h5\", \"_h6\"]],\n      h5: [\"_h5\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h3\", \"_h4\", \"_h6\"]],\n      h6: [\"_h6\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h3\", \"_h4\", \"_h5\"]],\n      italic: [\"_i\", \"fontStyle\"],\n      small: [\n        \"_small\",\n        \"fontSize\",\n        [\"_h1\", \"_h2\", \"_h3\", \"_h4\", \"_h5\", \"_h6\", \"_b\"],\n      ],\n      bold: [\"_b\", \"fontWeight\", [\"_small\"]],\n      underline: [\"_u\", \"textDecoration\", [\"_del\"]],\n      strike: [\"_del\", \"textDecoration\", [\"_u\"]],\n      color: [\"_color\", \"color\"],\n    };\n\n    const fontSizeRatio = {\n      //  should always be the same em value as css\n      h1: fontSize.h1 || 4.2,\n      h2: fontSize.h2 || 3.56,\n      h3: fontSize.h3 || 2.92,\n      h4: fontSize.h4 || 2.28,\n      h5: fontSize.h5 || 1.64,\n      h6: fontSize.h6 || 1.15,\n      small: fontSize.small || 0.8,\n    };\n\n    // // font size variables\n    // --wysiwyg-h1: calc(var(--wysiwyg-font) * 4.2);\n    // --wysiwyg-h2: calc(var(--wysiwyg-font) * 3.56);\n    // --wysiwyg-h3: calc(var(--wysiwyg-font) * 2.92);\n    // --wysiwyg-h4: calc(var(--wysiwyg-font) * 2.28);\n    // --wysiwyg-h5: calc(var(--wysiwyg-font) * 1.64);\n    // --wysiwyg-h6: calc(var(--wysiwyg-font) * 1.15);\n    // --wysiwyg-small: calc(var(--wysiwyg-font) * 0.8);\n    for (const [tag, ratio] of Object.entries(fontSizeRatio)) {\n      if (typeof ratio === \"number\") {\n        this.element.style.setProperty(\n          `--wysiwyg-${tag}`,\n          `calc(var(--wysiwyg-font) * ${ratio})`\n        );\n      } else if (typeof ratio === \"string\") {\n        if (ratio.includes(\"px\")) {\n          this.element.style.setProperty(`--wysiwyg-${tag}`, ratio);\n        } else if (ratio.includes(\"em\") || ratio.includes(\"rem\")) {\n          let emSize = parseFloat(ratio);\n          if (emSize > 0) {\n            this.element.style.setProperty(\n              `--wysiwyg-${tag}`,\n              `calc(var(--wysiwyg-font) * ${emSize})`\n            );\n          }\n        }\n      }\n    }\n\n    this.styleTagOfCommand = {};\n    this.counterTagOf = {};\n    this.cssPropertyOf = {};\n    this.cssPropertyChecker = {\n      textDecoration: (v) => {\n        //  v = <string: value from computedStyle>\n        if (v.includes(\"underline\")) return \"underline\";\n        else if (v.includes(\"line-through\")) return \"strike\";\n\n        return false;\n      },\n      fontSize: (v) => {\n        //  v = <string: value from computedStyle>\n        let documentFontSize = parseFloat(this.elementComputedStyle.fontSize);\n        let nodeFontSize = parseFloat(v);\n        for (let tag in fontSizeRatio) {\n          let f_size = fontSizeRatio[tag];\n\n          if (typeof f_size === \"number\") {\n            //  precision\n            let compare_size = documentFontSize * f_size;\n            let f_size_high = compare_size + 0.01;\n            let f_size_low = compare_size - 0.01;\n            if (f_size_high > nodeFontSize && f_size_low < nodeFontSize)\n              return tag;\n          } else if (typeof f_size === \"string\") {\n            if (f_size.includes(\"px\")) {\n              if (v === f_size) return tag;\n            } else if (f_size.includes(\"em\") || f_size.includes(\"rem\")) {\n              let emSize = parseFloat(f_size);\n              if (emSize > 0) {\n                let compare_size = documentFontSize * emSize;\n                let f_size_high = compare_size + 0.01;\n                let f_size_low = compare_size - 0.01;\n                if (f_size_high > nodeFontSize && f_size_low < nodeFontSize)\n                  return tag;\n              }\n            }\n          }\n        }\n        return false;\n      },\n      fontStyle: (v) => {\n        //  v = <string: value from computedStyle>\n        if (v.includes(\"italic\")) return \"italic\";\n        return false;\n      },\n    };\n\n    for (let c in command) {\n      this.commandTracker[c] = false;\n      this.styleTagOfCommand[c] = command[c][0];\n      this.cssPropertyOf[command[c][0]] = command[c][1];\n      if (!this.cssPropertyChecker.hasOwnProperty(command[c][1]))\n        this.cssPropertyChecker[command[c][1]] = c;\n      if (command[c][2]) this.counterTagOf[command[c][0]] = command[c][2];\n    }\n\n    /**\n         this.styleTagOfCommand = {\n            [commandKey]: <targetClassName>\n         };\n\n         this.cssPropertyChecker = {\n            [cssPropertyKey]: <commandKey | function(<cssValue>)>\n         };\n\n         this.cssPropertyOf = {\n            [targetClassName]: <cssPropertyKey>\n         };\n\n         this.counterTagOf = {\n            [targetClassName]: [<counterClassName>]\n         };\n\n         this.commandTracker = {\n            [commandKey]: <boolean>\n         };\n\n         console.log({\n            styleTagOfCommand: this.styleTagOfCommand,\n            cssPropertyChecker: this.cssPropertyChecker,\n            cssPropertyOf: this.cssPropertyOf,\n            counterTagOf: this.counterTagOf,\n            commandTracker: this.commandTracker\n         });\n         */\n\n    this.loadHTML(this.html, editable).catch((err) => {\n      throw err;\n    });\n  }\n\n  _wrapNode(node, wrapper, appendWhole = false) {\n    if (this.logExecution)\n      console.log(\"_wrapNode()\", { node, wrapper, appendWhole });\n    if (!(node instanceof Node)) return;\n\n    if (!node.parentNode) throw new Error(\"can't unwrap document fragment\");\n\n    // save current range\n    let sel = window.getSelection();\n    let range = sel.getRangeAt(0);\n    let start = null;\n    let startOffset = range.startOffset;\n    let end = null;\n    let endOffset = range.endOffset;\n\n    const withinRange = (n) => {\n      if (range.startContainer === n) {\n        start = n;\n      }\n      if (range.endContainer === n) {\n        end = n;\n      }\n    };\n\n    if (node.nodeType === 1) {\n      nodeCrawler(\n        (n) => {\n          withinRange(n);\n          return n;\n        },\n        { node }\n      );\n    } else withinRange(node);\n\n    if (wrapper) {\n      // place the wrapper\n      node.parentNode.insertBefore(wrapper, node);\n    }\n\n    // append node\n    if (node.nodeType === 3) {\n      if (wrapper) wrapper.append(node);\n      else throw new Error(\"no wrapper for text content\");\n    } else if (appendWhole) wrapper.append(node);\n    else\n      while (node.childNodes[0]) {\n        let child = node.childNodes[0];\n        if (wrapper) wrapper.append(child);\n        else node.parentNode.insertBefore(child, node);\n      }\n\n    let stripped;\n    if (node.nodeType === 1 && !appendWhole) {\n      let n = wrapper || node;\n      let p = n.parentNode;\n      stripped = node.previousSibling;\n      p.removeChild(node);\n    }\n\n    // restore range\n    if ((stripped || node).textContent && (start || end)) {\n      if (start && start === end && startOffset === endOffset)\n        range = adjustSelection({\n          node: stripped || node,\n          position: startOffset,\n        }, this.ceilingElement_queryArray);\n      else\n        range = adjustSelection({\n          node: [start, end],\n          position: [startOffset, endOffset],\n        }, this.ceilingElement_queryArray);\n    }\n\n    this.range = range;\n    return { node: stripped || node, range };\n  }\n\n  _getStartEndLine(\n    range = this.range,\n    element = this.element,\n    getInbetween = false\n  ) {\n    if (this.logExecution)\n      console.log(\"_getStartEndLine()\", { range, element });\n    if (!range) return [null, null, null];\n\n    let startLine = climbUpToEldestParent(range.startContainer, element);\n    let endLine = climbUpToEldestParent(range.endContainer, element);\n\n    let inBetween = [];\n    if (getInbetween) {\n      // collect all the lines in between startLine and endLine. line is a block element\n      let currentLine = startLine.nextSibling;\n      while (currentLine && currentLine !== endLine) {\n        if (\n          currentLine.nodeType === 1 &&\n          this.blockElement_queryArray.some((q) =>\n            currentLine.matches(this._classNameToQuery(q))\n          )\n        ) {\n          inBetween.push(currentLine);\n        }\n        currentLine = currentLine.nextSibling;\n      }\n    }\n\n    return [startLine, endLine, inBetween];\n  }\n\n  _isThereContentEditableOverMyHead(node, element = this.element) {\n    if (node && node !== this.element) {\n      let flyup = node;\n      while (flyup && this.element !== flyup) {\n        if (flyup.getAttribute(\"contenteditable\") === \"true\") return true;\n\n        flyup = flyup.parentNode;\n      }\n    }\n    return false;\n  }\n\n  // Add browser-specific normalization\n  _normalizeBrowserQuirks() {\n    // Handle Firefox's extra <br> tags\n    if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {\n      nodeCrawler((node) => {\n        if (node.nodeName === 'BR' &&\n          (!node.nextSibling || node.nextSibling.nodeName === 'BR')) {\n          node.remove();\n        }\n        return node;\n      }, { node: this.element });\n    }\n\n    // Handle Safari's selection quirks\n    if (navigator.userAgent.toLowerCase().indexOf('safari') > -1) {\n      // Safari-specific fixes\n    }\n  }\n\n  _isSelectionTrespassRestrictedRange(\n    range = this.range,\n    element = this.element\n  ) {\n    if (!range) {\n      if (this.logExecution)\n        console.log(\"_isSelectionTrespassRestrictedRange():true\", {\n          range,\n          element,\n        });\n      return true;\n    }\n\n    let { commonAncestorContainer, startContainer, endContainer, startLine, endLine, inBetween } = range;\n    let restrict = this.restrictedElement_queryArray;\n\n    if (startLine === endLine) {\n      commonAncestorContainer =\n        commonAncestorContainer.nodeType === 3\n          ? commonAncestorContainer.parentNode\n          : commonAncestorContainer;\n      for (let r of restrict) {\n        let cl = commonAncestorContainer.closest(this._classNameToQuery(r));\n        if (cl) {\n          let isThere = this._isThereContentEditableOverMyHead(\n            commonAncestorContainer,\n            element\n          );\n          if (!isThere) {\n            return true;\n          }\n        }\n      }\n    } else if (inBetween?.length) {\n      for (let i = 0; i < inBetween.length; i++) {\n        for (let r of restrict) {\n          if (inBetween[i].closest(this._classNameToQuery(r))) {\n            let isThere = this._isThereContentEditableOverMyHead(inBetween[i]);\n            if (!isThere) {\n              return true;\n            }\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  _classNameToQuery(q) {\n    if (this.logExecution) console.log(\"_classNameToQuery()\", { q });\n    if (q.includes(\"_stop\") && q[0] !== \".\") return \".\" + q;\n    return q[0] === \"_\" ? \".\" + q : q;\n  }\n\n  _createEmptyParagraph(append) {\n    if (this.logExecution) console.log(\"_createEmptyParagraph()\", { append });\n    let p = document.createElement(\"p\");\n\n    if (append && typeof append === \"string\")\n      append = document.createTextNode(append);\n\n    p.append(append || document.createTextNode(\"\"));\n\n    if (!append) p.append(document.createElement(\"br\"));\n\n    return p;\n  }\n\n  _trackStyle(n, cls) {\n    if (this.logExecution) console.log(\"_trackStyle()\", { n, cls });\n    let commandTracker = {};\n    let style = window.getComputedStyle(n);\n\n    for (let c of this.alignClass) {\n      if (n.closest(\".\" + c))\n        commandTracker[c.substring(1, c.length - 1)] = true;\n    }\n\n    let checker = (sp) => {\n      let key = this.cssPropertyChecker[sp];\n      if (typeof key === \"function\") {\n        key = key(style[sp]);\n        if (key) {\n          if (cls) return key;\n          commandTracker[key] = true;\n        }\n      } else if (sp === \"color\" && style[sp]) {\n        let col =\n          style[sp][0] === \"#\" ? style[sp] : new ColorMangle(style[sp]).hex();\n\n        if (col !== this.defaultFontColor) {\n          if (cls) return col;\n          commandTracker[key] = col;\n        }\n      } else if (\n        style[sp] !== this.elementComputedStyle[sp] &&\n        this._isTextElement(n)\n      ) {\n        if (cls) return true;\n        commandTracker[key] = true;\n      }\n      return false;\n    };\n\n    if (cls) return checker(this.cssPropertyOf[cls.toLowerCase()]);\n\n    for (let sp in this.cssPropertyChecker) {\n      checker(sp);\n    }\n\n    return commandTracker;\n  }\n\n  _lastLineBlank(force) {\n    if (this.logExecution) console.log(\"_lastLineBlank()\", { force });\n    if (this.lastLineBlank || force) {\n      let lastLine = this.element.lastChild;\n      if (\n        lastLine.nodeName !== \"P\" ||\n        (lastLine.nodeName === \"P\" &&\n          lastLine.textContent &&\n          lastLine.textContent !== \"\\u200B\")\n      ) {\n        this.element.append(this._createEmptyParagraph());\n      }\n    }\n  }\n\n  _selectionchange = () => {\n    let sel = window.getSelection();\n\n    let anchorElement =\n      sel.anchorNode?.nodeType === 3\n        ? sel.anchorNode.parentNode\n        : sel.anchorNode;\n\n    let focusElement =\n      sel.focusNode?.nodeType === 3\n        ? sel.focusNode.parentNode\n        : sel.focusNode;\n\n    if (anchorElement.closest(`#${this.elementId}`) && focusElement.closest(`#${this.elementId}`)) {\n      let lastChild = this.element.lastChild;\n      if (!lastChild) {\n        // Wysiwyg is empty\n        lastChild = this._createEmptyParagraph();\n        this.element.appendChild(lastChild);\n\n        // Adjust selection\n        this.range = adjustSelection({\n          node: lastChild,\n          position: true,\n        }, this.ceilingElement_queryArray);\n      }\n      else {\n        this.range = adjustSelection(null);\n      }\n    }\n    else {\n      this.range = null;\n      this.commandTracker = {};\n      return;\n    }\n\n    //  track commandTracker\n    let commandTracker = {};\n    for (let style in this.styleTagOfCommand) {\n      commandTracker[style] = false;\n    }\n\n    let [startLine, endLine, inBetween] = this._getStartEndLine(\n      this.range,\n      this.element,\n      true\n    );\n    this.range.startLine = startLine;\n    this.range.endLine = endLine;\n    this.range.inBetween = inBetween;\n\n    let restricted = this.restrictedElement_queryArray.concat(\n      this.specialTextElement_queryArray\n    );\n\n    let crawlResult = nodeCrawler(\n      (node) => {\n        if (\n          (node.nodeType === 1 && node.closest(\"blockquote\")) ||\n          (node.nodeType === 3 && node.parentNode.closest(\"blockquote\"))\n        )\n          commandTracker.quote = true;\n\n\n        for (let c of restricted) {\n          if (node.nodeType === 3\n            ? node.parentNode.closest(c)\n            : node.nodeType === 1\n              ? node.closest(c)\n              : !(node instanceof Node)) {\n            return node;\n          }\n        }\n\n        if (\n          node.nodeType === 3 ||\n          node.nodeName === \"BR\" ||\n          (node.nodeType === 1 &&\n            node.childNodes.length === 1 &&\n            (node.childNodes[0].nodeName === \"BR\" ||\n              node.childNodes[0].nodeType === 3))\n        ) {\n          let n =\n            node.nodeType === 3 || node.nodeName === \"BR\"\n              ? node.parentNode\n              : node;\n\n          let comm = this._trackStyle(n);\n          for (let c in comm) commandTracker[c] = comm[c];\n        }\n        return node;\n      },\n      { node: this.range, parentNode: this.element }\n    );\n\n    if (!crawlResult.node.length) {\n      let comm = this._trackStyle(this.range.startContainer);\n      for (let c in comm) commandTracker[c] = comm[c];\n    }\n\n    this.commandTracker = commandTracker;\n    let caratPosition;\n    let caratEl = this.range.endContainer || this.range.startContainer;\n\n    if (caratEl.nodeType === 3)\n      caratPosition = this.range.getBoundingClientRect();\n    else if (caratEl.nodeType === 1)\n      caratPosition = caratEl.getBoundingClientRect();\n\n    this._callback({\n      commandTracker,\n      range: this.range,\n      caratPosition,\n    }).catch((err) => console.error(err));\n    this._lastLineBlank();\n  }\n\n  _setEventListener(listen) {\n    if (this.logExecution) console.log(\"_setEventListener()\", { listen });\n    /**\n     * keydown -> observer(dom change) -> selection change -> click | keyup\n     */\n\n    document.removeEventListener(\"selectionchange\", this._selectionchange);\n    this.imgInput = null;\n    if (this.element) {\n      this.element.removeEventListener(\"keydown\", this._keydown);\n      this.element.removeEventListener(\"mousedown\", this._normalize);\n      window.removeEventListener(\"mousedown\", this._normalize);\n      this.element.removeEventListener(\"paste\", this._paste);\n      this.element.removeEventListener(\"keyup\", this._keyup);\n    }\n\n    if (!listen) return;\n\n    //  image selector\n    let imgInput = document.createElement(\"input\");\n    for (const [key, value] of Object.entries({\n      id: generateId(\"imageInput\"),\n      type: \"file\",\n      accept: \"image/gif,image/png,image/jpeg,image/webp\",\n      hidden: true,\n      multiple: true,\n    })) {\n      imgInput.setAttribute(key, value);\n    }\n\n    this.imgInput = imgInput;\n    this.imgInput.addEventListener(\"change\", (e) => {\n      this._imageSelected(e).catch((err) => {\n        console.error(err);\n      });\n    });\n\n    this._keydown = function (e) {\n      // if (this._isSelectionTrespassRestrictedRange()) {\n      //   e.preventDefault();\n      //   return;\n      // };\n\n      if (!this.range) return;\n      let { startContainer, startOffset, collapsed, startLine, endLine, inBetween } =\n        this.range;\n\n      let key = e.key.toUpperCase();\n      let shift = e.shiftKey;\n\n      this.lastKey = key;\n\n      if (key === \"ENTER\" && e.shiftKey) {\n        // prevent shift+enter\n        if (!this.range.endLine.closest(\"LI\")) e.preventDefault();\n        return;\n      }\n\n      // delete key\n      if ([\"BACKSPACE\", \"DELETE\"].includes(key)) {\n        if (\n          (!this.element.textContent &&\n            this.element.childNodes.length <= 1 &&\n            this._isTextElement(this.element.childNodes[0]) &&\n            this.element.childNodes[0] === startLine)\n          ||\n          this.element.childNodes.length === 0\n        ) {\n          if (this.logExecution) console.log(\"nothing to delete\");\n          // there is nothing to delete\n          e.preventDefault();\n          return;\n        }\n\n        if (startLine === this.element || endLine === this.element) {\n          e.preventDefault();\n          return;\n        }\n\n        let stc = this.range.startContainer;\n        if (this.range.collapsed) {\n          if (this.logExecution) console.log(\"range is collapsed\");\n          let block = (stc.nodeType === 3 ? stc.parentNode : stc).closest(\n            \"blockquote\"\n          );\n          if (\n            block &&\n            block.childNodes[0] === climbUpToEldestParent(stc, block) &&\n            this.range.startOffset === 0\n          ) {\n            // if the block is empty and the cursor is on the first offset position within the blockquote\n            // cursor is on the first offset position within the blockquote\n\n            if (this.logExecution)\n              console.log(\n                \"block is empty and the cursor is on the first offset position within the blockquote\"\n              );\n            e.preventDefault();\n\n            this.command(\"quote\");\n            return;\n          }\n\n          if (this.range.startOffset === 0 || this.range.startOffset === 1 && (stc.textContent[0] === \"\\u200B\" || stc.textContent.length === 0)) {\n            let prevsib = this.range.startLine.previousSibling;\n            for (let cl of this.unSelectable_queryArray) {\n              // check if startLine element has a class name cl\n              // if cl starts with . then it's a class name\n              if (cl[0] === \".\") {\n                cl = cl.substring(1);\n                if (prevsib && prevsib.classList.contains(cl))\n                  prevsib.remove();\n              }\n              else {\n                if (prevsib && prevsib.tagName === cl)\n                  prevsib.remove();\n              }\n            }\n          }\n        }\n        if (startLine !== endLine) {\n          for (let cl of this.unSelectable_queryArray) {\n            // check if startLine element has a class name cl\n            // if cl starts with . then it's a class name\n            if (cl[0] === \".\") {\n              cl = cl.substring(1);\n              if (startLine.classList.contains(cl))\n                startLine.remove();\n              if (endLine.classList.contains(cl))\n                endLine.remove();\n            }\n            else {\n              if (startLine.tagName === cl)\n                startLine.remove();\n              if (endLine.tagName === cl)\n                endLine.remove();\n            }\n          }\n        }\n        return;\n      }\n\n      //  hashtag flag\n      if (key === \"#\" && !this.hashtag_flag) {\n        this.hashtag_flag = true;\n        return;\n      }\n\n      //  url flag\n      if ([\":\", \"/\", \".\"].includes(key) && !this.urllink_flag) {\n        this.urllink_flag = true;\n        return;\n      }\n\n      // insert hashtag | urllink\n      if (\n        (this.hashtag_flag || this.urllink_flag) &&\n        ([\" \", \"ENTER\", \"TAB\"].includes(key) || key.includes(\"ARROW\"))\n      ) {\n        this._replaceText();\n        // return;\n      }\n\n      if (key === \"TAB\") {\n        e.preventDefault();\n        let sweep_array = [];\n\n        if (!collapsed) {\n          let sweep = startLine;\n          while (sweep && sweep !== endLine) {\n            sweep_array.push(sweep);\n            sweep = sweep.nextSibling;\n          }\n          sweep_array.push(endLine);\n        }\n\n        if (shift) {\n          // delete indent\n          let hasIndent = false;\n          let diveAndRemoveTab = (n) => {\n            while (n.childNodes[0]) {\n              n = n.childNodes[0];\n\n              while (n.nodeType === 3 && !n.textContent) n = n.nextSibling;\n\n              if (n.nodeType === 3 && n.textContent[0] === \"\\t\") {\n                hasIndent = true;\n                n.textContent = n.textContent.substring(1);\n                break;\n              }\n            }\n          };\n          if (sweep_array.length) {\n            for (let n of sweep_array) {\n              if (n.textContent[0] === \"\\t\") diveAndRemoveTab(n);\n            }\n            if (hasIndent)\n              adjustSelection({\n                node: [startLine, endLine],\n                position: [true, false],\n              }, this.ceilingElement_queryArray);\n          } else if (startLine.textContent[0] === \"\\t\") {\n            let lineOffset = (line, container, containerOffset) => {\n              if (line === container) return containerOffset;\n\n              nodeCrawler(\n                (n) => {\n                  if (container === n) return \"BREAK\";\n\n                  if (n.nodeType === 3 && n.textContent.length)\n                    containerOffset += n.textContent.length;\n\n                  return n;\n                },\n                { node: line }\n              );\n              return containerOffset;\n            };\n\n            let offset =\n              lineOffset(startLine, startContainer, startOffset) - 1;\n            offset = offset < 0 ? 0 : offset;\n\n            diveAndRemoveTab(startLine);\n            if (hasIndent)\n              adjustSelection({ node: startLine, position: offset }, this.ceilingElement_queryArray);\n          }\n        } else {\n          // indent\n          if (sweep_array.length) {\n            let hasIndent = false;\n            for (let n of sweep_array) {\n              hasIndent = true;\n              let tab = document.createTextNode(\"\\t\");\n              n.insertBefore(tab, n.childNodes[0]);\n            }\n            if (hasIndent)\n              adjustSelection({\n                node: [startLine, endLine],\n                position: [true, false],\n              }, this.ceilingElement_queryArray);\n          } else {\n            let tab = document.createTextNode(\"\\t\");\n            this.range.insertNode(tab);\n            adjustSelection({ node: tab, position: false }, this.ceilingElement_queryArray);\n          }\n        }\n        return;\n      }\n\n      if (key === \"ENTER\") {\n        //  remove zero space\n        if (\n          collapsed &&\n          (startContainer.textContent.includes(\"\\u200B\") ||\n            !startContainer.textContent)\n        ) {\n          nodeCrawler(\n            (n) => {\n              if (\n                n.nodeType === 3 &&\n                (n.textContent === \"\\u200B\" || !n.textContent)\n              ) {\n                n.remove();\n              }\n\n              return n;\n            },\n            {\n              node:\n                startContainer.nodeType === 3\n                  ? startContainer.parentNode\n                  : startContainer,\n            }\n          );\n        }\n\n        if (endLine.textContent[0] === \"\\t\") {\n          for (let s of endLine.textContent) {\n            if (s === \"\\t\") this.insertTabPending_tabString += \"\\t\";\n            else break;\n          }\n        }\n      }\n    }.bind(this);\n\n    this._normalize = function (e) {\n\n      e.stopPropagation();\n      // if (this._isSelectionTrespassRestrictedRange()) return;\n      this.restoreLastSelection();\n      this._normalizeDocument();\n      // this.range_backup = this.range.cloneRange();\n      this._replaceText(true);\n    }.bind(this);\n\n    this._backupSelection = function (e) { \n      // e.stopPropagation();\n      if (this.logExecution) console.log(\"_backupSelection()\");\n      if (this.range) {\n        this.range_backup = this.range.cloneRange();\n      }\n    }\n\n    this._paste = function (e) {\n      e.preventDefault();\n      if (this._isSelectionTrespassRestrictedRange()) return;\n      if (this.range) {\n        if (this._isSelectionTrespassRestrictedRange()) return;\n        let doc = document.createDocumentFragment();\n        doc.textContent = e.clipboardData\n          .getData(\"text/plain\")\n          .replace(/\\n\\n/g, \"\\n\");\n\n        if (doc.textContent.includes(\"#\")) {\n          this.hashtag_flag = true;\n        }\n\n        //  url flag\n        for (let u of [\":\", \"/\", \".\"]) {\n          doc.textContent.includes(u);\n          this.urllink_flag = true;\n        }\n\n        if (!this.range.collapsed) this.range.extractContents();\n        this.range.insertNode(doc);\n      }\n    }.bind(this);\n    this._keyup = function () {\n      if (this.removeSandwichedLine_array.length)\n        while (this.removeSandwichedLine_array.length)\n          this.removeSandwichedLine_array.pop().remove();\n    }.bind(this);\n\n    document.addEventListener(\"selectionchange\", this._selectionchange);\n    this.element.addEventListener(\"keydown\", this._keydown);\n    this.element.addEventListener(\"mouseup\", this._normalize);\n    // this.element.addEventListener('blur', this._normalize);\n    // fuck safari, firefox\n    window.addEventListener(\"mousedown\", this._backupSelection);\n    this.element.addEventListener(\"paste\", this._paste);\n    this.element.addEventListener(\"keyup\", this._keyup);\n  }\n\n  // Current code doesn't properly clean up event listeners\n  destroy() {\n    this.observer.disconnect();\n    document.removeEventListener(\"selectionchange\", this._selectionchange);\n    this.element.removeEventListener(\"keydown\", this._keydown);\n    this.element.removeEventListener(\"mouseup\", this._normalize);\n    window.removeEventListener(\"mousedown\", this._backupSelection);\n    this.element.removeEventListener(\"paste\", this._paste);\n    this.element.removeEventListener(\"keyup\", this._keyup);\n  }\n\n  _observeMutation(track) {\n    if (this.observer) this.observer.disconnect();\n\n    this.observer = null;\n\n    if (!track) return;\n\n    this._elementRemovalObserver = new MutationObserver((mutations) => {\n      for (const mutation of mutations) {\n        for (const removedNode of mutation.removedNodes) {\n          if (removedNode === this.element) {\n            // Element was removed from DOM\n            if (this.logExecution) console.log(\"wysiwyg element removed from DOM\");\n            this.destroy(); // Clean up listeners, observers, etc.\n            // Optionally, emit a callback or event here\n          }\n        }\n      }\n    });\n\n    this._elementRemovalObserver.observe(this.element.parentNode, {\n      childList: true,\n    });\n\n    this.observer = new MutationObserver((mutation_array) => {\n      if (this.logMutation) {\n        let monitor = mutation_array.map((m) => {\n          return {\n            target: m.target.cloneNode(true),\n            type: m.type,\n            name: m.attributeName,\n            added: (() => {\n              let clones = [];\n              for (let a of m.addedNodes) {\n                if (a.nodeType === 3) clones.push(a.textContent);\n                else clones.push(a.cloneNode(true));\n              }\n              return clones;\n            })(),\n            removed: (() => {\n              let clones = [];\n              for (let r of m.removedNodes) {\n                if (r.nodeType === 3) clones.push(r.textContent);\n                else clones.push(r.cloneNode(true));\n              }\n              return clones;\n            })(),\n          };\n        });\n\n        let mutate = [];\n        for (let m of monitor) {\n          if (m.type === \"childList\" || m.attributeName === \"class\")\n            mutate.push(m);\n        }\n\n        if (mutate.length)\n          this._callback({ mutation: mutate }).catch((err) => err);\n      }\n\n      for (const mutation of mutation_array) {\n        /** changes in attributes */\n        if (mutation.type === \"attributes\") {\n          const { target, attributeName } = mutation;\n          if (attributeName === \"class\") {\n            if (\n              target.parentNode &&\n              !target.classList.length &&\n              !(\n                this._isTextBlockElement(target) ||\n                this._isBlockElement(target) ||\n                target.nodeName === \"P\"\n              )\n            ) {\n              // this._unwrapElement(target);\n              this._wrapNode(target);\n            }\n            if (!target.classList.length) target.removeAttribute(\"class\");\n          }\n          //  prevent style attributes\n          if (attributeName === \"style\" && !this._isStyleAllowedElement(target))\n            target.removeAttribute(\"style\");\n          continue;\n        }\n\n        /** changes in node */\n        if (mutation.type === \"childList\") {\n          let mutationTarget = mutation.target;\n\n          /** removed nodes */\n          if (mutation.removedNodes.length) {\n            for (let m of mutation.removedNodes) {\n              /**\n               *  CAUTION!\n               *  changing the order of if statements below can lead to critical flaw\n               *  _custom_ class should always be checked after _urllink_ and _hashtag_\n               */\n\n              let callbackRemoved = (what, m) => {\n                if (!m.id) return;\n\n                let arrIdx = this[`${what}_array`].length;\n                let removed;\n\n                while (arrIdx--) {\n                  let got = this[`${what}_array`][arrIdx];\n                  if (got.elementId === m.id) {\n                    removed = this[`${what}_array`].splice(arrIdx, 1);\n                    break;\n                  }\n                }\n\n                if (removed) {\n                  this._callback({ removed: { [what]: removed } });\n                }\n              };\n\n              if (m?.classList?.contains(\"_media_\")) {\n                // let child = m.childNodes;\n                // let childIdx = child.length;\n                // while (childIdx--) {\n                // let c = child[childIdx];\n\n                // switch (c.nodeName) {\n                switch (m.nodeName) {\n                  case \"IMG\":\n                    // callbackRemoved(\"image\", c);\n                    callbackRemoved(\"image\", m);\n                    break;\n                }\n                // }\n                continue;\n              }\n\n              let toBreak = false;\n              for (let t of [\"hashtag\", \"urllink\", \"custom\"]) {\n                if (m?.id?.includes(t)) {\n                  callbackRemoved(t, m);\n                  toBreak = true;\n                  break;\n                }\n              }\n\n              toBreak = false;\n\n              if (\n                this._isCeilingElement(mutationTarget) &&\n                (() => {\n                  let idx = mutationTarget.childNodes.length;\n                  if (idx)\n                    while (idx--) {\n                      let node = mutationTarget.childNodes[idx];\n                      if (node.nodeType === 1 || node.textContent) {\n                        return false;\n                      }\n                    }\n                  return true;\n                })()\n              ) {\n                mutationTarget.remove();\n                continue;\n              }\n\n              if (\n                this._isTextBlockElement(mutationTarget) &&\n                mutationTarget.childNodes.length === 1 &&\n                this._isUnSelectableElement(mutationTarget.childNodes[0])\n              )\n                mutationTarget.append(document.createTextNode(\"\"));\n            }\n          }\n\n          /** added nodes */\n          if (mutation.addedNodes.length)\n            for (let i of mutation.addedNodes) {\n              let getBr = (n) => {\n                let idx = n?.childNodes?.length;\n                let br = [];\n                while (idx--) {\n                  let c = n.childNodes[idx];\n                  if (c.nodeName === \"BR\") br.push(c);\n                }\n                return br;\n              };\n\n              if (i.nodeType === 3) {\n                // wrap all eldest text node\n                if (this._isCeilingElement(mutationTarget))\n                  this._wrapNode(i, document.createElement(\"p\"));\n                // remove <br> when there is text\n                else if (i.textContent && i.textContent !== \"\\u200B\") {\n                  // prevent br added to line\n                  let br = getBr(mutationTarget);\n                  if (br.length) for (let b of br) b.remove();\n                }\n\n                continue;\n              }\n\n              if (i.nodeType === 1) {\n                if (i.childNodes.length > 0 && i.firstChild.tagName !== \"BR\") {\n                  let br = getBr(mutationTarget);\n                  if (br.length) for (let b of br) b.remove();\n                }\n\n                let node = (() => {\n                  let isWysiwygChild =\n                    i.closest(`#${this.elementId}`) && i.id !== this.elementId;\n                  let isWysiwygEldestChild = (() => {\n                    if (!isWysiwygChild) return false;\n\n                    return this._isCeilingElement(mutationTarget);\n                  })();\n\n                  let ceiling = (() => {\n                    for (let c of this.ceilingElement_queryArray) {\n                      let clo = i.closest(c);\n                      if (clo) return clo;\n                    }\n                    return null;\n                  })();\n\n                  let line = isWysiwygEldestChild\n                    ? i\n                    : isWysiwygChild &&\n                    (() => {\n                      let m = i;\n                      while (m && !this._isCeilingElement(m.parentNode)) {\n                        m = m.parentNode;\n                      }\n                      return m;\n                    })();\n\n                  return {\n                    isWysiwygChild,\n                    isWysiwygEldestChild,\n                    isMediaElement: i.closest(\"._media_\"),\n                    isBlockQuoteElement: i.closest(\"blockquote\"),\n                    isCustomElement: i.closest(\"._custom_\"),\n                    isHashtagElement: i.closest(\"._hashtag_\"),\n                    isUrlLinkElement: i.closest(\"._urllink_\"),\n                    ceiling,\n                    line,\n                  };\n                })();\n\n                if (!node.isWysiwygChild) continue; // bypass\n\n                if (\n                  node.isCustomElement ||\n                  node.isMediaElement ||\n                  node.isHashtagElement ||\n                  node.isUrlLinkElement\n                ) {\n                  // make sure un-editable element is secure\n                  let el =\n                    node.isCustomElement ||\n                    node.isMediaElement ||\n                    node.isHashtagElement ||\n                    node.isUrlLinkElement;\n\n                  // check if el has a value of contenteditable\n                  if (el.getAttribute(\"contenteditable\") !== \"true\")\n                    el.setAttribute(\"contenteditable\", \"false\");\n\n                  continue;\n                }\n\n                if (\n                  !(\n                    node.isWysiwygEldestChild &&\n                    (this._isBlockElement(i) || this._isTextBlockElement(i))\n                  ) &&\n                  i.nodeName !== \"BR\" &&\n                  !i.classList.length\n                ) {\n                  // unwrap anything that does not have class and is not block level text\n                  this._wrapNode(i);\n                  continue;\n                }\n\n                if (\n                  (() => {\n                    if (this._isStyleAllowedElement(i)) return false;\n\n                    for (let sa of this.restrictedElement_queryArray) {\n                      if (i.closest(sa)) return false;\n                    }\n\n                    return true;\n                  })()\n                )\n                  //  remove style attribute if not allowed\n                  i.removeAttribute(\"style\");\n\n                if (\n                  node.isWysiwygEldestChild &&\n                  !(this._isBlockElement(i) || this._isTextBlockElement(i))\n                ) {\n                  //  wrap eldest non text block element to p\n                  if (i.nodeName === \"BR\") i.remove();\n                  else this._wrapNode(i, document.createElement(\"p\"), true);\n                  continue;\n                }\n\n                if (\n                  mutationTarget.textContent &&\n                  mutationTarget.textContent !== \"\\u200B\"\n                ) {\n                  // prevent br added to line\n                  let br = getBr(mutationTarget);\n                  let doContinue = false;\n                  if (br.length)\n                    for (let b of br) {\n                      if (b === i) doContinue = true;\n                      b.remove();\n                    }\n                  if (doContinue) continue;\n                }\n\n                if (node.isWysiwygEldestChild && !this._isCeilingElement(i)) {\n                  // add tab on new line created by pressing enter\n                  if (this.insertTabPending_tabString) {\n                    let tab = document.createTextNode(\n                      this.insertTabPending_tabString\n                    );\n                    node.line.insertBefore(tab, node.line.childNodes[0]);\n                    this.insertTabPending_tabString = \"\";\n                    adjustSelection({ node: tab, position: false }, this.ceilingElement_queryArray);\n                  }\n\n                  // if empty text block is added add br\n                  if (\n                    !node.line.textContent ||\n                    node.line.textContent === \"\\u200B\"\n                  ) {\n                    let addBr = true;\n                    nodeCrawler(\n                      (n) => {\n                        if (n.nodeName === \"BR\") {\n                          addBr = false;\n                          return \"BREAK\";\n                        }\n                        return n;\n                      },\n                      { node: node.line }\n                    );\n\n                    if (addBr) node.line.append(document.createElement(\"br\"));\n                  }\n\n                  continue;\n                }\n\n                let classSet = (c) => {\n                  let counter = this.counterTagOf[c] || [];\n\n                  if (counter.length)\n                    counter = counter.concat(\n                      counter.map((m) => {\n                        return m + \"_stop\";\n                      })\n                    );\n\n                  return [\n                    c,\n                    c.includes(\"_stop\") ? c.replace(\"_stop\", \"\") : c + \"_stop\",\n                  ].concat(counter);\n                };\n\n                let toUnwrap = [];\n\n                if (i.classList.length) {\n                  climbUpToEldestParent(i, node.ceiling, true, (n) => {\n                    let cIdx = i.classList.length;\n                    while (cIdx--) {\n                      if (\n                        (() => {\n                          let set = classSet(i.classList[cIdx]);\n                          for (let s of set) {\n                            if (n.classList.contains(s)) return true;\n                          }\n                          return false;\n                        })()\n                      )\n                        toUnwrap.push(n);\n                    }\n\n                    return n;\n                  });\n                }\n\n                let idx = toUnwrap.length;\n\n                while (idx--) {\n                  // unwrap unnecessary counter parents\n                  this._wrapNode(toUnwrap[idx]);\n                }\n\n                let class_idx = i.classList.length;\n                while (class_idx--) {\n                  let className = i.classList[class_idx];\n                  let curSt = this._trackStyle(\n                    i,\n                    className.replace(\"_stop\", \"\")\n                  );\n                  let parSt = this._trackStyle(\n                    i.parentNode,\n                    className.replace(\"_stop\", \"\")\n                  );\n\n                  if (curSt === parSt)\n                    // remove style class if parent shares the same style\n                    i.classList.remove(className);\n                }\n\n                if (!i.classList.length) {\n                  // remove style attribute if there is no class\n                  i.removeAttribute(\"class\");\n                }\n\n                if (\n                  this._isTextBlockElement(mutationTarget) &&\n                  mutationTarget.childNodes.length === 1 &&\n                  this._isUnSelectableElement(mutationTarget.childNodes[0])\n                )\n                  mutationTarget.append(document.createTextNode(\"\"));\n              }\n            }\n        }\n      }\n    });\n    this.observer.observe(this.element, {\n      attributes: true,\n      childList: true,\n      subtree: true,\n    });\n  }\n\n  _append(i, insertAfter, wrap = false, focusElement) {\n    if (this.logExecution)\n      console.log(\"_append\", { i, insertAfter, wrap, focusElement });\n\n    if (!this.range) {\n      this.restoreLastSelection();\n      if (!this.range) return;\n    }\n\n    let common = climbUpToEldestParent(\n      this.range.commonAncestorContainer,\n      this.element\n    );\n    let startLine = this.range.startLine;\n    let endLine = this.range.endLine;\n    let insertRestricted = [\"HR\", \"UL\", \"LI\"]; //[\"HR\", \"UL\", \"LI\", \"._media_\", \"._custom_\"];\n\n    let append = (node) => {\n      if (node === this.element)\n        node = this.element.childNodes[this.element.childNodes.length - 1];\n\n      let next = node.nextSibling;\n      if (insertAfter) node.parentNode.insertBefore(insertAfter, next);\n\n      node.parentNode.insertBefore(i, insertAfter || next);\n      if (\n        this._isTextElement(node) &&\n        !node.textContent &&\n        this.element.lastChild !== node\n      )\n        node.remove();\n    };\n\n    if (wrap) {\n      let nodeToUnwrap = {};\n      let restricted = false;\n\n      let checker = (tag, el) => {\n        if (\n          el &&\n          (!nodeToUnwrap[tag] ||\n            (() => {\n              for (let u in nodeToUnwrap) {\n                if (nodeToUnwrap[u] === el) return false;\n              }\n              return true;\n            })())\n        )\n          nodeToUnwrap[tag] = el;\n      };\n\n      if (this.range.collapsed) {\n        checker(i.nodeName, startLine.closest(i.nodeName));\n\n        let idx = i.classList.length;\n        while (idx--) {\n          let className = i.classList[idx];\n          checker(className, startLine.closest(\".\" + className));\n        }\n      } else\n        nodeCrawler(\n          (n) => {\n            let chk = n.nodeType === 3 ? n.parentNode : n;\n            if (chk.nodeType !== 1) {\n              restricted = true;\n              return \"BREAK\";\n            }\n\n            if (n.nodeType === 1) {\n              for (let notAllowed of insertRestricted)\n                if (n.nodeName === notAllowed || n.closest(notAllowed)) {\n                  restricted = true;\n                  return \"BREAK\";\n                }\n            }\n\n            checker(i.nodeName, chk.closest(i.nodeName));\n\n            let idx = i.classList.length;\n            while (idx--) {\n              let className = i.classList[idx];\n              checker(className, chk.closest(\".\" + className));\n            }\n\n            if (n === this.range.endContainer) return \"BREAK\";\n\n            return n;\n          },\n          { node: common, startNode: this.range.startContainer }\n        );\n\n      if (restricted) return;\n\n      if (Object.keys(nodeToUnwrap).length) {\n        for (let u in nodeToUnwrap) this._wrapNode(nodeToUnwrap[u]);\n      } else {\n        append(endLine);\n\n        let extract = this.range.extractContents();\n\n        if (extract.childNodes[0]) {\n          while (extract.childNodes[0]) {\n            let t = extract.childNodes[0];\n            if (!t.textContent) t.remove();\n            else i.append(t);\n          }\n        } else i.append(this._createEmptyParagraph());\n\n        this.range = adjustSelection({\n          node: focusElement || i,\n          position: false,\n        }, this.ceilingElement_queryArray);\n\n        let fc = i.previousSibling;\n\n        if (fc) {\n          fc = fc.nodeType === 3 ? fc.parentNode : fc;\n\n          if (\n            this._isTextElement(fc) &&\n            (!fc.textContent || fc.textContent === \"\\u200B\")\n          )\n            fc.remove();\n        }\n      }\n\n      return;\n    }\n\n    for (let r of insertRestricted) {\n      if (endLine.closest(r)) endLine = endLine.closest(r);\n    }\n\n    append(endLine);\n\n    if (insertAfter)\n      this.range = adjustSelection({ node: focusElement || insertAfter }, this.ceilingElement_queryArray);\n  }\n\n  async _callback(data) {\n    if (typeof this.callback === \"function\") {\n      let cb = this.callback(data) || data;\n      if (cb instanceof Promise) {\n        cb = await cb;\n      }\n      return cb || data;\n    }\n    return data;\n  }\n\n  async _imageSelected(e) {\n    if (this.logExecution) console.log(\"_imageSelected\", { e });\n    let files = e.target.files;\n\n    const prepareForCallback = { image: [] };\n    let readFile = new FileReader();\n\n    const load = (file) => {\n      return new Promise((res) => {\n        readFile.onload = (f) => {\n          const { lastModified, name, size, type } = file;\n          const source = f.target.result;\n\n          let img = new Image();\n          img.onload = () => {\n            res({\n              dimension: {\n                width: img.width,\n                height: img.height,\n              },\n              lastModified,\n              filename: name,\n              fileSize: size,\n              fileType: type,\n              source,\n              elementId: generateId(\"img\"),\n            });\n          };\n          img.src = source;\n        };\n        readFile.readAsDataURL(file);\n      });\n    };\n\n    this.callback({ loading: true });\n    for (let idx = 0; files.length > idx; idx++) {\n      prepareForCallback.image[idx] = await load(files[idx]);\n    }\n    this.callback({ loading: false });\n\n    //  reset image input\n    this.imgInput.value = \"\";\n\n    let feedback = await this._callback(prepareForCallback);\n\n    if (!this.range) {\n      this.restoreLastSelection();\n    }\n\n    if (\n      !this.range ||\n      (() => {\n        let c = this.range.commonAncestorContainer;\n        c = c.nodeType === 3 ? c.parentNode : c;\n        return !c.closest(\"#\" + this.elementId);\n      })()\n    )\n      this.element.focus();\n\n    if (!this.range) return;\n\n    if (feedback.image.length === 0) return;\n\n    // reverse the order of images\n    feedback.image.reverse();\n    let lasttxt = this._createEmptyParagraph();\n    this.element.insertBefore(lasttxt, this.range.endLine.nextSibling);\n    for (let i = 0; i < feedback.image.length; i++) {\n      let img = feedback.image[i];\n      let media = this._loadImage(img);\n      this.range.insertNode(media);\n      if (i === feedback.image.length - 1) {\n        this.range = adjustSelection({ node: lasttxt, position: true }, this.ceilingElement_queryArray);\n      }\n    }\n\n    this.setSafeLine();\n  }\n\n  _loadImage(i) {\n    /**\n         elementId: \"img_uniqueId\"\n         element: HTML\n         fileSize: 0\n         fileType: \"image/jpeg\"\n         source: \"file.jpg | http://url.com/file.jpg | s3 filename | base 64 string\"\n         lastModified: 0000000000000\n         filename: \"selectedLocalFilename.jpg\"\n         */\n\n    let image = i?.element instanceof Node ? i.element : null;\n\n    if (image) {\n      if (image.id) i.elementId = image.id;\n      else image.id = i.elementId;\n    }\n\n    if (!image) {\n      image = document.createElement(\"img\");\n      i.element = image;\n\n      let classname =\n        \"_img_\" +\n        i.source\n          .substring(i.source.length - 128)\n          .replace(/[/:.\"'\\\\@#$%\\?= \\{\\}\\|&*`!<>+]/g, \"\");\n      if (image.classList.contains(classname)) image.classList.add(classname);\n\n      if (Array.isArray(i.class)) {\n        for (let cl of i.class) image.classList.add(cl);\n      }\n\n      if (image.tagName === \"IMG\") image.setAttribute(\"src\", i.source);\n\n      if (typeof i.onclick === \"function\") {\n        image.addEventListener(\"click\", i.onclick);\n        image.classList.add(\"_hover_\");\n      }\n\n      if (\n        i.style &&\n        typeof i.style === \"object\" &&\n        Object.keys(i.style).length\n      ) {\n        for (let st in i.style) {\n          image.style.setProperty(st, i.style[st]);\n        }\n      }\n    }\n\n    // wrapper.setAttribute(\"contenteditable\", \"false\");\n    // wrapper.append(image);\n\n    if (!image.classList.contains(\"_media_\"))\n      image.classList.add(\"_media_\");\n\n\n    let pushArray = true;\n\n    for (let chk of this.image_array)\n      if (chk.elementId === i.elementId) {\n        pushArray = false;\n        break;\n      }\n\n    if (pushArray) this.image_array.push(i);\n\n\n    // return wrapper;\n    return image;\n  }\n\n  _getAnchorOffsetFromLine(line) {\n    const sel = window.getSelection();\n    if (!sel || !sel.anchorNode) return 0;\n\n    let anchorNode = sel.anchorNode;\n    let anchorOffset = sel.anchorOffset;\n\n    // If anchorNode is not inside line, return 0\n    if (!line.contains(anchorNode) && line !== anchorNode) return 0;\n\n    let offset = 0;\n    let found = false;\n\n    function traverse(node) {\n      if (found) return;\n      if (node === anchorNode) {\n        offset += anchorOffset;\n        found = true;\n        return;\n      }\n      if (node.nodeType === 3) {\n        offset += node.textContent.length;\n      } else {\n        for (let child of node.childNodes) {\n          traverse(child);\n          if (found) break;\n        }\n      }\n    }\n\n    traverse(line);\n    return offset;\n  }\n  _getFocusOffsetFromLine(line) {\n    const sel = window.getSelection();\n    if (!sel || !sel.focusNode) return 0;\n\n    let focusNode = sel.focusNode;\n    let focusOffset = sel.focusOffset;\n\n    // If focusNode is not inside line, return 0\n    if (!line.contains(focusNode) && line !== focusNode) return 0;\n\n    let offset = 0;\n    let found = false;\n\n    function traverse(node) {\n      if (found) return;\n      if (node === focusNode) {\n        offset += focusOffset;\n        found = true;\n        return;\n      }\n      if (node.nodeType === 3) {\n        offset += node.textContent.length;\n      } else {\n        for (let child of node.childNodes) {\n          traverse(child);\n          if (found) break;\n        }\n      }\n    }\n\n    traverse(line);\n    return offset;\n  }\n\n  _normalizeDocument() {\n    nodeCrawler(\n      (n) => {\n        if (n.nodeType === 3 && n.textContent.includes(\"\\u200B\")) {\n          //!n.textContent ||\n          n.textContent = n.textContent.replace(\"\\u200B\", \"\");\n\n          if (!n.textContent) {\n            let cel;\n            for (let c of this.ceilingElement_queryArray)\n              if (n.parentNode.closest(c)) {\n                cel = n.parentNode.closest(c);\n                break;\n              }\n\n            let el = climbUpToEldestParent(n, cel, true);\n\n            let par = el.parentNode;\n            if (\n              !this._isCeilingElement(par) &&\n              !el.textContent &&\n              this.element.lastChild !== el\n            ) {\n              par.removeChild(el);\n              n = par;\n            }\n            return n;\n          }\n        } else if (n.nodeType === 1 && n.nodeName !== \"BR\") {\n          console.log(\"normalize\", n);  \n          if (n.childNodes.length === 0 || n.childNodes.length === 1 && n.childNodes[0].nodeType === 3 && n.childNodes[0].textContent === \"\") {\n            let st = this.range.startContainer;\n            if(st.nodeType === 3) {\n              st = st.parentNode;\n            }\n            console.log({st, n});\n            if (st !== n) {\n              n.remove();\n            }\n            return n;\n          }\n          n.normalize();\n        }\n\n        return n;\n      },\n      { node: this.element }\n    );\n  }\n\n  _replaceText(wholeDocument = false) {\n    if (this.logExecution) console.log(\"_replaceText\", { wholeDocument });\n    const process = (typeName, setData) => {\n      if (!this[typeName]) return;\n\n      let regex = regexr[typeName] || null;\n\n      if (regex === null) throw new Error(\"no regex to process\");\n\n      if (typeof setData !== \"function\")\n        throw new Error(\"setData should be returning function\");\n\n      let node = wholeDocument\n        ? this.element\n        : this.range?.commonAncestorContainer;\n\n      if (!node) return;\n\n      if (node.nodeType === 3) node = node.parentNode;\n\n      let res = (() => {\n        let className = `_${typeName}_`;\n        let element = [];\n        let collected = [];\n\n        let textNodes = [];\n        nodeCrawler(\n          (n) => {\n            if (n.nodeType === 3 && n.textContent) {\n              if (\n                n.nextSibling?.nodeType === 3 &&\n                n.nextSibling.textContent &&\n                n.nextSibling.textContent !== \"\\u200B\"\n              ) {\n                let par = n.parentNode;\n                par.normalize();\n                n = par;\n              } else if (\n                n.textContent !== \"\\u200B\" &&\n                !n.parentNode.closest(\".\" + className)\n              )\n                textNodes.push(n);\n            }\n\n            return n;\n          },\n          { node }\n        );\n\n        textNodes.forEach((node) => {\n          replaceTextNode(node, regex, function (matched) {\n            if (matched.length > 1) {\n              return {\n                name: \"span\",\n                attrs: { class: `${className} ${className}${matched}` },\n                content: matched,\n              };\n            }\n          });\n        });\n\n        function replaceTextNode(node, regex, handler) {\n          let par = node.parentNode,\n            nxt = node.nextSibling,\n            doc = node.ownerDocument,\n            hits;\n\n          if (regex.global) {\n            while (node && (hits = regex.exec(node.nodeValue))) {\n              regex.lastIndex = 0;\n              node = handleResult(node, hits, handler.apply(this, hits));\n            }\n          } else if ((hits = regex.exec(node.nodeValue)))\n            handleResult(node, hits, handler.apply(this, hits));\n\n          function handleResult(node, hits, results) {\n            let orig = node.nodeValue;\n            node.nodeValue = orig.slice(0, hits.index);\n            [].concat(create(par, results)).forEach(function (n) {\n              let res = par.insertBefore(n, nxt);\n              element.push(res);\n            });\n            let rest = orig.slice(hits.index + hits[0].length);\n            if (rest) {\n              let text = doc.createTextNode(rest);\n              return par.insertBefore(text, nxt);\n            }\n          }\n\n          function create(el, o) {\n            if (o.map)\n              return o.map(function (v) {\n                return create(el, v);\n              });\n            else if (typeof o === \"object\") {\n              let e = doc.createElementNS(\n                o.namespaceURI || el.namespaceURI,\n                o.name\n              );\n              if (o.attrs) for (let a in o.attrs) e.setAttribute(a, o.attrs[a]);\n              if (o.content)\n                [].concat(create(e, o.content)).forEach(e.appendChild, e);\n              if (typeof o.content === \"string\") collected.push(o.content);\n              e.contentEditable = \"false\";\n              return e;\n            } else return doc.createTextNode(o + \"\");\n          }\n        }\n\n        let anchorText;\n        if (element.length) {\n          for (let el of element) {\n            anchorText = node.ownerDocument.createTextNode(\"\");\n            el.parentNode.insertBefore(anchorText, el.nextSibling);\n          }\n        }\n        return { collected, element, anchorText };\n      })();\n\n      let textEl = res.element;\n\n      if (!wholeDocument) {\n        this.range = adjustSelection({\n          node: res.anchorText,\n          position: false,\n        }, this.ceilingElement_queryArray);\n      }\n\n      let toCallback = [];\n      let collectId = [];\n\n      if (textEl[0])\n        for (let el of textEl) {\n          let elementId = generateId(typeName);\n          el.setAttribute(\"id\", elementId);\n          let tc = setData(el) || {};\n          tc.elementId = el.id;\n          tc.element = el;\n\n          el.removeAttribute(\"style\");\n          collectId.push(el.id);\n          toCallback.push(tc);\n        }\n\n      if (toCallback.length) {\n        this._callback({ [typeName]: toCallback })\n          .then((e) => {\n            for (let idx = 0; collectId.length > idx; idx++) {\n              //  elementId is read only\n              e[typeName][idx].elementId = collectId[idx];\n            }\n\n            if (Array.isArray(e[typeName]) && e[typeName].length)\n              for (let h of e[typeName]) {\n                let dom = document.getElementById(h.elementId);\n\n                dom.setAttribute(\"id\", h.elementId);\n                dom.setAttribute(\"contenteditable\", \"false\");\n\n                if (typeof h.onclick === \"function\") {\n                  dom.addEventListener(\"click\", h.onclick);\n                  dom.classList.add(\"_hover_\");\n                }\n\n                if (\n                  h.style &&\n                  typeof h.style === \"object\" &&\n                  Object.keys(h.style).length\n                ) {\n                  for (let s in h.style) dom.style.setProperty(s, h.style[s]);\n                }\n\n                this[`${typeName}_array`].push(h);\n              }\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      }\n    };\n\n    if (this.urllink_flag) {\n      process(\"urllink\", (url) => {\n        let u = url.textContent;\n        url.addEventListener(\"click\", function () {\n          if (!u.match(/^https?:\\/\\//i)) {\n            u = \"http://\" + u;\n          }\n          window.open(u, \"_blank\");\n        });\n\n        return { url: u };\n      });\n    }\n\n    if (this.hashtag_flag) {\n      process(\"hashtag\", (tag) => {\n        let t = tag.textContent;\n        return { tag: t[0] === \"#\" ? t.substring(1) : t };\n      });\n    }\n\n    this.hashtag_flag = false;\n    this.urllink_flag = false;\n  }\n\n  _checkElement(node, chkArr, closest, exp) {\n    /**\n     * parentNode when node is a text node\n     * chkArr is an array of class names or tag names\n     * closest is a boolean to check if the element is closest to the node\n     */\n    if (this.logExecution)\n      console.log(\"_checkElement\", { node, chkArr, closest, exp });\n    if (node && node.nodeType === 1)\n      for (let c of chkArr) {\n        if (closest) {\n          let clo = node.closest(c);\n          if (clo) {\n            if (exp && exp[c]) {\n              if (c === \"._custom_\") {\n                let flyup = node;\n                let gotTheMatch = false;\n                if (node !== this.element) {\n                  while ((flyup && this.element !== flyup) || !gotTheMatch) {\n                    gotTheMatch =\n                      flyup.getAttribute(exp[c].attr) === exp[c].value;\n                    if (gotTheMatch) return false;\n\n                    flyup = flyup.parentNode;\n                  }\n                }\n              } else\n                return clo.getAttribute(exp[c].attr) === exp[c].value\n                  ? false\n                  : clo;\n            }\n\n            return clo;\n          }\n        } else if (\n          c[0] === \"#\"\n            ? node.id === c.substring(1)\n            : c[0] === \".\"\n              ? node.classList.contains(c.substring(1))\n              : node.nodeName === c\n        )\n          return true;\n      }\n    return false;\n  }\n\n  _isUnSelectableElement(node) {\n    if (this.logExecution) console.log(\"_isUnSelectableElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    let exceptions = {\n      \"._custom_\": { attr: \"contenteditable\", value: \"true\" },\n    };\n    return this._checkElement(\n      node,\n      this.unSelectable_queryArray,\n      true,\n      exceptions\n    );\n  }\n\n  _isStyleAllowedElement(node) {\n    if (this.logExecution) console.log(\"_isStyleAllowedElement\", { node });\n    return this._checkElement(node, this.styleAllowedElement_queryArray);\n  }\n\n  _isCeilingElement(node) {\n    if (this.logExecution) console.log(\"_isCeilingElement\", { node });\n    return this._checkElement(node, this.ceilingElement_queryArray);\n  }\n\n  _isBlockElement(node) {\n    if (this.logExecution) console.log(\"_isBlockElement\", { node });\n    return this._checkElement(node, this.blockElement_queryArray);\n  }\n\n  _isTextAreaElement(node) {\n    if (this.logExecution) console.log(\"_isTextAreaElement\", { node });\n    return this._checkElement(node, this.textAreaElement_queryArray);\n  }\n\n  _isTextBlockElement(node) {\n    if (this.logExecution) console.log(\"_isTextBlockElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    return this._checkElement(node, this.textBlockElement_queryArray);\n  }\n\n  _isSpecialTextElement(node) {\n    if (this.logExecution) console.log(\"_isSpecialTextElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    return this._checkElement(node, this.specialTextElement_queryArray);\n  }\n\n  _isTextElement(node) {\n    if (this.logExecution) console.log(\"_isTextElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    return (\n      (this._isTextBlockElement(node) || node.nodeName === \"SPAN\") &&\n      !this._isSpecialTextElement(node)\n    );\n  }\n  setSafeLine() {\n    let firstChild = this.element.firstChild;\n    let lastChild = this.element.lastChild;\n    console.log({ firstChild, lastChild });\n    this.unSelectable_queryArray.forEach((cl) => {\n      if (cl[0] === \".\") {\n        cl = cl.substring(1);\n        if (firstChild && firstChild.nodeType === 1 && firstChild.classList.contains(cl))\n          this.element.insertBefore(\n            this._createEmptyParagraph(),\n            firstChild\n          );\n        if (lastChild && lastChild.nodeType === 1 && lastChild.classList.contains(cl))\n          this.element.appendChild(this._createEmptyParagraph());\n      }\n      else {\n        if (firstChild && firstChild?.tagName === cl)\n          this.element.insertBefore(\n            this._createEmptyParagraph(),\n            firstChild\n          );\n        if (lastChild && lastChild?.tagName === cl)\n          this.element.appendChild(this._createEmptyParagraph());\n      }\n    });\n  }\n  /**\n   * List of command for editing wysiwyg text.\n   * @param {'quote'} action - Add blockquote below selected line.\n   * @also\n   * @param {'unorderedList'} action - Add unordered list below selected line.\n   * @also\n   * @param {'orderedList'} action - Add ordered list below selected line.\n   * @also\n   * @param {'divider'} action - Add HR below selected line.\n   * @also\n   * @param {'image'} action - Add image below selected line.\n   * @also\n   * @param {'alignLeft'} action - Align selected line to left.\n   * @also\n   * @param {'alignCenter'} action - Align selected line to center.\n   * @also\n   * @param {'alignRight'} action - Align selected line to right.\n   * @also\n   * @param {'color' | 'hex | rgb string | hsl string'} action - Apply color to selected text. If 'color' is given, the default focus color is applied to the text.\n   * @also\n   * @param {'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' | 'small' | 'bold' | 'italic' | 'underline' | 'strike'} action - Apply style to selection.\n   * @also\n   * @param {object} action - Custom element object\n   * @param {object | string} action.element - Custom element can be node objects | html string | string\n   * @param {string} action.elementId - Set custom elements parent id. Otherwise auto generated\n   * @param {object} action.style - Set custom elements parent css style\n   * @param {boolean} action.insert - Set custom element insert mode. If true, inserts element at carat position, otherwise appends on next line\n   */\n  command(action) {\n    if (!action) return;\n\n    if (!this.range) this.restoreLastSelection();\n\n    switch (action) {\n      case \"quote\": {\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        let p = this._createEmptyParagraph();\n        let bq = document.createElement(\"blockquote\");\n        this._append(bq, p, true);\n        break;\n      }\n      case \"unorderedList\": {\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        let p = this._createEmptyParagraph();\n        let li = document.createElement(\"li\"),\n          ul = document.createElement(\"ul\");\n        ul.append(li);\n        this._append(ul, p, false, li);\n        break;\n      }\n      case \"orderedList\": {\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        let p = this._createEmptyParagraph();\n        let li = document.createElement(\"li\"),\n          ul = document.createElement(\"ol\");\n        ul.append(li);\n        this._append(ul, p, false, li);\n        break;\n      }\n      case \"divider\": {\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        // let p = this._createEmptyParagraph(),\n        let hr = document.createElement(\"hr\");\n        hr.setAttribute(\"contenteditable\", \"false\");\n        // this._append(hr, p, false);\n        this._append(hr, null, false);\n        this.setSafeLine();\n        break;\n      }\n      case \"image\":\n        this.imgInput.click();\n        break;\n      case \"alignLeft\":\n      case \"alignCenter\":\n      case \"alignRight\":\n        if (!this.range) return;\n        let startLine = this.range.startLine;\n        let endLine = this.range.endLine;\n\n        let collectLines = [];\n        collectLines.push(startLine);\n\n        while (collectLines[collectLines.length - 1] !== endLine) {\n          let nextLine = collectLines[collectLines.length - 1].nextSibling;\n\n          while (nextLine && !this._isTextBlockElement(nextLine)) {\n            if (\n              this._isCeilingElement(nextLine) &&\n              nextLine.firstChild &&\n              this._isTextBlockElement(nextLine.firstChild)\n            ) {\n              nextLine = nextLine.firstChild;\n              break;\n            }\n            nextLine = nextLine.nextSibling;\n          }\n\n          if (\n            !nextLine &&\n            this._isCeilingElement(\n              collectLines[collectLines.length - 1].parentNode\n            )\n          )\n            nextLine =\n              collectLines[collectLines.length - 1].parentNode.nextSibling;\n\n          if (nextLine) collectLines.push(nextLine);\n          else break;\n        }\n\n        let commandTracker = Object.assign({}, this.commandTracker);\n\n        for (let l of collectLines) {\n          for (let c of this.alignClass) {\n            if (l.classList.contains(c)) l.classList.remove(c);\n            commandTracker[c.substring(1, c.length - 1)] = false;\n          }\n\n          if (action !== \"alignLeft\" && !this.commandTracker[action]) {\n            for (let c of this.alignClass) {\n              if (c.includes(action)) l.classList.add(c);\n            }\n            commandTracker[action] = true;\n          }\n        }\n\n        this.commandTracker = commandTracker;\n\n        this._callback({\n          commandTracker,\n          range: this.range,\n        }).catch((err) => err);\n        break;\n    }\n\n    let isColor;\n    try {\n      isColor = new ColorMangle(action).hex();\n      action = \"color\";\n    } catch { }\n\n    //  style command\n    if (this.styleTagOfCommand[action]) {\n      let wrapper,\n        query = this.styleTagOfCommand[action],\n        stopperMode = false;\n\n      let counter = this.counterTagOf[query]\n        ? this.counterTagOf[query].map((c) => this._classNameToQuery(c))\n        : [];\n      if (counter.length)\n        counter = counter.concat(counter.map((c) => c + \"_stop\"));\n\n      //  setup query\n      query = this._classNameToQuery(query);\n\n      if (this.commandTracker[action]) {\n        let pass;\n\n        if (action === \"color\") {\n          pass =\n            isColor === this.commandTracker[action] ||\n            (isColor === undefined &&\n              this.commandTracker[action] ===\n              this.cssVariable[\"--content-text_focus\"]);\n        } else pass = true;\n\n        if (pass) {\n          query = this._classNameToQuery(query + \"_stop\");\n          stopperMode = true;\n        }\n      }\n\n      //  setup wrapper element\n      if (query[0] === \".\") {\n        wrapper = document.createElement(\"SPAN\");\n        wrapper.classList.add(query.substring(1));\n      } else wrapper = document.createElement(query);\n\n      if (isColor && !stopperMode) wrapper.style.color = isColor;\n\n      let restrictedClass = this._isSelectionTrespassRestrictedRange();\n      if (this.range.collapsed) {\n        if (restrictedClass) return;\n\n        let text = document.createTextNode(\"\");\n        // let text = document.createTextNode(\"\\u200B\");\n        wrapper.append(text);\n\n        if (this.range.startContainer.nodeName === \"BR\")\n          this.range.startContainer.parentNode.insertBefore(\n            wrapper,\n            this.range.startContainer\n          );\n        else this.range.insertNode(wrapper);\n        \n        console.log('setrange')\n        this.range = adjustSelection({ node: text, position: false }, this.ceilingElement_queryArray);\n      }\n      else {\n        if (restrictedClass) {\n          this.range = adjustSelection({\n            node: this.range.endContainer,\n            position: this.range.endOffset,\n          }, this.ceilingElement_queryArray);\n          return;\n        }\n        //  selection has range\n        let extract = this.range.extractContents();\n        let span = document.createElement(\"span\");\n\n        while (extract.childNodes[0]) span.append(extract.childNodes[0]);\n\n        nodeCrawler(\n          (n) => {\n            let res = restrictedClass\n              ? this._classNameToQuery(restrictedClass)\n              : null;\n            let par = n.nodeType === 3 ? n.parentNode : n;\n            let restricted =\n              res && par.hasOwnProperty(\"closest\") ? par.closest(res) : false;\n\n            if (n.nodeType === 3 && !restricted)\n              n.textContent = n.textContent.replaceAll(\"\\t\", \"\");\n\n            return n;\n          },\n          { node: span, startFromEldestChild: true, parentNode: this.element }\n        );\n\n        while (span.childNodes[0]) extract.append(span.childNodes[0]);\n\n        //  unwrap duplicates and stopper | counter\n        let unwrapTarget = [query];\n\n        //  add countering | opposite tag to unwrap\n        if (stopperMode) {\n          let rev = query.replace(\"_stop\", \"\").substring(1);\n          rev = rev[0] === \"_\" ? \".\" + rev : rev;\n          unwrapTarget.push(rev);\n        } else {\n          let rev = query + \"_stop\";\n          rev = rev[0] === \".\" ? rev : \".\" + rev;\n          unwrapTarget.push(rev);\n        }\n\n        unwrapTarget = unwrapTarget.concat(counter);\n        let del = extract.querySelectorAll(unwrapTarget.join());\n        let idx = del.length;\n        if (idx) while (idx--) this._wrapNode(del[idx]);\n\n        //  split wrapper\n        let wrapperSplit = [wrapper.cloneNode(true)];\n\n        while (extract.childNodes[0]) {\n          let child = extract.childNodes[0];\n\n          if (child.nodeType === 1 && this._isBlockElement(child)) {\n            let nest = this._isTextAreaElement(child);\n\n            if (nest) {\n              for (let idx = 0; child.childNodes.length > idx; idx++) {\n                let text = child.childNodes[idx];\n\n                if (this._isTextElement(text)) {\n                  let nestedWrapper = wrapper.cloneNode(true);\n                  while (text.childNodes[0]) {\n                    if (text.childNodes[0].textContent)\n                      nestedWrapper.append(text.childNodes[0]);\n                    else text.childNodes[0].remove();\n                  }\n                  text.append(nestedWrapper);\n                }\n              }\n\n              if (!child.textContent) {\n                child.remove();\n                continue;\n              }\n            }\n\n            let doc = document.createDocumentFragment();\n            doc.append(child);\n            wrapperSplit.push(doc);\n          } else {\n            if (child.nodeType === 1 && this._isTextBlockElement(child)) {\n              let nestedWrapper = wrapper.cloneNode(true);\n\n              while (child.childNodes[0])\n                nestedWrapper.append(child.childNodes[0]);\n\n              if (\n                nestedWrapper.childNodes.length === 1 &&\n                nestedWrapper.childNodes[0].nodeName !== \"BR\" &&\n                !nestedWrapper.textContent.length\n              ) {\n                child.remove();\n                continue;\n              }\n\n              child.append(nestedWrapper);\n              let doc = document.createDocumentFragment();\n              doc.append(child);\n              wrapperSplit.push(doc);\n            } else wrapperSplit[wrapperSplit.length - 1].append(child);\n          }\n        }\n\n        let output = document.createDocumentFragment();\n        for (let ws of wrapperSplit) output.append(ws);\n\n        let fc = output.firstChild;\n        let lc = output.lastChild;\n\n        if (this._isTextElement(fc) && !fc.textContent) {\n          let fn = fc.nextSibling;\n          fc.remove();\n          fc = fn;\n        }\n        if (this._isTextElement(lc) && !fc.textContent) {\n          let lp = lc.nextSibling;\n          lc.remove();\n          lc = lp;\n        }\n\n        this.range.insertNode(output);\n        this.range = adjustSelection({\n          node: [fc, lc],\n          position: [true, false],\n        }, this.ceilingElement_queryArray);\n\n        //  remove garbage node\n        fc = fc.nodeType === 3 ? fc.parentNode : fc;\n        lc = lc.nodeType === 3 ? lc.parentNode : lc;\n\n        let next = lc.nextSibling;\n        if (\n          this._isTextElement(next) &&\n          (!next.textContent || next.textContent === \"\\u200B\")\n        )\n          next.remove();\n\n        let prev = fc.previousSibling;\n        if (\n          (this._isTextElement(prev) && !prev.textContent) ||\n          prev.textContent === \"\\u200B\"\n        )\n          prev.remove();\n      }\n      // this._normalizeDocument();\n      return;\n    }\n\n    //  custom component\n    if (typeof action === \"object\") {\n      /**\n        action = {\n          elementId: <string: generated parent element id>,\n          element: <HTMLElement>,\n          style: {<css style object for parent element>},\n          insert: true | false,\n          contenteditable: false,\n        }\n      */\n\n      //  setup wrapper\n      let custom = null;\n\n      if (action.style)\n        for (let s in action.style) custom.style[s] = action.style[s];\n\n      action.elementId = action.elementId || generateId(\"custom\");\n\n      if (typeof action.element === \"string\") {\n        custom = document.createTextNode(action.element);\n        action.insert = true;\n      }\n      else if (action.element instanceof HTMLElement) {\n        custom = action.element;\n        custom.id = action.elementId;\n        custom.classList.add(\"_custom_\");\n      }\n      if (!this.range) this.element.focus();\n\n      this.custom_array.push(action);\n\n      this._callback({ custom: action }).then((_) => {\n\n        let txt = document.createTextNode(\"\");\n        if (action.insert) {\n          this.range.insertNode(txt); // when inserted in range, it will push the next el back\n          this.range.insertNode(custom);\n        } else {\n          this._append(custom, txt, false);\n        }\n        this.range = adjustSelection({\n          node: txt,\n          position: false,\n        }, this.ceilingElement_queryArray);\n\n        this.setSafeLine();\n      });\n    }\n\n  }\n\n  /**\n   * Restores the last selection range\n   */\n  restoreLastSelection() {\n    if (this.logExecution)\n      console.log(\"restoreLastSelection\", { range_backup: this.range_backup });\n    if (this.range_backup) {\n      this.range = adjustSelection({\n        node: [\n          this.range_backup.startContainer,\n          this.range_backup.endContainer,\n        ],\n        position: [this.range_backup.startOffset, this.range_backup.endOffset],\n      }, this.ceilingElement_queryArray);\n      let sel = window.getSelection();\n      let range = document.createRange();\n      range.setStart(this.range.startContainer, this.range.startOffset);\n      range.setEnd(this.range.endContainer, this.range.endOffset);\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n  }\n\n  /**\n   * Load html string to wysiwyg\n   * @param {string} html - HTML string to load.\n   * @param {boolean} [editable=false] - Set editable mode.\n   */\n  async loadHTML(html = this.html, editable = false) {\n    if (typeof html !== \"string\") {\n      throw new Error(\"html should be a string\");\n    }\n\n    this.setEditable(false);\n    this.html = html || \"\";\n    const div = document.createElement(\"div\");\n    div.innerHTML = html;\n\n    // image\n    const img = div.querySelectorAll(\"img\");\n    const imgCallback = [];\n    if (img.length)\n      for (let i of img) {\n        // const imageParent = i.closest(\"._media_\");\n\n        // if (imageParent) {\n        const source = i.getAttribute(\"src\");\n        let imgId = i.id || generateId(\"img\");\n        i.setAttribute(\"id\", imgId);\n\n        imgCallback.push({\n          source,\n          elementId: imgId,\n          element: i,\n        });\n        // }\n\n        this.image_array = JSON.parse(JSON.stringify(imgCallback));\n      }\n\n    // hashtag\n    const hashtag = div.querySelectorAll(\"._hashtag_\");\n    const hashtagCallback = [];\n    if (hashtag.length)\n      for (let i of hashtag) {\n        let clIdx = i.classList.length;\n        let tag,\n          elementId = i.id || generateId(\"hashtag\");\n        while (clIdx--) {\n          let cls = i.classList[clIdx];\n          if (cls.replace(\"_hashtag_\", \"\")[0] === \"#\") {\n            tag = cls.replace(\"_hashtag_\", \"\");\n          }\n        }\n        tag = tag?.[0] === \"#\" ? tag.substring(1) : tag;\n        if (tag) hashtagCallback.push({ tag, elementId, element: i });\n      }\n\n    // urllink\n    const urllink = div.querySelectorAll(\"._urllink_\");\n    const urllinkCallback = [];\n    if (urllink.length)\n      for (let i of urllink) {\n        let elementId = i.id || generateId(\"urllink\");\n        let url;\n\n        let clIdx = i.classList.length;\n        while (clIdx--) {\n          let cls = i.classList[clIdx];\n          if (cls.includes(\"_urllink_\").length) {\n            url = cls.replace(\"_urllink_\", \"\");\n          }\n        }\n        if (url) urllinkCallback.push({ url, elementId, element: i });\n      }\n\n    const custom = div.querySelectorAll(\"._custom_\");\n    const customCallback = [];\n    if (custom.length)\n      for (let i of custom) {\n        let elementId = i.id || generateId(\"custom\");\n        customCallback.push({ elementId, element: i });\n      }\n\n    let fb = await this._callback({\n      image: imgCallback,\n      hashtag: hashtagCallback,\n      urllink: urllinkCallback,\n      custom: customCallback,\n    });\n\n    // callback\n    for (let f in fb) {\n      if (f === \"image\") {\n        let img = fb[f];\n        for (let i of img) {\n          // let imgEl = div.querySelector(\"#\" + i.elementId);\n          // const imageParent = imgEl.closest(\"._media_\");\n          this._loadImage(i);\n        }\n      } else this[f + \"_array\"] = fb[f];\n    }\n\n    this.element.innerHTML = \"\";\n\n    while (div.childNodes[0]) this.element.append(div.childNodes[0]);\n\n    if (editable) this.setEditable(true);\n  }\n\n  /**\n   * Load html string to wysiwyg\n   * @param {function} [pre=(p)=>{return p}] - Pre processing callback before export.\n   * @return {object} - Exported wysiwyg data object\n   */\n  async export(pre) {\n    this._normalizeDocument();\n    const dom = this.element.cloneNode(true);\n\n    const { hashtag_array, image_array, urllink_array, custom_array } = this;\n    let title = \"\";\n    let text = \"\";\n\n    let setup = {\n      dom,\n      urllink: this.urllink ? urllink_array : undefined,\n      hashtag: this.hashtag ? hashtag_array : undefined,\n      image: image_array,\n      custom: custom_array,\n    };\n\n    if (typeof pre === \"function\") {\n      let promiseOrNot = pre(setup);\n\n      if (promiseOrNot instanceof Promise)\n        setup = (await promiseOrNot) || setup;\n      else setup = promiseOrNot || setup;\n\n      if (this.hashtag) this.hashtag_array = setup.hashtag;\n      if (this.urllink) this.urllink_array = setup.urllink;\n\n      this.image_array = setup.image;\n      this.custom_array = setup.custom;\n      title = setup.title || \"\";\n    }\n\n    const strip = setup.dom.querySelectorAll(\":scope > *\");\n\n    //  Loop through eldest child element in document\n    for (let sid = 0; sid < strip.length; sid++) {\n      let child = strip[sid];\n      if (child.textContent.length) {\n        //  set title and text information\n        let inputText = child.textContent;\n        if (!title) {\n          let titleSearchRegex = /([^\\s^.]{2,}[^\\s]+[.][^\\s^.]{2,})/g;\n          let urlArray = inputText.match(titleSearchRegex);\n\n          // We are replacing the urls with a special text here.\n          // Then we split the sentences by the dots.\n          // Then we replace the url with the special text and identify the title and body text\n\n          let split;\n          if (urlArray) {\n            for (let i = 0; i < urlArray.length; i++) {\n              inputText = inputText.replace(\n                urlArray[i].replace(/\\.+$/, \"\"),\n                \"[§url§]\" + i + \"[/§url§]\"\n              );\n            }\n\n            split = inputText.split(\".\");\n\n            for (let i = 0; i < split.length; i++) {\n              for (let j = 0; j < urlArray.length; j++) {\n                split[i] = split[i].replace(\n                  \"[§url§]\" + j + \"[/§url§]\",\n                  urlArray[j].replace(/\\.+$/, \"\")\n                );\n              }\n            }\n          } else split = inputText.split(\".\");\n\n          title = split[0];\n          if (title.length > 200) {\n            text += title.substring(200) + \".\";\n            title = title.substring(0, 200);\n          }\n\n          split.shift();\n          inputText = split.join(\".\").replace(/\\s\\s+/g, \" \");\n          text += inputText + \" \";\n        } else text += `${inputText}\\n`;\n      }\n\n      if (child.classList.contains(\"_media_\")) {\n        let idx = child.childNodes.length;\n        while (idx--) {\n          let c = child.childNodes[idx];\n          if (c.nodeName === \"IMG\") {\n            for (const f of this.image_array) {\n              if (f.elementId === c.id && f.source !== c.getAttribute(\"src\")) {\n                c.setAttribute(\"src\", f.source);\n                let cIdx = c.classList.length;\n                while (cIdx--) {\n                  if (\n                    c.classList[cIdx].includes(\"_img_\") &&\n                    c.classList[cIdx].length > 5\n                  ) {\n                    c.classList.remove(c.classList[cIdx]);\n                    let splitUrl = f.source.split(\"/\");\n                    let splitTail = splitUrl[splitUrl.length - 1];\n                    let splitTail_length = splitTail.length - 64;\n                    const sourceClip = splitUrl[splitUrl.length - 1].substring(\n                      splitTail_length > 0 ? splitTail : 0\n                    );\n                    c.classList.add(\"_img_\" + sourceClip);\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return {\n      html: setup.dom.innerHTML,\n      title: title.trim(),\n      text: text.trim(),\n      urllink: this.urllink ? this.urllink_array : undefined,\n      hashtag: this.hashtag ? this.hashtag_array : undefined,\n      image: this.image_array,\n      custom: this.custom_array,\n    };\n  }\n\n  /**\n   * Set placeholder string\n   * @param {string} p - Set placeholder string.\n   */\n  setPlaceholder(p) {\n    if (this.logExecution) console.log(\"setPlaceholder\", { p });\n    if (this.element) {\n      if (p && typeof p === \"string\")\n        this.element.setAttribute(\"placeholder\", p);\n      else this.element.removeAttribute(\"placeholder\");\n    }\n  }\n\n  /**\n   * Set spellcheck mode\n   * @param {boolean} bool - Set spellcheck mode.\n   */\n  setSpellcheck(bool) {\n    if (this.logExecution) console.log(\"setSpellcheck\", { bool });\n    if (this.element)\n      this.element.setAttribute(\"spellcheck\", bool ? \"on\" : \"off\");\n  }\n\n  /**\n   * Set edit mode\n   * @param {boolean} bool - Set wysiwyg to editable when true.\n   */\n  setEditable(bool) {\n    if (this.logExecution) console.log(\"setEditable\", { bool });\n    bool = this.element ? bool : false;\n\n    if (this.element)\n      this.element.setAttribute(\"contenteditable\", bool ? \"true\" : \"false\");\n\n    this._setEventListener(bool);\n    this._observeMutation(bool);\n  }\n}\n\nexport { Wysiwyg4All };\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","colorNames","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","goldenrod","gold","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavenderblush","lavender","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ColorMangle","constructor","color","fineTuned","this","format","_colorType","type","throwErr","chkType","string","toLowerCase","match","Array","isArray","length","exec","err","_extractDigit","color_arg","rgba","i","push","parseFloat","getAlpha","extract","colorScheme","darkMode","focusOriginal","focusSat","opacity","template","content_isHighLuminance","isHighLuminance","focus","includes","matchLuminance","compDir","analogous","focusHSL","hsla","h","an1HSL","an2HSL","Math","abs","complementary","fixedValue","darkModeAnalogous","analogousNude","k","textColor","assign","contrastRatio","unordered","keys","sort","reduce","target_color","target_ratio","direction","method","target","adj","m","dir","count","adj_set","adjustBrightness","adjustLuminance","legacy","hex","main_lum","_luminance","lum","currDir","lum_pre","deg","spin","v","val","hsl","plus","s","l","a","minus","add","_toString","r","g","b","rgb","map","pow","col","numberOrNot","n","def","color_arg1","color_arg2","lum1","lum2","option","blackOpacity","whiteOpacity","opa","c_min","min","c_max","max","delta","round","toFixed","digit","toString","slice","rgbObject","hexValues","parseInt","opacity_value","c","x","limit","rgbRange","result","adjustSaturation","adjustSelection","ceilingElement_query","toArray","allowObject","setRange","node","position","sel","window","getSelection","range","getRangeAt","document","createRange","p","Node","setTarget","nodeType","lastChild","firstChild","textLength","nodeCrawler","textContent","parentNode","getAttribute","text","createTextNode","insertBefore","childNodes","nodeName","previousSibling","setEnd","doCollapse","setStart","startContainer","startOffset","endContainer","endOffset","collapse","removeAllRanges","addRange","startLine","endLine","q","e","closest","climbUpToEldestParent","run","startFromEldestChild","startNode","Error","commonAncestorContainer","parentAnchor","id","uniqueId","outputNodes","nodeIsRange","commonContainer","nodes","generateId","crawl","withInRange","cwl","diving","console","log","nextSibling","removeAttribute","prefix","charAt","floor","random","Date","getTime","substring","wrapper","singleChildParent","callback","isSingleChildParent","childrenCount","children","sweep","divCount","iHaveText","cb","regexr","hashtag","hashtag_stopper","urllink","Wysiwyg4All","elementId","editable","placeholder","spellcheck","highlightColor","html","fontSize","desktop","tablet","phone","h1","h2","h3","h4","h5","h6","small","lastLineBlank","logMutation","logExecution","fontSizeCssVariable","hold","keyArr","image_array","hashtag_array","urllink_array","custom_array","blockElement_queryArray","specialTextElement_queryArray","restrictedElement_queryArray","textAreaElement_queryArray","textBlockElement_queryArray","ceilingElement_queryArray","unSelectable_queryArray","styleAllowedElement_queryArray","alignClass","hashtag_flag","urllink_flag","range_backup","commandTracker","isRangeDirectionForward","insertTabPending_tabString","removeSandwichedLine_array","lastKey","element","getElementById","innerHTML","cssVariable","style","setProperty","elementComputedStyle","getComputedStyle","defaultFontColor","classList","contains","setPlaceholder","setSpellcheck","paddingB","paddingBottom","paddingT","paddingTop","borderT","borderTopWidth","borderB","borderBottomWidth","minHeight","command","italic","bold","underline","strike","fontSizeRatio","tag","ratio","entries","emSize","styleTagOfCommand","counterTagOf","cssPropertyOf","cssPropertyChecker","textDecoration","documentFontSize","nodeFontSize","f_size","compare_size","fontStyle","loadHTML","catch","_wrapNode","appendWhole","start","end","withinRange","append","child","stripped","removeChild","_getStartEndLine","getInbetween","inBetween","currentLine","some","matches","_classNameToQuery","_isThereContentEditableOverMyHead","flyup","_normalizeBrowserQuirks","navigator","userAgent","indexOf","remove","_isSelectionTrespassRestrictedRange","restrict","_createEmptyParagraph","createElement","_trackStyle","cls","checker","sp","_isTextElement","_lastLineBlank","force","lastLine","_selectionchange","anchorElement","anchorNode","focusElement","focusNode","appendChild","caratPosition","restricted","concat","quote","comm","caratEl","getBoundingClientRect","_callback","error","_setEventListener","listen","removeEventListener","imgInput","_keydown","_normalize","_paste","_keyup","accept","hidden","multiple","setAttribute","addEventListener","_imageSelected","collapsed","toUpperCase","shift","shiftKey","preventDefault","stc","block","prevsib","cl","tagName","_replaceText","sweep_array","hasIndent","diveAndRemoveTab","offset","containerOffset","line","container","tab","insertNode","bind","stopPropagation","restoreLastSelection","_normalizeDocument","_backupSelection","cloneRange","doc","createDocumentFragment","clipboardData","getData","replace","u","extractContents","pop","destroy","observer","disconnect","_observeMutation","track","_elementRemovalObserver","MutationObserver","mutations","mutation","removedNode","removedNodes","observe","childList","mutation_array","monitor","cloneNode","name","attributeName","added","clones","addedNodes","removed","mutate","mutationTarget","callbackRemoved","what","arrIdx","splice","toBreak","t","_isCeilingElement","idx","_isTextBlockElement","_isUnSelectableElement","getBr","br","isWysiwygChild","isWysiwygEldestChild","ceiling","clo","isMediaElement","isBlockQuoteElement","isCustomElement","isHashtagElement","isUrlLinkElement","el","_isBlockElement","_isStyleAllowedElement","sa","doContinue","addBr","classSet","counter","toUnwrap","cIdx","set","class_idx","className","attributes","subtree","_append","insertAfter","wrap","common","insertRestricted","next","nodeToUnwrap","chk","notAllowed","fc","data","Promise","files","prepareForCallback","image","readFile","FileReader","load","file","res","onload","f","lastModified","size","source","img","Image","dimension","width","height","filename","fileSize","fileType","src","readAsDataURL","loading","feedback","reverse","lasttxt","media","_loadImage","setSafeLine","classname","class","onclick","st","pushArray","_getAnchorOffsetFromLine","anchorOffset","found","traverse","_getFocusOffsetFromLine","focusOffset","cel","par","normalize","wholeDocument","process","typeName","setData","regex","anchorText","collected","textNodes","forEach","handler","hits","nxt","ownerDocument","global","nodeValue","lastIndex","handleResult","apply","results","orig","index","create","rest","createElementNS","namespaceURI","attrs","content","contentEditable","replaceTextNode","matched","textEl","toCallback","collectId","tc","then","dom","url","open","_checkElement","chkArr","exp","attr","gotTheMatch","_isTextAreaElement","_isSpecialTextElement","action","bq","li","ul","hr","click","collectLines","nextLine","isColor","query","stopperMode","pass","undefined","restrictedClass","span","replaceAll","unwrapTarget","rev","del","querySelectorAll","join","wrapperSplit","nestedWrapper","output","ws","lc","fn","lp","prev","custom","insert","HTMLElement","_","txt","setEditable","div","imgCallback","imgId","JSON","parse","stringify","hashtagCallback","clIdx","urllinkCallback","customCallback","fb","pre","title","setup","promiseOrNot","strip","sid","inputText","split","titleSearchRegex","urlArray","j","splitUrl","splitTail","splitTail_length","sourceClip","trim","bool"],"sourceRoot":""}