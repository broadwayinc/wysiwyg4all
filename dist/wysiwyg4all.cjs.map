{"version":3,"file":"wysiwyg4all.cjs","mappings":"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","sources":["webpack://wysiwyg4all/webpack/bootstrap","webpack://wysiwyg4all/webpack/runtime/define property getters","webpack://wysiwyg4all/webpack/runtime/hasOwnProperty shorthand","webpack://wysiwyg4all/webpack/runtime/make namespace object","webpack://wysiwyg4all/./node_modules/colormangle/colormangle.js","webpack://wysiwyg4all/./wysiwyg4all.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","class ColorMangle {\n    /**\n     * @param {string} [color='#4848db'] - Argument string can be either color name string or any type of HTML color codes (hex, rgb, hsl).\n     */\n    constructor(color = '#4848db', fineTuned = true) {\n        this.fineTuned = fineTuned;\n        this.colorName = {\n            \"aliceblue\": \"#f0f8ff\",\n            \"antiquewhite\": \"#faebd7\",\n            \"aqua\": \"#00ffff\",\n            \"aquamarine\": \"#7fffd4\",\n            \"azure\": \"#f0ffff\",\n            \"beige\": \"#f5f5dc\",\n            \"bisque\": \"#ffe4c4\",\n            \"black\": \"#000000\",\n            \"blanchedalmond\": \"#ffebcd\",\n            \"blue\": \"#0000ff\",\n            \"blueviolet\": \"#8a2be2\",\n            \"brown\": \"#a52a2a\",\n            \"burlywood\": \"#deb887\",\n            \"cadetblue\": \"#5f9ea0\",\n            \"chartreuse\": \"#7fff00\",\n            \"chocolate\": \"#d2691e\",\n            \"coral\": \"#ff7f50\",\n            \"cornflowerblue\": \"#6495ed\",\n            \"cornsilk\": \"#fff8dc\",\n            \"crimson\": \"#dc143c\",\n            \"cyan\": \"#00ffff\",\n            \"darkblue\": \"#00008b\",\n            \"darkcyan\": \"#008b8b\",\n            \"darkgoldenrod\": \"#b8860b\",\n            \"darkgray\": \"#a9a9a9\",\n            \"darkgreen\": \"#006400\",\n            \"darkgrey\": \"#a9a9a9\",\n            \"darkkhaki\": \"#bdb76b\",\n            \"darkmagenta\": \"#8b008b\",\n            \"darkolivegreen\": \"#556b2f\",\n            \"darkorange\": \"#ff8c00\",\n            \"darkorchid\": \"#9932cc\",\n            \"darkred\": \"#8b0000\",\n            \"darksalmon\": \"#e9967a\",\n            \"darkseagreen\": \"#8fbc8f\",\n            \"darkslateblue\": \"#483d8b\",\n            \"darkslategray\": \"#2f4f4f\",\n            \"darkslategrey\": \"#2f4f4f\",\n            \"darkturquoise\": \"#00ced1\",\n            \"darkviolet\": \"#9400d3\",\n            \"deeppink\": \"#ff1493\",\n            \"deepskyblue\": \"#00bfff\",\n            \"dimgray\": \"#696969\",\n            \"dimgrey\": \"#696969\",\n            \"dodgerblue\": \"#1e90ff\",\n            \"firebrick\": \"#b22222\",\n            \"floralwhite\": \"#fffaf0\",\n            \"forestgreen\": \"#228b22\",\n            \"fuchsia\": \"#ff00ff\",\n            \"gainsboro\": \"#dcdcdc\",\n            \"ghostwhite\": \"#f8f8ff\",\n            \"goldenrod\": \"#daa520\",\n            \"gold\": \"#ffd700\",\n            \"gray\": \"#808080\",\n            \"green\": \"#008000\",\n            \"greenyellow\": \"#adff2f\",\n            \"grey\": \"#808080\",\n            \"honeydew\": \"#f0fff0\",\n            \"hotpink\": \"#ff69b4\",\n            \"indianred\": \"#cd5c5c\",\n            \"indigo\": \"#4b0082\",\n            \"ivory\": \"#fffff0\",\n            \"khaki\": \"#f0e68c\",\n            \"lavenderblush\": \"#fff0f5\",\n            \"lavender\": \"#e6e6fa\",\n            \"lawngreen\": \"#7cfc00\",\n            \"lemonchiffon\": \"#fffacd\",\n            \"lightblue\": \"#add8e6\",\n            \"lightcoral\": \"#f08080\",\n            \"lightcyan\": \"#e0ffff\",\n            \"lightgoldenrodyellow\": \"#fafad2\",\n            \"lightgray\": \"#d3d3d3\",\n            \"lightgreen\": \"#90ee90\",\n            \"lightgrey\": \"#d3d3d3\",\n            \"lightpink\": \"#ffb6c1\",\n            \"lightsalmon\": \"#ffa07a\",\n            \"lightseagreen\": \"#20b2aa\",\n            \"lightskyblue\": \"#87cefa\",\n            \"lightslategray\": \"#778899\",\n            \"lightslategrey\": \"#778899\",\n            \"lightsteelblue\": \"#b0c4de\",\n            \"lightyellow\": \"#ffffe0\",\n            \"lime\": \"#00ff00\",\n            \"limegreen\": \"#32cd32\",\n            \"linen\": \"#faf0e6\",\n            \"magenta\": \"#ff00ff\",\n            \"maroon\": \"#800000\",\n            \"mediumaquamarine\": \"#66cdaa\",\n            \"mediumblue\": \"#0000cd\",\n            \"mediumorchid\": \"#ba55d3\",\n            \"mediumpurple\": \"#9370db\",\n            \"mediumseagreen\": \"#3cb371\",\n            \"mediumslateblue\": \"#7b68ee\",\n            \"mediumspringgreen\": \"#00fa9a\",\n            \"mediumturquoise\": \"#48d1cc\",\n            \"mediumvioletred\": \"#c71585\",\n            \"midnightblue\": \"#191970\",\n            \"mintcream\": \"#f5fffa\",\n            \"mistyrose\": \"#ffe4e1\",\n            \"moccasin\": \"#ffe4b5\",\n            \"navajowhite\": \"#ffdead\",\n            \"navy\": \"#000080\",\n            \"oldlace\": \"#fdf5e6\",\n            \"olive\": \"#808000\",\n            \"olivedrab\": \"#6b8e23\",\n            \"orange\": \"#ffa500\",\n            \"orangered\": \"#ff4500\",\n            \"orchid\": \"#da70d6\",\n            \"palegoldenrod\": \"#eee8aa\",\n            \"palegreen\": \"#98fb98\",\n            \"paleturquoise\": \"#afeeee\",\n            \"palevioletred\": \"#db7093\",\n            \"papayawhip\": \"#ffefd5\",\n            \"peachpuff\": \"#ffdab9\",\n            \"peru\": \"#cd853f\",\n            \"pink\": \"#ffc0cb\",\n            \"plum\": \"#dda0dd\",\n            \"powderblue\": \"#b0e0e6\",\n            \"purple\": \"#800080\",\n            \"rebeccapurple\": \"#663399\",\n            \"red\": \"#ff0000\",\n            \"rosybrown\": \"#bc8f8f\",\n            \"royalblue\": \"#4169e1\",\n            \"saddlebrown\": \"#8b4513\",\n            \"salmon\": \"#fa8072\",\n            \"sandybrown\": \"#f4a460\",\n            \"seagreen\": \"#2e8b57\",\n            \"seashell\": \"#fff5ee\",\n            \"sienna\": \"#a0522d\",\n            \"silver\": \"#c0c0c0\",\n            \"skyblue\": \"#87ceeb\",\n            \"slateblue\": \"#6a5acd\",\n            \"slategray\": \"#708090\",\n            \"slategrey\": \"#708090\",\n            \"snow\": \"#fffafa\",\n            \"springgreen\": \"#00ff7f\",\n            \"steelblue\": \"#4682b4\",\n            \"tan\": \"#d2b48c\",\n            \"teal\": \"#008080\",\n            \"thistle\": \"#d8bfd8\",\n            \"tomato\": \"#ff6347\",\n            \"turquoise\": \"#40e0d0\",\n            \"violet\": \"#ee82ee\",\n            \"wheat\": \"#f5deb3\",\n            \"white\": \"#ffffff\",\n            \"whitesmoke\": \"#f5f5f5\",\n            \"yellow\": \"#ffff00\",\n            \"yellowgreen\": \"#9acd32\"\n        };\n        let format = this._colorType(color);\n        this.type = format.type;\n        this.color = format.color;\n    }\n\n    _colorType(color = this.color, throwErr = true) {\n        let chkType, type;\n\n        try {\n            if (!color)\n                throw 'invalid color';\n\n            if (typeof color === 'object' && color.string)\n                color = color.string;\n\n            if (typeof color === 'string')\n                color = color.toLowerCase();\n            else\n                throw 'invalid color';\n\n            if (color === this.color)\n                return { type: this.type, color: this.color };\n\n            if (this.colorName[color])\n                return { type: 'hex', color: this.colorName[color] };\n\n            chkType = color.match(/^(rgba?|rgb?|hsla?|#)/g);\n\n            if (Array.isArray(chkType)) {\n\n                if (chkType[0] === '#') {\n\n                    if (color.length === 4)\n                        // convert shorthand hex\n                        color = color[0] + color[1] + color[1] + color[2] + color[2] + color[3] + color[3];\n\n                    if (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(color))\n                        // is valid hex\n                        type = 'hex';\n\n                    else\n                        throw 'invalid hex';\n\n                } else if (color[color.length - 1] === ')')\n                    // hex, rgb, rgba, hsl, hsla\n                    type = chkType[0];\n\n                return { type, color };\n\n            }\n\n        } catch (err) {\n            if (throwErr)\n                throw err + ':' + color;\n        }\n\n        return {};\n    }\n\n    _extractDigit(color_arg = this.color) {\n        let { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type === 'hex')\n            color = this.rgba(1, color).string;\n\n        const value = [];\n\n        for (const i of color.match(/\\d+(\\.\\d+)?/g))\n            value.push(parseFloat(i));\n\n        if (value.length < 4) value.push(1);\n\n        return value;\n    }\n\n    /**\n     * @return {number} - Retrieves color alpha value (range 0 ~ 1)\n     */\n    getAlpha(color_arg = this.color) {\n        let extract = this._extractDigit(color_arg);\n        return extract ? extract[3] || 1 : 1;\n    }\n\n    /**\n     * @typedef {Object} colorScheme\n     * @property {string} --alert\n     * @property {string} --alert-text\n     * @property {string} --alert-text_placeholder\n     * @property {string} --alert-text_shade\n     * @property {string} --alert-text_shadow\n     * @property {string} --alert-text_soft\n     * @property {string} --alert-text_transparent\n     * @property {string} --alert_placeholder\n     * @property {string} --alert_shade\n     * @property {string} --alert_shadow\n     * @property {string} --alert_soft\n     * @property {string} --alert_transparent\n     * @property {string} --analogous\n     * @property {string} --analogous-text\n     * @property {string} --analogous-text_placeholder\n     * @property {string} --analogous-text_shade\n     * @property {string} --analogous-text_shadow\n     * @property {string} --analogous-text_soft\n     * @property {string} --analogous-text_transparent\n     * @property {string} --analogous_placeholder\n     * @property {string} --analogous_shade\n     * @property {string} --analogous_shadow\n     * @property {string} --analogous_soft\n     * @property {string} --analogous_transparent\n     * @property {string} --background\n     * @property {string} --background-focus\n     * @property {string} --background-focus-nude\n     * @property {string} --background-focus-nude_placeholder\n     * @property {string} --background-focus-nude_shade\n     * @property {string} --background-focus-nude_shadow\n     * @property {string} --background-focus-nude_soft\n     * @property {string} --background-focus-nude_transparent\n     * @property {string} --background-focus-text\n     * @property {string} --background-focus-text_placeholder\n     * @property {string} --background-focus-text_shade\n     * @property {string} --background-focus-text_shadow\n     * @property {string} --background-focus-text_soft\n     * @property {string} --background-focus-text_transparent\n     * @property {string} --background-focus_placeholder\n     * @property {string} --background-focus_shade\n     * @property {string} --background-focus_shadow\n     * @property {string} --background-focus_soft\n     * @property {string} --background-focus_transparent\n     * @property {string} --background-text\n     * @property {string} --background-text_placeholder\n     * @property {string} --background-text_shade\n     * @property {string} --background-text_shadow\n     * @property {string} --background-text_soft\n     * @property {string} --background-text_transparent\n     * @property {string} --background_placeholder\n     * @property {string} --background_shade\n     * @property {string} --background_shadow\n     * @property {string} --background_soft\n     * @property {string} --background_transparent\n     * @property {string} --button\n     * @property {string} --button-nude\n     * @property {string} --button-nude_placeholder\n     * @property {string} --button-nude_shade\n     * @property {string} --button-nude_shadow\n     * @property {string} --button-nude_soft\n     * @property {string} --button-nude_transparent\n     * @property {string} --button-text\n     * @property {string} --button-text_placeholder\n     * @property {string} --button-text_shade\n     * @property {string} --button-text_shadow\n     * @property {string} --button-text_soft\n     * @property {string} --button-text_transparent\n     * @property {string} --button_placeholder\n     * @property {string} --button_shade\n     * @property {string} --button_shadow\n     * @property {string} --button_soft\n     * @property {string} --button_transparent\n     * @property {string} --complementary\n     * @property {string} --complementary-text\n     * @property {string} --complementary-text_placeholder\n     * @property {string} --complementary-text_shade\n     * @property {string} --complementary-text_shadow\n     * @property {string} --complementary-text_soft\n     * @property {string} --complementary-text_transparent\n     * @property {string} --complementary_placeholder\n     * @property {string} --complementary_shade\n     * @property {string} --complementary_shadow\n     * @property {string} --complementary_soft\n     * @property {string} --complementary_transparent\n     * @property {string} --content\n     * @property {string} --content-focus\n     * @property {string} --content-focus-nude\n     * @property {string} --content-focus-nude_placeholder\n     * @property {string} --content-focus-nude_shade\n     * @property {string} --content-focus-nude_shadow\n     * @property {string} --content-focus-nude_soft\n     * @property {string} --content-focus-nude_transparent\n     * @property {string} --content-focus-text\n     * @property {string} --content-focus-text_placeholder\n     * @property {string} --content-focus-text_shade\n     * @property {string} --content-focus-text_shadow\n     * @property {string} --content-focus-text_soft\n     * @property {string} --content-focus-text_transparent\n     * @property {string} --content-focus_placeholder\n     * @property {string} --content-focus_shade\n     * @property {string} --content-focus_shadow\n     * @property {string} --content-focus_soft\n     * @property {string} --content-focus_transparent\n     * @property {string} --content-text\n     * @property {string} --content-text_placeholder\n     * @property {string} --content-text_shade\n     * @property {string} --content-text_shadow\n     * @property {string} --content-text_soft\n     * @property {string} --content-text_transparent\n     * @property {string} --content_placeholder\n     * @property {string} --content_shade\n     * @property {string} --content_shadow\n     * @property {string} --content_soft\n     * @property {string} --content_transparent\n     * @property {string} --focus\n     * @property {string} --focus-text\n     * @property {string} --focus-text_placeholder\n     * @property {string} --focus-text_shade\n     * @property {string} --focus-text_shadow\n     * @property {string} --focus-text_soft\n     * @property {string} --focus-text_transparent\n     * @property {string} --focus_placeholder\n     * @property {string} --focus_shade\n     * @property {string} --focus_shadow\n     * @property {string} --focus_soft\n     * @property {string} --focus_transparent\n     * @property {string} --placeholder\n     * @property {string} --saturate\n     * @property {string} --saturate-text\n     * @property {string} --saturate-text_placeholder\n     * @property {string} --saturate-text_shade\n     * @property {string} --saturate-text_shadow\n     * @property {string} --saturate-text_soft\n     * @property {string} --saturate-text_transparent\n     * @property {string} --saturate_placeholder\n     * @property {string} --saturate_shade\n     * @property {string} --saturate_shadow\n     * @property {string} --saturate_soft\n     * @property {string} --saturate_transparent\n     * @property {string} --shade\n     * @property {string} --shadow\n     * @property {string} --success\n     * @property {string} --success-text\n     * @property {string} --success-text_placeholder\n     * @property {string} --success-text_shade\n     * @property {string} --success-text_shadow\n     * @property {string} --success-text_soft\n     * @property {string} --success-text_transparent\n     * @property {string} --success_placeholder\n     * @property {string} --success_shade\n     * @property {string} --success_shadow\n     * @property {string} --success_soft\n     * @property {string} --success_transparent\n     * @property {string} --toolbar\n     * @property {string} --toolbar-focus\n     * @property {string} --toolbar-focus-nude\n     * @property {string} --toolbar-focus-nude_placeholder\n     * @property {string} --toolbar-focus-nude_shade\n     * @property {string} --toolbar-focus-nude_shadow\n     * @property {string} --toolbar-focus-nude_soft\n     * @property {string} --toolbar-focus-nude_transparent\n     * @property {string} --toolbar-focus-text\n     * @property {string} --toolbar-focus-text_placeholder\n     * @property {string} --toolbar-focus-text_shade\n     * @property {string} --toolbar-focus-text_shadow\n     * @property {string} --toolbar-focus-text_soft\n     * @property {string} --toolbar-focus-text_transparent\n     * @property {string} --toolbar-focus_placeholder\n     * @property {string} --toolbar-focus_shade\n     * @property {string} --toolbar-focus_shadow\n     * @property {string} --toolbar-focus_soft\n     * @property {string} --toolbar-focus_transparent\n     * @property {string} --toolbar-text\n     * @property {string} --toolbar-text_placeholder\n     * @property {string} --toolbar-text_shade\n     * @property {string} --toolbar-text_shadow\n     * @property {string} --toolbar-text_soft\n     * @property {string} --toolbar-text_transparent\n     * @property {string} --toolbar_placeholder\n     * @property {string} --toolbar_shade\n     * @property {string} --toolbar_shadow\n     * @property {string} --toolbar_soft\n     * @property {string} --toolbar_transparent\n     * @property {string} --transparent\n     */\n    /**\n     * Generates color scheme object.\n     * @param {string} [color=this.color] - Focus color for color scheme\n     * @param {boolean} [darkMode=false] - Dark mode when true\n     * @return {colorScheme} - { [&lt;CSS Variable names&gt;] : &lt;string | HTML color string&gt; }\n     */\n    colorScheme(color = this.color, darkMode = false) {\n\n        let opacity = {\n            text: { black: 0.88, white: 1 },\n            soft: { black: 0.66, white: 0.88 },\n            placeholder: { black: 0.44, white: 0.55 },\n            transparent: { black: 0.22, white: 0.33 },\n            shade: { black: 0.066, white: 0.11 },\n            shadow: { black: 0.033, white: 0.066 }\n        };\n\n        let template = {\n            '--background': darkMode ? '#121212' : '#f7f7f7',\n            '--content': darkMode ? '#2b2b2b' : '#ffffff',\n            '--toolbar': darkMode ? '#2b2b2b' : '#ffffff'\n        };\n\n        let focusOriginal;\n        let focusSat;\n        let content_isHighLuminance = this.isHighLuminance(template['--content']);\n        let focus = (() => {\n            if (color && typeof color === 'object') {\n                if (color['--button']) {\n                    focusOriginal = color['--button'];\n                    return focusOriginal;\n                }\n                for (let key of color)\n                    if (key.includes('focus')) {\n                        focusOriginal = color[key];\n                        return focusOriginal;\n                    }\n            }\n\n            focusOriginal = color;\n            focusSat = this.matchLuminance(color, template['--content'], content_isHighLuminance ? 1.5 : 4.5);\n            return darkMode ? focusSat : color;\n        })();\n\n        let compDir = 1;\n        let analogous = (() => {\n            let deg = 30;\n            let analogous = this.analogous(focusOriginal, deg);\n            let focusHSL = this.hsla(1, focusOriginal).h;\n            let an1HSL = this.hsla(1, analogous[0]).h;\n            let an2HSL = this.hsla(1, analogous[1]).h;\n\n            if (focusHSL + deg > 360)\n                an1HSL = an1HSL + 360;\n            if (focusHSL - deg < 0)\n                an2HSL = 360 - an2HSL;\n\n            if (Math.abs(focusHSL - an1HSL) > Math.abs(focusHSL - an2HSL)) {\n                compDir = -1;\n                return analogous[1];\n            }\n\n            return analogous[0];\n        })();\n\n        let complementary = this.matchLuminance(this.complementary(focus, 60 * compDir), template['--background'], 3.1);\n        let fixedValue = {\n            '--shadow': 'rgba(0, 0, 0, 0.033)',\n            '--shade': 'rgba(0, 0, 0, 0.066)',\n            '--transparent': 'rgba(0, 0, 0, 0.22)',\n            '--placeholder': 'rgba(0, 0, 0, 0.33)'\n        };\n\n        let darkModeAnalogous = darkMode ? this.matchLuminance(analogous, template['--background'], 4.5) : analogous;\n        let analogousNude = this.matchLuminance(analogous, template['--background'], 4.5);\n\n        for (let k in template) {\n            template[k + '-text'] = this.textColor(opacity.text, template[k]);\n            template[k + '-focus'] = k.includes('--background') ? darkModeAnalogous : focus;\n            template[k + '-focus-nude'] = k.includes('--background') ? analogousNude : this.matchLuminance(darkMode ? focus : focusSat, template[k], 1.66);\n            template[k + '-focus-text'] = this.textColor(1, k.includes('--background') ? darkModeAnalogous : focus);\n        }\n\n        template['--focus'] = focusOriginal;\n        template['--focus-text'] = this.textColor(1, focusOriginal);\n        template['--saturate'] = focusSat;\n        template['--saturate-text'] = this.textColor(1, focusSat);\n\n        Object.assign(template, {\n            '--complementary': complementary,\n            '--complementary-text': this.textColor(1, complementary),\n            '--analogous': analogous,\n            '--analogous-text': this.textColor(1, analogous),\n            '--alert': 'tomato',\n            '--alert-text': 'white',\n            '--success': 'seagreen',\n            '--success-text': 'white',\n            '--button': focus,\n            '--button-nude': darkMode ? this.matchLuminance(focusSat, template[\"--content\"], 7) : this.contrastRatio(template[\"--content\"], focusSat) < 4.5 ? \"inherit\" : focusSat,\n            '--button-text': this.textColor(1, focus)\n        });\n\n        for (let k in template) {\n            if (!template[k] || template[k] === \"\")\n                continue;\n\n            let highLum = this.isHighLuminance(template[k]);\n            for (let op of ['soft', 'placeholder', 'transparent', 'shadow', 'shade']) {\n\n                template[k + '_' + op] = this.rgba(opacity[op][highLum ? 'white' : 'black'], template[k]).string;\n            }\n        }\n\n        // template['--button-border'] = (() => {\n        //     let focus_isHighLuminance = this.isHighLuminance(focus);\n        //     let border = this.matchLuminance(this.adjustLuminance(-1, template['--button']), template['--button'], 1.15, -1, focus_isHighLuminance ? 'luminance' : 'brightness');\n        //     return focus_isHighLuminance ? this.rgba(0.5, border).string : border;\n        // })();\n\n        if (color && typeof color === 'object') {\n            for (let key of color)\n                if (key[0] !== '-')\n                    throw 'invalid color scheme';\n            Object.assign(template, color);\n        }\n\n        let unordered = Object.assign(template, fixedValue);\n        return Object.keys(unordered).sort().reduce(\n            (obj, key) => {\n                obj[key] = unordered[key];\n                return obj;\n            },\n            {}\n        );\n    }\n\n    /**\n     * Match luminance of target_color with base color\n     * @param {string} target_color - Target color\n     * @param {string} [color_arg=this.color] - Base color\n     * @param {number} [target_ratio] - Set contrast ratio difference\n     * @param {number} [direction] - Adjust direction. Adjust to darker luminance when -1. Brighter when 1, otherwise auto.\n     * @param {string} [method] - Luminance adjustment mode: 'brightness | luminance | saturation'\n     * @return {string} - HTML color string\n     */\n    matchLuminance(target_color, color_arg = this.color, target_ratio, direction, method) {\n        let { color } = this._colorType(color_arg);\n        let target = this._colorType(target_color).color;\n\n        if (target_ratio) {\n            let adj = target;\n            let m = this.contrastRatio(adj, color);\n            if (m < target_ratio) {\n                let dir = direction || this.isHighLuminance(color) ? -1 : 1;\n                let count = 100;\n                while (m < target_ratio && count--) {\n                    let adj_set;\n\n                    switch (method) {\n                        case 'brightness':\n                            adj_set = this.adjustBrightness(1 * dir, adj);\n                            break;\n                        case 'luminance':\n                            adj_set = this.adjustLuminance(1 * dir, adj);\n                            break;\n                        default:\n                            adj_set = this.adjustBrightness(1 * dir, { legacy: true, color: adj });\n                    }\n\n                    if (adj === adj_set)\n                        break;\n                    adj = adj_set;\n\n                    m = this.contrastRatio(adj, color);\n                }\n            }\n            return this.hex(adj);\n        } else {\n            let main_lum = this._luminance(color);\n            let lum = this._luminance(target);\n\n            if (Math.abs(lum - main_lum) < 0.01)\n                return target;\n\n            let adj = this.hex(target);\n\n            let dir = (lum, main_lum) => {\n                return lum < main_lum ? 1 : -1;\n            };\n\n            let currDir = dir(lum, main_lum);\n            while (Math.abs(lum - main_lum) > 0.01 && currDir === dir(lum, main_lum)) {\n                let adj_set;\n                switch (method) {\n                    case 'saturation':\n                        adj_set = this.adjustBrightness(currDir, { color: adj, legacy: true });\n                        break;\n                    case 'luminance':\n                        adj_set = this.adjustLuminance(currDir, adj);\n                        break;\n                    default:\n                        adj_set = this.adjustBrightness(currDir, adj);\n                }\n                let lum_pre = this._luminance(adj_set);\n                if (lum_pre === lum || currDir !== dir(lum_pre, main_lum))\n                    break;\n                lum = lum_pre;\n                adj = adj_set;\n            }\n            return this.hex(adj);\n        }\n    }\n\n    /**\n     * Generate analogous color\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {number} [deg=30] - Amount of hue separation\n     * @return {Array} - 2 analogous color is returned. [&lt;hsla color&gt;, ... ]\n     */\n    analogous(color_arg = this.color, deg = 30) {\n        let { color } = this._colorType(color_arg);\n\n        let spin = (h, v) => {\n            let val = h + v;\n            return val < 0 ? 360 + val : val > 360 ? val - 360 : val;\n        };\n\n        let hsl = this.hsla(this.getAlpha(color), color);\n        let plus = 'hsla(' + spin(hsl.h, deg) + ', ' + hsl.s + '%, ' + hsl.l + '%, ' + hsl.a + ')';\n        let minus = 'hsla(' + spin(hsl.h, -deg) + ', ' + hsl.s + '%, ' + hsl.l + '%, ' + hsl.a + ')';\n\n        return [this.matchLuminance(plus, color), this.matchLuminance(minus, color)];\n    }\n\n    /**\n     * Generate complementary color\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {number} [add=0] - Add or subtract hue from complementary color\n     * @return {string} - HEX color string\n     */\n    complementary(color_arg = this.color, add = 0) {\n        let { color } = this._colorType(color_arg);\n\n        let hsl = this.hsla(this.getAlpha(color), color);\n\n        if (hsl.h < 180)\n            hsl.h += 180;\n        else\n            hsl.h -= 180;\n\n        hsl.h += add;\n        hsl.h = hsl.h > 360 ? hsl.h - 360 : hsl.h < 0 ? 360 - hsl.h : hsl.h;\n\n        return this.hex(this._toString(hsl));\n    }\n\n    /**\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {boolean} [fineTuned=false] - Custom Color space is applied when true\n     * @return {boolean} - True if color has high luminance\n     */\n    isHighLuminance(color_arg = this.color, fineTuned = this.fineTuned) {\n        const { r, g, b } = this.rgba(1, this._colorType(color_arg).color);\n\n        let yiq =\n            fineTuned ?\n                ((r * (299 - 64)) + (g * (587 * 1.25)) + (b * 114)) / 1000 : // Fine tuned\n                ((r * 299) + (g * 587) + (b * 114)) / 1000; // Standard color space formula\n\n        // Web standard of color space threshold is 128\n        return (yiq >= (fineTuned ? 188 : 128));\n    }\n\n    _luminance(color_arg = this.color) {\n        let rgb = this.rgba(1, color_arg);\n        let a = [rgb.r, rgb.g, rgb.b].map(function (v) {\n            v /= 255;\n            return v <= 0.03928\n                ? v / 12.92\n                : Math.pow((v + 0.055) / 1.055, 2.4);\n        });\n\n        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;\n    }\n\n    _toString(col) {\n        let numberOrNot = (n, def = 100) => {\n            return typeof n === 'number' ? n : def;\n        };\n        if (typeof col === 'string')\n            return col;\n\n        if (col.hasOwnProperty('h'))\n            return 'hsla(' + (col.h || 0) + ', ' + numberOrNot(col.s) + '%, ' + numberOrNot(col.l) + '%, ' + numberOrNot(col.a, 1) + ')';\n\n        if (col.hasOwnProperty('r'))\n            return 'rgba(' + numberOrNot(col.r) + ', ' + numberOrNot(col.g) + ', ' + numberOrNot(col.b) + ', ' + numberOrNot(col.a, 1) + ')';\n        throw col;\n    }\n\n    /**\n     * Returns contrast ratio between the given color.\n     * Useful to determine if the given color is suitable for text with the constructed color as a background.\n     * @param {string} color_arg1 - Color string you want to compare luminance ratio.\n     * @param {string} [color_arg2=this.color] - Color string you want to compare with color_arg1\n     * @return {number} - Contrast ratio\n     */\n    contrastRatio(color_arg1, color_arg2 = this.color) {\n        let lum1 = this._luminance(color_arg2) + 0.05;\n        let lum2 = this._luminance(color_arg1) + 0.05;\n\n        return lum1 > lum2 ? lum1 / lum2 : lum2 / lum1;\n    }\n\n    /**\n     * Returns suitable text color (Black / White).\n     * @param {(number | Object)} opacity - Can set returning color values opacity.\n     * @param {number} opacity.black - Set returning color values opacity when the result color is black.\n     * @param {number} opacity.white - Set returning color values opacity when the result color is white.\n     * @param {(string|Object)} [option=this.color] - Background color of text\n     * @param {(string|Object)} [option.color=this.color] - Background color of text\n     * @param {(string|Object)} [option.fineTuned=true] - Follows standard color space calculation when false\n     * @return {string | null} - HTML color string\n     */\n    textColor(opacity = 1, option = this.color) {\n\n        if (typeof option === 'string')\n            option = { color: option };\n\n        let { color = this.color, fineTuned = true } = option;\n\n        color = this._colorType(color).color;\n\n        // returns null if color opacity is below 0.5\n        if (this.getAlpha(color) < 0.5)\n            return \"\";\n\n        let blackOpacity, whiteOpacity;\n\n        if (typeof opacity === 'number' && opacity < 1) {\n            blackOpacity = opacity;\n            whiteOpacity = opacity;\n        } else if (opacity && typeof opacity === 'object') {\n            for (let k of ['black', 'white']) {\n                let opa = opacity[k];\n                if (typeof opa === 'number' && opa < 1) {\n                    if (k === 'black')\n                        blackOpacity = opa;\n                    else if (k === 'white')\n                        whiteOpacity = opa;\n                }\n            }\n        }\n\n        const opa = (v) => {\n            if (typeof v === 'number') {\n                if (v < 1 && v > 0) return v;\n                else if (v > 1) return 1;\n                else return 0;\n            } else return 1;\n        };\n\n        if (this.isHighLuminance(color, fineTuned))\n            return blackOpacity ? `rgba(0, 0, 0, ${opa(blackOpacity)})` : 'black';\n\n        return whiteOpacity ? `rgba(255, 255, 255, ${opa(whiteOpacity)})` : 'white';\n    }\n\n    /**\n     * Returns hsla color\n     * @param {number} [opacity] - Set opacity for returning color value.\n     * @param {string} [color_arg=this.color] - Color to convert to hsla string\n     * @return {Object} - { h: &lt;number&gt;, s: &lt;number&gt;, l: &lt;number&gt;, r: &lt;number&gt;, g: &lt;number&gt;, b: &lt;number&gt;, a: &lt;number&gt;, string: &lt;string | rgba color string&gt; }\n     */\n    hsla(opacity, color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        const hsl = (r, g, b) => {\n            r /= 255;\n            g /= 255;\n            b /= 255;\n\n            let c_min = Math.min(r, g, b),\n                c_max = Math.max(r, g, b),\n                delta = c_max - c_min,\n                h = 0,\n                s = 0,\n                l = 0;\n\n            if (delta === 0)\n                h = 0;\n            else if (c_max === r)\n                h = ((g - b) / delta) % 6;\n            else if (c_max === g)\n                h = (b - r) / delta + 2;\n            else\n                h = (r - g) / delta + 4;\n\n            h = Math.round(h * 60);\n\n            if (h < 0) h += 360;\n\n            l = (c_max + c_min) / 2;\n            s = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));\n            s = +(s * 100).toFixed(1);\n            l = +(l * 100).toFixed(1);\n            return { h, s, l };\n        };\n\n        if (type === 'hex') {\n            opacity = typeof opacity === 'number' ? opacity : 1;\n            const rgba = this.rgba(opacity, color);\n            const { r, g, b, a } = rgba;\n            const { h, s, l } = hsl(r, g, b);\n\n            return {\n                r, g, b, a,\n                h: h,\n                s: s,\n                l: l,\n                string: this._toString({ h, s, l, a: opacity })\n            };\n\n        } else {\n\n            const digit = this._extractDigit(color);\n            opacity = typeof opacity === 'number' ? opacity : digit[3] || 1;\n\n            if (type.includes('hsl')) {\n                const { r, g, b, a } = this.rgba(opacity, color);\n\n                return {\n                    r, g, b, a,\n                    h: digit[0],\n                    s: digit[1],\n                    l: digit[2],\n                    string: this._toString({\n                        h: digit[0],\n                        s: digit[1],\n                        l: digit[2],\n                        a\n                    })\n                };\n\n            } else if (type.includes('rgb')) {\n                const value = {\n                    r: digit[0],\n                    g: digit[1],\n                    b: digit[2],\n                    a: opacity\n                };\n                const { h, s, l } = hsl(value.r, value.g, value.b);\n\n                return Object.assign(value, {\n                    r: value.r,\n                    g: value.g,\n                    b: value.b,\n                    h: h,\n                    s: s,\n                    l: l,\n                    a: value.a,\n                    string: this._toString({ h, s, l, a: value.a })\n                });\n\n            }\n        }\n    }\n\n    /**\n     * Returns hex color string\n     * @param {string} [color_arg=this.color] - Color to convert to hex string\n     * @return {string} - HEX color string\n     */\n    hex(color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type.includes('rgb') || type.includes('hsl')) {\n            const rgba = this.rgba(1, color);\n            return '#' + ((1 << 24) + (rgba.r << 16) + (rgba.g << 8) + rgba.b).toString(16).slice(1);\n        }\n\n        return color;\n    }\n\n    /**\n     * Returns rgba color\n     * @param {number} [opacity] - Set opacity of returning color\n     * @param {string} [color_arg=this.color] - Color to convert to rgba string\n     * @return {Object} - { r: &lt;number&gt;, g: &lt;number&gt;, b: &lt;number&gt;, a: &lt;number&gt;, string: &lt;string | HTML color string&gt; }\n     */\n    rgba(opacity, color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type === 'hex') {\n            const hex = color;\n            let rgbObject = { r: null, g: null, b: null };\n            let hexValues = hex.match(/[a-fA-F0-9]{2}/g);\n\n            if (hex.length === 4) {\n                hexValues = hex.match(/[a-fA-F0-9]{1}/g);\n                hexValues = hexValues.map(hex => \"\" + hex + hex);\n            }\n            let count = 0;\n            for (const key in rgbObject) {\n                rgbObject[key] = parseInt(hexValues[count], 16);\n                count++;\n            }\n\n            const opacity_value = typeof opacity === 'number' ? opacity : 1;\n            let { r, g, b } = rgbObject;\n\n            return {\n                ...rgbObject,\n                a: opacity_value,\n                string: this._toString({\n                    r: +r, g: +g, b: +b, a: opacity_value\n                })\n            };\n\n        } else {\n            const digit = this._extractDigit(color);\n            const a = typeof opacity === 'number' ? opacity : digit[3] || 1;\n\n            if (type.includes('rgb')) {\n\n                let value = {\n                    r: digit[0],\n                    g: digit[1],\n                    b: digit[2],\n                    a\n                };\n\n                return Object.assign({\n                    string: this._toString(value)\n                }, value);\n\n            } else if (type.includes('hsl')) {\n\n                let h = digit[0];\n                let s = digit[1];\n                let l = digit[2];\n\n                s /= 100;\n                l /= 100;\n\n                let c = (1 - Math.abs(2 * l - 1)) * s,\n                    x = c * (1 - Math.abs((h / 60) % 2 - 1)),\n                    m = l - c / 2,\n                    r = 0,\n                    g = 0,\n                    b = 0;\n                if (0 <= h && h < 60) {\n                    r = c;\n                    g = x;\n                    b = 0;\n                } else if (60 <= h && h < 120) {\n                    r = x;\n                    g = c;\n                    b = 0;\n                } else if (120 <= h && h < 180) {\n                    r = 0;\n                    g = c;\n                    b = x;\n                } else if (180 <= h && h < 240) {\n                    r = 0;\n                    g = x;\n                    b = c;\n                } else if (240 <= h && h < 300) {\n                    r = x;\n                    g = 0;\n                    b = c;\n                } else if (300 <= h && h < 360) {\n                    r = c;\n                    g = 0;\n                    b = x;\n                }\n                r = Math.round((r + m) * 255);\n                g = Math.round((g + m) * 255);\n                b = Math.round((b + m) * 255);\n\n                return {\n                    r, g, b, a,\n                    string: this._toString({ r, g, b, a })\n                };\n\n            }\n        }\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {(string|Object)} [option=this.color] - Color to adjust || additional option.\n     * @param {(string|Object)} [option.color_arg=this.color] - Color to adjust.\n     * @param {(string|Object)} [option.legacy=false] - Legacy adjust mode. Adjust brightness by saturation and luminance.\n     * @return {string} - Brightness adjusted HTML color string\n     */\n    adjustBrightness(value = 0, option = this.color) {\n        let color_arg, legacy = false;\n        if (typeof option === 'string')\n            color_arg = option || this.color;\n        else {\n            color_arg = option.color || this.color;\n            legacy = option.legacy || false;\n        }\n\n        if (legacy) {\n            let { color } = this._colorType(color_arg);\n            let col = this.hsla(this.getAlpha(color), color);\n\n            let limit = (v, limit = 100) => {\n                return v > limit ? limit : v < 0 ? 0 : v;\n            };\n\n            col.s += ((value > 0 ? (100 - col.s) : col.s) / 100) * value;\n            col.s = limit(col.s);\n            col.l += ((value > 0 ? (100 - col.l) : col.l) / 100) * value;\n            col.l = limit(col.l);\n\n            return this._toString(col);\n        }\n\n        let { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (value === 0)\n            return color;\n\n        const opacity = type === 'hex' ? 1 : this._extractDigit(color)[3] || 1;\n        const rgb = this.rgba(opacity, color);\n\n        let rgbRange = {\n            r: 0 - rgb['r'],\n            g: 0 - rgb['g'],\n            b: 0 - rgb['b']\n        };\n\n        if (value > 0) {\n            Object.keys(rgbRange).map(function (key) {\n                rgbRange[key] = 255 - rgb[key];\n            });\n        }\n\n        ['r', 'g', 'b'].map(function (key) {\n            rgb[key] += parseInt(rgbRange[key] / 100 * Math.abs(value));\n        });\n\n        const result = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';\n\n        if (type === 'hex')\n            return this.hex(result);\n\n        else if (type.includes('rgb'))\n            return this.rgba(rgb.a, result).string;\n\n        else if (type.includes('hsl'))\n            return this.hsla(rgb.a, result).string;\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {string} [color_arg=this.color] - Color to adjust.\n     * @return {string} - Luminance adjusted hsla color string\n     */\n    adjustLuminance(value = 0, color_arg = this.color) {\n        let { color } = this._colorType(color_arg);\n        let col = this.hsla(this.getAlpha(color), color);\n\n        let limit = (v, limit = 100) => {\n            return v > limit ? limit : v < 0 ? 0 : v;\n        };\n\n        col.l += ((value > 0 ? (100 - col.l) : col.l) / 100) * value;\n        col.l = limit(col.l);\n\n        return this._toString(col);\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {string} [color_arg=this.color] - Color to adjust.\n     * @return {string} - Saturation adjusted hsla color string\n     */\n    adjustSaturation(value = 0, color_arg = this.color) {\n        let { color } = this._colorType(color_arg);\n        let col = this.hsla(this.getAlpha(color), color);\n\n        let limit = (v, limit = 100) => {\n            return v > limit ? limit : v < 0 ? 0 : v;\n        };\n\n        col.s += ((value > 0 ? (100 - col.s) : col.s) / 100) * value;\n        col.s = limit(col.s);\n\n        return this._toString(col);\n    }\n}\n\nexport { ColorMangle };","import { ColorMangle } from \"colormangle\";\n\nclass Wysiwyg4All {\n  /**\n   * Wysiwyg4All is a simple framework for building a text editor for your website.\n   * Focused on expandability and customizations.\n   * Additional library ColorMangle is required for text colors.\n   * @param {{}} option - Options\n   * @param {string} option.elementId - ID of target <DIV>.\n   * @param {boolean} [option.editable=true] - When set to false, Wysiwyg will not be editable. By doing this, it can be used as readonly.\n   * @param {string} [option.placeholder=''] - Add placeholder string.\n   * @param {boolean} [option.spellcheck=false] - Set spellcheck to true/false.\n   * @param {string | object} [option.highlightColor='teal'] - Sets the highlight color of the wysiwyg (web color name | hex | rgb | hsl). Or can provide custom color scheme object (more details in api doc).\n   * @param {string} [option.html=''] - HTML string to load on initialization.\n   * @param {function} [option.callback=(cb)=>{return cb}] - Setup callback function. Callback argument contains array of information such as current text style, added images, hashtags, urllinks, selected range... etc.\n   * @param {{} | number} [option.fontSize={desktop:18, tablet: 16, phone: 14}] - Set default font size of each screen size in px. If number is given all screen size will share the same give font size.\n   * @param {boolean} [option.lastLineBlank=false] - When set to true, Blank line will always be added on the last line of wysiwyg.\n   * @param {boolean} [option.hashtag=false] - When set to true, wysiwyg will auto detect hashtag strings.\n   * @param {boolean} [option.urllink=false] - When set to true, wysiwyg will auto detect url strings.\n   * @param {boolean} [option.logMutation=false] - When set to true, wysiwyg will output dom mutation data via callback function.\n   */\n  constructor(option) {\n    this.hashtag_regex =\n      /#[\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC\\w-]+(?:\\+[\\w-]+)*/g;\n    this.hashtag_stopper_regex =\n      /[^\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC\\w-]/g;\n    this.urllink_regex =\n      /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})/gi;\n\n    let {\n      elementId = \"\",\n      editable = true,\n      placeholder = \"\",\n      spellcheck = false,\n      highlightColor = \"teal\",\n      html = \"\",\n      callback,\n      fontSize = {\n        desktop: \"18px\",\n        tablet: \"16px\",\n        phone: \"14px\",\n\n        h1: 4.2,\n        h2: 3.56,\n        h3: 2.92,\n        h4: 2.28,\n        h5: 1.64,\n        h6: 1.15,\n        small: 0.8,\n      },\n      lastLineBlank = false,\n      hashtag = false,\n      urllink = false,\n      logMutation = false,\n      logExecution = false,\n    } = option;\n\n    this.hashtag = hashtag;\n    this.urllink = urllink;\n    this.logMutation = logMutation;\n    this.logExecution = logExecution;\n    this.fontSizeCssVariable = {};\n\n    if (typeof fontSize === \"number\")\n      this.fontSizeCssVariable = {\n        \"--wysiwyg-font-desktop\": `${fontSize}`,\n        \"--wysiwyg-font-tablet\": `${fontSize}`,\n        \"--wysiwyg-font-phone\": `${fontSize}`,\n      };\n    else if (typeof fontSize === \"object\" && Object.keys(fontSize).length) {\n      let hold;\n      let keyArr = [\"desktop\", \"tablet\", \"phone\"];\n\n      for (let k of keyArr) {\n        if (fontSize[k]) {\n          hold = fontSize[k];\n          if (typeof hold === \"number\") hold = `${hold}px`;\n        }\n        this.fontSizeCssVariable[`--wysiwyg-font-${k}`] = `${hold}`;\n      }\n    }\n\n    if (!elementId || typeof elementId !== \"string\")\n      throw new Error(\"The wysiwyg element should have an ID\");\n    elementId = elementId[0] === \"#\" ? elementId.substring(1) : elementId;\n\n    this.html = html;\n    this.elementId = elementId[0] === \"#\" ? elementId.substring(1) : elementId;\n    this.placeholder = placeholder;\n    this.spellcheck = spellcheck;\n    this.lastLineBlank = lastLineBlank;\n\n    if (typeof highlightColor === \"string\")\n      highlightColor = new ColorMangle(highlightColor).color;\n\n    this.colorScheme = highlightColor;\n    this.callback = callback || null;\n\n    this.image_array = [];\n    this.hashtag_array = [];\n    this.urllink_array = [];\n    this.custom_array = [];\n\n    this.blockElement_queryArray = [\n      \"HR\",\n      \"BLOCKQUOTE\",\n      \"UL\",\n      \"OL\",\n      \"._media_\",\n      \"._custom_\",\n    ];\n    this.specialTextElement_queryArray = [\"._hashtag_\", \"._urllink_\"];\n    this.restrictedElement_queryArray = [\"._media_\", \"._custom_\"];\n    this.textAreaElement_queryArray = [\"BLOCKQUOTE\", \"LI\"];\n    this.textBlockElement_queryArray = [\"P\", \"LI\", \"TD\", \"TH\"]; //, \"TD\", \"TH\", '._color', '._small', '._h1`', '._h2', '._h3', '._h4', '._h5', '._h6', '._b', '._i', '._u', '._del'\n    this.ceilingElement_queryArray = [\n      \"UL\",\n      \"OL\",\n      \"BLOCKQUOTE\",\n      `#${elementId}`,\n      \"TD\",\n      \"TH\",\n    ];\n    this.unSelectable_queryArray = [\n      \"._media_\",\n      \"._custom_\",\n      \"._hashtag_\",\n      \"._urllink_\",\n      \"HR\",\n    ];\n    this.styleAllowedElement_queryArray = [\n      \"._color\",\n      `#${elementId}`,\n      \"._hashtag_\",\n      \"._urllink_\",\n      \"TD\",\n      \"TH\",\n    ]; // ALLOWED ELEMENTS FOR STYLE ATTRIBUTE <... style=\"...\">\n    this.alignClass = [\"_alignCenter_\", \"_alignRight_\"];\n\n    this.hashtag_flag = false;\n    this.urllink_flag = false;\n    this.range_backup = null;\n\n    this.commandTracker = {};\n    this.range = null;\n    this.isRangeDirectionForward = true;\n    this.insertTabPending_tabString = \"\";\n    this.removeSandwichedLine_array = [];\n    this.lastKey = null;\n\n    //  setup div\n    this.element = document.getElementById(this.elementId);\n    if (!this.element) throw `element #${this.elementId} is null`;\n\n    this.element.innerHTML = \"\";\n\n    this.cssVariable = new ColorMangle().colorScheme(this.colorScheme);\n    Object.assign(this.cssVariable, this.fontSizeCssVariable);\n\n    for (const v in this.cssVariable)\n      this.element.style.setProperty(v, this.cssVariable[v]);\n\n    this.elementComputedStyle = window.getComputedStyle(this.element);\n    this.defaultFontColor = new ColorMangle(\n      this.cssVariable[\"--content-text\"]\n    ).hex();\n    this.highlightColor = new ColorMangle(\n      this.cssVariable[\"--content-focus\"]\n    ).hex();\n\n    if (!this.element.classList.contains(\"_wysiwyg4all\"))\n      this.element.classList.add(\"_wysiwyg4all\");\n\n    this.setPlaceholder(this.placeholder);\n    this.setSpellcheck(this.spellcheck);\n\n    //  re-adjust min-height depending on padding\n    let paddingB = this.elementComputedStyle.paddingBottom;\n    let paddingT = this.elementComputedStyle.paddingTop;\n    let borderT = this.elementComputedStyle.borderTopWidth;\n    let borderB = this.elementComputedStyle.borderBottomWidth;\n\n    this.element.style.minHeight = `calc(${paddingB} + ${paddingT} + ${borderT} + ${borderB} + 1.6em)`;\n\n    //  command style tag\n    const command = {\n      //  [<targetClassName>, <cssProperty>, [<string: counter tag | class name>]]\n      h1: [\"_h1\", \"fontSize\", [\"_small\", \"_h2\", \"_h3\", \"_h4\", \"_h5\", \"_h6\"]],\n      h2: [\"_h2\", \"fontSize\", [\"_small\", \"_h1\", \"_h3\", \"_h4\", \"_h5\", \"_h6\"]],\n      h3: [\"_h3\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h4\", \"_h5\", \"_h6\"]],\n      h4: [\"_h4\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h3\", \"_h5\", \"_h6\"]],\n      h5: [\"_h5\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h3\", \"_h4\", \"_h6\"]],\n      h6: [\"_h6\", \"fontSize\", [\"_small\", \"_h1\", \"_h2\", \"_h3\", \"_h4\", \"_h5\"]],\n      italic: [\"_i\", \"fontStyle\"],\n      small: [\n        \"_small\",\n        \"fontSize\",\n        [\"_h1\", \"_h2\", \"_h3\", \"_h4\", \"_h5\", \"_h6\", \"_b\"],\n      ],\n      bold: [\"_b\", \"fontWeight\", [\"_small\"]],\n      underline: [\"_u\", \"textDecoration\", [\"_del\"]],\n      strike: [\"_del\", \"textDecoration\", [\"_u\"]],\n      color: [\"_color\", \"color\"],\n    };\n\n    const fontSizeRatio = {\n      //  should always be the same em value as css\n      // h1: 4.2,\n      // h2: 3.56,\n      // h3: 2.92,\n      // h4: 2.28,\n      // h5: 1.64,\n      // h6: 1.15,\n      // small: 0.8,\n      h1: fontSize.h1 || 4.2,\n      h2: fontSize.h2 || 3.56,\n      h3: fontSize.h3 || 2.92,\n      h4: fontSize.h4 || 2.28,\n      h5: fontSize.h5 || 1.64,\n      h6: fontSize.h6 || 1.15,\n      small: fontSize.small || 0.8,\n    };\n\n    // // font size variables\n    // --wysiwyg-h1: calc(var(--wysiwyg-font) * 4.2);\n    // --wysiwyg-h2: calc(var(--wysiwyg-font) * 3.56);\n    // --wysiwyg-h3: calc(var(--wysiwyg-font) * 2.92);\n    // --wysiwyg-h4: calc(var(--wysiwyg-font) * 2.28);\n    // --wysiwyg-h5: calc(var(--wysiwyg-font) * 1.64);\n    // --wysiwyg-h6: calc(var(--wysiwyg-font) * 1.15);\n    // --wysiwyg-small: calc(var(--wysiwyg-font) * 0.8);\n    for (const [tag, ratio] of Object.entries(fontSizeRatio)) {\n      if (typeof ratio === \"number\") {\n        this.element.style.setProperty(\n          `--wysiwyg-${tag}`,\n          `calc(var(--wysiwyg-font) * ${ratio})`\n        );\n      } else if (typeof ratio === \"string\") {\n        if (ratio.includes(\"px\")) {\n          this.element.style.setProperty(`--wysiwyg-${tag}`, ratio);\n        } else if (ratio.includes(\"em\") || ratio.includes(\"rem\")) {\n          let emSize = parseFloat(ratio);\n          if (emSize > 0) {\n            this.element.style.setProperty(\n              `--wysiwyg-${tag}`,\n              `calc(var(--wysiwyg-font) * ${emSize})`\n            );\n          }\n        }\n      }\n    }\n\n    this.styleTagOfCommand = {};\n    this.counterTagOf = {};\n    this.cssPropertyOf = {};\n    this.cssPropertyChecker = {\n      textDecoration: (v) => {\n        //  v = <string: value from computedStyle>\n        if (v.includes(\"underline\")) return \"underline\";\n        else if (v.includes(\"line-through\")) return \"strike\";\n\n        return false;\n      },\n      fontSize: (v) => {\n        //  v = <string: value from computedStyle>\n        let documentFontSize = parseFloat(this.elementComputedStyle.fontSize);\n        let nodeFontSize = parseFloat(v);\n        for (let tag in fontSizeRatio) {\n          let f_size = fontSizeRatio[tag];\n\n          if (typeof f_size === \"number\") {\n            //  precision\n            let compare_size = documentFontSize * f_size;\n            let f_size_high = compare_size + 0.01;\n            let f_size_low = compare_size - 0.01;\n            if (f_size_high > nodeFontSize && f_size_low < nodeFontSize)\n              return tag;\n          } else if (typeof f_size === \"string\") {\n            if (f_size.includes(\"px\")) {\n              if (v === f_size) return tag;\n            } else if (f_size.includes(\"em\") || f_size.includes(\"rem\")) {\n              let emSize = parseFloat(f_size);\n              if (emSize > 0) {\n                let compare_size = documentFontSize * emSize;\n                let f_size_high = compare_size + 0.01;\n                let f_size_low = compare_size - 0.01;\n                if (f_size_high > nodeFontSize && f_size_low < nodeFontSize)\n                  return tag;\n              }\n            }\n          }\n        }\n        return false;\n      },\n      fontStyle: (v) => {\n        //  v = <string: value from computedStyle>\n        if (v.includes(\"italic\")) return \"italic\";\n        return false;\n      },\n    };\n\n    for (let c in command) {\n      this.commandTracker[c] = false;\n      this.styleTagOfCommand[c] = command[c][0];\n      this.cssPropertyOf[command[c][0]] = command[c][1];\n      if (!this.cssPropertyChecker.hasOwnProperty(command[c][1]))\n        this.cssPropertyChecker[command[c][1]] = c;\n      if (command[c][2]) this.counterTagOf[command[c][0]] = command[c][2];\n    }\n\n    /**\n         this.styleTagOfCommand = {\n            [commandKey]: <targetClassName>\n         };\n\n         this.cssPropertyChecker = {\n            [cssPropertyKey]: <commandKey | function(<cssValue>)>\n         };\n\n         this.cssPropertyOf = {\n            [targetClassName]: <cssPropertyKey>\n         };\n\n         this.counterTagOf = {\n            [targetClassName]: [<counterClassName>]\n         };\n\n         this.commandTracker = {\n            [commandKey]: <boolean>\n         };\n\n         console.log({\n            styleTagOfCommand: this.styleTagOfCommand,\n            cssPropertyChecker: this.cssPropertyChecker,\n            cssPropertyOf: this.cssPropertyOf,\n            counterTagOf: this.counterTagOf,\n            commandTracker: this.commandTracker\n         });\n         */\n\n    this.loadHTML(this.html, editable).catch((err) => {\n      throw err;\n    });\n  }\n\n  _adjustSelection(\n    target,\n    ceilingElement_query = this.ceilingElement_queryArray\n  ) {\n    if (this.logExecution)\n      console.log(\"_adjustSelection()\", { target, ceilingElement_query });\n\n    let toArray = (v, allowObject = false) => {\n      if (Array.isArray(v)) return v;\n      else if (\n        (typeof v === \"string\" && v) ||\n        typeof v === \"number\" ||\n        typeof v === \"boolean\" ||\n        (allowObject && typeof v === \"object\")\n      )\n        return [v];\n      else return [];\n    };\n\n    let setRange = !!target;\n\n    let { node = null, position = true } = target || {};\n\n    let sel = window.getSelection();\n    if (!sel) return null;\n\n    let range;\n    try {\n      range = sel.getRangeAt(0);\n    } catch (err) {\n      if (setRange) range = document.createRange();\n    }\n\n    if (setRange) {\n      node = toArray(node, true);\n      position = toArray(position, true);\n\n      for (let p of position)\n        if (typeof p !== \"number\" && typeof p !== \"boolean\" && p !== null)\n          throw \"INVALID_POSITION\";\n\n      for (let n of node) {\n        if (!(n instanceof Node) && n !== null) {\n          if (n === false) return;\n          throw \"INVALID_NODE\";\n        }\n      }\n\n      const setTarget = (node, position) => {\n        if (node instanceof Node) {\n          if (node.nodeType === 1) {\n            if (typeof position === \"boolean\")\n              while (position === false ? node.lastChild : node.firstChild)\n                node = position === false ? node.lastChild : node.firstChild;\n            else if (typeof position === \"number\") {\n              let textLength = 0;\n              this._nodeCrawler(\n                (n) => {\n                  if (n.nodeType === 3 && n.textContent.length) {\n                    let length = n.textContent.length;\n                    if (\n                      n.parentNode.getAttribute(\"contenteditable\") === \"false\"\n                    ) {\n                      if (position - (textLength + length) >= 0)\n                        textLength += length;\n                      else {\n                        position = length;\n                        return \"BREAK\";\n                      }\n                      return n;\n                    } else {\n                      node = n;\n\n                      if (position - (textLength + length) >= 0) {\n                        textLength += length;\n                      } else {\n                        position -= textLength;\n                        return \"BREAK\";\n                      }\n                    }\n                  }\n                  return n;\n                },\n                {\n                  node,\n                }\n              );\n              if (node.nodeType === 1) {\n                let text = document.createTextNode(\"\\u200B\");\n                node.insertBefore(text, node.childNodes[0]);\n                node = text;\n                position = 0;\n              }\n            }\n\n            if (node.nodeName === \"BR\" && node.parentNode.childNodes.length > 1)\n              node = node.previousSibling || node;\n          }\n          if (typeof position === \"boolean\")\n            position = position ? 0 : node.textContent.length;\n          else\n            position =\n              position > node.textContent.length\n                ? node.textContent.length\n                : position;\n\n          return { node, position };\n        }\n      };\n\n      let doCollapse = false,\n        setEnd,\n        setStart = (() => {\n          node[0] = node[0] === null ? range.startContainer : node[0];\n          position[0] = position[0] === null ? range.startOffset : position[0];\n          return setTarget(node[0], position[0]);\n        })();\n      range.setStart(setStart.node, setStart.position);\n\n      if (position.length > 1)\n        setEnd = setTarget(\n          (node[1] === null ? range.endContainer : node[1]) || node[0],\n          position[1] === null ? range.endOffset : position[1]\n        );\n      else {\n        setEnd = setStart;\n        doCollapse = true;\n      }\n\n      range.setEnd(setEnd.node, setEnd.position);\n\n      if (doCollapse) range.collapse(true);\n\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n\n    if (ceilingElement_query && range) {\n      let startLine, endLine;\n      for (let q of ceilingElement_query) {\n        let e =\n          range.endContainer.nodeType === 3\n            ? range.endContainer.parentNode\n            : range.endContainer;\n        let s =\n          range.startContainer.nodeType === 3\n            ? range.startContainer.parentNode\n            : range.startContainer;\n\n        if (!startLine && s.closest(q))\n          startLine = this._climbUpToEldestParent(s, s.closest(q));\n        if (!endLine && e.closest(q))\n          endLine = this._climbUpToEldestParent(e, e.closest(q));\n      }\n\n      range.startLine = startLine;\n      range.endLine = endLine;\n    }\n\n    return range;\n  }\n\n  _generateId(option) {\n    if (this.logExecution) console.log(\"_generateId()\", { option });\n    let limit = 12;\n    let prefix = \"\";\n\n    if (typeof option === \"number\") limit = option;\n    else if (typeof option === \"string\") prefix = `${option}_`;\n\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n\n    let text = \"\";\n    for (let i = 0; i < limit - 6; i++)\n      text += possible.charAt(\n        Math.floor(Math.random() * (possible.length - 1))\n      );\n\n    const numb = new Date().getTime().toString().substring(7, 13); // SECOND, MILLISECOND\n\n    // const shuffleArray = (array) => {\n    //     let currentIndex = array.length;\n    //     let temporaryValue, randomIndex;\n    //     while (0 !== currentIndex) {\n    //         randomIndex = Math.floor(Math.random() * currentIndex);\n    //         currentIndex -= 1;\n    //         temporaryValue = array[currentIndex];\n    //         array[currentIndex] = array[randomIndex];\n    //         array[randomIndex] = temporaryValue;\n    //     }\n    //     return array;\n    // };\n\n    // const letter_array = shuffleArray((text + numb).split(''));\n\n    // let output = '';\n    // for (let i = 0; i < limit; i++) output += letter_array[i];\n\n    return prefix + numb + text;\n  }\n\n  _nodeCrawler(run, option) {\n    if (this.logExecution) console.log(\"_nodeCrawler()\", { run, option });\n    const { parentNode, node, startFromEldestChild, startNode } = option;\n\n    if (startFromEldestChild && !parentNode)\n      throw new Error(\"Need parentNode to crawl up single child\");\n\n    if (!node || !(node instanceof Node || node?.commonAncestorContainer))\n      throw new Error(\"No node to crawl\");\n\n    let outputNodes = [],\n      nodeIsRange = !!node.commonAncestorContainer,\n      commonContainer = null,\n      parentAnchor;\n\n    if (parentNode && parentNode instanceof Node && parentNode?.nodeType === 1)\n      parentAnchor = parentNode;\n\n    if (nodeIsRange) {\n      commonContainer = node.commonAncestorContainer;\n      commonContainer =\n        commonContainer.nodeType === 3\n          ? commonContainer.parentNode || commonContainer\n          : commonContainer;\n    } else commonContainer = node;\n\n    if (startFromEldestChild)\n      commonContainer = this._climbUpToEldestParent(\n        commonContainer,\n        parentNode,\n        true\n      );\n\n    if (parentAnchor) {\n      while (\n        commonContainer.nodeType === 3 ||\n        (commonContainer !== parentAnchor &&\n          commonContainer.parentNode &&\n          commonContainer.parentNode !== parentAnchor)\n      )\n        commonContainer = commonContainer.parentNode;\n    }\n\n    /** crawl order below (outputs node on the way)\n     *  If 'BREAK' is returned, the node is not saved in outputNode\n     *\n     *  start   ->  [                   end\n     *                  |               ^ (finish)\n     *                  v               | (outputNode)\n     *              outputNode  ->  outputNode\n     *\n     *  NOTE: Will not crawl when node is textNode\n     */\n\n    if (commonContainer.nodeType === 3) {\n      outputNodes.push(run(commonContainer));\n\n      return { nodes: outputNodes, commonContainer };\n    }\n\n    let id, uniqueId;\n    if (commonContainer.nodeType === 1) {\n      uniqueId =\n        commonContainer.id ||\n        (() => {\n          id = this._generateId(\"crawl\");\n          commonContainer.id = id;\n          return id;\n        })();\n    }\n\n    let crawl =\n      (startNode instanceof Node ? startNode : null) ||\n      (nodeIsRange ? node.startContainer : commonContainer.childNodes[0]);\n    let endNode = nodeIsRange\n      ? node.endContainer\n      : commonContainer.childNodes[\n          commonContainer.childNodes.length\n            ? commonContainer.childNodes.length - 1\n            : 0\n        ];\n\n    let withInRange = (cwl) => {\n      if (!cwl || !(cwl instanceof Node)) return false;\n      if (cwl.nodeType === 1)\n        return cwl.id !== uniqueId && cwl.parentNode?.closest(\"#\" + uniqueId);\n      else return true;\n    };\n\n    while (withInRange(crawl)) {\n      if (crawl.nodeType === 1 && crawl.childNodes.length) {\n        // dive down to deepest child's first crawl\n        crawl = crawl.childNodes[0];\n      } else if (crawl) {\n        // entering the deepest elements first child.\n\n        if (typeof run === \"function\") crawl = run(crawl);\n        if (crawl === \"BREAK\" || !withInRange(crawl)) break;\n\n        outputNodes.push(crawl);\n\n        // break out if the crawl hits the end\n        if (crawl === endNode) break;\n\n        /**\n         * Climb up the node if the node doesn't have any next siblings\n         * Stop when it hits the commonContainer\n         */\n        let breakOut = false;\n        while (\n          !crawl.nextSibling &&\n          crawl.parentNode &&\n          withInRange(crawl.parentNode)\n        ) {\n          crawl = crawl.parentNode;\n          if (crawl) {\n            if (typeof run === \"function\") crawl = run(crawl);\n\n            if (crawl === \"BREAK\" || !withInRange(crawl)) {\n              breakOut = true;\n              break;\n            }\n\n            if (crawl) outputNodes.push(crawl);\n          }\n        }\n\n        if (breakOut) break;\n\n        // move on to next crawl\n        crawl = crawl.nextSibling;\n      }\n    }\n\n    if (id) commonContainer.removeAttribute(\"id\");\n\n    return { node: outputNodes, commonContainer };\n  }\n\n  _wrapNode(node, wrapper, appendWhole = false) {\n    if (this.logExecution)\n      console.log(\"_wrapNode()\", { node, wrapper, appendWhole });\n    if (!(node instanceof Node)) return;\n\n    if (!node.parentNode) throw new Error(\"can't unwrap document fragment\");\n\n    // save current range\n    let sel = window.getSelection();\n    let range = sel.getRangeAt(0);\n    let start = null;\n    let startOffset = range.startOffset;\n    let end = null;\n    let endOffset = range.endOffset;\n\n    const withinRange = (n) => {\n      if (range.startContainer === n) {\n        start = n;\n      }\n      if (range.endContainer === n) {\n        end = n;\n      }\n    };\n\n    if (node.nodeType === 1) {\n      this._nodeCrawler(\n        (n) => {\n          withinRange(n);\n          return n;\n        },\n        { node }\n      );\n    } else withinRange(node);\n\n    if (wrapper) {\n      // place the wrapper\n      node.parentNode.insertBefore(wrapper, node);\n    }\n\n    // append node\n    if (node.nodeType === 3) {\n      if (wrapper) wrapper.append(node);\n      else throw new Error(\"no wrapper for text content\");\n    } else if (appendWhole) wrapper.append(node);\n    else\n      while (node.childNodes[0]) {\n        let child = node.childNodes[0];\n        if (wrapper) wrapper.append(child);\n        else node.parentNode.insertBefore(child, node);\n      }\n\n    let stripped;\n    if (node.nodeType === 1 && !appendWhole) {\n      let n = wrapper || node;\n      let p = n.parentNode;\n      stripped = node.previousSibling;\n      p.removeChild(node);\n    }\n\n    // restore range\n    if ((stripped || node).textContent && (start || end)) {\n      if (start && start === end && startOffset === endOffset)\n        range = this._adjustSelection({\n          node: stripped || node,\n          position: startOffset,\n        });\n      else\n        range = this._adjustSelection({\n          node: [start, end],\n          position: [startOffset, endOffset],\n        });\n    }\n\n    this.range = range;\n    return { node: stripped || node, range };\n  }\n\n  _climbUpToEldestParent(node, wrapper, singleChildParent = false, callback) {\n    if (this.logExecution)\n      console.log(\"_climbUpToEldestParent()\", {\n        node,\n        wrapper,\n        singleChildParent,\n        callback,\n      });\n    callback =\n      callback ||\n      ((n) => {\n        return n;\n      });\n\n    if (!(wrapper instanceof Node) || wrapper?.nodeType === 3)\n      throw new Error(\"invalid wrapper node\");\n\n    let id;\n    let uniqueId =\n      wrapper.id ||\n      (() => {\n        id = this._generateId(\"eldest\");\n        wrapper.id = id;\n        return id;\n      })();\n    // on single parent mode climb up if parent has only 1 child or 2 child with zero space text\n    function _isSingleChildParent(n) {\n      if (!n || n.nodeType === 3) return false;\n\n      let childrenCount = n?.children?.length;\n      return (\n        childrenCount === 0 ||\n        (() => {\n          let sweep = n.childNodes.length;\n          let divCount = 0;\n          let iHaveText = false;\n\n          while (sweep--) {\n            let s = n.childNodes[sweep];\n\n            if (\n              s.nodeType === 3 &&\n              s.textContent.length > 0 &&\n              s.textContent !== \"\\u200B\"\n            )\n              iHaveText = true;\n            else if (s.nodeType === 1 && s.nodeName !== \"BR\") divCount++;\n\n            // if (divCount > 1 || divCount && iHaveText)\n            if ((divCount > 1 && !iHaveText) || (divCount && iHaveText))\n              return false;\n          }\n\n          return true;\n        })()\n      );\n    }\n    while (\n      node?.id !== uniqueId &&\n      node.parentNode &&\n      node.parentNode.closest(\"#\" + uniqueId) &&\n      node.parentNode.id !== uniqueId &&\n      (singleChildParent ? _isSingleChildParent(node?.parentNode) : true)\n    ) {\n      let cb = callback(node.parentNode);\n\n      if (!cb || cb === \"BREAK\") break;\n\n      node = cb;\n    }\n\n    if (id) wrapper.removeAttribute(\"id\");\n\n    return node;\n  }\n\n  _getStartEndLine(\n    range = this.range,\n    element = this.element,\n    getInbetween = false\n  ) {\n    if (this.logExecution)\n      console.log(\"_getStartEndLine()\", { range, element });\n    if (!range) return [null, null, null];\n\n    let startLine = this._climbUpToEldestParent(range.startContainer, element);\n    let endLine = this._climbUpToEldestParent(range.endContainer, element);\n\n    let inBetween = [];\n    if (getInbetween) {\n      // collect all the lines in between startLine and endLine. line is a block element\n      let currentLine = startLine.nextSibling;\n      while (currentLine && currentLine !== endLine) {\n        if (\n          currentLine.nodeType === 1 &&\n          this.blockElement_queryArray.some((q) =>\n            currentLine.matches(this._classNameToQuery(q))\n          )\n        ) {\n          inBetween.push(currentLine);\n        }\n        currentLine = currentLine.nextSibling;\n      }\n    }\n    if (this.logExecution)\n      console.log(\"startLine | endLine\", { startLine, endLine, inBetween });\n\n    return [startLine, endLine, inBetween];\n  }\n\n  _isThereContentEditableOverMyHead(node, element = this.element) {\n    if (node && node !== this.element) {\n      let flyup = node;\n      while (flyup && this.element !== flyup) {\n        if (flyup.getAttribute(\"contenteditable\") === \"true\") return true;\n\n        flyup = flyup.parentNode;\n      }\n    }\n    return false;\n  }\n\n  _isSelectionWithinRestrictedRange(\n    range = this.range,\n    element = this.element\n  ) {\n    if (!range) {\n      if (this.logExecution)\n        console.log(\"_isSelectionWithinRestrictedRange():true\", {\n          range,\n          element,\n        });\n      return true;\n    }\n\n    let { commonAncestorContainer, startContainer, endContainer } = range;\n    let restrict = this.restrictedElement_queryArray;\n    // let startLine = this._climbUpToEldestParent(startContainer, element);\n    // let endLine = this._climbUpToEldestParent(endContainer, element);\n\n    // if (this.logExecution) console.log('startLine | endLine', {startLine, endLine});\n    let [startLine, endLine, inBetween] = this._getStartEndLine(\n      range,\n      element,\n      true\n    );\n    if (startLine === endLine) {\n      commonAncestorContainer =\n        commonAncestorContainer.nodeType === 3\n          ? commonAncestorContainer.parentNode\n          : commonAncestorContainer;\n      for (let r of restrict) {\n        let cl = commonAncestorContainer.closest(this._classNameToQuery(r));\n        if (cl) {\n          // if (cl.getAttribute('contenteditable') !== 'true') {\n          //     return r;\n          // }\n          let isThere = this._isThereContentEditableOverMyHead(\n            commonAncestorContainer,\n            element\n          );\n          if (!isThere) {\n            return true;\n          }\n        }\n        // let cl = commonAncestorContainer.closest(this._classNameToQuery(r));\n        // if (cl)\n        //     return r;\n      }\n    } else if (inBetween?.length) {\n      for (let i = 0; i < inBetween.length; i++) {\n        for (let r of restrict) {\n          if (inBetween[i].closest(this._classNameToQuery(r))) {\n            let isThere = this._isThereContentEditableOverMyHead(inBetween[i]);\n            if (!isThere) {\n              return true;\n            }\n          }\n        }\n      }\n      // while (startLine && startLine !== endLine) {\n      //     startLine = startLine.nextSibling;\n      //     if (startLine) {\n      //         if (startLine.nodeType === 1)\n      //             for (let r of restrict) {\n      //                 if (startLine.classList.contains(r)) {\n      //                     if (startLine.getAttribute('contenteditable') !== 'true') {\n      //                         return r;\n      //                     }\n      //                 }\n      //                 // if (startLine.classList.contains(r))\n      //                 //     return r;\n      //             }\n      //     } else\n      //         break;\n      // }\n    }\n\n    return false;\n  }\n\n  _classNameToQuery(q) {\n    if (this.logExecution) console.log(\"_classNameToQuery()\", { q });\n    if (q.includes(\"_stop\") && q[0] !== \".\") return \".\" + q;\n    return q[0] === \"_\" ? \".\" + q : q;\n  }\n\n  _createEmptyParagraph(append) {\n    if (this.logExecution) console.log(\"_createEmptyParagraph()\", { append });\n    let p = document.createElement(\"p\");\n\n    if (append && typeof append === \"string\")\n      append = document.createTextNode(append);\n\n    p.append(append || document.createTextNode(\"\"));\n\n    if (!append) p.append(document.createElement(\"br\"));\n\n    return p;\n  }\n\n  _trackStyle(n, cls) {\n    if (this.logExecution) console.log(\"_trackStyle()\", { n, cls });\n    let commandTracker = {};\n    let style = window.getComputedStyle(n);\n\n    for (let c of this.alignClass) {\n      if (n.closest(\".\" + c))\n        commandTracker[c.substring(1, c.length - 1)] = true;\n    }\n\n    let checker = (sp) => {\n      let key = this.cssPropertyChecker[sp];\n      if (typeof key === \"function\") {\n        key = key(style[sp]);\n        if (key) {\n          if (cls) return key;\n          commandTracker[key] = true;\n        }\n      } else if (sp === \"color\" && style[sp]) {\n        let col =\n          style[sp][0] === \"#\" ? style[sp] : new ColorMangle(style[sp]).hex();\n\n        if (col !== this.defaultFontColor) {\n          if (cls) return col;\n          commandTracker[key] = col;\n        }\n      } else if (\n        style[sp] !== this.elementComputedStyle[sp] &&\n        this._isTextElement(n)\n      ) {\n        if (cls) return true;\n        commandTracker[key] = true;\n      }\n      return false;\n    };\n\n    if (cls) return checker(this.cssPropertyOf[cls.toLowerCase()]);\n\n    for (let sp in this.cssPropertyChecker) {\n      checker(sp);\n    }\n\n    return commandTracker;\n  }\n\n  _lastLineBlank(force) {\n    if (this.logExecution) console.log(\"_lastLineBlank()\", { force });\n    if (this.lastLineBlank || force) {\n      let lastLine = this.element.lastChild;\n      if (\n        lastLine.nodeName !== \"P\" ||\n        (lastLine.nodeName === \"P\" &&\n          lastLine.textContent &&\n          lastLine.textContent !== \"\\u200B\")\n      ) {\n        this.element.append(this._createEmptyParagraph());\n      }\n    }\n  }\n\n  _setEventListener(listen) {\n    if (this.logExecution) console.log(\"_setEventListener()\", { listen });\n    /**\n     * keydown -> observer(dom change) -> selection change -> click | keyup\n     */\n\n    document.removeEventListener(\"selectionchange\", this._selectionchange);\n    this.imgInput = null;\n    if (this.element) {\n      this.element.removeEventListener(\"keydown\", this._keydown);\n      this.element.removeEventListener(\"mousedown\", this._normalize);\n      window.removeEventListener(\"mousedown\", this._normalize);\n      this.element.removeEventListener(\"paste\", this._paste);\n      this.element.removeEventListener(\"keyup\", this._keyup);\n    }\n\n    if (!listen) return;\n\n    //  image selector\n    let imgInput = document.createElement(\"input\");\n    for (const [key, value] of Object.entries({\n      id: this._generateId(\"imageInput\"),\n      type: \"file\",\n      accept: \"image/gif,image/png,image/jpeg,image/webp\",\n      hidden: true,\n      multiple: true,\n    })) {\n      imgInput.setAttribute(key, value);\n    }\n\n    this.imgInput = imgInput;\n    this.imgInput.addEventListener(\"change\", (e) => {\n      this._imageSelected(e).catch((err) => {\n        console.error(err);\n      });\n    });\n\n    this._selectionchange = function () {\n      this._modifySelection(() => {\n        let isForward =\n          !(this.lastKey === \"DELETE\" || this.lastKey === \"BACKSPACE\") ||\n          this.isRangeDirectionForward;\n\n        let rangeHeader = isForward\n          ? this.range.endContainer\n          : this.range.startContainer;\n        this.lastKey = null;\n\n        //  nudge range in-case carat is within non selectables\n        let unSel = this._isUnSelectableElement(rangeHeader);\n        if (unSel) {\n          let selNext = isForward ? unSel.nextSibling : unSel.previousSibling;\n          \n          if(this.logExecution) console.log('nudging range', {unSel, selNext, isForward});\n          \n          if (!selNext && !isForward) {\n            selNext = document.createTextNode(\"\\u200B\");\n            unSel.parentNode.insertBefore(\n              selNext,\n              isForward ? unSel.nextSibling : unSel\n            );\n          }\n          if (selNext)\n            this.range = this._adjustSelection({\n              node: this.range.collapsed\n                ? selNext\n                : isForward\n                ? [null, selNext]\n                : [selNext, null],\n              position: this.range.collapsed\n                ? isForward\n                  ? 0\n                  : selNext.textContent.length\n                : isForward\n                ? [null, 0]\n                : [0, null],\n            });\n        }\n\n        //  track commandTracker\n        let commandTracker = {};\n        for (let style in this.styleTagOfCommand) {\n          commandTracker[style] = false;\n        }\n\n        if (this._isSelectionWithinRestrictedRange()) {\n          this.commandTracker = commandTracker;\n          return;\n        }\n\n        let skipTrack = this.restrictedElement_queryArray.concat(\n          this.specialTextElement_queryArray\n        );\n        let crawlResult = this._nodeCrawler(\n          (node) => {\n            if (\n              (node.nodeType === 1 && node.closest(\"blockquote\")) ||\n              (node.nodeType === 3 && node.parentNode.closest(\"blockquote\"))\n            )\n              commandTracker.quote = true;\n\n            let styleRestrictedParents = (c) => {\n              return node.nodeType === 3\n                ? node.parentNode.closest(c)\n                : node.nodeType === 1\n                ? node.closest(c)\n                : !(node instanceof Node);\n            };\n\n            for (let p of skipTrack) {\n              let chk = styleRestrictedParents(p);\n              if (chk) return node;\n            }\n\n            if (\n              node.nodeType === 3 ||\n              node.nodeName === \"BR\" ||\n              (node.nodeType === 1 &&\n                node.childNodes.length === 1 &&\n                (node.childNodes[0].nodeName === \"BR\" ||\n                  node.childNodes[0].nodeType === 3))\n            ) {\n              let n =\n                node.nodeType === 3 || node.nodeName === \"BR\"\n                  ? node.parentNode\n                  : node;\n\n              let comm = this._trackStyle(n);\n              for (let c in comm) commandTracker[c] = comm[c];\n            }\n            return node;\n          },\n          { node: this.range, parentNode: this.element }\n        );\n\n        if (!crawlResult.node.length) {\n          let comm = this._trackStyle(this.range.startContainer);\n          for (let c in comm) commandTracker[c] = comm[c];\n        }\n\n        this.commandTracker = commandTracker;\n        let caratPosition;\n        let caratEl = this.isRangeDirectionForward\n          ? this.range.endContainer\n          : this.range.startContainer;\n\n        if (caratEl.nodeType === 3)\n          caratPosition = this.range.getBoundingClientRect();\n        else if (caratEl.nodeType === 1)\n          caratPosition = caratEl.getBoundingClientRect();\n\n        this._callback({\n          commandTracker,\n          range: this.range,\n          caratPosition,\n        }).catch((err) => console.error(err));\n        this._lastLineBlank();\n      });\n    }.bind(this);\n\n    this._keydown = function (e) {\n      if (this._isSelectionWithinRestrictedRange()) return;\n\n      this._modifySelection(() => {\n        if (!this.range) return;\n        let { startContainer, startOffset, collapsed, startLine, endLine } =\n          this.range;\n\n        let key = e.key.toUpperCase();\n        let shift = e.shiftKey;\n\n        this.lastKey = key;\n\n        if (key === \"ENTER\" && e.shiftKey) {\n          // prevent shift+enter\n          if (!this.range.endLine.closest(\"LI\")) e.preventDefault();\n          return;\n        }\n\n        // delete key\n        if ([\"BACKSPACE\", \"DELETE\"].includes(key)) {\n          this.isRangeDirectionForward = true;\n\n          // if (\n          //     this.element.childNodes.length === 1 &&\n          //     this._isTextBlockElement(this.element.childNodes[0]) &&\n          //     this.element.childNodes[0].textContent.length === 0\n          // ) {\n          //     if(this.logExecution) console.log('dead end');\n          //     e.preventDefault();\n          //     // Optionally, reset to a blank paragraph\n          //     // this.element.childNodes[0].innerHTML = '<br>';\n          //     // this.range = this._adjustSelection({ node: this.element.childNodes[0], position: 0 });\n          //     this._lastLineBlank(true);\n          // }\n\n          if (\n            !this.element.textContent &&\n            this.element.childNodes.length <= 1 &&\n            this._isTextElement(this.element.childNodes[0]) &&\n            this.element.childNodes[0] === startLine\n          ) {\n            if(this.logExecution) console.log('nothing to delete');\n            // there is nothing to delete\n            e.preventDefault();\n          } else {\n            let stc = this.range.startContainer;\n            if (this.range.collapsed) {\n              let block = (stc.nodeType === 3 ? stc.parentNode : stc).closest(\n                \"blockquote\"\n              );\n              if (\n                block &&\n                block.childNodes[0] ===\n                  this._climbUpToEldestParent(stc, block) &&\n                this.range.startOffset === 0\n              ) {\n                // if the block is empty and the cursor is on the first offset position within the blockquote\n                // cursor is on the first offset position within the blockquote\n                e.preventDefault();\n                this.command(\"quote\");\n              }\n\n              if(this.range.startOffset === 0) {\n                let ceil = this._climbUpToEldestParent(stc, this.element).previousSibling;\n                for(let cl of this.restrictedElement_queryArray) {\n                  if(ceil && ceil.closest(cl)) {\n                    // remove the element\n                    this.element.removeChild(ceil);\n                    e.preventDefault();\n                    return;\n                  }\n                }\n              }\n            }\n\n            let commonAncestorContainer = this.range.commonAncestorContainer;\n            // check if commonAncestorContainer is the only element in this.element\n\n            // e.preventDefault();\n            if (\n              !this.range.startOffset &&\n              ((this.element.childNodes.length === 1 &&\n              commonAncestorContainer === this.element.childNodes[0]) ||\n              (commonAncestorContainer === this.element && this.element.childNodes.length === 0))\n            ) {\n              // if the element is empty and the cursor is on the first offset position within the block\n              // let t = document.createTextNode(\"\\u200B\");\n              // let stcEl = stc.nodeType === 3 ? stc.parentNode : stc;\n              // stcEl.insertBefore(t, stcEl[0]);\n              e.preventDefault();\n              return;\n            }\n\n            // // Not sure what this is meant to do...\n            // if (stc.nodeType === 1 && this._isTextBlockElement(stc) && !this.range.startOffset) {\n            //     let t = document.createTextNode('\\u200B');\n            //     stc.insertBefore(t, stc.childNodes[0]);\n            //     this.range = this._adjustSelection({\n            //         node: t,\n            //         position: 0\n            //     });\n            // }\n          }\n\n          return;\n        }\n\n        //  hashtag flag\n        if (key === \"#\" && !this.hashtag_flag) {\n          this.hashtag_flag = true;\n          return;\n        }\n\n        //  url flag\n        if ([\":\", \"/\", \".\"].includes(key) && !this.urllink_flag) {\n          this.urllink_flag = true;\n          return;\n        }\n\n        // insert hashtag | urllink\n        if (\n          (this.hashtag_flag || this.urllink_flag) &&\n          ([\" \", \"ENTER\", \"TAB\"].includes(key) || key.includes(\"ARROW\"))\n        ) {\n          this._replaceText();\n          // return;\n        }\n\n        // when user press shift + arrows to expand the selection range,\n        // this.isRangeDirectionForward is responsible of setting direction to expand\n        // when set to true, the endOffset will change when using shift + arrow\n        if (shift) {\n          if (key === \"PAGEUP\" || key === \"HOME\") {\n            this.isRangeDirectionForward = false;\n            return;\n          }\n\n          if (key === \"PAGEDOWN\" || key === \"END\") {\n            this.isRangeDirectionForward = true;\n            return;\n          }\n        }\n\n        if (key.includes(\"ARROW\")) {\n          this._setArrow(e);\n          return;\n        }\n\n        if (key === \"TAB\") {\n          this.isRangeDirectionForward = true;\n\n          e.preventDefault();\n          let sweep_array = [];\n\n          if (!collapsed) {\n            let sweep = startLine;\n            while (sweep && sweep !== endLine) {\n              sweep_array.push(sweep);\n              sweep = sweep.nextSibling;\n            }\n            sweep_array.push(endLine);\n          }\n\n          if (shift) {\n            // delete indent\n            let hasIndent = false;\n            let diveAndRemoveTab = (n) => {\n              while (n.childNodes[0]) {\n                n = n.childNodes[0];\n\n                while (n.nodeType === 3 && !n.textContent) n = n.nextSibling;\n\n                if (n.nodeType === 3 && n.textContent[0] === \"\\t\") {\n                  hasIndent = true;\n                  n.textContent = n.textContent.substring(1);\n                  break;\n                }\n              }\n            };\n            if (sweep_array.length) {\n              for (let n of sweep_array) {\n                if (n.textContent[0] === \"\\t\") diveAndRemoveTab(n);\n              }\n              if (hasIndent)\n                this._adjustSelection({\n                  node: [startLine, endLine],\n                  position: [true, false],\n                });\n            } else if (startLine.textContent[0] === \"\\t\") {\n              let lineOffset = (line, container, containerOffset) => {\n                if (line === container) return containerOffset;\n\n                this._nodeCrawler(\n                  (n) => {\n                    if (container === n) return \"BREAK\";\n\n                    if (n.nodeType === 3 && n.textContent.length)\n                      containerOffset += n.textContent.length;\n\n                    return n;\n                  },\n                  { node: line }\n                );\n                return containerOffset;\n              };\n\n              let offset =\n                lineOffset(startLine, startContainer, startOffset) - 1;\n              offset = offset < 0 ? 0 : offset;\n\n              diveAndRemoveTab(startLine);\n              if (hasIndent)\n                this._adjustSelection({ node: startLine, position: offset });\n            }\n          } else {\n            // indent\n            if (sweep_array.length) {\n              let hasIndent = false;\n              for (let n of sweep_array) {\n                hasIndent = true;\n                let tab = document.createTextNode(\"\\t\");\n                n.insertBefore(tab, n.childNodes[0]);\n              }\n              if (hasIndent)\n                this._adjustSelection({\n                  node: [startLine, endLine],\n                  position: [true, false],\n                });\n            } else {\n              let tab = document.createTextNode(\"\\t\");\n              this.range.insertNode(tab);\n              this._adjustSelection({ node: tab, position: false });\n            }\n          }\n          return;\n        }\n\n        if (key === \"ENTER\") {\n          //  remove zero space\n          if (\n            collapsed &&\n            (startContainer.textContent.includes(\"\\u200B\") ||\n              !startContainer.textContent)\n          ) {\n            this._nodeCrawler(\n              (n) => {\n                if (\n                  n.nodeType === 3 &&\n                  (n.textContent === \"\\u200B\" || !n.textContent)\n                ) {\n                  n.remove();\n                }\n\n                return n;\n              },\n              {\n                node:\n                  startContainer.nodeType === 3\n                    ? startContainer.parentNode\n                    : startContainer,\n              }\n            );\n          }\n\n          if (endLine.textContent[0] === \"\\t\") {\n            for (let s of endLine.textContent) {\n              if (s === \"\\t\") this.insertTabPending_tabString += \"\\t\";\n              else break;\n            }\n          }\n        }\n\n        this.isRangeDirectionForward = true;\n      });\n    }.bind(this);\n\n    this._normalize = function (e) {\n      e.stopPropagation();\n      this._modifySelection(() => {\n        if (this._isSelectionWithinRestrictedRange()) return;\n        this._normalizeDocument(true);\n        this.range_backup = this.range.cloneRange();\n        this._replaceText(true);\n      });\n    }.bind(this);\n    this._paste = function (e) {\n      e.preventDefault();\n      if (this._isSelectionWithinRestrictedRange()) return;\n      this._modifySelection(() => {\n        if (this.range) {\n          if (this._isSelectionWithinRestrictedRange()) return;\n          let doc = document.createDocumentFragment();\n          doc.textContent = e.clipboardData\n            .getData(\"text/plain\")\n            .replace(/\\n\\n/g, \"\\n\");\n\n          if (doc.textContent.includes(\"#\")) {\n            this.hashtag_flag = true;\n          }\n\n          //  url flag\n          for (let u of [\":\", \"/\", \".\"]) {\n            doc.textContent.includes(u);\n            this.urllink_flag = true;\n          }\n\n          if (!this.range.collapsed) this.range.extractContents();\n          this.range.insertNode(doc);\n        }\n      });\n    }.bind(this);\n    this._keyup = function () {\n      if (this.removeSandwichedLine_array.length)\n        while (this.removeSandwichedLine_array.length)\n          this.removeSandwichedLine_array.pop().remove();\n    }.bind(this);\n\n    document.addEventListener(\"selectionchange\", this._selectionchange);\n    this.element.addEventListener(\"keydown\", this._keydown);\n    this.element.addEventListener(\"mousedown\", this._normalize);\n    // this.element.addEventListener('blur', this._normalize);\n    // fuck safari, firefox\n    window.addEventListener(\"mousedown\", this._normalize);\n    this.element.addEventListener(\"paste\", this._paste);\n    this.element.addEventListener(\"keyup\", this._keyup);\n  }\n\n  _observeMutation(track) {\n    if (this.observer) this.observer.disconnect();\n\n    this.observer = null;\n\n    if (!track) return;\n\n    this.observer = new MutationObserver((mutation_array) => {\n      if (this.logMutation) {\n        let monitor = mutation_array.map((m) => {\n          return {\n            target: m.target.cloneNode(true),\n            type: m.type,\n            name: m.attributeName,\n            added: (() => {\n              let clones = [];\n              for (let a of m.addedNodes) {\n                if (a.nodeType === 3) clones.push(a.textContent);\n                else clones.push(a.cloneNode(true));\n              }\n              return clones;\n            })(),\n            removed: (() => {\n              let clones = [];\n              for (let r of m.removedNodes) {\n                if (r.nodeType === 3) clones.push(r.textContent);\n                else clones.push(r.cloneNode(true));\n              }\n              return clones;\n            })(),\n          };\n        });\n\n        let mutate = [];\n        for (let m of monitor) {\n          if (m.type === \"childList\" || m.attributeName === \"class\")\n            mutate.push(m);\n        }\n\n        if (mutate.length)\n          this._callback({ mutation: mutate }).catch((err) => err);\n      }\n\n      for (const mutation of mutation_array) {\n        /** changes in attributes */\n        if (mutation.type === \"attributes\") {\n          const { target, attributeName } = mutation;\n          if (attributeName === \"class\") {\n            if (\n              target.parentNode &&\n              !target.classList.length &&\n              !(\n                this._isTextBlockElement(target) ||\n                this._isBlockElement(target) ||\n                target.nodeName === \"P\"\n              )\n            ) {\n              // this._unwrapElement(target);\n              this._wrapNode(target);\n            }\n            if (!target.classList.length) target.removeAttribute(\"class\");\n          }\n          //  prevent style attributes\n          if (attributeName === \"style\" && !this._isStyleAllowedElement(target))\n            target.removeAttribute(\"style\");\n          continue;\n        }\n\n        /** changes in node */\n        if (mutation.type === \"childList\") {\n          let mutationTarget = mutation.target;\n\n          /** removed nodes */\n          if (mutation.removedNodes.length) {\n            for (let m of mutation.removedNodes) {\n              /**\n               *  CAUTION!\n               *  changing the order of if statements below can lead to critical flaw\n               *  _custom_ class should always be checked after _urllink_ and _hashtag_\n               */\n\n              let callbackRemoved = (what, m) => {\n                if (!m.id) return;\n\n                let arrIdx = this[`${what}_array`].length;\n                let removed;\n\n                while (arrIdx--) {\n                  let got = this[`${what}_array`][arrIdx];\n                  if (got.elementId === m.id) {\n                    removed = this[`${what}_array`].splice(arrIdx, 1);\n                    break;\n                  }\n                }\n\n                if (removed) {\n                  this._callback({ removed: { [what]: removed } });\n                }\n              };\n\n              if (m?.classList?.contains(\"_media_\")) {\n                let child = m.childNodes;\n                let childIdx = child.length;\n                while (childIdx--) {\n                  let c = child[childIdx];\n                  switch (c.nodeName) {\n                    case \"IMG\":\n                      callbackRemoved(\"image\", c);\n                      break;\n                  }\n                }\n                continue;\n              }\n\n              let toBreak = false;\n              for (let t of [\"hashtag\", \"urllink\", \"custom\"]) {\n                if (m?.id?.includes(t)) {\n                  callbackRemoved(t, m);\n                  toBreak = true;\n                  break;\n                }\n              }\n\n              toBreak = false;\n\n              if (\n                this._isCeilingElement(mutationTarget) &&\n                (() => {\n                  let idx = mutationTarget.childNodes.length;\n                  if (idx)\n                    while (idx--) {\n                      let node = mutationTarget.childNodes[idx];\n                      if (node.nodeType === 1 || node.textContent) {\n                        return false;\n                      }\n                    }\n                  return true;\n                })()\n              ) {\n                mutationTarget.remove();\n                continue;\n              }\n\n              if (\n                this._isTextBlockElement(mutationTarget) &&\n                mutationTarget.childNodes.length === 1 &&\n                this._isUnSelectableElement(mutationTarget.childNodes[0])\n              )\n                mutationTarget.append(document.createTextNode(\"\"));\n            }\n          }\n\n          /** added nodes */\n          if (mutation.addedNodes.length)\n            for (let i of mutation.addedNodes) {\n              let getBr = (n) => {\n                let idx = n?.childNodes?.length;\n                let br = [];\n                while (idx--) {\n                  let c = n.childNodes[idx];\n                  if (c.nodeName === \"BR\") br.push(c);\n                }\n                return br;\n              };\n\n              if (i.nodeType === 3) {\n                // wrap all eldest text node\n                if (this._isCeilingElement(mutationTarget))\n                  this._wrapNode(i, document.createElement(\"p\"));\n                // remove <br> when there is text\n                else if (i.textContent && i.textContent !== \"\\u200B\") {\n                  // prevent br added to line\n                  let br = getBr(mutationTarget);\n                  if (br.length) for (let b of br) b.remove();\n                }\n\n                continue;\n              }\n\n              if (i.nodeType === 1) {\n                let node = (() => {\n                  let isWysiwygChild =\n                    i.closest(`#${this.elementId}`) && i.id !== this.elementId;\n                  let isWysiwygEldestChild = (() => {\n                    if (!isWysiwygChild) return false;\n\n                    return this._isCeilingElement(mutationTarget);\n                  })();\n\n                  let ceiling = (() => {\n                    for (let c of this.ceilingElement_queryArray) {\n                      let clo = i.closest(c);\n                      if (clo) return clo;\n                    }\n                    return null;\n                  })();\n\n                  let line = isWysiwygEldestChild\n                    ? i\n                    : isWysiwygChild &&\n                      (() => {\n                        let m = i;\n                        while (m && !this._isCeilingElement(m.parentNode)) {\n                          m = m.parentNode;\n                        }\n                        return m;\n                      })();\n\n                  return {\n                    isWysiwygChild,\n                    isWysiwygEldestChild,\n                    isMediaElement: i.closest(\"._media_\"),\n                    isBlockQuoteElement: i.closest(\"blockquote\"),\n                    isCustomElement: i.closest(\"._custom_\"),\n                    isHashtagElement: i.closest(\"._hashtag_\"),\n                    isUrlLinkElement: i.closest(\"._urllink_\"),\n                    ceiling,\n                    line,\n                  };\n                })();\n\n                if (!node.isWysiwygChild) continue; // bypass\n\n                if (\n                  node.isCustomElement ||\n                  node.isMediaElement ||\n                  node.isHashtagElement ||\n                  node.isUrlLinkElement\n                ) {\n                  // make sure un-editable element is secure\n                  let el =\n                    node.isCustomElement ||\n                    node.isMediaElement ||\n                    node.isHashtagElement ||\n                    node.isUrlLinkElement;\n\n                  // check if el has a value of contenteditable\n                  if (el.getAttribute(\"contenteditable\") !== \"true\")\n                    el.setAttribute(\"contenteditable\", \"false\");\n\n                  continue;\n                }\n\n                if (\n                  !(\n                    node.isWysiwygEldestChild &&\n                    (this._isBlockElement(i) || this._isTextBlockElement(i))\n                  ) &&\n                  i.nodeName !== \"BR\" &&\n                  !i.classList.length\n                ) {\n                  // unwrap anything that does not have class and is not block level text\n                  this._wrapNode(i);\n                  continue;\n                }\n\n                if (\n                  (() => {\n                    if (this._isStyleAllowedElement(i)) return false;\n\n                    for (let sa of this.restrictedElement_queryArray) {\n                      if (i.closest(sa)) return false;\n                    }\n\n                    return true;\n                  })()\n                )\n                  //  remove style attribute if not allowed\n                  i.removeAttribute(\"style\");\n\n                if (\n                  node.isWysiwygEldestChild &&\n                  !(this._isBlockElement(i) || this._isTextBlockElement(i))\n                ) {\n                  //  wrap eldest non text block element to p\n                  if (i.nodeName === \"BR\") i.remove();\n                  else this._wrapNode(i, document.createElement(\"p\"), true);\n                  continue;\n                }\n\n                if (\n                  mutationTarget.textContent &&\n                  mutationTarget.textContent !== \"\\u200B\"\n                ) {\n                  // prevent br added to line\n                  let br = getBr(mutationTarget);\n                  let doContinue = false;\n                  if (br.length)\n                    for (let b of br) {\n                      if (b === i) doContinue = true;\n                      b.remove();\n                    }\n                  if (doContinue) continue;\n                }\n\n                if (node.isWysiwygEldestChild && !this._isCeilingElement(i)) {\n                  // add tab on new line created by pressing enter\n                  if (this.insertTabPending_tabString) {\n                    let tab = document.createTextNode(\n                      this.insertTabPending_tabString\n                    );\n                    node.line.insertBefore(tab, node.line.childNodes[0]);\n                    this.insertTabPending_tabString = \"\";\n                    this._adjustSelection({ node: tab, position: false });\n                  }\n\n                  // if empty text block is added add br\n                  if (\n                    !node.line.textContent ||\n                    node.line.textContent === \"\\u200B\"\n                  ) {\n                    let addBr = true;\n                    this._nodeCrawler(\n                      (n) => {\n                        if (n.nodeName === \"BR\") {\n                          addBr = false;\n                          return \"BREAK\";\n                        }\n                        return n;\n                      },\n                      { node: node.line }\n                    );\n\n                    if (addBr) node.line.append(document.createElement(\"br\"));\n                  }\n\n                  continue;\n                }\n\n                let classSet = (c) => {\n                  let counter = this.counterTagOf[c] || [];\n\n                  if (counter.length)\n                    counter = counter.concat(\n                      counter.map((m) => {\n                        return m + \"_stop\";\n                      })\n                    );\n\n                  return [\n                    c,\n                    c.includes(\"_stop\") ? c.replace(\"_stop\", \"\") : c + \"_stop\",\n                  ].concat(counter);\n                };\n\n                let toUnwrap = [];\n\n                if (i.classList.length) {\n                  this._climbUpToEldestParent(i, node.ceiling, true, (n) => {\n                    let cIdx = i.classList.length;\n                    while (cIdx--) {\n                      if (\n                        (() => {\n                          let set = classSet(i.classList[cIdx]);\n                          for (let s of set) {\n                            if (n.classList.contains(s)) return true;\n                          }\n                          return false;\n                        })()\n                      )\n                        toUnwrap.push(n);\n                    }\n\n                    return n;\n                  });\n                }\n\n                let idx = toUnwrap.length;\n\n                while (idx--) {\n                  // unwrap unnecessary counter parents\n                  this._wrapNode(toUnwrap[idx]);\n                }\n\n                let class_idx = i.classList.length;\n                while (class_idx--) {\n                  let className = i.classList[class_idx];\n                  let curSt = this._trackStyle(\n                    i,\n                    className.replace(\"_stop\", \"\")\n                  );\n                  let parSt = this._trackStyle(\n                    i.parentNode,\n                    className.replace(\"_stop\", \"\")\n                  );\n\n                  if (curSt === parSt)\n                    // remove style class if parent shares the same style\n                    i.classList.remove(className);\n                }\n\n                if (!i.classList.length) {\n                  // remove style attribute if there is no class\n                  i.removeAttribute(\"class\");\n                }\n\n                if (\n                  this._isTextBlockElement(mutationTarget) &&\n                  mutationTarget.childNodes.length === 1 &&\n                  this._isUnSelectableElement(mutationTarget.childNodes[0])\n                )\n                  mutationTarget.append(document.createTextNode(\"\"));\n              }\n            }\n        }\n      }\n    });\n    this.observer.observe(this.element, {\n      attributes: true,\n      childList: true,\n      subtree: true,\n    });\n  }\n\n  _setArrow(e) {\n    if (this.logExecution) console.log(\"_setArrow\", { e });\n    if (!this.range || !e?.key) return;\n\n    let endContainer,\n      endOffset,\n      startContainer,\n      startOffset,\n      collapsed,\n      startLine,\n      endLine,\n      isAllRangeOnSameLine,\n      currentLine,\n      caratElement,\n      arrowDirection;\n\n    let key = e.key.toUpperCase();\n    let shift = e?.shiftKey || false;\n    let metaKey = e?.ctrlKey || e?.metaKey || false;\n    let rangeSetup = () => {\n      endContainer = this.range?.endContainer;\n      endOffset = this.range?.endOffset;\n      startContainer = this.range?.startContainer;\n      startOffset = this.range?.startOffset;\n      collapsed = this.range?.collapsed;\n      startLine = this.range?.startLine;\n      endLine = this.range?.endLine;\n      isAllRangeOnSameLine = startLine === endLine;\n      currentLine = this.isRangeDirectionForward ? endLine : startLine;\n      caratElement = this.isRangeDirectionForward\n        ? endContainer\n        : startContainer;\n      caratElement =\n        caratElement?.nodeType === 3 ? caratElement?.parentNode : caratElement;\n    };\n\n    let preventDefault = () => {\n      try {\n        e.preventDefault();\n      } catch (err) {}\n    };\n\n    let removeZeroSpace = () => {\n      let targetContainer = this.isRangeDirectionForward\n        ? endContainer\n        : startContainer;\n      let nudged = false;\n\n      if (\n        collapsed &&\n        (targetContainer.textContent.includes(\"\\u200B\") ||\n          !targetContainer.textContent)\n      ) {\n        this._nodeCrawler(\n          (n) => {\n            if (\n              n.nodeType === 3 &&\n              (n.textContent === \"\\u200B\" || !n.textContent)\n            ) {\n              let r = n.nextSibling || n.parentNode;\n              let siblingDirection = this.isRangeDirectionForward\n                ? \"nextSibling\"\n                : \"previousSibling\";\n\n              if (\n                n === targetContainer ||\n                (() => {\n                  // fuck safari\n                  if (targetContainer.nodeType === 1) {\n                    let idx = targetContainer.childNodes.length;\n                    while (idx--) {\n                      if (targetContainer.childNodes[idx] === n) return true;\n                    }\n                    return false;\n                  }\n                })()\n              ) {\n                let run = r;\n                if (run.nodeType === 1 && n.parentNode === run) {\n                  if (run[siblingDirection]) nudged = run[siblingDirection];\n                } else nudged = r;\n\n                n.remove();\n\n                this.range = this._adjustSelection({\n                  node: !collapsed\n                    ? this.isRangeDirectionForward\n                      ? [null, nudged || r]\n                      : [nudged || r, null]\n                    : nudged,\n                  position: !collapsed\n                    ? this.isRangeDirectionForward\n                      ? [null, nudged]\n                      : [!nudged, null]\n                    : this.isRangeDirectionForward,\n                });\n\n                rangeSetup();\n                preventDefault();\n                return \"BREAK\";\n              }\n            }\n            return n;\n          },\n          { node: targetContainer }\n        );\n      }\n      return !!nudged;\n    };\n\n    let isCaratOnMultiLine = (el) => {\n      // check if carat is on the first / last line of multi wrapped line\n\n      let posTarget = arrowDirection === \"DOWN\" ? \"bottom\" : \"top\";\n      let caratViewPortPosition = this.range.getBoundingClientRect();\n      let elPosition = el.getBoundingClientRect()[posTarget];\n      let phoneTextSize = parseInt(\n        this.fontSizeCssVariable[\"--wysiwyg-font-phone\"]\n      );\n\n      if (caratViewPortPosition.height) {\n        let isLastLine =\n          (posTarget === \"bottom\"\n            ? elPosition - caratViewPortPosition[posTarget]\n            : caratViewPortPosition[posTarget] - elPosition) < phoneTextSize;\n        return !isLastLine;\n      }\n\n      return false;\n    };\n\n    let nudgeRangeToInlineElement = () => {\n      let rem = removeZeroSpace();\n\n      if (\n        !rem &&\n        window.getComputedStyle(caratElement).display === \"inline-block\"\n      ) {\n        let _caratElement =\n          caratElement.nodeType === 3 ? caratElement.parentNode : caratElement;\n        while (\n          window.getComputedStyle(_caratElement).display === \"inline-block\"\n        ) {\n          _caratElement = _caratElement.parentNode;\n        }\n\n        let siblingDirection =\n          arrowDirection === \"UP\" ? \"previousSibling\" : \"nextSibling\";\n        let nextEl = _caratElement[siblingDirection];\n\n        if (!nextEl) {\n          let t = document.createTextNode(\"\");\n          _caratElement.parentNode.insertBefore(\n            t,\n            siblingDirection === \"previousSibling\" ? _caratElement : nextEl\n          );\n        }\n\n        _caratElement = _caratElement[siblingDirection];\n\n        if (_caratElement) {\n          let setDirection = (() => {\n            return arrowDirection === \"DOWN\";\n          })();\n\n          this.range = this._adjustSelection({\n            node: shift\n              ? this.isRangeDirectionForward\n                ? [null, _caratElement]\n                : [_caratElement, null]\n              : _caratElement,\n            position: shift\n              ? this.isRangeDirectionForward\n                ? [null, setDirection]\n                : [setDirection, null]\n              : setDirection,\n          });\n\n          rangeSetup();\n\n          return true;\n        }\n      }\n      return false;\n    };\n\n    rangeSetup();\n\n    switch (key) {\n      case \"ARROWLEFT\":\n        arrowDirection = \"LEFT\";\n      case \"ARROWRIGHT\":\n        arrowDirection = arrowDirection || \"RIGHT\";\n\n        if (metaKey || (collapsed && shift)) {\n          this.isRangeDirectionForward = arrowDirection === \"RIGHT\";\n          rangeSetup();\n        }\n\n        let caratOnSingleLine = !isCaratOnMultiLine(caratElement);\n\n        let nudged;\n        if (caratOnSingleLine) {\n          if (metaKey && arrowDirection === \"RIGHT\")\n            nudged = nudgeRangeToInlineElement();\n        }\n\n        if (!nudged) removeZeroSpace();\n\n        break;\n\n      case \"ARROWUP\":\n        arrowDirection = \"UP\";\n      case \"ARROWDOWN\":\n        arrowDirection = arrowDirection || \"DOWN\";\n\n        if (!collapsed && !shift) {\n          preventDefault();\n          let adj =\n            arrowDirection === \"UP\"\n              ? [startContainer, startOffset]\n              : [endContainer, endOffset];\n          this.range = this._adjustSelection({\n            node: adj[0],\n            position: adj[1],\n          });\n          break;\n        }\n\n        if (collapsed || isAllRangeOnSameLine) {\n          this.isRangeDirectionForward = arrowDirection === \"DOWN\";\n          rangeSetup();\n        }\n\n        if (isCaratOnMultiLine(caratElement)) break;\n\n        let iNudged = nudgeRangeToInlineElement();\n\n        if (iNudged) break;\n        else removeZeroSpace();\n\n        let isMultiLine = isCaratOnMultiLine(currentLine);\n        if (isMultiLine) break;\n\n        let eldestParentOfCurrentLine = this._climbUpToEldestParent(\n          currentLine,\n          this.element\n        );\n\n        let isCurrentLineInsideSubCeiling =\n          eldestParentOfCurrentLine.id !== this.elementId &&\n          this._isCeilingElement(eldestParentOfCurrentLine);\n\n        // break out if current line is inside the sub ceiling and it's not on the last line\n        if (\n          isCurrentLineInsideSubCeiling &&\n          ((arrowDirection === \"UP\" &&\n            eldestParentOfCurrentLine.firstChild !== currentLine) ||\n            (arrowDirection === \"DOWN\" &&\n              eldestParentOfCurrentLine.lastChild !== currentLine))\n        )\n          break;\n\n        let siblingSet = [\n          isCurrentLineInsideSubCeiling\n            ? eldestParentOfCurrentLine.previousSibling\n            : currentLine.previousSibling,\n          isCurrentLineInsideSubCeiling\n            ? eldestParentOfCurrentLine.nextSibling\n            : currentLine.nextSibling,\n        ];\n\n        if (arrowDirection === \"UP\") siblingSet.reverse();\n\n        let [backwardNode, forwardNode] = siblingSet;\n\n        // if current line is on last line of sub ceiling set forward node to sub ceiling\n        let _forwardNode = isCurrentLineInsideSubCeiling\n          ? eldestParentOfCurrentLine\n          : forwardNode;\n        if (_forwardNode) {\n          if (this._isBlockElement(_forwardNode) && !shift) {\n            preventDefault();\n\n            let leap =\n              arrowDirection === \"UP\"\n                ? _forwardNode.previousSibling\n                : _forwardNode.nextSibling;\n\n            if (!leap || this._isBlockElement(leap)) {\n              let p = this._createEmptyParagraph();\n              _forwardNode.parentNode.insertBefore(\n                p,\n                arrowDirection === \"UP\" ? _forwardNode : leap\n              );\n              _forwardNode = p;\n            } else _forwardNode = leap;\n\n            this.range = this._adjustSelection({\n              node: _forwardNode,\n              position: arrowDirection === \"DOWN\",\n            });\n\n            if (\n              !shift &&\n              !currentLine.textContent &&\n              (this._isBlockElement(backwardNode) ||\n                (!backwardNode && currentLine === this.element.firstChild))\n            )\n              this.removeSandwichedLine_array.push(currentLine);\n          } else if (!isMultiLine && arrowDirection === \"DOWN\") {\n            preventDefault();\n            let collectOffset = 0;\n            let currentOffset = this.isRangeDirectionForward\n              ? endOffset\n              : startOffset;\n            this._nodeCrawler(\n              (n) => {\n                if (n === endContainer) return \"BREAK\";\n                else if (n.nodeType === 3 && n.textContent)\n                  collectOffset += n.textContent.length;\n                return n;\n              },\n              {\n                node: currentLine,\n              }\n            );\n            collectOffset += currentOffset;\n            this.range = this._adjustSelection({\n              node: collapsed\n                ? forwardNode\n                : this.isRangeDirectionForward\n                ? [null, forwardNode]\n                : [forwardNode, null],\n              position: collapsed\n                ? collectOffset\n                : this.isRangeDirectionForward\n                ? [null, collectOffset]\n                : [collectOffset, null],\n            });\n          }\n        } else preventDefault();\n    }\n  }\n\n  _append(i, insertAfter, wrap = false, focusElement) {\n    if (this.logExecution)\n      console.log(\"_append\", { i, insertAfter, wrap, focusElement });\n    let common = this._climbUpToEldestParent(\n      this.range.commonAncestorContainer,\n      this.element\n    );\n    let [startLine, endLine] = this._getStartEndLine();\n    // let startLine = this._climbUpToEldestParent(this.range.startContainer, this.element);\n    // let endLine = this._climbUpToEldestParent(this.range.endContainer, this.element);\n    let insertRestricted = [\"HR\", \"UL\", \"LI\", \"._media_\", \"._custom_\"];\n\n    let append = (node) => {\n      if (node === this.element)\n        node = this.element.childNodes[this.element.childNodes.length - 1];\n\n      let next = node.nextSibling;\n      if (insertAfter) node.parentNode.insertBefore(insertAfter, next);\n\n      node.parentNode.insertBefore(i, insertAfter || next);\n      if (\n        this._isTextElement(node) &&\n        !node.textContent &&\n        this.element.lastChild !== node\n      )\n        node.remove();\n    };\n\n    if (wrap) {\n      let nodeToUnwrap = {};\n      let restricted = false;\n\n      let checker = (tag, el) => {\n        if (\n          el &&\n          (!nodeToUnwrap[tag] ||\n            (() => {\n              for (let u in nodeToUnwrap) {\n                if (nodeToUnwrap[u] === el) return false;\n              }\n              return true;\n            })())\n        )\n          nodeToUnwrap[tag] = el;\n      };\n\n      if (this.range.collapsed) {\n        checker(i.nodeName, startLine.closest(i.nodeName));\n\n        let idx = i.classList.length;\n        while (idx--) {\n          let className = i.classList[idx];\n          checker(className, startLine.closest(\".\" + className));\n        }\n      } else\n        this._nodeCrawler(\n          (n) => {\n            let chk = n.nodeType === 3 ? n.parentNode : n;\n            if (chk.nodeType !== 1) {\n              restricted = true;\n              return \"BREAK\";\n            }\n\n            if (n.nodeType === 1) {\n              for (let notAllowed of insertRestricted)\n                if (n.nodeName === notAllowed || n.closest(notAllowed)) {\n                  restricted = true;\n                  return \"BREAK\";\n                }\n            }\n\n            checker(i.nodeName, chk.closest(i.nodeName));\n\n            let idx = i.classList.length;\n            while (idx--) {\n              let className = i.classList[idx];\n              checker(className, chk.closest(\".\" + className));\n            }\n\n            if (n === this.range.endContainer) return \"BREAK\";\n\n            return n;\n          },\n          { node: common, startNode: this.range.startContainer }\n        );\n\n      if (restricted) return;\n\n      if (Object.keys(nodeToUnwrap).length) {\n        for (let u in nodeToUnwrap) this._wrapNode(nodeToUnwrap[u]);\n      } else {\n        append(endLine);\n\n        let extract = this.range.extractContents();\n\n        if (extract.childNodes[0]) {\n          while (extract.childNodes[0]) {\n            let t = extract.childNodes[0];\n            if (!t.textContent) t.remove();\n            else i.append(t);\n          }\n        } else i.append(this._createEmptyParagraph());\n\n        this.range = this._adjustSelection({\n          node: focusElement || i,\n          position: false,\n        });\n\n        //  remove garbage node\n        let fc = i.previousSibling;\n        // let lc = i.nextSibling;\n\n        if (fc) {\n          fc = fc.nodeType === 3 ? fc.parentNode : fc;\n\n          if (\n            this._isTextElement(fc) &&\n            (!fc.textContent || fc.textContent === \"\\u200B\")\n          )\n            fc.remove();\n        }\n      }\n\n      return;\n    }\n\n    for (let r of insertRestricted) {\n      if (endLine.closest(r)) endLine = endLine.closest(r);\n    }\n\n    append(endLine);\n\n    if (insertAfter)\n      this.range = this._adjustSelection({ node: focusElement || insertAfter });\n  }\n\n  async _callback(data) {\n    if (typeof this.callback === \"function\") {\n      let cb = this.callback(data) || data;\n      if (cb instanceof Promise) {\n        cb = await cb;\n      }\n      return cb || data;\n    }\n    return data;\n  }\n\n  async _imageSelected(e) {\n    if (this.logExecution) console.log(\"_imageSelected\", { e });\n    let files = e.target.files;\n\n    const prepareForCallback = { image: [] };\n    let readFile = new FileReader();\n\n    const load = (file) => {\n      return new Promise((res) => {\n        readFile.onload = (f) => {\n          const { lastModified, name, size, type } = file;\n          const source = f.target.result;\n\n          let img = new Image();\n          img.onload = () => {\n            res({\n              dimension: {\n                width: img.width,\n                height: img.height,\n              },\n              lastModified,\n              filename: name,\n              fileSize: size,\n              fileType: type,\n              source,\n              elementId: this._generateId(\"img\"),\n            });\n          };\n          img.src = source;\n        };\n        readFile.readAsDataURL(file);\n      });\n    };\n\n    this.callback({ loading: true });\n    for (let idx = 0; files.length > idx; idx++) {\n      prepareForCallback.image[idx] = await load(files[idx]);\n    }\n    this.callback({ loading: false });\n\n    //  reset image input\n    this.imgInput.value = \"\";\n\n    let feedback = await this._callback(prepareForCallback);\n\n    if (!this.range) {\n      this.restoreLastSelection();\n    }\n    if (\n      !this.range ||\n      (() => {\n        let c = this.range.commonAncestorContainer;\n        c = c.nodeType === 3 ? c.parentNode : c;\n        return !c.closest(\"#\" + this.elementId);\n      })()\n    )\n      this.element.focus();\n\n    this._modifySelection(() => {\n      for (let img of feedback.image) {\n        let media = this._loadImage(img, document.createElement(\"div\"));\n        this._append(media, this._createEmptyParagraph());\n      }\n    });\n  }\n\n  _loadImage(imageObject, wrapper) {\n    if (this.logExecution) console.log(\"_loadImage\", { imageObject, wrapper });\n    /**\n         elementId: \"img_uniqueId\"\n         element: HTML\n         fileSize: 0\n         fileType: \"image/jpeg\"\n         source: \"file.jpg | http://url.com/file.jpg | s3 filename | base 64 string\"\n         lastModified: 0000000000000\n         filename: \"selectedLocalFilename.jpg\"\n         */\n\n    if (wrapper instanceof Node) {\n      if (!wrapper.classList.contains(\"_media_\"))\n        wrapper.classList.add(\"_media_\");\n\n      if (wrapper.getAttribute(\"contenteditable\") !== \"false\")\n        wrapper.setAttribute(\"contenteditable\", \"false\");\n    } else throw \"image needs _media_ wrapper\";\n\n    let process = (i) => {\n      let image = i?.element instanceof Node ? i.element : null;\n\n      if (image) {\n        if (image.id) i.elementId = image.id;\n        else image.id = i.elementId;\n      }\n\n      if (!image) {\n        image = document.createElement(\"img\");\n        i.element = image;\n\n        let classname =\n          \"_img_\" +\n          i.source\n            .substring(i.source.length - 128)\n            .replace(/[/:.\"'\\\\@#$%\\?= \\{\\}\\|&*`!<>+]/g, \"\");\n        if (image.classList.contains(classname)) image.classList.add(classname);\n\n        if (Array.isArray(i.class)) {\n          for (let cl of i.class) image.classList.add(cl);\n        }\n\n        if (image.tagName === \"IMG\") image.setAttribute(\"src\", i.source);\n\n        if (typeof i.onclick === \"function\") {\n          image.addEventListener(\"click\", i.onclick);\n          image.classList.add(\"_hover_\");\n        }\n\n        if (\n          i.style &&\n          typeof i.style === \"object\" &&\n          Object.keys(i.style).length\n        ) {\n          for (let st in i.style) {\n            wrapper.style.setProperty(st, i.style[st]);\n          }\n        }\n      }\n\n      wrapper.setAttribute(\"contenteditable\", \"false\");\n      wrapper.append(image);\n\n      let pushArray = true;\n\n      for (let chk of this.image_array)\n        if (chk.elementId === i.elementId) {\n          pushArray = false;\n          break;\n        }\n\n      if (pushArray) this.image_array.push(i);\n    };\n\n    process(imageObject);\n\n    return wrapper;\n  }\n\n  _getAnchorOffsetFromLine(line) {\n    const sel = window.getSelection();\n    if (!sel || !sel.anchorNode) return 0;\n\n    let anchorNode = sel.anchorNode;\n    let anchorOffset = sel.anchorOffset;\n\n    // If anchorNode is not inside line, return 0\n    if (!line.contains(anchorNode) && line !== anchorNode) return 0;\n\n    let offset = 0;\n    let found = false;\n\n    function traverse(node) {\n      if (found) return;\n      if (node === anchorNode) {\n        offset += anchorOffset;\n        found = true;\n        return;\n      }\n      if (node.nodeType === 3) {\n        offset += node.textContent.length;\n      } else {\n        for (let child of node.childNodes) {\n          traverse(child);\n          if (found) break;\n        }\n      }\n    }\n\n    traverse(line);\n    return offset;\n  }\n  _getFocusOffsetFromLine(line) {\n    const sel = window.getSelection();\n    if (!sel || !sel.focusNode) return 0;\n\n    let focusNode = sel.focusNode;\n    let focusOffset = sel.focusOffset;\n\n    // If focusNode is not inside line, return 0\n    if (!line.contains(focusNode) && line !== focusNode) return 0;\n\n    let offset = 0;\n    let found = false;\n\n    function traverse(node) {\n      if (found) return;\n      if (node === focusNode) {\n        offset += focusOffset;\n        found = true;\n        return;\n      }\n      if (node.nodeType === 3) {\n        offset += node.textContent.length;\n      } else {\n        for (let child of node.childNodes) {\n          traverse(child);\n          if (found) break;\n        }\n      }\n    }\n\n    traverse(line);\n    return offset;\n  }\n  _modifySelection(run, lineByLine) {\n    if (this.logExecution) console.log(\"_modifySelection\", { run });\n    let sel = window.getSelection();\n    let doSingleLine = (sel) => {\n      let anchorElement =\n        sel.anchorNode?.nodeType === 3\n          ? sel.anchorNode.parentNode\n          : sel.anchorNode;\n      if (anchorElement && anchorElement.closest(`#${this.elementId}`)) {\n        if (anchorElement.id === this.elementId) {\n          // In case selection is the wysiwyg element itself\n          let lastChild = this.element.lastChild;\n          if (!lastChild) {\n            // Wysiwyg is empty\n            lastChild = this._createEmptyParagraph();\n            this.element.appendChild(lastChild);\n\n            // Adjust selection\n            this.range = this._adjustSelection({\n              node: lastChild,\n              position: true,\n            });\n          }\n        } else this.range = this._adjustSelection(null);\n\n        if (typeof run === \"function\") run();\n        return;\n      }\n    };\n\n    // if (lineByLine) { // TODO: line by line\n    //   let [startLine, endLine, inBetween] = this._getStartEndLine(\n    //     this.range,\n    //     this.element,\n    //     true\n    //   );\n\n    //   if (this.logExecution) console.log({ startLine, endLine, inBetween });\n\n    //   if (startLine === endLine) {\n    //     return doSingleLine(sel);\n    //   } else {\n    //     this.range_backup = this.range.cloneRange();\n    //     this.range = this._adjustSelection({\n    //       node: startLine,\n    //       position: [this._getAnchorOffsetFromLine(startLine), false],\n    //     });\n    //     if (typeof run === \"function\") run();\n\n    //     if (inBetween?.length) {\n    //       for (let i of inBetween) {\n    //         this.range = this._adjustSelection({\n    //           node: inBetween[i],\n    //           position: [true, false],\n    //         });\n\n    //         if (typeof run === \"function\") run();\n    //       }\n    //     }\n\n    //     this.range = this._adjustSelection({\n    //       node: endLine,\n    //       position: [true, this._getFocusOffsetFromLine(endLine)],\n    //     });\n\n    //     if (typeof run === \"function\") run();\n\n    //     this.restoreLastSelection();\n    //     return;\n    //   }\n    // } else if (sel) {\n    return doSingleLine(sel);\n    // }\n\n    this.range = null;\n    this.commandTracker = {};\n  }\n\n  _normalizeDocument(normalize) {\n    if (this.logExecution) console.log(\"_normalizeDocument\", { normalize });\n    if (!normalize) return;\n\n    this._nodeCrawler(\n      (n) => {\n        if (n.nodeType === 3 && n.textContent.includes(\"\\u200B\")) {\n          //!n.textContent ||\n          n.textContent = n.textContent.replace(\"\\u200B\", \"\");\n\n          if (!n.textContent) {\n            let cel;\n            for (let c of this.ceilingElement_queryArray)\n              if (n.parentNode.closest(c)) {\n                cel = n.parentNode.closest(c);\n                break;\n              }\n\n            let el = this._climbUpToEldestParent(n, cel, true);\n\n            let par = el.parentNode;\n            if (\n              !this._isCeilingElement(par) &&\n              !el.textContent &&\n              this.element.lastChild !== el\n            ) {\n              par.removeChild(el);\n              n = par;\n            }\n            return n;\n          }\n        } else if (n.nodeType === 1) n.normalize();\n\n        return n;\n      },\n      { node: this.element }\n    );\n  }\n\n  _replaceText(wholeDocument = false) {\n    if (this.logExecution) console.log(\"_replaceText\", { wholeDocument });\n    const process = (typeName, setData) => {\n      if (!this[typeName]) return;\n\n      let regex = this[`${typeName}_regex`] || null;\n\n      if (regex === null) throw new Error(\"no regex to process\");\n\n      if (typeof setData !== \"function\")\n        throw new Error(\"setData should be returning function\");\n\n      let node = wholeDocument\n        ? this.element\n        : this.range?.commonAncestorContainer;\n\n      if (!node) return;\n\n      if (node.nodeType === 3) node = node.parentNode;\n\n      let res = (() => {\n        let className = `_${typeName}_`;\n        let element = [];\n        let collected = [];\n\n        let textNodes = [];\n        this._nodeCrawler(\n          (n) => {\n            if (n.nodeType === 3 && n.textContent) {\n              if (\n                n.nextSibling?.nodeType === 3 &&\n                n.nextSibling.textContent &&\n                n.nextSibling.textContent !== \"\\u200B\"\n              ) {\n                let par = n.parentNode;\n                par.normalize();\n                n = par;\n              } else if (\n                n.textContent !== \"\\u200B\" &&\n                !n.parentNode.closest(\".\" + className)\n              )\n                textNodes.push(n);\n            }\n\n            return n;\n          },\n          { node }\n        );\n\n        textNodes.forEach((node) => {\n          replaceTextNode(node, regex, function (matched) {\n            if (matched.length > 1) {\n              return {\n                name: \"span\",\n                attrs: { class: `${className} ${className}${matched}` },\n                content: matched,\n              };\n            }\n          });\n        });\n\n        function replaceTextNode(node, regex, handler) {\n          let par = node.parentNode,\n            nxt = node.nextSibling,\n            doc = node.ownerDocument,\n            hits;\n\n          if (regex.global) {\n            while (node && (hits = regex.exec(node.nodeValue))) {\n              regex.lastIndex = 0;\n              node = handleResult(node, hits, handler.apply(this, hits));\n            }\n          } else if ((hits = regex.exec(node.nodeValue)))\n            handleResult(node, hits, handler.apply(this, hits));\n\n          function handleResult(node, hits, results) {\n            let orig = node.nodeValue;\n            node.nodeValue = orig.slice(0, hits.index);\n            [].concat(create(par, results)).forEach(function (n) {\n              let res = par.insertBefore(n, nxt);\n              element.push(res);\n            });\n            let rest = orig.slice(hits.index + hits[0].length);\n            if (rest) {\n              let text = doc.createTextNode(rest);\n              return par.insertBefore(text, nxt);\n            }\n          }\n\n          function create(el, o) {\n            if (o.map)\n              return o.map(function (v) {\n                return create(el, v);\n              });\n            else if (typeof o === \"object\") {\n              let e = doc.createElementNS(\n                o.namespaceURI || el.namespaceURI,\n                o.name\n              );\n              if (o.attrs) for (let a in o.attrs) e.setAttribute(a, o.attrs[a]);\n              if (o.content)\n                [].concat(create(e, o.content)).forEach(e.appendChild, e);\n              if (typeof o.content === \"string\") collected.push(o.content);\n              e.contentEditable = \"false\";\n              return e;\n            } else return doc.createTextNode(o + \"\");\n          }\n        }\n\n        let anchorText;\n        if (element.length) {\n          for (let el of element) {\n            anchorText = node.ownerDocument.createTextNode(\"\");\n            el.parentNode.insertBefore(anchorText, el.nextSibling);\n          }\n        }\n        return { collected, element, anchorText };\n      })();\n\n      let textEl = res.element;\n\n      if (!wholeDocument) {\n        this.range = this._adjustSelection({\n          node: res.anchorText,\n          position: false,\n        });\n      }\n\n      let toCallback = [];\n      let collectId = [];\n\n      if (textEl[0])\n        for (let el of textEl) {\n          let elementId = this._generateId(typeName);\n          el.setAttribute(\"id\", elementId);\n          let tc = setData(el) || {};\n          tc.elementId = el.id;\n          tc.element = el;\n\n          el.removeAttribute(\"style\");\n          collectId.push(el.id);\n          toCallback.push(tc);\n        }\n\n      if (toCallback.length) {\n        this._callback({ [typeName]: toCallback })\n          .then((e) => {\n            for (let idx = 0; collectId.length > idx; idx++) {\n              //  elementId is read only\n              e[typeName][idx].elementId = collectId[idx];\n            }\n\n            if (Array.isArray(e[typeName]) && e[typeName].length)\n              for (let h of e[typeName]) {\n                let dom = document.getElementById(h.elementId);\n\n                dom.setAttribute(\"id\", h.elementId);\n                dom.setAttribute(\"contenteditable\", \"false\");\n\n                if (typeof h.onclick === \"function\") {\n                  dom.addEventListener(\"click\", h.onclick);\n                  dom.classList.add(\"_hover_\");\n                }\n\n                if (\n                  h.style &&\n                  typeof h.style === \"object\" &&\n                  Object.keys(h.style).length\n                ) {\n                  for (let s in h.style) dom.style.setProperty(s, h.style[s]);\n                }\n\n                this[`${typeName}_array`].push(h);\n              }\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      }\n    };\n\n    if (this.urllink_flag) {\n      process(\"urllink\", (url) => {\n        let u = url.textContent;\n        url.addEventListener(\"click\", function () {\n          if (!u.match(/^https?:\\/\\//i)) {\n            u = \"http://\" + u;\n          }\n          window.open(u, \"_blank\");\n        });\n\n        return { url: u };\n      });\n    }\n\n    if (this.hashtag_flag) {\n      process(\"hashtag\", (tag) => {\n        let t = tag.textContent;\n        return { tag: t[0] === \"#\" ? t.substring(1) : t };\n      });\n    }\n\n    this.hashtag_flag = false;\n    this.urllink_flag = false;\n  }\n\n  _checkElement(node, chkArr, closest, exp) {\n    /**\n     * parentNode when node is a text node\n     * chkArr is an array of class names or tag names\n     * closest is a boolean to check if the element is closest to the node\n     */\n    if (this.logExecution)\n      console.log(\"_checkElement\", { node, chkArr, closest, exp });\n    if (node && node.nodeType === 1)\n      for (let c of chkArr) {\n        if (closest) {\n          let clo = node.closest(c);\n          if (clo) {\n            if (exp && exp[c]) {\n              if (c === \"._custom_\") {\n                let flyup = node;\n                let gotTheMatch = false;\n                if (node !== this.element) {\n                  while ((flyup && this.element !== flyup) || !gotTheMatch) {\n                    gotTheMatch =\n                      flyup.getAttribute(exp[c].attr) === exp[c].value;\n                    if (gotTheMatch) return false;\n\n                    flyup = flyup.parentNode;\n                  }\n                }\n              } else\n                return clo.getAttribute(exp[c].attr) === exp[c].value\n                  ? false\n                  : clo;\n            }\n\n            return clo;\n          }\n        } else if (\n          c[0] === \"#\"\n            ? node.id === c.substring(1)\n            : c[0] === \".\"\n            ? node.classList.contains(c.substring(1))\n            : node.nodeName === c\n        )\n          return true;\n      }\n    return false;\n  }\n\n  _isUnSelectableElement(node) {\n    if (this.logExecution) console.log(\"_isUnSelectableElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    let exceptions = {\n      \"._custom_\": { attr: \"contenteditable\", value: \"true\" },\n    };\n    return this._checkElement(\n      node,\n      this.unSelectable_queryArray,\n      true,\n      exceptions\n    );\n  }\n\n  _isStyleAllowedElement(node) {\n    if (this.logExecution) console.log(\"_isStyleAllowedElement\", { node });\n    return this._checkElement(node, this.styleAllowedElement_queryArray);\n  }\n\n  _isCeilingElement(node) {\n    if (this.logExecution) console.log(\"_isCeilingElement\", { node });\n    return this._checkElement(node, this.ceilingElement_queryArray);\n  }\n\n  _isBlockElement(node) {\n    if (this.logExecution) console.log(\"_isBlockElement\", { node });\n    return this._checkElement(node, this.blockElement_queryArray);\n  }\n\n  _isTextAreaElement(node) {\n    if (this.logExecution) console.log(\"_isTextAreaElement\", { node });\n    return this._checkElement(node, this.textAreaElement_queryArray);\n  }\n\n  _isTextBlockElement(node) {\n    if (this.logExecution) console.log(\"_isTextBlockElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    return this._checkElement(node, this.textBlockElement_queryArray);\n  }\n\n  _isSpecialTextElement(node) {\n    if (this.logExecution) console.log(\"_isSpecialTextElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    return this._checkElement(node, this.specialTextElement_queryArray);\n  }\n\n  _isTextElement(node) {\n    if (this.logExecution) console.log(\"_isTextElement\", { node });\n    node = node?.nodeType === 3 ? node.parentNode : node;\n    return (\n      (this._isTextBlockElement(node) || node.nodeName === \"SPAN\") &&\n      !this._isSpecialTextElement(node)\n    );\n  }\n\n  /**\n   * List of command for editing wysiwyg text.\n   * @param {'quote'} action - Add blockquote below selected line.\n   * @also\n   * @param {'unorderedList'} action - Add unordered list below selected line.\n   * @also\n   * @param {'orderedList'} action - Add ordered list below selected line.\n   * @also\n   * @param {'divider'} action - Add HR below selected line.\n   * @also\n   * @param {'image'} action - Add image below selected line.\n   * @also\n   * @param {'alignLeft'} action - Align selected line to left.\n   * @also\n   * @param {'alignCenter'} action - Align selected line to center.\n   * @also\n   * @param {'alignRight'} action - Align selected line to right.\n   * @also\n   * @param {'color' | 'hex | rgb string | hsl string'} action - Apply color to selected text. If 'color' is given, the default focus color is applied to the text.\n   * @also\n   * @param {'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' | 'small' | 'bold' | 'italic' | 'underline' | 'strike'} action - Apply style to selection.\n   * @also\n   * @param {object} action - Custom element object\n   * @param {object | string} action.element - Custom element can be node objects | html string | string\n   * @param {string} action.elementId - Set custom elements parent id. Otherwise auto generated\n   * @param {object} action.style - Set custom elements parent css style\n   * @param {boolean} action.insert - Set custom element insert mode. If true, inserts element at carat position, otherwise appends on next line\n   */\n  command(action) {\n    if (!action) return;\n\n    if (!this.range) this.restoreLastSelection();\n\n    switch (action) {\n      case \"quote\":\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        this._modifySelection(() => {\n          let p = this._createEmptyParagraph(),\n            bq = document.createElement(\"blockquote\");\n          this._append(bq, p, true);\n        });\n        return;\n      case \"unorderedList\":\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        this._modifySelection(() => {\n          let p = this._createEmptyParagraph(),\n            li = document.createElement(\"li\"),\n            ul = document.createElement(\"ul\");\n          ul.append(li);\n          this._append(ul, p, false, li);\n        });\n\n        return;\n      case \"orderedList\":\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        this._modifySelection(() => {\n          let p = this._createEmptyParagraph(),\n            li = document.createElement(\"li\"),\n            ul = document.createElement(\"ol\");\n          ul.append(li);\n          this._append(ul, p, false, li);\n        });\n\n        return;\n      case \"divider\":\n        if (\n          !this.range ||\n          (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest(\"#\" + this.elementId);\n          })()\n        )\n          this.element.focus();\n\n        this._modifySelection(() => {\n          let p = this._createEmptyParagraph(),\n            hr = document.createElement(\"hr\");\n          hr.setAttribute(\"contenteditable\", \"false\");\n          this._append(hr, p, false);\n        });\n        return;\n      case \"image\":\n        this.imgInput.click();\n        return;\n      case \"alignLeft\":\n      case \"alignCenter\":\n      case \"alignRight\":\n        if (!this.range) return;\n\n        this._modifySelection(() => {\n          let startLine = this.range.startLine;\n          let endLine = this.range.endLine;\n\n          let collectLines = [];\n          collectLines.push(startLine);\n\n          while (collectLines[collectLines.length - 1] !== endLine) {\n            let nextLine = collectLines[collectLines.length - 1].nextSibling;\n\n            while (nextLine && !this._isTextBlockElement(nextLine)) {\n              if (\n                this._isCeilingElement(nextLine) &&\n                nextLine.firstChild &&\n                this._isTextBlockElement(nextLine.firstChild)\n              ) {\n                nextLine = nextLine.firstChild;\n                break;\n              }\n              nextLine = nextLine.nextSibling;\n            }\n\n            if (\n              !nextLine &&\n              this._isCeilingElement(\n                collectLines[collectLines.length - 1].parentNode\n              )\n            )\n              nextLine =\n                collectLines[collectLines.length - 1].parentNode.nextSibling;\n\n            if (nextLine) collectLines.push(nextLine);\n            else break;\n          }\n\n          let commandTracker = Object.assign({}, this.commandTracker);\n\n          for (let l of collectLines) {\n            for (let c of this.alignClass) {\n              if (l.classList.contains(c)) l.classList.remove(c);\n              commandTracker[c.substring(1, c.length - 1)] = false;\n            }\n\n            if (action !== \"alignLeft\" && !this.commandTracker[action]) {\n              for (let c of this.alignClass) {\n                if (c.includes(action)) l.classList.add(c);\n              }\n              commandTracker[action] = true;\n            }\n          }\n\n          this.commandTracker = commandTracker;\n\n          this._callback({\n            commandTracker,\n            range: this.range,\n          }).catch((err) => err);\n        });\n        return;\n\n      default:\n        break;\n    }\n\n    let isColor;\n    try {\n      isColor = new ColorMangle(action).hex();\n      action = \"color\";\n    } catch {}\n\n    //  style command\n    if (this.styleTagOfCommand[action]) {\n      this._modifySelection(() => {\n        let wrapper,\n          query = this.styleTagOfCommand[action],\n          stopperMode = false;\n\n        let counter = this.counterTagOf[query]\n          ? this.counterTagOf[query].map((c) => this._classNameToQuery(c))\n          : [];\n        if (counter.length)\n          counter = counter.concat(counter.map((c) => c + \"_stop\"));\n\n        //  setup query\n        query = this._classNameToQuery(query);\n\n        if (this.commandTracker[action]) {\n          let pass;\n\n          if (action === \"color\") {\n            pass =\n              isColor === this.commandTracker[action] ||\n              (isColor === undefined &&\n                this.commandTracker[action] ===\n                  this.cssVariable[\"--content-focus\"]);\n          } else pass = true;\n\n          if (pass) {\n            query = this._classNameToQuery(query + \"_stop\");\n            stopperMode = true;\n          }\n        }\n\n        //  setup wrapper element\n        if (query[0] === \".\") {\n          wrapper = document.createElement(\"SPAN\");\n          wrapper.classList.add(query.substring(1));\n        } else wrapper = document.createElement(query);\n\n        if (isColor && !stopperMode) wrapper.style.color = isColor;\n\n        let restrictedClass = this._isSelectionWithinRestrictedRange();\n        if (this.range.collapsed) {\n          if (restrictedClass) return;\n\n          let text = document.createTextNode(\"\");\n          // let text = document.createTextNode(\"\\u200B\");\n          wrapper.append(text);\n\n          if (this.range.startContainer.nodeName === \"BR\")\n            this.range.startContainer.parentNode.insertBefore(\n              wrapper,\n              this.range.startContainer\n            );\n          else this.range.insertNode(wrapper);\n\n          this.range = this._adjustSelection({ node: text, position: false });\n        } else {\n          if (restrictedClass) {\n            this.range = this._adjustSelection({\n              node: this.range.endContainer,\n              position: this.range.endOffset,\n            });\n            return;\n          }\n          //  selection has range\n          let extract = this.range.extractContents();\n          let span = document.createElement(\"span\");\n\n          while (extract.childNodes[0]) span.append(extract.childNodes[0]);\n\n          this._nodeCrawler(\n            (n) => {\n              let res = restrictedClass\n                ? this._classNameToQuery(restrictedClass)\n                : null;\n              let par = n.nodeType === 3 ? n.parentNode : n;\n              let restricted =\n                res && par.hasOwnProperty(\"closest\") ? par.closest(res) : false;\n\n              if (n.nodeType === 3 && !restricted)\n                n.textContent = n.textContent.replaceAll(\"\\t\", \"\");\n\n              return n;\n            },\n            { node: span, startFromEldestChild: true, parentNode: this.element }\n          );\n\n          while (span.childNodes[0]) extract.append(span.childNodes[0]);\n\n          //  unwrap duplicates and stopper | counter\n          let unwrapTarget = [query];\n\n          //  add countering | opposite tag to unwrap\n          if (stopperMode) {\n            let rev = query.replace(\"_stop\", \"\").substring(1);\n            rev = rev[0] === \"_\" ? \".\" + rev : rev;\n            unwrapTarget.push(rev);\n          } else {\n            let rev = query + \"_stop\";\n            rev = rev[0] === \".\" ? rev : \".\" + rev;\n            unwrapTarget.push(rev);\n          }\n\n          unwrapTarget = unwrapTarget.concat(counter);\n          let del = extract.querySelectorAll(unwrapTarget.join());\n          let idx = del.length;\n          if (idx) while (idx--) this._wrapNode(del[idx]);\n\n          //  split wrapper\n          let wrapperSplit = [wrapper.cloneNode(true)];\n\n          while (extract.childNodes[0]) {\n            let child = extract.childNodes[0];\n\n            if (child.nodeType === 1 && this._isBlockElement(child)) {\n              let nest = this._isTextAreaElement(child);\n\n              if (nest) {\n                for (let idx = 0; child.childNodes.length > idx; idx++) {\n                  let text = child.childNodes[idx];\n\n                  if (this._isTextElement(text)) {\n                    let nestedWrapper = wrapper.cloneNode(true);\n                    while (text.childNodes[0]) {\n                      if (text.childNodes[0].textContent)\n                        nestedWrapper.append(text.childNodes[0]);\n                      else text.childNodes[0].remove();\n                    }\n                    text.append(nestedWrapper);\n                  }\n                }\n\n                if (!child.textContent) {\n                  child.remove();\n                  continue;\n                }\n              }\n\n              let doc = document.createDocumentFragment();\n              doc.append(child);\n              wrapperSplit.push(doc);\n            } else {\n              if (child.nodeType === 1 && this._isTextBlockElement(child)) {\n                let nestedWrapper = wrapper.cloneNode(true);\n\n                while (child.childNodes[0])\n                  nestedWrapper.append(child.childNodes[0]);\n\n                if (\n                  nestedWrapper.childNodes.length === 1 &&\n                  nestedWrapper.childNodes[0].nodeName !== \"BR\" &&\n                  !nestedWrapper.textContent.length\n                ) {\n                  child.remove();\n                  continue;\n                }\n\n                child.append(nestedWrapper);\n                let doc = document.createDocumentFragment();\n                doc.append(child);\n                wrapperSplit.push(doc);\n              } else wrapperSplit[wrapperSplit.length - 1].append(child);\n            }\n          }\n\n          let output = document.createDocumentFragment();\n          for (let ws of wrapperSplit) output.append(ws);\n\n          let fc = output.firstChild;\n          let lc = output.lastChild;\n\n          if (this._isTextElement(fc) && !fc.textContent) {\n            let fn = fc.nextSibling;\n            fc.remove();\n            fc = fn;\n          }\n          if (this._isTextElement(lc) && !fc.textContent) {\n            let lp = lc.nextSibling;\n            lc.remove();\n            lc = lp;\n          }\n\n          this.range.insertNode(output);\n          this.range = this._adjustSelection({\n            node: [fc, lc],\n            position: [true, false],\n          });\n\n          //  remove garbage node\n          fc = fc.nodeType === 3 ? fc.parentNode : fc;\n          lc = lc.nodeType === 3 ? lc.parentNode : lc;\n\n          let next = lc.nextSibling;\n          if (\n            this._isTextElement(next) &&\n            (!next.textContent || next.textContent === \"\\u200B\")\n          )\n            next.remove();\n\n          let prev = fc.previousSibling;\n          if (\n            (this._isTextElement(prev) && !prev.textContent) ||\n            prev.textContent === \"\\u200B\"\n          )\n            prev.remove();\n        }\n      }, true);\n\n      return;\n    }\n\n    //  custom component\n    if (typeof action === \"object\") {\n      /**\n        action = {\n          elementId: <string: generated parent element id>,\n          element: <HTMLElement>,\n          style: {<css style object for parent element>},\n          insert: true | false,\n          contenteditable: false,\n        }\n      */\n\n      this._modifySelection(() => {\n        //  setup wrapper\n        let custom = document.createElement(\"div\");\n        custom.classList.add(\"_custom_\");\n        custom.setAttribute(\n          \"contenteditable\",\n          (!!action?.contenteditable).toString()\n        );\n\n        if (action.style)\n          for (let s in action.style) custom.style[s] = action.style[s];\n\n        action.elementId = action.elementId || this._generateId(\"custom\");\n        custom.id = action.elementId;\n\n        if (typeof action.element === \"string\")\n          custom.innerHTML = action.element;\n        else if (action.element instanceof HTMLElement)\n          custom.append(action.element);\n\n        if (!custom.children.length) action.insert = true; // insert if only text node\n\n        if (!this.range) this.element.focus();\n\n        this.custom_array.push(action);\n\n        this._callback({ custom: action }).then((_) => {\n          if (action.insert) {\n            let txt = document.createTextNode(\"\");\n            this.range.insertNode(txt); // when inserted in range, it will push the next el back\n            this.range.insertNode(custom);\n            this.range = this._adjustSelection({\n              node: txt,\n              position: false,\n            });\n          } else this._append(custom, this._createEmptyParagraph(), false);\n        });\n      });\n    }\n  }\n\n  /**\n   * Restores the last selection range\n   */\n  restoreLastSelection() {\n    if (this.logExecution)\n      console.log(\"restoreLastSelection\", { range_backup: this.range_backup });\n    if (this.range_backup) {\n      this.range = this._adjustSelection({\n        node: [\n          this.range_backup.startContainer,\n          this.range_backup.endContainer,\n        ],\n        position: [this.range_backup.startOffset, this.range_backup.endOffset],\n      });\n      let sel = window.getSelection();\n      let range = document.createRange();\n      range.setStart(this.range.startContainer, this.range.startOffset);\n      range.setEnd(this.range.endContainer, this.range.endOffset);\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n  }\n\n  /**\n   * Load html string to wysiwyg\n   * @param {string} html - HTML string to load.\n   * @param {boolean} [editable=false] - Set editable mode.\n   */\n  async loadHTML(html = this.html, editable = false) {\n    if (typeof html !== \"string\") {\n      throw new Error(\"html should be a string\");\n    }\n\n    this.setEditable(false);\n    this.html = html || \"\";\n    const div = document.createElement(\"div\");\n    div.innerHTML = html;\n\n    // image\n    const img = div.querySelectorAll(\"img\");\n    const imgCallback = [];\n    if (img.length)\n      for (let i of img) {\n        const imageParent = i.closest(\"._media_\");\n\n        if (imageParent) {\n          const source = i.getAttribute(\"src\");\n          let imgId = i.id || this._generateId(\"img\");\n          i.setAttribute(\"id\", imgId);\n\n          imgCallback.push({\n            source,\n            elementId: imgId,\n            element: i,\n          });\n        }\n\n        this.image_array = JSON.parse(JSON.stringify(imgCallback));\n      }\n\n    // hashtag\n    const hashtag = div.querySelectorAll(\"._hashtag_\");\n    const hashtagCallback = [];\n    if (hashtag.length)\n      for (let i of hashtag) {\n        let clIdx = i.classList.length;\n        let tag,\n          elementId = i.id || this._generateId(\"hashtag\");\n        while (clIdx--) {\n          let cls = i.classList[clIdx];\n          if (cls.replace(\"_hashtag_\", \"\")[0] === \"#\") {\n            tag = cls.replace(\"_hashtag_\", \"\");\n          }\n        }\n        tag = tag?.[0] === \"#\" ? tag.substring(1) : tag;\n        if (tag) hashtagCallback.push({ tag, elementId, element: i });\n      }\n\n    // urllink\n    const urllink = div.querySelectorAll(\"._urllink_\");\n    const urllinkCallback = [];\n    if (urllink.length)\n      for (let i of urllink) {\n        let elementId = i.id || this._generateId(\"urllink\");\n        let url;\n\n        let clIdx = i.classList.length;\n        while (clIdx--) {\n          let cls = i.classList[clIdx];\n          if (cls.includes(\"_urllink_\").length) {\n            url = cls.replace(\"_urllink_\", \"\");\n          }\n        }\n        if (url) urllinkCallback.push({ url, elementId, element: i });\n      }\n\n    const custom = div.querySelectorAll(\"._custom_\");\n    const customCallback = [];\n    if (custom.length)\n      for (let i of custom) {\n        let elementId = i.id || this._generateId(\"custom\");\n        customCallback.push({ elementId, element: i });\n      }\n\n    let fb = await this._callback({\n      image: imgCallback,\n      hashtag: hashtagCallback,\n      urllink: urllinkCallback,\n      custom: customCallback,\n    });\n\n    // callback\n    for (let f in fb) {\n      if (f === \"image\") {\n        let img = fb[f];\n        for (let i of img) {\n          let imgEl = div.querySelector(\"#\" + i.elementId);\n          const imageParent = imgEl.closest(\"._media_\");\n          this._loadImage(i, imageParent);\n        }\n      } else this[f + \"_array\"] = fb[f];\n    }\n\n    this.element.innerHTML = \"\";\n\n    while (div.childNodes[0]) this.element.append(div.childNodes[0]);\n\n    if (editable) this.setEditable(true);\n  }\n\n  /**\n   * Load html string to wysiwyg\n   * @param {function} [pre=(p)=>{return p}] - Pre processing callback before export.\n   * @return {object} - Exported wysiwyg data object\n   */\n  async export(pre) {\n    this._normalizeDocument(true);\n    const dom = this.element.cloneNode(true);\n\n    const { hashtag_array, image_array, urllink_array, custom_array } = this;\n    let title = \"\";\n    let text = \"\";\n\n    let setup = {\n      dom,\n      urllink: this.urllink ? urllink_array : undefined,\n      hashtag: this.hashtag ? hashtag_array : undefined,\n      image: image_array,\n      custom: custom_array,\n    };\n\n    if (typeof pre === \"function\") {\n      let promiseOrNot = pre(setup);\n\n      if (promiseOrNot instanceof Promise)\n        setup = (await promiseOrNot) || setup;\n      else setup = promiseOrNot || setup;\n\n      if (this.hashtag) this.hashtag_array = setup.hashtag;\n      if (this.urllink) this.urllink_array = setup.urllink;\n\n      this.image_array = setup.image;\n      this.custom_array = setup.custom;\n      title = setup.title || \"\";\n    }\n\n    const strip = setup.dom.querySelectorAll(\":scope > *\");\n\n    //  Loop through eldest child element in document\n    for (let sid = 0; sid < strip.length; sid++) {\n      let child = strip[sid];\n      if (child.textContent.length) {\n        //  set title and text information\n        let inputText = child.textContent;\n        if (!title) {\n          let titleSearchRegex = /([^\\s^.]{2,}[^\\s]+[.][^\\s^.]{2,})/g;\n          let urlArray = inputText.match(titleSearchRegex);\n\n          // We are replacing the urls with a special text here.\n          // Then we split the sentences by the dots.\n          // Then we replace the url with the special text and identify the title and body text\n\n          let split;\n          if (urlArray) {\n            for (let i = 0; i < urlArray.length; i++) {\n              inputText = inputText.replace(\n                urlArray[i].replace(/\\.+$/, \"\"),\n                \"[url]\" + i + \"[/url]\"\n              );\n            }\n\n            split = inputText.split(\".\");\n\n            for (let i = 0; i < split.length; i++) {\n              for (let j = 0; j < urlArray.length; j++) {\n                split[i] = split[i].replace(\n                  \"[url]\" + j + \"[/url]\",\n                  urlArray[j].replace(/\\.+$/, \"\")\n                );\n              }\n            }\n          } else split = inputText.split(\".\");\n\n          title = split[0];\n          if (title.length > 200) {\n            text += title.substring(200) + \".\";\n            title = title.substring(0, 200);\n          }\n\n          split.shift();\n          inputText = split.join(\".\").replace(/\\s\\s+/g, \" \");\n          text += inputText + \" \";\n        } else text += `${inputText}\\n`;\n      }\n\n      if (child.classList.contains(\"_media_\")) {\n        let idx = child.childNodes.length;\n        while (idx--) {\n          let c = child.childNodes[idx];\n          if (c.nodeName === \"IMG\") {\n            for (const f of this.image_array) {\n              if (f.elementId === c.id && f.source !== c.getAttribute(\"src\")) {\n                c.setAttribute(\"src\", f.source);\n                let cIdx = c.classList.length;\n                while (cIdx--) {\n                  if (\n                    c.classList[cIdx].includes(\"_img_\") &&\n                    c.classList[cIdx].length > 5\n                  ) {\n                    c.classList.remove(c.classList[cIdx]);\n                    let splitUrl = f.source.split(\"/\");\n                    let splitTail = splitUrl[splitUrl.length - 1];\n                    let splitTail_length = splitTail.length - 64;\n                    const sourceClip = splitUrl[splitUrl.length - 1].substring(\n                      splitTail_length > 0 ? splitTail : 0\n                    );\n                    c.classList.add(\"_img_\" + sourceClip);\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return {\n      html: setup.dom.innerHTML,\n      title: title.trim(),\n      text: text.trim(),\n      urllink: this.urllink ? this.urllink_array : undefined,\n      hashtag: this.hashtag ? this.hashtag_array : undefined,\n      image: this.image_array,\n      custom: this.custom_array,\n    };\n  }\n\n  /**\n   * Set placeholder string\n   * @param {string} p - Set placeholder string.\n   */\n  setPlaceholder(p) {\n    if (this.logExecution) console.log(\"setPlaceholder\", { p });\n    if (this.element) {\n      if (p && typeof p === \"string\")\n        this.element.setAttribute(\"placeholder\", p);\n      else this.element.removeAttribute(\"placeholder\");\n    }\n  }\n\n  /**\n   * Set spellcheck mode\n   * @param {boolean} bool - Set spellcheck mode.\n   */\n  setSpellcheck(bool) {\n    if (this.logExecution) console.log(\"setSpellcheck\", { bool });\n    if (this.element)\n      this.element.setAttribute(\"spellcheck\", bool ? \"on\" : \"off\");\n  }\n\n  /**\n   * Set edit mode\n   * @param {boolean} bool - Set wysiwyg to editable when true.\n   */\n  setEditable(bool) {\n    if (this.logExecution) console.log(\"setEditable\", { bool });\n    bool = this.element ? bool : false;\n\n    if (this.element)\n      this.element.setAttribute(\"contenteditable\", bool ? \"true\" : \"false\");\n\n    this._setEventListener(bool);\n    this._observeMutation(bool);\n  }\n}\n\nexport { Wysiwyg4All };\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","ColorMangle","constructor","color","fineTuned","this","colorName","format","_colorType","type","throwErr","chkType","string","toLowerCase","match","Array","isArray","length","exec","err","_extractDigit","color_arg","rgba","i","push","parseFloat","getAlpha","extract","colorScheme","darkMode","focusOriginal","focusSat","opacity","text","black","white","soft","placeholder","transparent","shade","shadow","template","content_isHighLuminance","isHighLuminance","focus","includes","matchLuminance","compDir","analogous","focusHSL","hsla","h","an1HSL","an2HSL","Math","abs","complementary","darkModeAnalogous","analogousNude","k","textColor","assign","contrastRatio","highLum","op","unordered","keys","sort","reduce","target_color","target_ratio","direction","method","target","adj","m","dir","count","adj_set","adjustBrightness","adjustLuminance","legacy","hex","main_lum","_luminance","lum","currDir","lum_pre","deg","spin","v","val","hsl","plus","s","l","a","minus","add","_toString","r","g","b","rgb","map","pow","col","numberOrNot","n","def","color_arg1","color_arg2","lum1","lum2","option","blackOpacity","whiteOpacity","opa","c_min","min","c_max","max","delta","round","toFixed","digit","toString","slice","rgbObject","hexValues","parseInt","opacity_value","c","x","limit","rgbRange","result","adjustSaturation","Wysiwyg4All","hashtag_regex","hashtag_stopper_regex","urllink_regex","elementId","editable","spellcheck","highlightColor","html","callback","fontSize","desktop","tablet","phone","h1","h2","h3","h4","h5","h6","small","lastLineBlank","hashtag","urllink","logMutation","logExecution","fontSizeCssVariable","hold","keyArr","Error","substring","image_array","hashtag_array","urllink_array","custom_array","blockElement_queryArray","specialTextElement_queryArray","restrictedElement_queryArray","textAreaElement_queryArray","textBlockElement_queryArray","ceilingElement_queryArray","unSelectable_queryArray","styleAllowedElement_queryArray","alignClass","hashtag_flag","urllink_flag","range_backup","commandTracker","range","isRangeDirectionForward","insertTabPending_tabString","removeSandwichedLine_array","lastKey","element","document","getElementById","innerHTML","cssVariable","style","setProperty","elementComputedStyle","window","getComputedStyle","defaultFontColor","classList","contains","setPlaceholder","setSpellcheck","paddingB","paddingBottom","paddingT","paddingTop","borderT","borderTopWidth","borderB","borderBottomWidth","minHeight","command","italic","bold","underline","strike","fontSizeRatio","tag","ratio","entries","emSize","styleTagOfCommand","counterTagOf","cssPropertyOf","cssPropertyChecker","textDecoration","documentFontSize","nodeFontSize","f_size","compare_size","fontStyle","loadHTML","catch","_adjustSelection","ceilingElement_query","console","log","toArray","allowObject","setRange","node","position","sel","getSelection","getRangeAt","createRange","p","Node","setTarget","nodeType","lastChild","firstChild","textLength","_nodeCrawler","textContent","parentNode","getAttribute","createTextNode","insertBefore","childNodes","nodeName","previousSibling","setEnd","doCollapse","setStart","startContainer","startOffset","endContainer","endOffset","collapse","removeAllRanges","addRange","startLine","endLine","q","e","closest","_climbUpToEldestParent","_generateId","prefix","charAt","floor","random","Date","getTime","run","startFromEldestChild","startNode","commonAncestorContainer","parentAnchor","id","uniqueId","outputNodes","nodeIsRange","commonContainer","nodes","crawl","endNode","withInRange","cwl","breakOut","nextSibling","removeAttribute","_wrapNode","wrapper","appendWhole","start","end","withinRange","append","child","stripped","removeChild","singleChildParent","_isSingleChildParent","childrenCount","children","sweep","divCount","iHaveText","cb","_getStartEndLine","getInbetween","inBetween","currentLine","some","matches","_classNameToQuery","_isThereContentEditableOverMyHead","flyup","_isSelectionWithinRestrictedRange","restrict","_createEmptyParagraph","createElement","_trackStyle","cls","checker","sp","_isTextElement","_lastLineBlank","force","lastLine","_setEventListener","listen","removeEventListener","_selectionchange","imgInput","_keydown","_normalize","_paste","_keyup","accept","hidden","multiple","setAttribute","addEventListener","_imageSelected","error","_modifySelection","isForward","rangeHeader","unSel","_isUnSelectableElement","selNext","collapsed","caratPosition","skipTrack","concat","quote","comm","caratEl","getBoundingClientRect","_callback","bind","toUpperCase","shift","shiftKey","preventDefault","stc","block","ceil","cl","_replaceText","_setArrow","remove","sweep_array","hasIndent","diveAndRemoveTab","offset","line","container","containerOffset","lineOffset","tab","insertNode","stopPropagation","_normalizeDocument","cloneRange","doc","createDocumentFragment","clipboardData","getData","replace","u","extractContents","pop","_observeMutation","track","observer","disconnect","MutationObserver","mutation_array","monitor","cloneNode","name","attributeName","added","clones","addedNodes","removed","removedNodes","mutate","mutation","mutationTarget","callbackRemoved","what","arrIdx","splice","childIdx","toBreak","t","_isCeilingElement","idx","_isTextBlockElement","getBr","br","isWysiwygChild","isWysiwygEldestChild","ceiling","clo","isMediaElement","isBlockQuoteElement","isCustomElement","isHashtagElement","isUrlLinkElement","el","_isBlockElement","_isStyleAllowedElement","sa","doContinue","addBr","classSet","counter","toUnwrap","cIdx","set","class_idx","className","observe","attributes","childList","subtree","isAllRangeOnSameLine","caratElement","arrowDirection","metaKey","ctrlKey","rangeSetup","removeZeroSpace","targetContainer","nudged","siblingDirection","isCaratOnMultiLine","posTarget","caratViewPortPosition","elPosition","phoneTextSize","height","nudgeRangeToInlineElement","display","_caratElement","nextEl","setDirection","isMultiLine","eldestParentOfCurrentLine","isCurrentLineInsideSubCeiling","siblingSet","reverse","backwardNode","forwardNode","_forwardNode","leap","collectOffset","currentOffset","_append","insertAfter","wrap","focusElement","common","insertRestricted","next","nodeToUnwrap","restricted","chk","notAllowed","fc","data","Promise","files","prepareForCallback","image","readFile","FileReader","load","file","res","onload","f","lastModified","size","source","img","Image","dimension","width","filename","fileSize","fileType","src","readAsDataURL","loading","feedback","restoreLastSelection","media","_loadImage","imageObject","classname","class","tagName","onclick","st","pushArray","process","_getAnchorOffsetFromLine","anchorNode","anchorOffset","found","traverse","_getFocusOffsetFromLine","focusNode","focusOffset","lineByLine","anchorElement","appendChild","doSingleLine","normalize","cel","par","wholeDocument","typeName","setData","regex","anchorText","collected","textNodes","forEach","handler","hits","nxt","ownerDocument","global","nodeValue","lastIndex","handleResult","apply","results","orig","index","create","rest","createElementNS","namespaceURI","attrs","content","contentEditable","replaceTextNode","matched","textEl","toCallback","collectId","tc","then","dom","url","open","_checkElement","chkArr","exp","attr","gotTheMatch","_isTextAreaElement","_isSpecialTextElement","action","bq","li","ul","hr","click","collectLines","nextLine","isColor","query","stopperMode","pass","undefined","restrictedClass","span","replaceAll","unwrapTarget","rev","del","querySelectorAll","join","wrapperSplit","nestedWrapper","output","ws","lc","fn","lp","prev","custom","contenteditable","HTMLElement","insert","_","txt","setEditable","div","imgCallback","imgId","JSON","parse","stringify","hashtagCallback","clIdx","urllinkCallback","customCallback","fb","imageParent","querySelector","pre","title","setup","promiseOrNot","strip","sid","inputText","split","titleSearchRegex","urlArray","j","splitUrl","splitTail","splitTail_length","sourceClip","trim","bool"],"sourceRoot":""}