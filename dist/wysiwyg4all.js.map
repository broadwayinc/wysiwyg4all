{"version":3,"file":"wysiwyg4all.js","mappings":";CAAA,SAA2CA,EAAMC,GAChD,GAAsB,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,SACb,GAAqB,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,OACP,CACJ,IAAIK,EAAIL,IACR,IAAI,IAAIM,KAAKD,GAAuB,iBAAZJ,QAAuBA,QAAUF,GAAMO,GAAKD,EAAEC,EACvE,CACA,CATD,CASGC,MAAM,IACT,mBCTA,IAAIC,EAAsB,CCA1BA,EAAwB,CAACP,EAASQ,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAEV,EAASS,IAC5EE,OAAOC,eAAeZ,EAASS,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDF,EAAwB,CAACQ,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFT,EAAyBP,IACH,oBAAXoB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeZ,EAASoB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeZ,EAAS,aAAc,CAAEsB,OAAO,GAAO,0CCL9D,MAAMC,EAAa,CACfC,UAAW,UACXC,aAAc,UACdC,KAAM,UACNC,WAAY,UACZC,MAAO,UACPC,MAAO,UACPC,OAAQ,UACRC,MAAO,UACPC,eAAgB,UAChBC,KAAM,UACNC,WAAY,UACZC,MAAO,UACPC,UAAW,UACXC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,MAAO,UACPC,eAAgB,UAChBC,SAAU,UACVC,QAAS,UACTC,KAAM,UACNC,SAAU,UACVC,SAAU,UACVC,cAAe,UACfC,SAAU,UACVC,UAAW,UACXC,SAAU,UACVC,UAAW,UACXC,YAAa,UACbC,eAAgB,UAChBC,WAAY,UACZC,WAAY,UACZC,QAAS,UACTC,WAAY,UACZC,aAAc,UACdC,cAAe,UACfC,cAAe,UACfC,cAAe,UACfC,cAAe,UACfC,WAAY,UACZC,SAAU,UACVC,YAAa,UACbC,QAAS,UACTC,QAAS,UACTC,WAAY,UACZC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbC,QAAS,UACTC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,KAAM,UACNC,KAAM,UACNC,MAAO,UACPC,YAAa,UACbC,KAAM,UACNC,SAAU,UACVC,QAAS,UACTC,UAAW,UACXC,OAAQ,UACRC,MAAO,UACPC,MAAO,UACPC,cAAe,UACfC,SAAU,UACVC,UAAW,UACXC,aAAc,UACdC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,qBAAsB,UACtBC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,UAAW,UACXC,YAAa,UACbC,cAAe,UACfC,aAAc,UACdC,eAAgB,UAChBC,eAAgB,UAChBC,eAAgB,UAChBC,YAAa,UACbC,KAAM,UACNC,UAAW,UACXC,MAAO,UACPC,QAAS,UACTC,OAAQ,UACRC,iBAAkB,UAClBC,WAAY,UACZC,aAAc,UACdC,aAAc,UACdC,eAAgB,UAChBC,gBAAiB,UACjBC,kBAAmB,UACnBC,gBAAiB,UACjBC,gBAAiB,UACjBC,aAAc,UACdC,UAAW,UACXC,UAAW,UACXC,SAAU,UACVC,YAAa,UACbC,KAAM,UACNC,QAAS,UACTC,MAAO,UACPC,UAAW,UACXC,OAAQ,UACRC,UAAW,UACXC,OAAQ,UACRC,cAAe,UACfC,UAAW,UACXC,cAAe,UACfC,cAAe,UACfC,WAAY,UACZC,UAAW,UACXC,KAAM,UACNC,KAAM,UACNC,KAAM,UACNC,WAAY,UACZC,OAAQ,UACRC,cAAe,UACfC,IAAK,UACLC,UAAW,UACXC,UAAW,UACXC,YAAa,UACbC,OAAQ,UACRC,WAAY,UACZC,SAAU,UACVC,SAAU,UACVC,OAAQ,UACRC,OAAQ,UACRC,QAAS,UACTC,UAAW,UACXC,UAAW,UACXC,UAAW,UACXC,KAAM,UACNC,YAAa,UACbC,UAAW,UACXC,IAAK,UACLC,KAAM,UACNC,QAAS,UACTC,OAAQ,UACRC,UAAW,UACXC,OAAQ,UACRC,MAAO,UACPC,MAAO,UACPC,WAAY,UACZC,OAAQ,UACRC,YAAa,WAGjB,MAAMC,EAIF,WAAAC,CAAYC,EAAQ,UAAWC,GAAY,GACvCC,KAAKD,UAAYA,EAEjB,IAAIE,EAASD,KAAKE,WAAWJ,GAC7BE,KAAKG,KAAOF,EAAOE,KACnBH,KAAKF,MAAQG,EAAOH,KACxB,CAEA,UAAAI,CAAWJ,EAAQE,KAAKF,MAAOM,GAAW,GACtC,IAAIC,EAASF,EAEb,IACI,IAAKL,EACD,KAAM,gBAKV,GAHqB,iBAAVA,GAAsBA,EAAMQ,SACnCR,EAAQA,EAAMQ,QAEG,iBAAVR,EAGP,KAAM,gBAEV,IAJIA,EAAQA,EAAMS,iBAIJP,KAAKF,MACf,MAAO,CAAEK,KAAMH,KAAKG,KAAML,MAAOE,KAAKF,OAE1C,GAAIvJ,EAAWuJ,GACX,MAAO,CAAEK,KAAM,MAAOL,MAAOvJ,EAAWuJ,IAI5C,GAFAO,EAAUP,EAAMU,MAAM,0BAElBC,MAAMC,QAAQL,GAAU,CAExB,GAAmB,MAAfA,EAAQ,GAAY,CAMpB,GAJqB,IAAjBP,EAAMa,SAENb,EAAQA,EAAM,GAAKA,EAAM,GAAKA,EAAM,GAAKA,EAAM,GAAKA,EAAM,GAAKA,EAAM,GAAKA,EAAM,KAEhF,4CAA4Cc,KAAKd,GAKjD,KAAM,cAHNK,EAAO,KAKf,KAAuC,MAA5BL,EAAMA,EAAMa,OAAS,KAE5BR,EAAOE,EAAQ,IAEnB,MAAO,CAAEF,OAAML,QAEnB,CAEJ,CAAE,MAAOe,GACL,GAAIT,EACA,MAAMS,EAAM,IAAMf,CAC1B,CAEA,MAAO,CAAC,CACZ,CAEA,aAAAgB,CAAcC,EAAYf,KAAKF,OAC3B,IAAI,KAAEK,EAAOH,KAAKG,KAAI,MAAEL,EAAQE,KAAKF,OAAUE,KAAKE,WAAWa,GAElD,QAATZ,IACAL,EAAQE,KAAKgB,KAAK,EAAGlB,GAAOQ,QAEhC,MAAMhK,EAAQ,GAEd,IAAK,MAAMjB,KAAKyK,EAAMU,MAAM,gBACxBlK,EAAM2K,KAAKC,WAAW7L,IAI1B,OAFIiB,EAAMqK,OAAS,GAAGrK,EAAM2K,KAAK,GAE1B3K,CACX,CAKA,QAAA6K,CAASJ,EAAYf,KAAKF,OACtB,IAAIsB,EAAUpB,KAAKc,cAAcC,GACjC,OAAOK,GAAUA,EAAQ,IAAU,CACvC,CAmCA,WAAAC,CAAYvB,EAAQE,KAAKF,MAAOwB,GAAW,GAEvC,IAeIC,EACAC,EAhBAC,EACM,CAAE1K,MAAO,IAAMyI,MAAO,GAQ5BkC,EAAW,CACX,eAAgBJ,EAAW,UAAY,UACvC,YAAaA,EAAW,UAAY,WAMpCK,EAA0B3B,KAAK4B,gBAAgBF,EAAS,cACxDG,EAAQ,MACR,GAAI/B,GAA0B,iBAAVA,EAAoB,CACpC,GAAIA,EAAM,YAEN,OADAyB,EAAgBzB,EAAM,YACfyB,EAEX,IAAK,IAAI9L,KAAOqK,EACZ,GAAIrK,EAAIqM,SAAS,SAEb,OADAP,EAAgBzB,EAAMrK,GACf8L,CAEnB,CAIA,OAFAA,EAAgBzB,EAChB0B,EAAWxB,KAAK+B,eAAejC,EAAO4B,EAAS,aAAcC,EAA0B,IAAM,KACtFL,EAAWE,EAAW1B,CAChC,EAhBW,GAkBRkC,EAAU,EACVC,EAAY,MACZ,IACIA,EAAYjC,KAAKiC,UAAUV,EADrB,IAENW,EAAWlC,KAAKmC,KAAK,EAAGZ,GAAea,EACvCC,EAASrC,KAAKmC,KAAK,EAAGF,EAAU,IAAIG,EACpCE,EAAStC,KAAKmC,KAAK,EAAGF,EAAU,IAAIG,EAOxC,OALIF,EANM,GAMW,MACjBG,GAAkB,KAClBH,EARM,GAQW,IACjBI,EAAS,IAAMA,GAEfC,KAAKC,IAAIN,EAAWG,GAAUE,KAAKC,IAAIN,EAAWI,IAClDN,GAAW,EACJC,EAAU,IAGdA,EAAU,EACpB,EAlBe,GAoBZQ,EAAgBzC,KAAK+B,eAAe/B,KAAKyC,cAAcZ,EAAO,GAAKG,GAAUN,EAAS,gBAAiB,KACvGgB,EAAa,CAIb,gBAAiBpB,EAAW,4BAA8B,uBAG1DqB,EAAoBrB,EAAWtB,KAAK+B,eAAeE,EAAWP,EAAS,gBAAiB,KAAOO,EAC/FW,EAAgB5C,KAAK+B,eAAeE,EAAWP,EAAS,gBAAiB,KAE7E,IAAK,IAAImB,KAAKnB,EACVA,EAASmB,EAAI,SAAW7C,KAAK8C,UAAUrB,EAAcC,EAASmB,IAC9DnB,EAASmB,EAAI,UAAYA,EAAEf,SAAS,gBAAkBa,EAAoBd,EAC1EH,EAASmB,EAAI,eAAiBA,EAAEf,SAAS,gBAAkBc,EAAgB5C,KAAK+B,eAAeT,EAAWO,EAAQL,EAAUE,EAASmB,GAAI,MACzInB,EAASmB,EAAI,eAAiB7C,KAAK8C,UAAU,EAAGD,EAAEf,SAAS,gBAAkBa,EAAoBd,GAuCrG,GApCAH,EAAS,WAAaH,EACtBG,EAAS,gBAAkB1B,KAAK8C,UAAU,EAAGvB,GAC7CG,EAAS,cAAgBF,EACzBE,EAAS,mBAAqB1B,KAAK8C,UAAU,EAAGtB,GAEhD7L,OAAOoN,OAAOrB,EAAU,CACpB,kBAAmBe,EACnB,uBAAwBzC,KAAK8C,UAAU,EAAGL,GAC1C,cAAeR,EACf,mBAAoBjC,KAAK8C,UAAU,EAAGb,GACtC,UAAW,SAEX,YAAa,YAEb,WAAYJ,EACZ,gBAAiBP,EAAWtB,KAAK+B,eAAeP,EAAUE,EAAS,aAAc,GAAK1B,KAAKgD,cAActB,EAAS,aAAcF,GAAY,IAAM,UAAYA,EAC9J,gBAAiBxB,KAAK8C,UAAU,EAAGjB,KAoBnC/B,GAA0B,iBAAVA,EAAoB,CACpC,IAAK,IAAIrK,KAAOqK,EACZ,GAAe,MAAXrK,EAAI,GACJ,KAAM,uBACdE,OAAOoN,OAAOrB,EAAU5B,EAC5B,CAEA,IAAImD,EAAYtN,OAAOoN,OAAOrB,EAAUgB,GACxC,OAAO/M,OAAOuN,KAAKD,GAAWE,OAAOC,QACjC,CAACrN,EAAKN,KACFM,EAAIN,GAAOwN,EAAUxN,GACdM,IAEX,CAAC,EAET,CAWA,cAAAgM,CAAesB,EAActC,EAAYf,KAAKF,MAAOwD,EAAcC,EAAWC,GAC1E,IAAI,MAAE1D,GAAUE,KAAKE,WAAWa,GAC5B0C,EAASzD,KAAKE,WAAWmD,GAAcvD,MAE3C,GAAIwD,EAAc,CACd,IAAII,EAAMD,EACNE,EAAI3D,KAAKgD,cAAcU,EAAK5D,GAChC,GAAI6D,EAAIL,EAAc,CAClB,IAAIM,EAAML,GAAavD,KAAK4B,gBAAgB9B,IAAU,EAAI,EACtD+D,EAAQ,IACZ,KAAOF,EAAIL,GAAgBO,KAAS,CAChC,IAAIC,EAEJ,OAAQN,GACJ,IAAK,aACDM,EAAU9D,KAAK+D,iBAAiB,EAAIH,EAAKF,GACzC,MACJ,IAAK,YACDI,EAAU9D,KAAKgE,gBAAgB,EAAIJ,EAAKF,GACxC,MACJ,QACII,EAAU9D,KAAK+D,iBAAiB,EAAIH,EAAK,CAAEK,QAAQ,EAAMnE,MAAO4D,IAGxE,GAAIA,IAAQI,EACR,MACJJ,EAAMI,EAENH,EAAI3D,KAAKgD,cAAcU,EAAK5D,EAChC,CACJ,CACA,OAAOE,KAAKkE,IAAIR,EACpB,CAAO,CACH,IAAIS,EAAWnE,KAAKoE,WAAWtE,GAC3BuE,EAAMrE,KAAKoE,WAAWX,GAE1B,GAAIlB,KAAKC,IAAI6B,EAAMF,GAAY,IAC3B,OAAOV,EAEX,IAAIC,EAAM1D,KAAKkE,IAAIT,GAEfG,EAAM,CAACS,EAAKF,IACLE,EAAMF,EAAW,GAAK,EAG7BG,EAAUV,EAAIS,EAAKF,GACvB,KAAO5B,KAAKC,IAAI6B,EAAMF,GAAY,KAAQG,IAAYV,EAAIS,EAAKF,IAAW,CACtE,IAAIL,EACJ,OAAQN,GACJ,IAAK,aACDM,EAAU9D,KAAK+D,iBAAiBO,EAAS,CAAExE,MAAO4D,EAAKO,QAAQ,IAC/D,MACJ,IAAK,YACDH,EAAU9D,KAAKgE,gBAAgBM,EAASZ,GACxC,MACJ,QACII,EAAU9D,KAAK+D,iBAAiBO,EAASZ,GAEjD,IAAIa,EAAUvE,KAAKoE,WAAWN,GAC9B,GAAIS,IAAYF,GAAOC,IAAYV,EAAIW,EAASJ,GAC5C,MACJE,EAAME,EACNb,EAAMI,CACV,CACA,OAAO9D,KAAKkE,IAAIR,EACpB,CACJ,CAQA,SAAAzB,CAAUlB,EAAYf,KAAKF,MAAO0E,EAAM,IACpC,IAAI,MAAE1E,GAAUE,KAAKE,WAAWa,GAE5B0D,EAAO,CAACrC,EAAGsC,KACX,IAAIC,EAAMvC,EAAIsC,EACd,OAAOC,EAAM,EAAI,IAAMA,EAAMA,EAAM,IAAMA,EAAM,IAAMA,CAAG,EAGxDC,EAAM5E,KAAKmC,KAAKnC,KAAKmB,SAASrB,GAAQA,GACtC+E,EAAO,QAAUJ,EAAKG,EAAIxC,EAAGoC,GAAO,KAAOI,EAAIE,EAAI,MAAQF,EAAIG,EAAI,MAAQH,EAAIxP,EAAI,IACnF4P,EAAQ,QAAUP,EAAKG,EAAIxC,GAAIoC,GAAO,KAAOI,EAAIE,EAAI,MAAQF,EAAIG,EAAI,MAAQH,EAAIxP,EAAI,IAEzF,MAAO,CAAC4K,KAAK+B,eAAe8C,EAAM/E,GAAQE,KAAK+B,eAAeiD,EAAOlF,GACzE,CAQA,aAAA2C,CAAc1B,EAAYf,KAAKF,MAAOmF,EAAM,GACxC,IAAI,MAAEnF,GAAUE,KAAKE,WAAWa,GAE5B6D,EAAM5E,KAAKmC,KAAKnC,KAAKmB,SAASrB,GAAQA,GAU1C,OARI8E,EAAIxC,EAAI,IACRwC,EAAIxC,GAAK,IAETwC,EAAIxC,GAAK,IAEbwC,EAAIxC,GAAK6C,EACTL,EAAIxC,EAAIwC,EAAIxC,EAAI,IAAMwC,EAAIxC,EAAI,IAAMwC,EAAIxC,EAAI,EAAI,IAAMwC,EAAIxC,EAAIwC,EAAIxC,EAE3DpC,KAAKkE,IAAIlE,KAAKkF,UAAUN,GACnC,CAOA,eAAAhD,CAAgBb,EAAYf,KAAKF,MAAOC,EAAYC,KAAKD,WACrD,MAAM,EAAEoF,EAAC,EAAEC,EAAC,EAAEC,GAAMrF,KAAKgB,KAAK,EAAGhB,KAAKE,WAAWa,GAAWjB,OAQ5D,OALIC,GACU,IAAJoF,EAAuB,OAAJC,EAAyB,IAAJC,GAAY,KAChD,IAAJF,EAAgB,IAAJC,EAAgB,IAAJC,GAAY,OAG9BtF,EAAY,IAAM,IACtC,CAEA,UAAAqE,CAAWrD,EAAYf,KAAKF,OACxB,IAAIwF,EAAMtF,KAAKgB,KAAK,EAAGD,GACnB3L,EAAI,CAACkQ,EAAIH,EAAGG,EAAIF,EAAGE,EAAID,GAAGE,KAAI,SAAUb,GAExC,OADAA,GAAK,MACO,OACNA,EAAI,MACJnC,KAAKiD,KAAKd,EAAI,MAAS,MAAO,IACxC,IAEA,MAAc,MAAPtP,EAAE,GAAqB,MAAPA,EAAE,GAAqB,MAAPA,EAAE,EAC7C,CAEA,SAAA8P,CAAUO,GACN,IAAIC,EAAc,CAACC,EAAGC,EAAM,MACJ,iBAAND,EAAiBA,EAAIC,EAEvC,GAAmB,iBAARH,EACP,OAAOA,EAEX,GAAIA,EAAIvP,eAAe,KACnB,MAAO,SAAWuP,EAAIrD,GAAK,GAAK,KAAOsD,EAAYD,EAAIX,GAAK,MAAQY,EAAYD,EAAIV,GAAK,MAAQW,EAAYD,EAAIrQ,EAAG,GAAK,IAE7H,GAAIqQ,EAAIvP,eAAe,KACnB,MAAO,QAAUwP,EAAYD,EAAIN,GAAK,KAAOO,EAAYD,EAAIL,GAAK,KAAOM,EAAYD,EAAIJ,GAAK,KAAOK,EAAYD,EAAIrQ,EAAG,GAAK,IACjI,MAAMqQ,CACV,CASA,aAAAzC,CAAc6C,EAAYC,EAAa9F,KAAKF,OACxC,IAAIiG,EAAO/F,KAAKoE,WAAW0B,GAAc,IACrCE,EAAOhG,KAAKoE,WAAWyB,GAAc,IAEzC,OAAOE,EAAOC,EAAOD,EAAOC,EAAOA,EAAOD,CAC9C,CAYA,SAAAjD,CAAUrB,EAAU,EAAGwE,EAASjG,KAAKF,OAEX,iBAAXmG,IACPA,EAAS,CAAEnG,MAAOmG,IAEtB,IAQIC,EAAcC,GARd,MAAErG,EAAQE,KAAKF,MAAK,UAAEC,GAAY,GAASkG,EAK/C,GAHAnG,EAAQE,KAAKE,WAAWJ,GAAOA,MAG3BE,KAAKmB,SAASrB,GAAS,GACvB,MAAO,GAIX,GAAuB,iBAAZ2B,GAAwBA,EAAU,EACzCyE,EAAezE,EACf0E,EAAe1E,OACZ,GAAIA,GAA8B,iBAAZA,EACzB,IAAK,IAAIoB,IAAK,CAAC,QAAS,SAAU,CAC9B,IAAIuD,EAAM3E,EAAQoB,GACC,iBAARuD,GAAoBA,EAAM,IACvB,UAANvD,EACAqD,EAAeE,EACJ,UAANvD,IACLsD,EAAeC,GAE3B,CAGJ,MAAMA,EAAO1B,GACQ,iBAANA,EACHA,EAAI,GAAKA,EAAI,EAAUA,EAClBA,EAAI,EAAU,EACX,EACF,EAGlB,OAAI1E,KAAK4B,gBAAgB9B,EAAOC,GACrBmG,EAAe,iBAAiBE,EAAIF,MAAmB,QAE3DC,EAAe,uBAAuBC,EAAID,MAAmB,OACxE,CAQA,IAAAhE,CAAKV,EAASV,EAAYf,KAAKF,OAC3B,MAAM,KAAEK,EAAOH,KAAKG,KAAI,MAAEL,EAAQE,KAAKF,OAAUE,KAAKE,WAAWa,GAE3D6D,EAAM,CAACO,EAAGC,EAAGC,KACfF,GAAK,IACLC,GAAK,IACLC,GAAK,IAEL,IAAIgB,EAAQ9D,KAAK+D,IAAInB,EAAGC,EAAGC,GACvBkB,EAAQhE,KAAKiE,IAAIrB,EAAGC,EAAGC,GACvBoB,EAAQF,EAAQF,EAChBjE,EAAI,EACJ0C,EAAI,EACJC,EAAI,EAmBR,OAhBI3C,EADU,IAAVqE,EACI,EACCF,IAAUpB,GACTC,EAAIC,GAAKoB,EAAS,EACnBF,IAAUnB,GACVC,EAAIF,GAAKsB,EAAQ,GAEjBtB,EAAIC,GAAKqB,EAAQ,EAE1BrE,EAAIG,KAAKmE,MAAU,GAAJtE,GAEXA,EAAI,IAAGA,GAAK,KAEhB2C,GAAKwB,EAAQF,GAAS,EACtBvB,EAAc,IAAV2B,EAAc,EAAIA,GAAS,EAAIlE,KAAKC,IAAI,EAAIuC,EAAI,IACpDD,IAAU,IAAJA,GAAS6B,QAAQ,GACvB5B,IAAU,IAAJA,GAAS4B,QAAQ,GAChB,CAAEvE,IAAG0C,IAAGC,EAAG,EAGtB,GAAa,QAAT5E,EAAgB,CAChBsB,EAA6B,iBAAZA,EAAuBA,EAAU,EAClD,MAAMT,EAAOhB,KAAKgB,KAAKS,EAAS3B,IAC1B,EAAEqF,EAAC,EAAEC,EAAC,EAAEC,EAAC,EAAEjQ,GAAM4L,GACjB,EAAEoB,EAAC,EAAE0C,EAAC,EAAEC,GAAMH,EAAIO,EAAGC,EAAGC,GAE9B,MAAO,CACHF,IAAGC,IAAGC,IAAGjQ,IACTgN,EAAGA,EACH0C,EAAGA,EACHC,EAAGA,EACHzE,OAAQN,KAAKkF,UAAU,CAAE9C,IAAG0C,IAAGC,IAAG3P,EAAGqM,IAG7C,CAAO,CAEH,MAAMmF,EAAQ5G,KAAKc,cAAchB,GAGjC,GAFA2B,EAA6B,iBAAZA,EAAuBA,EAAUmF,EAAM,IAAM,EAE1DzG,EAAK2B,SAAS,OAAQ,CACtB,MAAM,EAAEqD,EAAC,EAAEC,EAAC,EAAEC,EAAC,EAAEjQ,GAAM4K,KAAKgB,KAAKS,EAAS3B,GAE1C,MAAO,CACHqF,IAAGC,IAAGC,IAAGjQ,IACTgN,EAAGwE,EAAM,GACT9B,EAAG8B,EAAM,GACT7B,EAAG6B,EAAM,GACTtG,OAAQN,KAAKkF,UAAU,CACnB9C,EAAGwE,EAAM,GACT9B,EAAG8B,EAAM,GACT7B,EAAG6B,EAAM,GACTxR,MAIZ,CAAO,GAAI+K,EAAK2B,SAAS,OAAQ,CAC7B,MAAMxL,EAAQ,CACV6O,EAAGyB,EAAM,GACTxB,EAAGwB,EAAM,GACTvB,EAAGuB,EAAM,GACTxR,EAAGqM,IAED,EAAEW,EAAC,EAAE0C,EAAC,EAAEC,GAAMH,EAAItO,EAAM6O,EAAG7O,EAAM8O,EAAG9O,EAAM+O,GAEhD,OAAO1P,OAAOoN,OAAOzM,EAAO,CACxB6O,EAAG7O,EAAM6O,EACTC,EAAG9O,EAAM8O,EACTC,EAAG/O,EAAM+O,EACTjD,EAAGA,EACH0C,EAAGA,EACHC,EAAGA,EACH3P,EAAGkB,EAAMlB,EACTkL,OAAQN,KAAKkF,UAAU,CAAE9C,IAAG0C,IAAGC,IAAG3P,EAAGkB,EAAMlB,KAGnD,CACJ,CACJ,CAOA,GAAA8O,CAAInD,EAAYf,KAAKF,OACjB,MAAM,KAAEK,EAAOH,KAAKG,KAAI,MAAEL,EAAQE,KAAKF,OAAUE,KAAKE,WAAWa,GAEjE,GAAIZ,EAAK2B,SAAS,QAAU3B,EAAK2B,SAAS,OAAQ,CAC9C,MAAMd,EAAOhB,KAAKgB,KAAK,EAAGlB,GAC1B,MAAO,MAAQ,GAAK,KAAOkB,EAAKmE,GAAK,KAAOnE,EAAKoE,GAAK,GAAKpE,EAAKqE,GAAGwB,SAAS,IAAIC,MAAM,EAC1F,CAEA,OAAOhH,CACX,CAQA,IAAAkB,CAAKS,EAASV,EAAYf,KAAKF,OAC3B,MAAM,KAAEK,EAAOH,KAAKG,KAAI,MAAEL,EAAQE,KAAKF,OAAUE,KAAKE,WAAWa,GAEjE,GAAa,QAATZ,EAAgB,CAChB,MAAM+D,EAAMpE,EACZ,IAAIiH,EAAY,CAAE5B,EAAG,KAAMC,EAAG,KAAMC,EAAG,MACnC2B,EAAY9C,EAAI1D,MAAM,mBAEP,IAAf0D,EAAIvD,SACJqG,EAAY9C,EAAI1D,MAAM,mBACtBwG,EAAYA,EAAUzB,KAAIrB,GAAO,GAAKA,EAAMA,KAEhD,IAAIL,EAAQ,EACZ,IAAK,MAAMpO,KAAOsR,EACdA,EAAUtR,GAAOwR,SAASD,EAAUnD,GAAQ,IAC5CA,IAGJ,MAAMqD,EAAmC,iBAAZzF,EAAuBA,EAAU,EAC9D,IAAI,EAAE0D,EAAC,EAAEC,EAAC,EAAEC,GAAM0B,EAElB,MAAO,IACAA,EACH3R,EAAG8R,EACH5G,OAAQN,KAAKkF,UAAU,CACnBC,GAAIA,EAAGC,GAAIA,EAAGC,GAAIA,EAAGjQ,EAAG8R,IAIpC,CAAO,CACH,MAAMN,EAAQ5G,KAAKc,cAAchB,GAC3B1K,EAAuB,iBAAZqM,EAAuBA,EAAUmF,EAAM,IAAM,EAE9D,GAAIzG,EAAK2B,SAAS,OAAQ,CAEtB,IAAIxL,EAAQ,CACR6O,EAAGyB,EAAM,GACTxB,EAAGwB,EAAM,GACTvB,EAAGuB,EAAM,GACTxR,KAGJ,OAAOO,OAAOoN,OAAO,CACjBzC,OAAQN,KAAKkF,UAAU5O,IACxBA,EAEP,CAAO,GAAI6J,EAAK2B,SAAS,OAAQ,CAE7B,IAAIM,EAAIwE,EAAM,GACV9B,EAAI8B,EAAM,GACV7B,EAAI6B,EAAM,GAEd9B,GAAK,IACLC,GAAK,IAEL,IAAIoC,GAAK,EAAI5E,KAAKC,IAAI,EAAIuC,EAAI,IAAMD,EAChCsC,EAAID,GAAK,EAAI5E,KAAKC,IAAKJ,EAAI,GAAM,EAAI,IACrCuB,EAAIoB,EAAIoC,EAAI,EACZhC,EAAI,EACJC,EAAI,EACJC,EAAI,EA8BR,OA7BI,GAAKjD,GAAKA,EAAI,IACd+C,EAAIgC,EACJ/B,EAAIgC,EACJ/B,EAAI,GACG,IAAMjD,GAAKA,EAAI,KACtB+C,EAAIiC,EACJhC,EAAI+B,EACJ9B,EAAI,GACG,KAAOjD,GAAKA,EAAI,KACvB+C,EAAI,EACJC,EAAI+B,EACJ9B,EAAI+B,GACG,KAAOhF,GAAKA,EAAI,KACvB+C,EAAI,EACJC,EAAIgC,EACJ/B,EAAI8B,GACG,KAAO/E,GAAKA,EAAI,KACvB+C,EAAIiC,EACJhC,EAAI,EACJC,EAAI8B,GACG,KAAO/E,GAAKA,EAAI,MACvB+C,EAAIgC,EACJ/B,EAAI,EACJC,EAAI+B,GAERjC,EAAI5C,KAAKmE,MAAgB,KAATvB,EAAIxB,IACpByB,EAAI7C,KAAKmE,MAAgB,KAATtB,EAAIzB,IACpB0B,EAAI9C,KAAKmE,MAAgB,KAATrB,EAAI1B,IAEb,CACHwB,IAAGC,IAAGC,IAAGjQ,IACTkL,OAAQN,KAAKkF,UAAU,CAAEC,IAAGC,IAAGC,IAAGjQ,MAG1C,CACJ,CACJ,CASA,gBAAA2O,CAAiBzN,EAAQ,EAAG2P,EAASjG,KAAKF,OACtC,IAAIiB,EAAWkD,GAAS,EAQxB,GAPsB,iBAAXgC,EACPlF,EAAYkF,GAAUjG,KAAKF,OAE3BiB,EAAYkF,EAAOnG,OAASE,KAAKF,MACjCmE,EAASgC,EAAOhC,SAAU,GAG1BA,EAAQ,CACR,IAAI,MAAEnE,GAAUE,KAAKE,WAAWa,GAC5B0E,EAAMzF,KAAKmC,KAAKnC,KAAKmB,SAASrB,GAAQA,GAEtCuH,EAAQ,CAAC3C,EAAG2C,EAAQ,MACb3C,EAAI2C,EAAQA,EAAQ3C,EAAI,EAAI,EAAIA,EAQ3C,OALAe,EAAIX,IAAOxO,EAAQ,EAAK,IAAMmP,EAAIX,EAAKW,EAAIX,GAAK,IAAOxO,EACvDmP,EAAIX,EAAIuC,EAAM5B,EAAIX,GAClBW,EAAIV,IAAOzO,EAAQ,EAAK,IAAMmP,EAAIV,EAAKU,EAAIV,GAAK,IAAOzO,EACvDmP,EAAIV,EAAIsC,EAAM5B,EAAIV,GAEX/E,KAAKkF,UAAUO,EAC1B,CAEA,IAAI,KAAEtF,EAAOH,KAAKG,KAAI,MAAEL,EAAQE,KAAKF,OAAUE,KAAKE,WAAWa,GAE/D,GAAc,IAAVzK,EACA,OAAOwJ,EAEX,MAAM2B,EAAmB,QAATtB,EAAiB,EAAIH,KAAKc,cAAchB,GAAO,IAAM,EAC/DwF,EAAMtF,KAAKgB,KAAKS,EAAS3B,GAE/B,IAAIwH,EAAW,CACXnC,EAAG,EAAIG,EAAO,EACdF,EAAG,EAAIE,EAAO,EACdD,EAAG,EAAIC,EAAO,GAGdhP,EAAQ,GACRX,OAAOuN,KAAKoE,GAAU/B,KAAI,SAAU9P,GAChC6R,EAAS7R,GAAO,IAAM6P,EAAI7P,EAC9B,IAGJ,CAAC,IAAK,IAAK,KAAK8P,KAAI,SAAU9P,GAC1B6P,EAAI7P,IAAQwR,SAASK,EAAS7R,GAAO,IAAM8M,KAAKC,IAAIlM,GACxD,IAEA,MAAMiR,EAAS,OAASjC,EAAIH,EAAI,KAAOG,EAAIF,EAAI,KAAOE,EAAID,EAAI,IAE9D,MAAa,QAATlF,EACOH,KAAKkE,IAAIqD,GAEXpH,EAAK2B,SAAS,OACZ9B,KAAKgB,KAAKsE,EAAIlQ,EAAGmS,GAAQjH,OAE3BH,EAAK2B,SAAS,OACZ9B,KAAKmC,KAAKmD,EAAIlQ,EAAGmS,GAAQjH,YAD/B,CAET,CAOA,eAAA0D,CAAgB1N,EAAQ,EAAGyK,EAAYf,KAAKF,OACxC,IAAI,MAAEA,GAAUE,KAAKE,WAAWa,GAC5B0E,EAAMzF,KAAKmC,KAAKnC,KAAKmB,SAASrB,GAAQA,GAS1C,OAHA2F,EAAIV,IAAOzO,EAAQ,EAAK,IAAMmP,EAAIV,EAAKU,EAAIV,GAAK,IAAOzO,EACvDmP,EAAIV,EALQ,EAACL,EAAG2C,EAAQ,MACb3C,EAAI2C,EAAQA,EAAQ3C,EAAI,EAAI,EAAIA,EAInC2C,CAAM5B,EAAIV,GAEX/E,KAAKkF,UAAUO,EAC1B,CAOA,gBAAA+B,CAAiBlR,EAAQ,EAAGyK,EAAYf,KAAKF,OACzC,IAAI,MAAEA,GAAUE,KAAKE,WAAWa,GAC5B0E,EAAMzF,KAAKmC,KAAKnC,KAAKmB,SAASrB,GAAQA,GAS1C,OAHA2F,EAAIX,IAAOxO,EAAQ,EAAK,IAAMmP,EAAIX,EAAKW,EAAIX,GAAK,IAAOxO,EACvDmP,EAAIX,EALQ,EAACJ,EAAG2C,EAAQ,MACb3C,EAAI2C,EAAQA,EAAQ3C,EAAI,EAAI,EAAIA,EAInC2C,CAAM5B,EAAIX,GAEX9E,KAAKkF,UAAUO,EAC1B,EC/7BG,MAAMgC,EAmBT,WAAA5H,CAAYoG,GACR,QAA2B,IAAhBrG,EACP,KAAM,oCAEVI,KAAK0H,cAAgB,yoIACrB1H,KAAK2H,sBAAwB,2nIAC7B3H,KAAK4H,cAAgB,sNAErB,IAAI,UACAC,EAAY,GAAE,SACdC,GAAW,EAAI,YACfC,EAAc,GAAE,WAChBC,GAAa,EAAK,eAClBC,EAAiB,OAAM,KACvBC,EAAO,GAAE,SACTC,EAAQ,SACRC,EAAW,CACPC,QAAS,GACTC,OAAQ,GACRC,MAAO,IACV,cACDC,GAAgB,EAAK,QACrBC,GAAU,EAAK,QACfC,GAAU,EAAK,YACfC,GAAc,GACd1C,EAOJ,GALAjG,KAAKyI,QAAUA,EACfzI,KAAK0I,QAAUA,EACf1I,KAAK2I,YAAcA,EACnB3I,KAAK4I,oBAAsB,CAAC,EAEJ,iBAAbR,EACPpI,KAAK4I,oBAAsB,CACvB,yBAA0B,GAAGR,MAC7B,wBAAyB,GAAGA,MAC5B,uBAAwB,GAAGA,YAE9B,GAAwB,iBAAbA,GAAyBzS,OAAOuN,KAAKkF,GAAUzH,OAAQ,CACnE,IAAIkI,EACAC,EAAS,CAAC,UAAW,SAAU,SAEnC,IAAK,IAAIjG,KAAKiG,EACV,GAAIV,EAASvF,GAAI,CACbgG,EAAOT,EAASvF,GAChB,KACJ,CAGJ,IAAKgG,EACD,KAAM,mBAEV,IAAK,IAAIhG,KAAKiG,EACNV,EAASvF,KACTgG,EAAOT,EAASvF,IACpB7C,KAAK4I,oBAAoB,kBAAkB/F,KAAO,GAAGgG,KAE7D,CAEA,IAAKhB,GAAkC,iBAAdA,EAAwB,MAAM,IAAIkB,MAAM,yCA2CjE,GA1CAlB,EAA6B,MAAjBA,EAAU,GAAaA,EAAUmB,UAAU,GAAKnB,EAE5D7H,KAAKkI,KAAOA,EACZlI,KAAK6H,UAA6B,MAAjBA,EAAU,GAAaA,EAAUmB,UAAU,GAAKnB,EACjE7H,KAAK+H,YAAcA,EACnB/H,KAAKgI,WAAaA,EAClBhI,KAAKwI,cAAgBA,EAES,iBAAnBP,IACPA,EAAiB,IAAIrI,EAAYqI,GAAgBnI,OAErDE,KAAKqB,YAAc4G,EACnBjI,KAAKmI,SAAWA,GAAY,KAE5BnI,KAAKiJ,YAAc,GACnBjJ,KAAKkJ,cAAgB,GACrBlJ,KAAKmJ,cAAgB,GACrBnJ,KAAKoJ,aAAe,GAEpBpJ,KAAKqJ,wBAA0B,CAAC,KAAM,aAAc,KAAM,KAAM,WAAY,aAC5ErJ,KAAKsJ,8BAAgC,CAAC,aAAc,cACpDtJ,KAAKuJ,6BAA+B,CAAC,WAAY,aACjDvJ,KAAKwJ,2BAA6B,CAAC,aAAc,MACjDxJ,KAAKyJ,4BAA8B,CAAC,IAAK,MACzCzJ,KAAK0J,0BAA4B,CAAC,KAAM,KAAM,aAAc,IAAI7B,KAChE7H,KAAK2J,wBAA0B,CAAC,WAAY,YAAa,aAAc,aAAc,MACrF3J,KAAK4J,+BAAiC,CAAC,UAAW,IAAI/B,IAAa,aAAc,cACjF7H,KAAK6J,WAAa,CAAC,gBAAiB,gBAEpC7J,KAAK8J,cAAe,EACpB9J,KAAK+J,cAAe,EACpB/J,KAAKgK,aAAe,KAEpBhK,KAAKiK,eAAiB,CAAC,EACvBjK,KAAKkK,MAAQ,KACblK,KAAKmK,yBAA0B,EAC/BnK,KAAKoK,2BAA6B,GAClCpK,KAAKqK,2BAA6B,GAClCrK,KAAKsK,QAAU,KAGftK,KAAKuK,QAAUC,SAASC,eAAezK,KAAK6H,YACvC7H,KAAKuK,QACN,KAAM,YAAYvK,KAAK6H,oBAE3B7H,KAAKuK,QAAQG,UAAY,GAEzB1K,KAAK2K,aAAc,IAAI/K,GAAcyB,YAAYrB,KAAKqB,aACtD1L,OAAOoN,OAAO/C,KAAK2K,YAAa3K,KAAK4I,qBAErC,IAAK,MAAMlE,KAAK1E,KAAK2K,YACjB3K,KAAKuK,QAAQK,MAAMC,YAAYnG,EAAG1E,KAAK2K,YAAYjG,IAEvD1E,KAAK8K,qBAAuBC,OAAOC,iBAAiBhL,KAAKuK,SACzDvK,KAAKiL,iBAAmB,IAAIrL,EAAYI,KAAK2K,YAAY,mBAAmBzG,MAC5ElE,KAAKiI,eAAiB,IAAIrI,EAAYI,KAAK2K,YAAY,oBAAoBzG,MAEtElE,KAAKuK,QAAQW,UAAUC,SAAS,iBACjCnL,KAAKuK,QAAQW,UAAUjG,IAAI,gBAE/BjF,KAAKoL,eAAepL,KAAK+H,aACzB/H,KAAKqL,cAAcrL,KAAKgI,YAGxB,IAAIsD,EAAWtL,KAAK8K,qBAAqBS,cACrCC,EAAWxL,KAAK8K,qBAAqBW,WACrCC,EAAU1L,KAAK8K,qBAAqBa,eACpCC,EAAU5L,KAAK8K,qBAAqBe,kBAExC7L,KAAKuK,QAAQK,MAAMkB,UAAY,QAAQR,OAAcE,OAAcE,OAAaE,aAGhF,MAAMG,EAAU,CAEZC,GAAI,CAAC,MAAO,WAAY,CAAC,SAAU,MAAO,MAAO,MAAO,MAAO,QAC/DC,GAAI,CAAC,MAAO,WAAY,CAAC,SAAU,MAAO,MAAO,MAAO,MAAO,QAC/DC,GAAI,CAAC,MAAO,WAAY,CAAC,SAAU,MAAO,MAAO,MAAO,MAAO,QAC/DC,GAAI,CAAC,MAAO,WAAY,CAAC,SAAU,MAAO,MAAO,MAAO,MAAO,QAC/DC,GAAI,CAAC,MAAO,WAAY,CAAC,SAAU,MAAO,MAAO,MAAO,MAAO,QAC/DC,GAAI,CAAC,MAAO,WAAY,CAAC,SAAU,MAAO,MAAO,MAAO,MAAO,QAC/DC,OAAQ,CAAC,KAAM,aACfC,MAAO,CAAC,SAAU,WAAY,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACzEC,KAAM,CAAC,KAAM,aAAc,CAAC,WAC5BC,UAAW,CAAC,KAAM,iBAAkB,CAAC,SACrCC,OAAQ,CAAC,OAAQ,iBAAkB,CAAC,OACpC5M,MAAO,CAAC,SAAU,UAGhB6M,EAAgB,CAElBX,GAAI,IACJC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJE,MAAO,IAGXvM,KAAK4M,kBAAoB,CAAC,EAC1B5M,KAAK6M,aAAe,CAAC,EACrB7M,KAAK8M,cAAgB,CAAC,EACtB9M,KAAK+M,mBAAqB,CACtB,eAAmBrI,GAEXA,EAAE5C,SAAS,aAAqB,cAC3B4C,EAAE5C,SAAS,iBAAwB,SAIhD,SAAa4C,IAET,IAAIsI,EAAmB9L,WAAWlB,KAAK8K,qBAAqB1C,UACxD6E,EAAe/L,WAAWwD,GAC9B,IAAK,IAAIwI,KAAOP,EAAe,CAC3B,IAGIQ,EAAeH,EAHNL,EAAcO,GAM3B,GAFkBC,EAAe,IAEfF,GADDE,EAAe,IACeF,EAAc,OAAOC,CACxE,CACA,OAAO,CAAK,EAEhB,UAAcxI,KAENA,EAAE5C,SAAS,WACJ,UAKnB,IAAK,IAAIqF,KAAK4E,EACV/L,KAAKiK,eAAe9C,IAAK,EACzBnH,KAAK4M,kBAAkBzF,GAAK4E,EAAQ5E,GAAG,GACvCnH,KAAK8M,cAAcf,EAAQ5E,GAAG,IAAM4E,EAAQ5E,GAAG,GAC1CnH,KAAK+M,mBAAmB7W,eAAe6V,EAAQ5E,GAAG,MACnDnH,KAAK+M,mBAAmBhB,EAAQ5E,GAAG,IAAMA,GACzC4E,EAAQ5E,GAAG,KACXnH,KAAK6M,aAAad,EAAQ5E,GAAG,IAAM4E,EAAQ5E,GAAG,IAiCtDnH,KAAKoN,SAASpN,KAAKkI,KAAMJ,GAAUuF,OAAMxM,IACrC,MAAMA,CAAG,GAEjB,CAEA,gBAAAyM,CAAiB7J,EAAQ8J,EAAuBvN,KAAK0J,2BACjD,IAmBIQ,EAnBAsD,EAAU,CAAC9I,EAAG+I,GAAc,IACxBhN,MAAMC,QAAQgE,GAAWA,EAEZ,iBAANA,GAAkBA,GACZ,iBAANA,GACM,kBAANA,GACP+I,GAA4B,iBAAN/I,EACf,CAACA,GACA,GAGZgJ,IAAajK,GAEb,KAAEkK,EAAO,KAAI,SAAEC,GAAW,GAASnK,GAAU,CAAC,EAE9CoK,EAAM9C,OAAO+C,eACjB,IAAKD,EACD,OAAO,KAGX,IACI3D,EAAQ2D,EAAIE,WAAW,EAC3B,CAAE,MAAOlN,GACD6M,IACAxD,EAAQM,SAASwD,cACzB,CAEA,GAAIN,EAAU,CACVC,EAAOH,EAAQG,GAAM,GACrBC,EAAWJ,EAAQI,GAAU,GAE7B,IAAK,IAAIK,KAAKL,EACV,GAAiB,iBAANK,GAA+B,kBAANA,GAAyB,OAANA,EAAY,KAAM,mBAE7E,IAAK,IAAItI,KAAKgI,EACV,KAAMhI,aAAauI,OAAe,OAANvI,EAAY,KAAM,eAGlD,MAAMwI,EAAY,CAACR,EAAMC,KACrB,GAAID,aAAgBO,KAAM,CACtB,GAAsB,IAAlBP,EAAKS,SAAgB,CACrB,GAAwB,kBAAbR,EACP,MAAoB,IAAbA,EAAqBD,EAAKU,UAAYV,EAAKW,YAC9CX,GAAoB,IAAbC,EAAqBD,EAAKU,UAAYV,EAAKW,gBAErD,GAAwB,iBAAbV,EAAuB,CACnC,IAAIW,EAAa,EA4BjB,GA3BAvO,KAAKwO,cAAa7I,IACd,GAAmB,IAAfA,EAAEyI,UAAkBzI,EAAE8I,YAAY9N,OAAQ,CAC1C,IAAIA,EAASgF,EAAE8I,YAAY9N,OAC3B,GAAqD,UAAjDgF,EAAE+I,WAAWC,aAAa,mBAE1B,OAAKf,GAAYW,EAAa5N,IAAY,GACtC4N,GAAc5N,EAKXgF,IAHHiI,EAAWjN,EACJ,SAMX,GAFAgN,EAAOhI,IAEFiI,GAAYW,EAAa5N,IAAY,GAItC,OADAiN,GAAYW,EACL,QAHPA,GAAc5N,CAM1B,CACA,OAAOgF,CAAC,GACT,CACCgI,SAEkB,IAAlBA,EAAKS,SAAgB,CACrB,IAAIQ,EAAOpE,SAASqE,eAAe,KACnClB,EAAKmB,aAAaF,EAAMjB,EAAKoB,WAAW,IACxCpB,EAAOiB,EACPhB,EAAW,CACf,CACJ,CAEsB,OAAlBD,EAAKqB,UAAqBrB,EAAKe,WAAWK,WAAWpO,OAAS,IAC9DgN,EAAOA,EAAKsB,iBAAmBtB,EACvC,CAKA,OAHIC,EADoB,kBAAbA,EACIA,EAAW,EAAID,EAAKc,YAAY9N,OAC/BiN,EAAWD,EAAKc,YAAY9N,OAASgN,EAAKc,YAAY9N,OAASiN,EAExE,CAAED,OAAMC,WACnB,GAGJ,IAAwBsB,EAApBC,GAAa,EAAeC,GAC5BzB,EAAK,GAAiB,OAAZA,EAAK,GAAczD,EAAMmF,eAAiB1B,EAAK,GACzDC,EAAS,GAAqB,OAAhBA,EAAS,GAAc1D,EAAMoF,YAAc1B,EAAS,GAC3DO,EAAUR,EAAK,GAAIC,EAAS,KAEvC1D,EAAMkF,SAASA,EAASzB,KAAMyB,EAASxB,UAEnCA,EAASjN,OAAS,EAClBuO,EAASf,GACQ,OAAZR,EAAK,GAAczD,EAAMqF,aAAe5B,EAAK,KAAOA,EAAK,GAC1C,OAAhBC,EAAS,GAAc1D,EAAMsF,UAAY5B,EAAS,KAEtDsB,EAASE,EACTD,GAAa,GAGjBjF,EAAMgF,OAAOA,EAAOvB,KAAMuB,EAAOtB,UAE7BuB,GACAjF,EAAMuF,UAAS,GAEnB5B,EAAI6B,kBACJ7B,EAAI8B,SAASzF,EACjB,CAEA,GAAIqD,GAAwBrD,EAAO,CAC/B,IAAI0F,EAAWC,EACf,IAAK,IAAIC,KAAKvC,EAAsB,CAChC,IAAIwC,EAAoC,IAAhC7F,EAAMqF,aAAanB,SACvBlE,EAAMqF,aAAab,WAAaxE,EAAMqF,aACtCzK,EAAsC,IAAlCoF,EAAMmF,eAAejB,SACzBlE,EAAMmF,eAAeX,WAAaxE,EAAMmF,gBAEvCO,GAAa9K,EAAEkL,QAAQF,KACxBF,EAAY5P,KAAKiQ,uBAAuBnL,EAAGA,EAAEkL,QAAQF,MACpDD,GAAWE,EAAEC,QAAQF,KACtBD,EAAU7P,KAAKiQ,uBAAuBF,EAAGA,EAAEC,QAAQF,IAC3D,CAEA5F,EAAM0F,UAAYA,EAClB1F,EAAM2F,QAAUA,CACpB,CAEA,OAAO3F,CACX,CAEA,WAAAgG,CAAYjK,GACR,IAAIoB,EAAQ,GACR8I,EAAS,GAES,iBAAXlK,EAAqBoB,EAAQpB,EACb,iBAAXA,IAAqBkK,EAAS,GAAGlK,MAIjD,IAAI2I,EAAO,GACX,IAAK,IAAIvZ,EAAI,EAAGA,EAAIgS,EAAQ,EAAGhS,IAAKuZ,GAHnB,uDAGoCwB,OAAO7N,KAAK8N,MAAsB,GAAhB9N,KAAK+N,WAE5E,MAkBMC,EAbe,CAACC,IAClB,IACIC,EAAgBC,EADhBC,EAAeH,EAAM7P,OAEzB,KAAO,IAAMgQ,GACTD,EAAcnO,KAAK8N,MAAM9N,KAAK+N,SAAWK,GACzCA,GAAgB,EAChBF,EAAiBD,EAAMG,GACvBH,EAAMG,GAAgBH,EAAME,GAC5BF,EAAME,GAAeD,EAEzB,OAAOD,CAAK,EAGKI,EAAchC,GAlBtB,IAAIiC,MACZC,UACAjK,WACAmC,UAAU,EAAG,KAe8B+H,MAAM,KAEtD,IAAIC,EAAS,GACb,IAAK,IAAI3b,EAAI,EAAGA,EAAIgS,EAAOhS,IAAK2b,GAAUT,EAAalb,GAEvD,OAAO8a,EAASa,CACpB,CAEA,YAAAxC,CAAayC,EAAKhL,GACd,MAAM,WAAEyI,EAAU,KAAEf,EAAI,qBAAEuD,EAAoB,UAAEC,GAAclL,EAE9D,GAAIiL,IAAyBxC,EACzB,MAAM,IAAI3F,MAAM,4CAEpB,IAAK4E,KAAUA,aAAgBO,MAAQP,GAAMyD,yBACzC,MAAM,IAAIrI,MAAM,oBAEpB,IAIIsI,EAwCAC,EAAIC,EA3CJC,EAAc,GACdC,IAAiB9D,EAA4B,wBAC7C+D,EAAkB,KAetB,GAZIhD,GAAcA,aAAsBR,MAAiC,IAAzBQ,GAAYN,WACxDiD,EAAe3C,GAEf+C,GACAC,EAAkB/D,EAAKyD,wBACvBM,EAA+C,IAA7BA,EAAgBtD,UAAiBsD,EAAgBhD,YAAgCgD,GAEnGA,EAAkB/D,EAElBuD,IACAQ,EAAkB1R,KAAKiQ,uBAAuByB,EAAiBhD,GAAY,IAE3E2C,EACA,KACiC,IAA7BK,EAAgBtD,UAChBsD,IAAoBL,GACpBK,EAAgBhD,YAChBgD,EAAgBhD,aAAe2C,GACjCK,EAAkBA,EAAgBhD,WAcxC,GAAiC,IAA7BgD,EAAgBtD,SAGhB,OAFAoD,EAAYvQ,KAAKgQ,EAAIS,IAEd,CAAEC,MAAOH,EAAaE,mBAIA,IAA7BA,EAAgBtD,WAChBmD,EAAWG,EAAgBJ,IAAM,MAC7BA,EAAKtR,KAAKkQ,YAAY,SACtBwB,EAAgBJ,GAAKA,EACdA,GAHsB,IAOrC,IAAIM,GAAUT,aAAqBjD,KAAQiD,EAAY,QAAUM,EAAc9D,EAAK0B,eAAiBqC,EAAgB3C,WAAW,IAC5H8C,EAAUJ,EAAc9D,EAAK4B,aAAemC,EAAgB3C,WAAW2C,EAAgB3C,WAAWpO,OAAS+Q,EAAgB3C,WAAWpO,OAAS,EAAI,GAEnJmR,EAAeC,MACVA,GAASA,aAAe7D,QACR,IAAjB6D,EAAI3D,UACG2D,EAAIT,KAAOC,GAAYQ,EAAIrD,YAAYsB,QAAQ,IAAMuB,IAIpE,KAAOO,EAAYF,IACf,GAAuB,IAAnBA,EAAMxD,UAAkBwD,EAAM7C,WAAWpO,OAEzCiR,EAAQA,EAAM7C,WAAW,QACtB,GAAI6C,EAAO,CAId,GADmB,mBAARX,IAAoBW,EAAQX,EAAIW,IAC7B,UAAVA,IAAsBE,EAAYF,GAAQ,MAK9C,GAHAJ,EAAYvQ,KAAK2Q,GAGbA,IAAUC,EAAS,MAMvB,IAAIG,GAAW,EACf,MAAQJ,EAAMK,aAAeL,EAAMlD,YAAcoD,EAAYF,EAAMlD,aAE/D,GADAkD,EAAQA,EAAMlD,WACVkD,EAAO,CAIP,GAHmB,mBAARX,IACPW,EAAQX,EAAIW,IAEF,UAAVA,IAAsBE,EAAYF,GAAQ,CAC1CI,GAAW,EACX,KACJ,CAEIJ,GACAJ,EAAYvQ,KAAK2Q,EACzB,CAGJ,GAAII,EAAU,MAGdJ,EAAQA,EAAMK,WAClB,CAMJ,OAHIX,GACAI,EAAgBQ,gBAAgB,MAE7B,CAAEvE,KAAM6D,EAAaE,kBAChC,CAEA,SAAAS,CAAUxE,EAAMyE,EAASC,GAAc,GACnC,KAAM1E,aAAgBO,MAAO,OAE7B,IAAKP,EAAKe,WACN,MAAM,IAAI3F,MAAM,kCAGpB,IACImB,EADMa,OAAO+C,eACDC,WAAW,GACvBuE,EAAQ,KACRhD,EAAcpF,EAAMoF,YACpBiD,EAAM,KACN/C,EAAYtF,EAAMsF,UAEtB,MAAMgD,EAAe7M,IACbuE,EAAMmF,iBAAmB1J,IACzB2M,EAAQ3M,GAERuE,EAAMqF,eAAiB5J,IACvB4M,EAAM5M,EACV,EAgBJ,GAbsB,IAAlBgI,EAAKS,SACLpO,KAAKwO,cAAa7I,IACd6M,EAAY7M,GACLA,IACR,CAAEgI,SACF6E,EAAY7E,GAEfyE,GAEAzE,EAAKe,WAAWI,aAAasD,EAASzE,GAIpB,IAAlBA,EAAKS,SAAgB,CACrB,IAAIgE,EAEC,MAAM,IAAIrJ,MAAM,+BADjBqJ,EAAQK,OAAO9E,EAEvB,MAAO,GAAI0E,EACPD,EAAQK,OAAO9E,QAEf,KAAOA,EAAKoB,WAAW,IAAI,CACvB,IAAI2D,EAAQ/E,EAAKoB,WAAW,GACxBqD,EAASA,EAAQK,OAAOC,GACvB/E,EAAKe,WAAWI,aAAa4D,EAAO/E,EAC7C,CAEJ,IAAIgF,EACJ,GAAsB,IAAlBhF,EAAKS,WAAmBiE,EAAa,CACrC,IACIpE,GADImE,GAAWzE,GACTe,WACViE,EAAWhF,EAAKsB,gBAChBhB,EAAE2E,YAAYjF,EAClB,CAcA,OAXKgF,GAAYhF,GAAMc,cAAgB6D,GAASC,KAExCrI,EADAoI,GAASA,IAAUC,GAAOjD,IAAgBE,EAClCxP,KAAKsN,iBAAiB,CAAEK,KAAMgF,GAAYhF,EAAMC,SAAU0B,IAE1DtP,KAAKsN,iBAAiB,CAC1BK,KAAM,CAAC2E,EAAOC,GACd3E,SAAU,CAAC0B,EAAaE,MAIpCxP,KAAKkK,MAAQA,EACN,CAAEyD,KAAMgF,GAAYhF,EAAMzD,QACrC,CAEA,oBAAA2I,CAAqBlN,GAEjB,IAAKA,GAAoB,IAAfA,EAAEyI,SACR,OAAO,EAEX,IAAI0E,EAAgBnN,GAAGoN,UAAUpS,OACjC,OACsB,IAAlBmS,GACA,MACI,IAAIE,EAAQrN,EAAEoJ,WAAWpO,OACrBsS,EAAW,EACXC,GAAY,EAEhB,KAAOF,KAAS,CACZ,IAAIlO,EAAIa,EAAEoJ,WAAWiE,GAQrB,GANmB,IAAflO,EAAEsJ,UAAkBtJ,EAAE2J,YAAY9N,OAAS,GAAuB,MAAlBmE,EAAE2J,YAClDyE,GAAY,EAEQ,IAAfpO,EAAEsJ,UAAiC,OAAftJ,EAAEkK,UAC3BiE,IAEAA,EAAW,GAAKA,GAAYC,EAC5B,OAAO,CACf,CAEA,OAAO,CACV,EAnBD,EAsBR,CAEA,sBAAAjD,CAAuBtC,EAAMyE,EAASe,GAAoB,EAAOhL,GAK7D,GAJAA,EAAWA,GAAY,CAAExC,GACdA,KAGLyM,aAAmBlE,OAA+B,IAAtBkE,GAAShE,SACvC,MAAM,IAAIrF,MAAM,wBAEpB,IAAIuI,EACAC,EAAWa,EAAQd,IAAM,MACzBA,EAAKtR,KAAKkQ,YAAY,UACtBkC,EAAQd,GAAKA,EACNA,GAHkB,GAO7B,KACI3D,GAAM2D,KAAOC,GACb5D,EAAKe,YACLf,EAAKe,WAAWsB,QAAQ,IAAMuB,IAC9B5D,EAAKe,WAAW4C,KAAOC,KACtB4B,GAAoBnT,KAAK6S,qBAAqBlF,GAAMe,cACvD,CAEE,IAAI0E,EAAKjL,EAASwF,EAAKe,YAEvB,IAAK0E,GAAa,UAAPA,EACP,MAEJzF,EAAOyF,CACX,CAKA,OAHI9B,GACAc,EAAQF,gBAAgB,MAErBvE,CACX,CAEA,iCAAA0F,CAAkCnJ,EAAQlK,KAAKkK,MAAOK,EAAUvK,KAAKuK,SACjE,IAAKL,EACD,OAAO,EAEX,IAAI,wBAAEkH,EAAuB,eAAE/B,EAAc,aAAEE,GAAiBrF,EAC5DoJ,EAAWtT,KAAKuJ,6BAChBqG,EAAY5P,KAAKiQ,uBAAuBZ,EAAgB9E,GACxDsF,EAAU7P,KAAKiQ,uBAAuBV,EAAchF,GAExD,GAAIqF,IAAcC,EAAS,CACvBuB,EAA+D,IAArCA,EAAwBhD,SAAiBgD,EAAwB1C,WAAa0C,EACxG,IAAK,IAAIjM,KAAKmO,EAEV,GADSlC,EAAwBpB,QAAQhQ,KAAKuT,kBAAkBpO,IAE5D,OAAOA,CAEnB,MACI,KAAOyK,GAAaA,IAAcC,IAC9BD,EAAYA,EAAUqC,YAClBrC,IACA,GAA2B,IAAvBA,EAAUxB,SACV,IAAK,IAAIjJ,KAAKmO,EACV,GAAI1D,EAAU1E,UAAUC,SAAShG,GAC7B,OAAOA,EAO/B,OAAO,CACX,CAEA,iBAAAoO,CAAkBzD,GACd,OAAIA,EAAEhO,SAAS,UAAqB,MAATgO,EAAE,IAEb,MAATA,EAAE,GADE,IAAMA,EACeA,CACpC,CAEA,qBAAA0D,CAAsBf,GAClB,IAAIxE,EAAIzD,SAASiJ,cAAc,KAU/B,OARIhB,GAA4B,iBAAXA,IACjBA,EAASjI,SAASqE,eAAe4D,IAErCxE,EAAEwE,OAAOA,GAAUjI,SAASqE,eAAe,KAEtC4D,GACDxE,EAAEwE,OAAOjI,SAASiJ,cAAc,OAE7BxF,CACX,CAEA,WAAAyF,CAAY/N,EAAGgO,GACX,IAAI1J,EAAiB,CAAC,EAClBW,EAAQG,OAAOC,iBAAiBrF,GAEpC,IAAK,IAAIwB,KAAKnH,KAAK6J,WACXlE,EAAEqK,QAAQ,IAAM7I,KAChB8C,EAAe9C,EAAE6B,UAAU,EAAG7B,EAAExG,OAAS,KAAM,GAGvD,IAAIiT,EAAWC,IACX,IAAIpe,EAAMuK,KAAK+M,mBAAmB8G,GAClC,GAAmB,mBAARpe,GAEP,GADAA,EAAMA,EAAImV,EAAMiJ,IACZpe,EAAK,CACL,GAAIke,EACA,OAAOle,EACXwU,EAAexU,IAAO,CAC1B,OACG,GAAW,UAAPoe,GAAkBjJ,EAAMiJ,GAAK,CAEpC,IAAIpO,EAAuB,MAAjBmF,EAAMiJ,GAAI,GAAajJ,EAAMiJ,GAAM,IAAIjU,EAAYgL,EAAMiJ,IAAK3P,MAExE,GAAIuB,IAAQzF,KAAKiL,iBAAkB,CAC/B,GAAI0I,EACA,OAAOlO,EACXwE,EAAexU,GAAOgQ,CAC1B,CAEJ,MAAO,GAAImF,EAAMiJ,KAAQ7T,KAAK8K,qBAAqB+I,IAAO7T,KAAK8T,eAAenO,GAAI,CAC9E,GAAIgO,EACA,OAAO,EACX1J,EAAexU,IAAO,CAC1B,CACA,OAAO,CAAK,EAGhB,GAAIke,EACA,OAAOC,EAAQ5T,KAAK8M,cAAc6G,EAAIpT,gBAE1C,IAAK,IAAIsT,KAAM7T,KAAK+M,mBAChB6G,EAAQC,GAGZ,OAAO5J,CACX,CAEA,cAAA8J,GACI,GAAI/T,KAAKwI,cAAe,CACpB,IAAIwL,EAAWhU,KAAKuK,QAAQ8D,WACF,MAAtB2F,EAAShF,UACa,MAAtBgF,EAAShF,UAAoBgF,EAASvF,aAAwC,MAAzBuF,EAASvF,cAC9DzO,KAAKuK,QAAQkI,OAAOzS,KAAKwT,wBAEjC,CACJ,CAEA,iBAAAS,CAAkBC,GAed,GAVA1J,SAAS2J,oBAAoB,kBAAmBnU,KAAKoU,kBACrDpU,KAAKqU,SAAW,KACZrU,KAAKuK,UACLvK,KAAKuK,QAAQ4J,oBAAoB,UAAWnU,KAAKsU,UACjDtU,KAAKuK,QAAQ4J,oBAAoB,YAAanU,KAAKuU,YACnDxJ,OAAOoJ,oBAAoB,YAAanU,KAAKuU,YAC7CvU,KAAKuK,QAAQ4J,oBAAoB,QAASnU,KAAKwU,QAC/CxU,KAAKuK,QAAQ4J,oBAAoB,QAASnU,KAAKyU,UAG9CP,EACD,OAGJ,IAAIG,EAAW7J,SAASiJ,cAAc,SACtC,IAAK,MAAOhe,EAAKa,KAAUX,OAAO+e,QAAQ,CACtCpD,GAAItR,KAAKkQ,YAAY,cACrB/P,KAAM,OACNwU,OAAQ,4CACRC,QAAQ,EACRC,UAAU,IAEVR,EAASS,aAAarf,EAAKa,GAG/B0J,KAAKqU,SAAWA,EAChBrU,KAAKqU,SAASU,iBAAiB,UAAUhF,IACrC/P,KAAKgV,eAAejF,GAAG1C,OAAMxM,IACzBoU,QAAQC,MAAMrU,EAAI,GACpB,IAGNb,KAAKoU,iBAAmB,WACpBpU,KAAKmV,kBAAiB,KAClB,IAAIC,IAA+B,WAAjBpV,KAAKsK,SAAyC,cAAjBtK,KAAKsK,UAA4BtK,KAAKmK,wBAEjFkL,EAAcD,EAAYpV,KAAKkK,MAAMqF,aAAevP,KAAKkK,MAAMmF,eACnErP,KAAKsK,QAAU,KAGf,IAAIgL,EAAQtV,KAAKuV,uBAAuBF,GACxC,GAAIC,EAAO,CACP,IAAIE,EAAUJ,EAAYE,EAAMrD,YAAcqD,EAAMrG,gBAE/CuG,GAAYJ,IACbI,EAAUhL,SAASqE,eAAe,KAClCyG,EAAM5G,WAAWI,aAAa0G,EAASJ,EAAYE,EAAMrD,YAAcqD,IAEvEE,IACAxV,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM3N,KAAKkK,MAAMuL,UAAYD,EAAUJ,EAAY,CAAC,KAAMI,GAAW,CAACA,EAAS,MAC/E5H,SAAU5N,KAAKkK,MAAMuL,UAAYL,EAAY,EAAII,EAAQ/G,YAAY9N,OAASyU,EAAY,CAAC,KAAM,GAAK,CAAC,EAAG,QAEtH,CAGA,IAAInL,EAAiB,CAAC,EACtB,IAAK,IAAIW,KAAS5K,KAAK4M,kBACnB3C,EAAeW,IAAS,EAG5B,GAAI5K,KAAKqT,oCAEL,YADArT,KAAKiK,eAAiBA,GAI1B,IA2CIyL,EA3CAC,EAAY3V,KAAKuJ,6BAA6BqM,OAAO5V,KAAKsJ,+BAoC9D,IAnCkBtJ,KAAKwO,cAAcb,KACX,IAAlBA,EAAKS,UAAkBT,EAAKqC,QAAQ,eAAmC,IAAlBrC,EAAKS,UAAkBT,EAAKe,WAAWsB,QAAQ,iBACpG/F,EAAe4L,OAAQ,GAM3B,IAAK,IAAI5H,KAAK0H,EAEV,GAN0BxO,EAKO8G,EAJR,IAAlBN,EAAKS,SAAiBT,EAAKe,WAAWsB,QAAQ7I,GAAuB,IAAlBwG,EAAKS,SAAiBT,EAAKqC,QAAQ7I,KAAOwG,aAAgBO,MAMhH,OAAOP,EAPc,IAACxG,EAU9B,GACsB,IAAlBwG,EAAKS,UACa,OAAlBT,EAAKqB,UACa,IAAlBrB,EAAKS,UACsB,IAA3BT,EAAKoB,WAAWpO,SAEoB,OAAhCgN,EAAKoB,WAAW,GAAGC,UACa,IAAhCrB,EAAKoB,WAAW,GAAGX,UAEzB,CAEE,IAAIzI,EAAsB,IAAlBgI,EAAKS,UAAoC,OAAlBT,EAAKqB,SAAoBrB,EAAKe,WAAaf,EAEtEmI,EAAO9V,KAAK0T,YAAY/N,GAC5B,IAAK,IAAIwB,KAAK2O,EACV7L,EAAe9C,GAAK2O,EAAK3O,EAEjC,CACA,OAAOwG,CAAI,GACZ,CAAEA,KAAM3N,KAAKkK,MAAOwE,WAAY1O,KAAKuK,UAEvBoD,KAAKhN,OAAQ,CAC1B,IAAImV,EAAO9V,KAAK0T,YAAY1T,KAAKkK,MAAMmF,gBACvC,IAAK,IAAIlI,KAAK2O,EACV7L,EAAe9C,GAAK2O,EAAK3O,EACjC,CAEAnH,KAAKiK,eAAiBA,EAEtB,IAAI8L,EAAU/V,KAAKmK,wBAA0BnK,KAAKkK,MAAMqF,aAAevP,KAAKkK,MAAMmF,eAEzD,IAArB0G,EAAQ3H,SACRsH,EAAgB1V,KAAKkK,MAAM8L,wBACD,IAArBD,EAAQ3H,WACbsH,EAAgBK,EAAQC,yBAE5BhW,KAAKiW,UAAU,CAAEhM,iBAAgBC,MAAOlK,KAAKkK,MAAOwL,kBAAiBrI,OAAMxM,GAAOA,IAClFb,KAAK+T,gBAAgB,GAE5B,EAAEmC,KAAKlW,MAERA,KAAKsU,SAAW,SAAWvE,GACnB/P,KAAKqT,qCAGTrT,KAAKmV,kBAAiB,KAClB,IAAKnV,KAAKkK,MACN,OACJ,IAAI,eACAmF,EAAc,YACdC,EAAW,UACXmG,EAAS,UACT7F,EAAS,QACTC,GACA7P,KAAKkK,MAELzU,EAAMsa,EAAEta,IAAI0gB,cACZC,EAAQrG,EAAEsG,SAId,GAFArW,KAAKsK,QAAU7U,EAEH,UAARA,GAAmBsa,EAAEsG,SAEhBrW,KAAKkK,MAAM2F,QAAQG,QAAQ,OAC5BD,EAAEuG,sBAKV,GAAI,CAAC,YAAa,UAAUxU,SAASrM,IAGjC,GAFAuK,KAAKmK,yBAA0B,GAG1BnK,KAAKuK,QAAQkE,aACdzO,KAAKuK,QAAQwE,WAAWpO,QAAU,GAClCX,KAAK8T,eAAe9T,KAAKuK,QAAQwE,WAAW,KAC5C/O,KAAKuK,QAAQwE,WAAW,KAAOa,EAG/BG,EAAEuG,sBACD,GAAItW,KAAKkK,MAAMuL,UAAW,CAC3B,IAAIc,EAAMvW,KAAKkK,MAAMmF,eAEjBmH,GAA0B,IAAjBD,EAAInI,SAAiBmI,EAAI7H,WAAa6H,GAAKvG,QAAQ,cAChE,GAAIwG,GAASA,EAAMzH,WAAW,KAAO/O,KAAKiQ,uBAAuBsG,EAAKC,IAAqC,IAA3BxW,KAAKkK,MAAMoF,YAEvFS,EAAEuG,iBACFtW,KAAK+L,QAAQ,cACV,GAAqB,IAAjBwK,EAAInI,UAAkBpO,KAAKyW,oBAAoBF,KAASvW,KAAKkK,MAAMoF,YAAa,CACvF,IAAIoH,EAAIlM,SAASqE,eAAe,KAChC0H,EAAIzH,aAAa4H,EAAGH,EAAIxH,WAAW,IACnC/O,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM+I,EACN9I,SAAU,GAElB,CACJ,OAKJ,GAAY,MAARnY,GAAgBuK,KAAK8J,aAMzB,IAAI,CAAC,IAAK,IAAK,KAAKhI,SAASrM,IAASuK,KAAK+J,aAA3C,CAcA,IARK/J,KAAK8J,cAAgB9J,KAAK+J,gBAAkB,CAAC,IAAK,QAAS,OAAOjI,SAASrM,IAAQA,EAAIqM,SAAS,WACjG9B,KAAK2W,eAOLP,EAAO,CACP,GAAY,WAAR3gB,GAA4B,SAARA,EAEpB,YADAuK,KAAKmK,yBAA0B,GAInC,GAAY,aAAR1U,GAA8B,QAARA,EAEtB,YADAuK,KAAKmK,yBAA0B,EAGvC,CAEA,GAAI1U,EAAIqM,SAAS,SACb9B,KAAK4W,UAAU7G,QAInB,GAAY,QAARta,EAAJ,CA4FA,GAAY,UAARA,KAEIggB,IAAcpG,EAAeZ,YAAY3M,SAAS,MAAcuN,EAAeZ,aAE/EzO,KAAKwO,cAAa7I,IACK,IAAfA,EAAEyI,UAAqC,MAAlBzI,EAAE8I,aAA6B9I,EAAE8I,aACtD9I,EAAEkR,SAGClR,IACR,CAAEgI,KAAkC,IAA5B0B,EAAejB,SAAiBiB,EAAeX,WAAaW,IAG5C,OAA3BQ,EAAQpB,YAAY,IACpB,IAAK,IAAI3J,KAAK+K,EAAQpB,YAAa,CAC/B,GAAU,OAAN3J,EAEC,MADD9E,KAAKoK,4BAA8B,IAE3C,CAIRpK,KAAKmK,yBAA0B,CAxB/B,KA1FA,CACInK,KAAKmK,yBAA0B,EAE/B4F,EAAEuG,iBACF,IAAIQ,EAAc,GAElB,IAAKrB,EAAW,CACZ,IAAIzC,EAAQpD,EACZ,KAAOoD,GAASA,IAAUnD,GACtBiH,EAAY7V,KAAK+R,GACjBA,EAAQA,EAAMf,YAElB6E,EAAY7V,KAAK4O,EACrB,CAEA,GAAIuG,EAAO,CAEP,IAAIW,GAAY,EACZC,EAAoBrR,IACpB,KAAOA,EAAEoJ,WAAW,IAAI,CAGpB,IAFApJ,EAAIA,EAAEoJ,WAAW,GAEK,IAAfpJ,EAAEyI,WAAmBzI,EAAE8I,aAC1B9I,EAAIA,EAAEsM,YAEV,GAAmB,IAAftM,EAAEyI,UAAuC,OAArBzI,EAAE8I,YAAY,GAAa,CAC/CsI,GAAY,EACZpR,EAAE8I,YAAc9I,EAAE8I,YAAYzF,UAAU,GACxC,KACJ,CACJ,GAEJ,GAAI8N,EAAYnW,OAAQ,CAEpB,IAAK,IAAIgF,KAAKmR,EACe,OAArBnR,EAAE8I,YAAY,IACduI,EAAiBrR,GAErBoR,GACA/W,KAAKsN,iBAAiB,CAClBK,KAAM,CAACiC,EAAWC,GAClBjC,SAAU,EAAC,GAAM,IAE7B,MAAO,GAAiC,OAA7BgC,EAAUnB,YAAY,GAAa,CAE1C,IAgBIwI,EAhBa,EAACC,EAAMC,EAAWC,KAC3BF,IAASC,GAGbnX,KAAKwO,cAAa7I,GACVwR,IAAcxR,EACP,SAEQ,IAAfA,EAAEyI,UAAkBzI,EAAE8I,YAAY9N,SAClCyW,GAAmBzR,EAAE8I,YAAY9N,QAE9BgF,IACR,CAAEgI,KAAMuJ,IAVAE,GAcFC,CAAWzH,EAAWP,EAAgBC,GAAe,EAClE2H,EAASA,EAAS,EAAI,EAAIA,EAE1BD,EAAiBpH,GACbmH,GACA/W,KAAKsN,iBAAiB,CAAEK,KAAMiC,EAAWhC,SAAUqJ,GAC3D,CACJ,MAEI,GAAIH,EAAYnW,OAAQ,CACpB,IAAIoW,GAAY,EAChB,IAAK,IAAIpR,KAAKmR,EAAa,CACvBC,GAAY,EACZ,IAAIO,EAAM9M,SAASqE,eAAe,MAClClJ,EAAEmJ,aAAawI,EAAK3R,EAAEoJ,WAAW,GACrC,CACIgI,GACA/W,KAAKsN,iBAAiB,CAClBK,KAAM,CAACiC,EAAWC,GAClBjC,SAAU,EAAC,GAAM,IAG7B,KAAO,CACH,IAAI0J,EAAM9M,SAASqE,eAAe,MAClC7O,KAAKkK,MAAMqN,WAAWD,GACtBtX,KAAKsN,iBAAiB,CAAEK,KAAM2J,EAAK1J,UAAU,GACjD,CAGR,CAtHA,MAFI5N,KAAK+J,cAAe,OANpB/J,KAAK8J,cAAe,CAsJW,GAG1C,EAAEoM,KAAKlW,MACRA,KAAKuU,WAAa,SAAWxE,GACzBA,EAAEyH,kBACFxX,KAAKmV,kBAAiB,KACdnV,KAAKqT,sCAETrT,KAAKyX,oBAAmB,GACxBzX,KAAKgK,aAAehK,KAAKkK,MAAMwN,aAC/B1X,KAAK2W,cAAa,GAAK,GAE9B,EAAET,KAAKlW,MACRA,KAAKwU,OAAS,SAAWzE,GACrBA,EAAEuG,iBACEtW,KAAKqT,qCAETrT,KAAKmV,kBAAiB,KAClB,GAAInV,KAAKkK,MAAO,CACZ,GAAIlK,KAAKqT,oCACL,OACJ,IAAIsE,EAAMnN,SAASoN,yBACnBD,EAAIlJ,YAAcsB,EAAE8H,cAAcC,QAAQ,cAAcC,QAAQ,QAAS,MAErEJ,EAAIlJ,YAAY3M,SAAS,OACzB9B,KAAK8J,cAAe,GAIxB,IAAK,IAAIkO,IAAK,CAAC,IAAK,IAAK,KACrBL,EAAIlJ,YAAY3M,SAASkW,GACzBhY,KAAK+J,cAAe,EAGnB/J,KAAKkK,MAAMuL,WACZzV,KAAKkK,MAAM+N,kBACfjY,KAAKkK,MAAMqN,WAAWI,EAE1B,IAEP,EAAEzB,KAAKlW,MACRA,KAAKyU,OAAS,WACV,GAAIzU,KAAKqK,2BAA2B1J,OAChC,KAAOX,KAAKqK,2BAA2B1J,QACnCX,KAAKqK,2BAA2B6N,MAAMrB,QACjD,EAAEX,KAAKlW,MAERwK,SAASuK,iBAAiB,kBAAmB/U,KAAKoU,kBAClDpU,KAAKuK,QAAQwK,iBAAiB,UAAW/U,KAAKsU,UAC9CtU,KAAKuK,QAAQwK,iBAAiB,YAAa/U,KAAKuU,YAGhDxJ,OAAOgK,iBAAiB,YAAa/U,KAAKuU,YAC1CvU,KAAKuK,QAAQwK,iBAAiB,QAAS/U,KAAKwU,QAC5CxU,KAAKuK,QAAQwK,iBAAiB,QAAS/U,KAAKyU,OAChD,CAEA,gBAAA0D,CAAiBC,GACTpY,KAAKqY,UACLrY,KAAKqY,SAASC,aAElBtY,KAAKqY,SAAW,KAEXD,IAGLpY,KAAKqY,SAAW,IAAIE,kBAAiBC,IAEjC,GAAIxY,KAAK2I,YAAa,CAClB,IAAI8P,EAAUD,EAAejT,KAAI5B,IACtB,CACHF,OAAQE,EAAEF,OAAOiV,WAAU,GAC3BvY,KAAMwD,EAAExD,KACRwY,KAAMhV,EAAEiV,cACRC,MAAO,MACH,IAAIC,EAAS,GACb,IAAK,IAAI1jB,KAAKuO,EAAEoV,WACO,IAAf3jB,EAAEgZ,SACF0K,EAAO7X,KAAK7L,EAAEqZ,aAEdqK,EAAO7X,KAAK7L,EAAEsjB,WAAU,IAEhC,OAAOI,CACV,EATM,GAUPE,QAAS,MACL,IAAIF,EAAS,GACb,IAAK,IAAI3T,KAAKxB,EAAEsV,aACO,IAAf9T,EAAEiJ,SACF0K,EAAO7X,KAAKkE,EAAEsJ,aAEdqK,EAAO7X,KAAKkE,EAAEuT,WAAU,IAEhC,OAAOI,CACV,EATQ,OAabI,EAAS,GACb,IAAK,IAAIvV,KAAK8U,EACK,cAAX9U,EAAExD,MAA4C,UAApBwD,EAAEiV,eAC5BM,EAAOjY,KAAK0C,GAGhBuV,EAAOvY,QACPX,KAAKiW,UAAU,CAAEkD,SAAUD,IAAU7L,OAAM+L,OAEnD,CAEA,IAAK,MAAMD,KAAYX,EAGnB,GAAsB,eAAlBW,EAAShZ,MAiBb,GAAsB,cAAlBgZ,EAAShZ,KAAsB,CAC/B,IAAIkZ,EAAiBF,EAAS1V,OAG9B,GAAI0V,EAASF,aAAatY,OACtB,IAAK,IAAIgD,KAAKwV,EAASF,aAAc,CAQjC,IAAIK,EAAkB,CAACC,EAAM5V,KACzB,IAAKA,EAAE2N,GACH,OAEJ,IACI0H,EADAQ,EAASxZ,KAAK,GAAGuZ,WAAc5Y,OAGnC,KAAO6Y,KAEH,GADUxZ,KAAK,GAAGuZ,WAAcC,GACxB3R,YAAclE,EAAE2N,GAAI,CACxB0H,EAAUhZ,KAAK,GAAGuZ,WAAcE,OAAOD,EAAQ,GAC/C,KACJ,CAGAR,GACAhZ,KAAKiW,UAAU,CAAE+C,QAAS,CAAE,CAACO,GAAOP,KAAa3L,OAAMxM,IACnD,MAAMA,CAAG,GAEjB,EAGJ,GAAI8C,GAAGuH,WAAWC,SAAS,WAAY,CACnC,IAAIuH,EAAQ/O,EAAEoL,WACV2K,EAAWhH,EAAM/R,OACrB,KAAO+Y,KAAY,CACf,IAAIvS,EAAIuL,EAAMgH,GAEL,QADDvS,EAAE6H,UAEFsK,EAAgB,QAASnS,EAGrC,CACA,QACJ,CAEA,IAAIwS,GAAU,EACd,IAAK,IAAIjD,IAAK,CAAC,UAAW,UAAW,UACjC,GAAI/S,GAAG2N,IAAIxP,SAAS4U,GAAI,CACpB4C,EAAgB5C,EAAG/S,GACnBgW,GAAU,EACV,KACJ,CAGJA,GAAU,EAGN,MACA,IAAIC,EAAMP,EAAetK,WAAWpO,OACpC,GAAIiZ,EACA,KAAOA,KAAO,CACV,IAAIjM,EAAO0L,EAAetK,WAAW6K,GACrC,GAAsB,IAAlBjM,EAAKS,UAAkBT,EAAKc,YAC5B,OAAO,CAEf,CACJ,OAAO,CACV,EAVG,GAWA4K,EAAexC,SAIf7W,KAAKyW,oBAAoB4C,IAAwD,IAArCA,EAAetK,WAAWpO,QACnEX,KAAKuV,uBAAuB8D,EAAetK,WAAW,KACzDsK,EAAe5G,OAAOjI,SAASqE,eAAe,IACtD,CAIJ,GAAIsK,EAASJ,WAAWpY,OACpB,IAAK,IAAItL,KAAK8jB,EAASJ,WAAY,CAE/B,IAAIc,EAASlU,IACT,IAAIiU,EAAMjU,GAAGoJ,YAAYpO,OACrBmZ,EAAK,GACT,KAAOF,KAAO,CACV,IAAIzS,EAAIxB,EAAEoJ,WAAW6K,GACF,OAAfzS,EAAE6H,UACF8K,EAAG7Y,KAAKkG,EAChB,CACA,OAAO2S,CAAE,EAGb,GAAmB,IAAfzkB,EAAE+Y,UAiBN,GAAmB,IAAf/Y,EAAE+Y,SAAgB,CAElB,IAAIT,EAAO,MACP,IAAIoM,EAAiB1kB,EAAE2a,QAAQ,IAAIhQ,KAAK6H,cAAgBxS,EAAEic,KAAOtR,KAAK6H,UAClEmS,EAAuB,OAClBD,GAGE/Z,KAAKia,kBAAkBZ,GAJP,GAOvBa,EAAU,MACV,IAAK,IAAI/S,KAAKnH,KAAK0J,0BAA2B,CAC1C,IAAIyQ,EAAM9kB,EAAE2a,QAAQ7I,GACpB,GAAIgT,EACA,OAAOA,CACf,CACA,OAAO,IACV,EAPa,GASVjD,EAAO8C,EAAuB3kB,EAAI0kB,GAAkB,MACpD,IAAIpW,EAAItO,EACR,KAAOsO,IAAM3D,KAAKia,kBAAkBtW,EAAE+K,aAClC/K,EAAIA,EAAE+K,WAEV,OAAO/K,CACV,EANuD,GAQxD,MAAO,CACHoW,iBACAC,uBACAI,eAAgB/kB,EAAE2a,QAAQ,YAC1BqK,oBAAqBhlB,EAAE2a,QAAQ,cAC/BsK,gBAAiBjlB,EAAE2a,QAAQ,aAC3BuK,iBAAkBllB,EAAE2a,QAAQ,cAC5BwK,iBAAkBnlB,EAAE2a,QAAQ,cAC5BkK,UACAhD,OAEP,EArCU,GAuCX,IAAKvJ,EAAKoM,eACN,SAEJ,GACIpM,EAAK2M,iBACL3M,EAAKyM,gBACLzM,EAAK4M,kBACL5M,EAAK6M,iBACP,EAEG7M,EAAK2M,iBACF3M,EAAKyM,gBACLzM,EAAK4M,kBACL5M,EAAK6M,kBAAkB1F,aAAa,kBAAmB,SAC3D,QACJ,CAEA,KAAMnH,EAAKqM,uBAAyBha,KAAKya,gBAAgBplB,IAAM2K,KAAKyW,oBAAoBphB,KACrE,OAAfA,EAAE2Z,UACD3Z,EAAE6V,UAAUvK,QAAQ,CAErBX,KAAKmS,UAAU9c,GACf,QACJ,CAgBA,GAdI,MACA,GAAI2K,KAAK0a,uBAAuBrlB,GAC5B,OAAO,EAEX,IAAK,IAAIslB,KAAM3a,KAAKuJ,6BAChB,GAAIlU,EAAE2a,QAAQ2K,GACV,OAAO,EAGf,OAAO,CACV,EAVG,IAYAtlB,EAAE6c,gBAAgB,SAElBvE,EAAKqM,uBAA0Bha,KAAKya,gBAAgBplB,KAAM2K,KAAKyW,oBAAoBphB,GAAK,CAErE,OAAfA,EAAE2Z,SACF3Z,EAAEwhB,SAEF7W,KAAKmS,UAAU9c,EAAGmV,SAASiJ,cAAc,MAAM,GACnD,QACJ,CAEA,GAAI4F,EAAe5K,aAA8C,MAA/B4K,EAAe5K,YAA0B,CAEvE,IAAIqL,EAAKD,EAAMR,GACXuB,GAAa,EACjB,GAAId,EAAGnZ,OACH,IAAK,IAAI0E,KAAKyU,EACNzU,IAAMhQ,IACNulB,GAAa,GACjBvV,EAAEwR,SAEV,GAAI+D,EACA,QACR,CAEA,GAAIjN,EAAKqM,uBAAyBha,KAAKia,kBAAkB5kB,GAAI,CAEzD,GAAI2K,KAAKoK,2BAA4B,CACjC,IAAIkN,EAAM9M,SAASqE,eAAe7O,KAAKoK,4BACvCuD,EAAKuJ,KAAKpI,aAAawI,EAAK3J,EAAKuJ,KAAKnI,WAAW,IACjD/O,KAAKoK,2BAA6B,GAClCpK,KAAKsN,iBAAiB,CAAEK,KAAM2J,EAAK1J,UAAU,GACjD,CAGA,IAAKD,EAAKuJ,KAAKzI,aAAyC,MAA1Bd,EAAKuJ,KAAKzI,YAA0B,CAC9D,IAAIoM,GAAQ,EACZ7a,KAAKwO,cAAa7I,GACK,OAAfA,EAAEqJ,UACF6L,GAAQ,EACD,SAEJlV,GACR,CAAEgI,KAAMA,EAAKuJ,OAEZ2D,GACAlN,EAAKuJ,KAAKzE,OAAOjI,SAASiJ,cAAc,MAChD,CAEA,QACJ,CAEA,IAAIqH,EAAY3T,IACZ,IAAI4T,EAAU/a,KAAK6M,aAAa1F,IAAM,GAOtC,OALI4T,EAAQpa,SACRoa,EAAUA,EAAQnF,OAAOmF,EAAQxV,KAAI5B,GAC1BA,EAAI,YAGZ,CACHwD,EACAA,EAAErF,SAAS,SAAWqF,EAAE4Q,QAAQ,QAAS,IAAM5Q,EAAI,SACrDyO,OAAOmF,EAAQ,EAGjBC,EAAW,GAEX3lB,EAAE6V,UAAUvK,QAEZX,KAAKiQ,uBAAuB5a,EAAGsY,EAAKuM,SAAS,GAAMvU,IAE/C,IAAIsV,EAAO5lB,EAAE6V,UAAUvK,OACvB,KAAOsa,KAEC,MACI,IAAIC,EAAMJ,EAASzlB,EAAE6V,UAAU+P,IAC/B,IAAK,IAAInW,KAAKoW,EACV,GAAIvV,EAAEuF,UAAUC,SAASrG,GACrB,OAAO,EAEf,OAAO,CACV,EAPD,IASAkW,EAAS/Z,KAAK0E,GAGtB,OAAOA,CAAC,IAKhB,IAAIiU,EAAMoB,EAASra,OAEnB,KAAOiZ,KAEH5Z,KAAKmS,UAAU6I,EAASpB,IAG5B,IAAIuB,EAAY9lB,EAAE6V,UAAUvK,OAC5B,KAAOwa,KAAa,CAChB,IAAIC,EAAY/lB,EAAE6V,UAAUiQ,GAChBnb,KAAK0T,YAAYre,EAAG+lB,EAAUrD,QAAQ,QAAS,OAC/C/X,KAAK0T,YAAYre,EAAEqZ,WAAY0M,EAAUrD,QAAQ,QAAS,MAIlE1iB,EAAE6V,UAAU2L,OAAOuE,EAC3B,CAEK/lB,EAAE6V,UAAUvK,QAEbtL,EAAE6c,gBAAgB,SAGlBlS,KAAKyW,oBAAoB4C,IAAwD,IAArCA,EAAetK,WAAWpO,QACnEX,KAAKuV,uBAAuB8D,EAAetK,WAAW,KACzDsK,EAAe5G,OAAOjI,SAASqE,eAAe,IACtD,OAnNI,GAAI7O,KAAKia,kBAAkBZ,GACvBrZ,KAAKmS,UAAU9c,EAAGmV,SAASiJ,cAAc,WAGxC,GAAIpe,EAAEoZ,aAAiC,MAAlBpZ,EAAEoZ,YAA0B,CAElD,IAAIqL,EAAKD,EAAMR,GACf,GAAIS,EAAGnZ,OACH,IAAK,IAAI0E,KAAKyU,EACVzU,EAAEwR,QACd,CA0MR,CACR,MAzUA,CACI,MAAM,OAAEpT,EAAM,cAAEmV,GAAkBO,EACZ,UAAlBP,KACInV,EAAOiL,YAAejL,EAAOyH,UAAUvK,QAAYX,KAAKyW,oBAAoBhT,IAAWzD,KAAKya,gBAAgBhX,IAA+B,MAApBA,EAAOuL,UAE9HhP,KAAKmS,UAAU1O,GAEdA,EAAOyH,UAAUvK,QAClB8C,EAAOyO,gBAAgB,UAGT,UAAlB0G,GAA8B5Y,KAAK0a,uBAAuBjX,IAC1DA,EAAOyO,gBAAgB,QAE/B,CA4TJ,IAEJlS,KAAKqY,SAASgD,QAAQrb,KAAKuK,QAAS,CAChC+Q,YAAY,EACZC,WAAW,EACXC,SAAS,IAGjB,CAEA,SAAA5E,CAAU7G,GACN,IAAK/P,KAAKkK,QAAU6F,GAAGta,IACnB,OAEJ,IACI8Z,EACAC,EACAH,EACAC,EACAmG,EACA7F,EACAC,EACA4L,EACAC,EACAC,EACAC,EAEAnmB,EAAMsa,EAAEta,IAAI0gB,cACZC,EAAQrG,GAAGsG,WAAY,EACvBwF,EAAU9L,GAAG+L,SAAW/L,GAAG8L,UAAW,EACtCE,EAAa,KACbxM,EAAevP,KAAKkK,MAAMqF,aAC1BC,EAAYxP,KAAKkK,MAAMsF,UACvBH,EAAiBrP,KAAKkK,MAAMmF,eAC5BC,EAActP,KAAKkK,MAAMoF,YACzBmG,EAAYzV,KAAKkK,MAAMuL,UACvB7F,EAAY5P,KAAKkK,MAAM0F,UACvBC,EAAU7P,KAAKkK,MAAM2F,QACrB4L,EAAuB7L,IAAcC,EACrC6L,EAAc1b,KAAKmK,wBAA0B0F,EAAUD,EACvD+L,EAAe3b,KAAKmK,wBAA0BoF,EAAeF,EAC7DsM,EAAyC,IAA1BA,EAAavN,SAAiBuN,EAAajN,WAAaiN,CAAY,EAInFrF,EAAiB,KACjB,IACIvG,EAAEuG,gBACN,CAAE,MAAOzV,GACT,GAGAmb,EAAkB,KAClB,IAAIC,EAAkBjc,KAAKmK,wBAA0BoF,EAAeF,EAChE6M,GAAS,EA6Cb,OA3CIzG,IAAcwG,EAAgBxN,YAAY3M,SAAS,MAAcma,EAAgBxN,aAEjFzO,KAAKwO,cAAa7I,IACd,GAAmB,IAAfA,EAAEyI,WAAqC,MAAlBzI,EAAE8I,cAA6B9I,EAAE8I,aAAc,CAEpE,IAAItJ,EAAIQ,EAAEsM,aAAetM,EAAE+I,WACvByN,EAAmBnc,KAAKmK,wBAA0B,cAAgB,kBAEtE,GAAIxE,IAAMsW,GAAmB,MAEzB,GAAiC,IAA7BA,EAAgB7N,SAAgB,CAChC,IAAIwL,EAAMqC,EAAgBlN,WAAWpO,OACrC,KAAOiZ,KACH,GAAIqC,EAAgBlN,WAAW6K,KAASjU,EACpC,OAAO,EAEf,OAAO,CACX,CACH,EAV4B,GAUvB,CAEF,IAAIsL,EAAM9L,EAgBV,OAfqB,IAAjB8L,EAAI7C,UAAkBzI,EAAE+I,aAAeuC,EACnCA,EAAIkL,KACJD,EAASjL,EAAIkL,IAEjBD,EAAS/W,EAEbQ,EAAEkR,SAEF7W,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAO8H,EAAuFyG,EAA3Elc,KAAKmK,wBAA0B,CAAC,KAAM+R,GAAU/W,GAAK,CAAC+W,GAAU/W,EAAG,MACtFyI,SAAW6H,EAA8EzV,KAAKmK,wBAAvEnK,KAAKmK,wBAA0B,CAAC,KAAM+R,GAAU,EAAEA,EAAQ,QAGrFH,IACAzF,IACO,OACX,CACJ,CACA,OAAO3Q,CAAC,GACT,CAAEgI,KAAMsO,MAGNC,CAAM,EAGfE,EAAsBC,IAGtB,IAAIC,EAA+B,SAAnBV,EAA4B,SAAW,MACnDW,EAAwBvc,KAAKkK,MAAM8L,wBACnCwG,EAAaH,EAAGrG,wBAAwBsG,GACxCG,EAAgBxV,SAASjH,KAAK4I,oBAAoB,yBAEtD,QAAI2T,EAAsBG,WACW,WAAdJ,EAAyBE,EAAaD,EAAsBD,GAAaC,EAAsBD,GAAaE,GAAcC,EAIrI,EAGZE,EAA4B,KAI5B,IAFUX,KAEoD,iBAAlDjR,OAAOC,iBAAiB2Q,GAAciB,QAA4B,CAE1E,IAAIC,EAA0C,IAA1BlB,EAAavN,SAAiBuN,EAAajN,WAAaiN,EAC5E,KAA0D,iBAAnD5Q,OAAOC,iBAAiB6R,GAAeD,SAC1CC,EAAgBA,EAAcnO,WAGlC,IAAIyN,EAAsC,OAAnBP,EAA0B,kBAAoB,cACjEkB,EAASD,EAAcV,GAE3B,IAAKW,EAAQ,CACT,IAAIpG,EAAIlM,SAASqE,eAAe,IAChCgO,EAAcnO,WAAWI,aAAa4H,EAAwB,oBAArByF,EAAyCU,EAAgBC,EACtG,CAIA,GAFAD,EAAgBA,EAAcV,GAE1BU,EAAe,CACf,IAAIE,EAC0B,SAAnBnB,EAUX,OAPA5b,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAMyI,EAASpW,KAAKmK,wBAA0B,CAAC,KAAM0S,GAAiB,CAACA,EAAe,MAASA,EAC/FjP,SAAUwI,EAASpW,KAAKmK,wBAA0B,CAAC,KAAM4S,GAAgB,CAACA,EAAc,MAASA,IAGrGhB,KAEO,CACX,CACJ,CACA,OAAO,CAAK,EAKhB,OAFAA,IAEQtmB,GACJ,IAAK,YACDmmB,EAAiB,OACrB,IAAK,aAQD,IAEIM,EATJN,EAAiBA,GAAkB,SAE/BC,GAAWpG,GAAaW,KACxBpW,KAAKmK,wBAA6C,UAAnByR,EAC/BG,MAGqBK,EAAmBT,IAKpCE,GAA8B,UAAnBD,IACXM,EAASS,KAGZT,GACDF,IAEJ,MAEJ,IAAK,UACDJ,EAAiB,KACrB,IAAK,YAGD,GAFAA,EAAiBA,GAAkB,QAE9BnG,IAAcW,EAAO,CACtBE,IACA,IAAI5S,EAAyB,OAAnBkY,EAA0B,CAACvM,EAAgBC,GAAe,CAACC,EAAcC,GACnFxP,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAAEK,KAAMjK,EAAI,GAAIkK,SAAUlK,EAAI,KACjE,KACJ,CAOA,IALI+R,GAAagG,KACbzb,KAAKmK,wBAA6C,SAAnByR,EAC/BG,KAGAK,EAAmBT,GACnB,MAIJ,GAFcgB,IAGV,MAEAX,IAEJ,IAAIgB,EAAcZ,EAAmBV,GACrC,GAAIsB,EACA,MAGJ,IAAIC,EAA4Bjd,KAAKiQ,uBAAuByL,EAAa1b,KAAKuK,SAE1E2S,EACAD,EAA0B3L,KAAOtR,KAAK6H,WAAa7H,KAAKia,kBAAkBgD,GAG9E,GACIC,IAEuB,OAAnBtB,GAA2BqB,EAA0B3O,aAAeoN,GACjD,SAAnBE,GAA6BqB,EAA0B5O,YAAcqN,GAGzE,MAGJ,IAAIyB,EAAa,CACbD,EAAgCD,EAA0BhO,gBAAkByM,EAAYzM,gBACxFiO,EAAgCD,EAA0BhL,YAAcyJ,EAAYzJ,aAGjE,OAAnB2J,GACAuB,EAAWC,UAEf,IAAKC,EAAcC,GAAeH,EAG9BI,EAAeL,EAAgCD,EAA4BK,EAC/E,GAAIC,GACA,GAAIvd,KAAKya,gBAAgB8C,KAAkBnH,EAAO,CAC9CE,IAEA,IAAIkH,EAA0B,OAAnB5B,EAA0B2B,EAAatO,gBAAkBsO,EAAatL,YAEjF,IAAKuL,GAAQxd,KAAKya,gBAAgB+C,GAAO,CACrC,IAAIvP,EAAIjO,KAAKwT,wBACb+J,EAAa7O,WAAWI,aAAab,EAAsB,OAAnB2N,EAA0B2B,EAAeC,GACjFD,EAAetP,CACnB,MACIsP,EAAeC,EAEnBxd,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM4P,EACN3P,SAA6B,SAAnBgO,IAITxF,GAAUsF,EAAYjN,cACtBzO,KAAKya,gBAAgB4C,KAAkBA,GAAgB3B,IAAgB1b,KAAKuK,QAAQ+D,aAErFtO,KAAKqK,2BAA2BpJ,KAAKya,EAC7C,MAAO,IAAKsB,GAAkC,SAAnBpB,EAA2B,CAClDtF,IACA,IAAImH,EAAgB,EAChBC,EAAgB1d,KAAKmK,wBAA0BqF,EAAYF,EAC/DtP,KAAKwO,cAAa7I,GACVA,IAAM4J,EACC,SACa,IAAf5J,EAAEyI,UAAkBzI,EAAE8I,cAC3BgP,GAAiB9X,EAAE8I,YAAY9N,QAC5BgF,IACR,CACCgI,KAAM+N,IAEV+B,GAAiBC,EACjB1d,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM8H,EAAY6H,EAActd,KAAKmK,wBAA0B,CAAC,KAAMmT,GAAe,CAACA,EAAa,MACnG1P,SAAU6H,EAAYgI,EAAgBzd,KAAKmK,wBAA0B,CAAC,KAAMsT,GAAiB,CAACA,EAAe,OAErH,OAEAnH,IAEhB,CAEA,OAAAqH,CAAQtoB,EAAGuoB,EAAaC,GAAO,EAAOC,GAClC,IAAIC,EAAS/d,KAAKiQ,uBAAuBjQ,KAAKkK,MAAMkH,wBAAyBpR,KAAKuK,SAC9EqF,EAAY5P,KAAKiQ,uBAAuBjQ,KAAKkK,MAAMmF,eAAgBrP,KAAKuK,SACxEsF,EAAU7P,KAAKiQ,uBAAuBjQ,KAAKkK,MAAMqF,aAAcvP,KAAKuK,SACpEyT,EAAmB,CAAC,KAAM,KAAM,KAAM,WAAY,aAElDvL,EAAU9E,IACNA,IAAS3N,KAAKuK,UACdoD,EAAO3N,KAAKuK,QAAQwE,WAAW/O,KAAKuK,QAAQwE,WAAWpO,OAAS,IAEpE,IAAIsd,EAAOtQ,EAAKsE,YACZ2L,GACAjQ,EAAKe,WAAWI,aAAa8O,EAAaK,GAE9CtQ,EAAKe,WAAWI,aAAazZ,EAAGuoB,GAAeK,GAC3Cje,KAAK8T,eAAenG,KAAUA,EAAKc,aAAezO,KAAKuK,QAAQ8D,YAAcV,GAC7EA,EAAKkJ,QAAQ,EAGrB,GAAIgH,EAAJ,CACI,IAAIK,EAAe,CAAC,EAChBC,GAAa,EAEbvK,EAAU,CAAC1G,EAAKmP,MACZA,GAAQ6B,EAAahR,KAAQ,MAC7B,IAAK,IAAI8K,KAAKkG,EACV,GAAIA,EAAalG,KAAOqE,EACpB,OAAO,EAEf,OAAO,CACV,EANgC,KAO7B6B,EAAahR,GAAOmP,EAAE,EAG9B,GAAIrc,KAAKkK,MAAMuL,UAAW,CACtB7B,EAAQve,EAAE2Z,SAAUY,EAAUI,QAAQ3a,EAAE2Z,WAExC,IAAI4K,EAAMvkB,EAAE6V,UAAUvK,OACtB,KAAOiZ,KAAO,CACV,IAAIwB,EAAY/lB,EAAE6V,UAAU0O,GAC5BhG,EAAQwH,EAAWxL,EAAUI,QAAQ,IAAMoL,GAC/C,CACJ,MACIpb,KAAKwO,cAAa7I,IACd,IAAIyY,EAAqB,IAAfzY,EAAEyI,SAAiBzI,EAAE+I,WAAa/I,EAC5C,GAAqB,IAAjByY,EAAIhQ,SAEJ,OADA+P,GAAa,EACN,QAGX,GAAmB,IAAfxY,EAAEyI,SACF,IAAK,IAAIiQ,KAAcL,EACnB,GAAIrY,EAAEqJ,WAAaqP,GAAc1Y,EAAEqK,QAAQqO,GAEvC,OADAF,GAAa,EACN,QAInBvK,EAAQve,EAAE2Z,SAAUoP,EAAIpO,QAAQ3a,EAAE2Z,WAElC,IAAI4K,EAAMvkB,EAAE6V,UAAUvK,OACtB,KAAOiZ,KAAO,CACV,IAAIwB,EAAY/lB,EAAE6V,UAAU0O,GAC5BhG,EAAQwH,EAAWgD,EAAIpO,QAAQ,IAAMoL,GACzC,CAEA,OAAIzV,IAAM3F,KAAKkK,MAAMqF,aACV,QAEJ5J,CAAC,GACT,CAAEgI,KAAMoQ,EAAQ5M,UAAWnR,KAAKkK,MAAMmF,iBAE7C,GAAI8O,EACA,OAEJ,GAAIxoB,OAAOuN,KAAKgb,GAAcvd,OAC1B,IAAK,IAAIqX,KAAKkG,EACVle,KAAKmS,UAAU+L,EAAalG,QAE7B,CAEHvF,EAAO5C,GAEP,IAAIzO,EAAUpB,KAAKkK,MAAM+N,kBAEzB,GAAI7W,EAAQ2N,WAAW,GACnB,KAAO3N,EAAQ2N,WAAW,IAAI,CAC1B,IAAI2H,EAAItV,EAAQ2N,WAAW,GACtB2H,EAAEjI,YAGHpZ,EAAEod,OAAOiE,GAFTA,EAAEG,QAGV,MACGxhB,EAAEod,OAAOzS,KAAKwT,yBAErBxT,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAMmQ,GAAgBzoB,EACtBuY,UAAU,IAId,IAAI0Q,EAAKjpB,EAAE4Z,gBAGPqP,IACAA,EAAqB,IAAhBA,EAAGlQ,SAAiBkQ,EAAG5P,WAAa4P,GAErCte,KAAK8T,eAAewK,IAASA,EAAG7P,aAAkC,MAAnB6P,EAAG7P,aAClD6P,EAAGzH,SAEf,CAGJ,KA9FA,CAgGA,IAAK,IAAI1R,KAAK6Y,EACNnO,EAAQG,QAAQ7K,KAChB0K,EAAUA,EAAQG,QAAQ7K,IAGlCsN,EAAO5C,GAEH+N,IACA5d,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAAEK,KAAMmQ,GAAgBF,IAV/D,CAYJ,CAEA,SAAA3H,CAAUsI,GACN,OAAO,IAAIC,SAAQC,IACf,GAA6B,mBAAlBze,KAAKmI,SAAyB,CACrC,IAAIiL,EAAKpT,KAAKmI,SAASoW,IAASA,EAC5BnL,aAAcoL,SACdpL,EAAGsL,MAAKvZ,IACJsZ,EAAItZ,EAAE,IAGdsZ,EAAIrL,GAAMmL,EACd,CACAE,EAAIF,EAAK,GAEjB,CAEA,oBAAMvJ,CAAejF,GACjB,IAAI4O,EAAQ5O,EAAEtM,OAAOkb,MAErB,MAAMC,EAAqB,CAAEC,MAAO,IACpC,IAAIC,EAAW,IAAIC,WAEnB,MAAMC,EAAQC,GACH,IAAIT,SAAQC,IACfK,EAASI,OAASC,IACd,MAAM,aAAEC,EAAY,KAAEzG,EAAI,KAAE0G,EAAI,KAAElf,GAAS8e,EACrCK,EAASH,EAAE1b,OAAO8D,OAExB,IAAIgY,EAAM,IAAIC,MACdD,EAAIL,OAAS,KACTT,EAAI,CACAgB,UAAW,CACPC,MAAOH,EAAIG,MACXhD,OAAQ6C,EAAI7C,QAEhB0C,eACAO,SAAUhH,EACViH,SAAUP,EACVQ,SAAU1f,EACVmf,SACAzX,UAAW7H,KAAKkQ,YAAY,QAC9B,EAENqP,EAAIO,IAAMR,CAAM,EAEpBR,EAASiB,cAAcd,EAAK,IAIpCjf,KAAKmI,SAAS,CAAE6X,SAAS,IACzB,IAAK,IAAIpG,EAAM,EAAG+E,EAAMhe,OAASiZ,EAAKA,IAClCgF,EAAmBC,MAAMjF,SAAaoF,EAAKL,EAAM/E,IAErD5Z,KAAKmI,SAAS,CAAE6X,SAAS,IAGzBhgB,KAAKqU,SAAS/d,MAAQ,GAEtB,IAAI2pB,QAAiBjgB,KAAKiW,UAAU2I,GAE/B5e,KAAKkK,OACNlK,KAAKkgB,uBAEJlgB,KAAKkK,QAAS,MACf,IAAI/C,EAAInH,KAAKkK,MAAMkH,wBAEnB,OADAjK,EAAmB,IAAfA,EAAEiH,SAAiBjH,EAAEuH,WAAavH,GAC9BA,EAAE6I,QAAQ,IAAMhQ,KAAK6H,UAChC,EAJkB,IAKf7H,KAAKuK,QAAQ1I,QAEjB7B,KAAKmV,kBAAiB,KAClB,IAAK,IAAIoK,KAAOU,EAASpB,MAAO,CAC5B,IAAIsB,EAAQngB,KAAKogB,WAAWb,EAAK/U,SAASiJ,cAAc,QACxDzT,KAAK2d,QAAQwC,EAAOngB,KAAKwT,wBAC7B,IAGR,CAEA,UAAA4M,CAAWC,EAAajO,GAWpB,KAAIA,aAAmBlE,MAQnB,KAAM,8BA0DV,OAjESkE,EAAQlH,UAAUC,SAAS,YAC5BiH,EAAQlH,UAAUjG,IAAI,WAEsB,UAA5CmN,EAAQzD,aAAa,oBACrByD,EAAQ0C,aAAa,kBAAmB,SAKlC,CAACzf,IAEX,IAAIwpB,EAAQxpB,GAAGkV,mBAAmB2D,KAAO7Y,EAAEkV,QAAU,KASrD,GAPIsU,IACIA,EAAMvN,GACNjc,EAAEwS,UAAYgX,EAAMvN,GAEpBuN,EAAMvN,GAAKjc,EAAEwS,YAGhBgX,EAAO,CACRA,EAAQrU,SAASiJ,cAAc,OAC/Bpe,EAAEkV,QAAUsU,EAEZ,IAAIyB,EAAY,QAAUjrB,EAAEiqB,OAAOtW,UAAU3T,EAAEiqB,OAAO3e,OAAS,KAAKoX,QAAQ,kCAAmC,IAI/G,GAHI8G,EAAM3T,UAAUC,SAASmV,IACzBzB,EAAM3T,UAAUjG,IAAIqb,GAEpB7f,MAAMC,QAAQrL,EAAEkrB,OAChB,IAAK,IAAIC,KAAMnrB,EAAEkrB,MACb1B,EAAM3T,UAAUjG,IAAIub,GAW5B,GARsB,QAAlB3B,EAAM4B,SACN5B,EAAM/J,aAAa,MAAOzf,EAAEiqB,QAEP,mBAAdjqB,EAAEqrB,UACT7B,EAAM9J,iBAAiB,QAAS1f,EAAEqrB,SAClC7B,EAAM3T,UAAUjG,IAAI,YAGpB5P,EAAEuV,OAA4B,iBAAZvV,EAAEuV,OAAsBjV,OAAOuN,KAAK7N,EAAEuV,OAAOjK,OAC/D,IAAK,IAAIggB,KAAMtrB,EAAEuV,MACbwH,EAAQxH,MAAMC,YAAY8V,EAAItrB,EAAEuV,MAAM+V,GAGlD,CAEAvO,EAAQ0C,aAAa,kBAAmB,SACxC1C,EAAQK,OAAOoM,GAEf,IAAI+B,GAAY,EAEhB,IAAK,IAAIxC,KAAOpe,KAAKiJ,YACjB,GAAImV,EAAIvW,YAAcxS,EAAEwS,UAAW,CAC/B+Y,GAAY,EACZ,KACJ,CAEAA,GACA5gB,KAAKiJ,YAAYhI,KAAK5L,EAAE,EAGhCwrB,CAAQR,GAEDjO,CACX,CAEA,gBAAA+C,CAAiBlE,GACb,IAAIpD,EAAM9C,OAAO+C,eACjB,GAAID,EAAK,CACL,IAAIiT,EAA6C,IAA7BjT,EAAIkT,YAAY3S,SAAiBP,EAAIkT,WAAWrS,WAAab,EAAIkT,WACrF,GAAID,GAAiBA,EAAc9Q,QAAQ,IAAIhQ,KAAK6H,aAAc,CAC9D,GAAIiZ,EAAcxP,KAAOtR,KAAK6H,UAAW,CAGrC,IAAIwG,EAAYrO,KAAKuK,QAAQ8D,UACxBA,IAEDA,EAAYrO,KAAKwT,wBACjBxT,KAAKuK,QAAQyW,YAAY3S,GAGzBrO,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAAEK,KAAMU,EAAWT,UAAU,IAGxE,MACI5N,KAAKkK,MAAQlK,KAAKsN,iBAAiB,MAGvC,YADmB,mBAAR2D,GAAoBA,IAEnC,CACJ,CAEAjR,KAAKkK,MAAQ,KACblK,KAAKiK,eAAiB,CAAC,CAC3B,CAEA,kBAAAwN,CAAmBwJ,GACVA,GAELjhB,KAAKwO,cAAa7I,IACd,GAAmB,IAAfA,EAAEyI,UAAmBzI,EAAE8I,YAAY3M,SAAS,MAG5C,GAFA6D,EAAE8I,YAAc9I,EAAE8I,YAAYsJ,QAAQ,IAAU,KAE3CpS,EAAE8I,YAAa,CAChB,IAAIyS,EACJ,IAAK,IAAI/Z,KAAKnH,KAAK0J,0BACf,GAAI/D,EAAE+I,WAAWsB,QAAQ7I,GAAI,CACzB+Z,EAAMvb,EAAE+I,WAAWsB,QAAQ7I,GAC3B,KACJ,CAEJ,IAAIkV,EAAKrc,KAAKiQ,uBAAuBtK,EAAGub,GAAK,GAEzCC,EAAM9E,EAAG3N,WAKb,OAJK1O,KAAKia,kBAAkBkH,IAAS9E,EAAG5N,aAAezO,KAAKuK,QAAQ8D,YAAcgO,IAC9E8E,EAAIvO,YAAYyJ,GAChB1W,EAAIwb,GAEDxb,CACX,OACsB,IAAfA,EAAEyI,UAAgBzI,EAAEsb,YAE/B,OAAOtb,CAAC,GACT,CAAEgI,KAAM3N,KAAKuK,SACpB,CAEA,YAAAoM,CAAayK,GAAgB,GAEzB,MAAMP,EAAU,CAACQ,EAAUC,KACvB,IAAKthB,KAAKqhB,GACN,OAEJ,IAAIE,EAAQvhB,KAAK,GAAGqhB,YAAqB,KAEzC,GAAc,OAAVE,EACA,MAAM,IAAIxY,MAAM,uBAEpB,GAAuB,mBAAZuY,EACP,MAAM,IAAIvY,MAAM,wCAEpB,IAAI4E,EAAOyT,EAAgBphB,KAAKuK,QAAUvK,KAAKkK,OAAOkH,wBAEtD,IAAKzD,EACD,OAEkB,IAAlBA,EAAKS,WACLT,EAAOA,EAAKe,YAEhB,IAAI+P,EAAM,MACN,IA6EI+C,EA7EApG,EAAY,IAAIiG,KAChB9W,EAAU,GACVkX,EAAY,GAEZC,EAAY,GA0EhB,GAzEA1hB,KAAKwO,cAAa7I,IACd,GAAmB,IAAfA,EAAEyI,UAAkBzI,EAAE8I,YACtB,GACgC,IAA5B9I,EAAEsM,aAAa7D,UACfzI,EAAEsM,YAAYxD,aACgB,MAA9B9I,EAAEsM,YAAYxD,YAA0B,CACxC,IAAI0S,EAAMxb,EAAE+I,WACZyS,EAAIF,YACJtb,EAAIwb,CACR,KACsB,MAAlBxb,EAAE8I,aACD9I,EAAE+I,WAAWsB,QAAQ,IAAMoL,IAE5BsG,EAAUzgB,KAAK0E,GAGvB,OAAOA,CAAC,GACT,CAAEgI,SAEL+T,EAAUC,SAAShU,KAYnB,SAAyBA,EAAM4T,EAAOK,GAClC,IAC8BC,EAD1BV,EAAMxT,EAAKe,WAAYoT,EAAMnU,EAAKsE,YAClC0F,EAAMhK,EAAKoU,cAEf,GAAIR,EAAMS,OACN,KAAOrU,IAASkU,EAAON,EAAM3gB,KAAK+M,EAAKsU,aACnCV,EAAMW,UAAY,EAClBvU,EAAOwU,EAAaxU,EAAMkU,EAAMD,EAAQQ,MAAMpiB,KAAM6hB,SAEhDA,EAAON,EAAM3gB,KAAK+M,EAAKsU,aAC/BE,EAAaxU,EAAMkU,EAAMD,EAAQQ,MAAMpiB,KAAM6hB,IAEjD,SAASM,EAAaxU,EAAMkU,EAAMQ,GAC9B,IAAIC,EAAO3U,EAAKsU,UAChBtU,EAAKsU,UAAYK,EAAKxb,MAAM,EAAG+a,EAAKU,OACpC,GAAG3M,OAAO4M,EAAOrB,EAAKkB,IAAUV,SAAQ,SAAUhc,GAC9C,IAAI8Y,EAAM0C,EAAIrS,aAAanJ,EAAGmc,GAC9BvX,EAAQtJ,KAAKwd,EACjB,IACA,IAAIgE,EAAOH,EAAKxb,MAAM+a,EAAKU,MAAQV,EAAK,GAAGlhB,QAC3C,GAAI8hB,EAAM,CACN,IAAI7T,EAAO+I,EAAI9I,eAAe4T,GAC9B,OAAOtB,EAAIrS,aAAaF,EAAMkT,EAClC,CACJ,CAEA,SAASU,EAAOnG,EAAI3mB,GAChB,GAAIA,EAAE6P,IAAK,OAAO7P,EAAE6P,KAAI,SAAUb,GAC9B,OAAO8d,EAAOnG,EAAI3X,EACtB,IACK,GAAiB,iBAANhP,EAAgB,CAC5B,IAAIqa,EAAI4H,EAAI+K,gBAAgBhtB,EAAEitB,cAAgBtG,EAAGsG,aAAcjtB,EAAEijB,MACjE,GAAIjjB,EAAEktB,MAAO,IAAK,IAAIxtB,KAAKM,EAAEktB,MAAO7S,EAAE+E,aAAa1f,EAAGM,EAAEktB,MAAMxtB,IAI9D,OAHIM,EAAEmtB,SAAS,GAAGjN,OAAO4M,EAAOzS,EAAGra,EAAEmtB,UAAUlB,QAAQ5R,EAAEiR,YAAajR,GAC7C,iBAAdra,EAAEmtB,SAAsBpB,EAAUxgB,KAAKvL,EAAEmtB,SACpD9S,EAAE+S,gBAAkB,QACb/S,CACX,CAAO,OAAO4H,EAAI9I,eAAenZ,EAAI,GACzC,CACJ,CAlDIqtB,CAAgBpV,EAAM4T,GAAO,SAAUyB,GACnC,GAAIA,EAAQriB,OAAS,EACjB,MAAO,CACHgY,KAAM,OACNiK,MAAO,CAAE,MAAS,GAAGxH,KAAaA,IAAY4H,KAC9CH,QAASG,EAGrB,GAAE,IA6CFzY,EAAQ5J,OACR,IAAK,IAAI0b,KAAM9R,EACXiX,EAAa7T,EAAKoU,cAAclT,eAAe,IAC/CwN,EAAG3N,WAAWI,aAAa0S,EAAYnF,EAAGpK,aAGlD,MAAO,CAAEwP,YAAWlX,UAASiX,aAChC,EAtFS,GAwFNyB,EAASxE,EAAIlU,QAEZ6W,IACDphB,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM8Q,EAAI+C,WACV5T,UAAU,KAIlB,IAAIsV,EAAa,GACbC,EAAY,GAEhB,GAAIF,EAAO,GACP,IAAK,IAAI5G,KAAM4G,EAAQ,CACnB,IAAIpb,EAAY7H,KAAKkQ,YAAYmR,GACjChF,EAAGvH,aAAa,KAAMjN,GACtB,IAAIub,EAAK9B,EAAQjF,IAAO,CAAC,EACzB+G,EAAGvb,UAAYwU,EAAG/K,GAClB8R,EAAG7Y,QAAU8R,EAEbA,EAAGnK,gBAAgB,SACnBiR,EAAUliB,KAAKob,EAAG/K,IAClB4R,EAAWjiB,KAAKmiB,EACpB,CAEAF,EAAWviB,QACXX,KAAKiW,UAAU,CAAE,CAACoL,GAAW6B,IAAcxE,MAAK3O,IAC5C,IAAK,IAAI6J,EAAM,EAAGuJ,EAAUxiB,OAASiZ,EAAKA,IAEtC7J,EAAEsR,GAAUzH,GAAK/R,UAAYsb,EAAUvJ,GAG3C,GAAInZ,MAAMC,QAAQqP,EAAEsR,KAActR,EAAEsR,GAAU1gB,OAC1C,IAAK,IAAIyB,KAAK2N,EAAEsR,GAAW,CACvB,IAAIgC,EAAM7Y,SAASC,eAAerI,EAAEyF,WAUpC,GARAwb,EAAIvO,aAAa,KAAM1S,EAAEyF,WACzBwb,EAAIvO,aAAa,kBAAmB,SAEX,mBAAd1S,EAAEse,UACT2C,EAAItO,iBAAiB,QAAS3S,EAAEse,SAChC2C,EAAInY,UAAUjG,IAAI,YAGlB7C,EAAEwI,OAA4B,iBAAZxI,EAAEwI,OAAsBjV,OAAOuN,KAAKd,EAAEwI,OAAOjK,OAC/D,IAAK,IAAImE,KAAK1C,EAAEwI,MACZyY,EAAIzY,MAAMC,YAAY/F,EAAG1C,EAAEwI,MAAM9F,IAGzC9E,KAAK,GAAGqhB,WAAkBpgB,KAAKmB,EACnC,KACLiL,OAAMxM,IACLoU,QAAQC,MAAMrU,EAAI,GAE1B,EAGAb,KAAK+J,cACL8W,EAAQ,WAAWyC,IAEf,IAAItL,EAAIsL,EAAI7U,YAQZ,OAPA6U,EAAIvO,iBAAiB,SAAS,WACrBiD,EAAExX,MAAM,mBACTwX,EAAI,UAAYA,GAEpBjN,OAAOwY,KAAKvL,EAAG,SACnB,IAEO,CAAEsL,IAAKtL,EAAG,IAIrBhY,KAAK8J,cACL+W,EAAQ,WAAW3T,IAEf,IAAIwJ,EAAIxJ,EAAIuB,YACZ,MAAO,CAAEvB,IAAc,MAATwJ,EAAE,GAAaA,EAAE1N,UAAU,GAAK0N,EAAG,IAKzD1W,KAAK8J,cAAe,EACpB9J,KAAK+J,cAAe,CACxB,CAEA,aAAAyZ,CAAc7V,EAAM8V,EAAQzT,GACxB,GAAIrC,GAA0B,IAAlBA,EAAKS,SACb,IAAK,IAAIjH,KAAKsc,EACV,GAAIzT,EAAS,CACT,IAAImK,EAAMxM,EAAKqC,QAAQ7I,GACvB,GAAIwG,EAAKqC,QAAQ7I,GACb,OAAOgT,CACf,MAAO,GACM,MAAThT,EAAE,GAAawG,EAAK2D,KAAOnK,EAAE6B,UAAU,GAC1B,MAAT7B,EAAE,GAAawG,EAAKzC,UAAUC,SAAShE,EAAE6B,UAAU,IAC/C2E,EAAKqB,WAAa7H,EAE1B,OAAO,EAEnB,OAAO,CACX,CAEA,sBAAAoO,CAAuB5H,GAEnB,OADAA,EAA0B,IAAnBA,GAAMS,SAAiBT,EAAKe,WAAaf,EACzC3N,KAAKwjB,cAAc7V,EAAM3N,KAAK2J,yBAAyB,EAClE,CAEA,sBAAA+Q,CAAuB/M,GACnB,OAAO3N,KAAKwjB,cAAc7V,EAAM3N,KAAK4J,+BACzC,CAEA,iBAAAqQ,CAAkBtM,GACd,OAAO3N,KAAKwjB,cAAc7V,EAAM3N,KAAK0J,0BACzC,CAEA,eAAA+Q,CAAgB9M,GACZ,OAAO3N,KAAKwjB,cAAc7V,EAAM3N,KAAKqJ,wBACzC,CAEA,kBAAAqa,CAAmB/V,GACf,OAAO3N,KAAKwjB,cAAc7V,EAAM3N,KAAKwJ,2BACzC,CAEA,mBAAAiN,CAAoB9I,GAEhB,OADAA,EAA0B,IAAnBA,GAAMS,SAAiBT,EAAKe,WAAaf,EACzC3N,KAAKwjB,cAAc7V,EAAM3N,KAAKyJ,4BACzC,CAEA,qBAAAka,CAAsBhW,GAElB,OADAA,EAA0B,IAAnBA,GAAMS,SAAiBT,EAAKe,WAAaf,EACzC3N,KAAKwjB,cAAc7V,EAAM3N,KAAKsJ,8BACzC,CAEA,cAAAwK,CAAenG,GAEX,OADAA,EAA0B,IAAnBA,GAAMS,SAAiBT,EAAKe,WAAaf,GACxC3N,KAAKyW,oBAAoB9I,IAA2B,SAAlBA,EAAKqB,YAAyBhP,KAAK2jB,sBAAsBhW,EACvG,CA8BA,OAAA5B,CAAQ6X,GAEJ,IAAKA,EACD,OAKJ,OAHK5jB,KAAKkK,OACNlK,KAAKkgB,uBAED0D,GACJ,IAAK,QAaD,OAZK5jB,KAAKkK,QAAS,MACf,IAAI/C,EAAInH,KAAKkK,MAAMkH,wBAEnB,OADAjK,EAAmB,IAAfA,EAAEiH,SAAiBjH,EAAEuH,WAAavH,GAC9BA,EAAE6I,QAAQ,IAAMhQ,KAAK6H,UAChC,EAJkB,IAKf7H,KAAKuK,QAAQ1I,aAEjB7B,KAAKmV,kBAAiB,KAClB,IAAIlH,EAAIjO,KAAKwT,wBACTqQ,EAAKrZ,SAASiJ,cAAc,cAChCzT,KAAK2d,QAAQkG,EAAI5V,GAAG,EAAK,IAGjC,IAAK,gBAgBD,OAfKjO,KAAKkK,QAAS,MACf,IAAI/C,EAAInH,KAAKkK,MAAMkH,wBAEnB,OADAjK,EAAmB,IAAfA,EAAEiH,SAAiBjH,EAAEuH,WAAavH,GAC9BA,EAAE6I,QAAQ,IAAMhQ,KAAK6H,UAChC,EAJkB,IAKf7H,KAAKuK,QAAQ1I,aAEjB7B,KAAKmV,kBAAiB,KAClB,IAAIlH,EAAIjO,KAAKwT,wBACTsQ,EAAKtZ,SAASiJ,cAAc,MAC5BsQ,EAAKvZ,SAASiJ,cAAc,MAChCsQ,EAAGtR,OAAOqR,GACV9jB,KAAK2d,QAAQoG,EAAI9V,GAAG,EAAO6V,EAAG,IAItC,IAAK,cAgBD,OAfK9jB,KAAKkK,QAAS,MACf,IAAI/C,EAAInH,KAAKkK,MAAMkH,wBAEnB,OADAjK,EAAmB,IAAfA,EAAEiH,SAAiBjH,EAAEuH,WAAavH,GAC9BA,EAAE6I,QAAQ,IAAMhQ,KAAK6H,UAChC,EAJkB,IAKf7H,KAAKuK,QAAQ1I,aAEjB7B,KAAKmV,kBAAiB,KAClB,IAAIlH,EAAIjO,KAAKwT,wBACTsQ,EAAKtZ,SAASiJ,cAAc,MAC5BsQ,EAAKvZ,SAASiJ,cAAc,MAChCsQ,EAAGtR,OAAOqR,GACV9jB,KAAK2d,QAAQoG,EAAI9V,GAAG,EAAO6V,EAAG,IAItC,IAAK,UAaD,OAZK9jB,KAAKkK,QAAS,MACf,IAAI/C,EAAInH,KAAKkK,MAAMkH,wBAEnB,OADAjK,EAAmB,IAAfA,EAAEiH,SAAiBjH,EAAEuH,WAAavH,GAC9BA,EAAE6I,QAAQ,IAAMhQ,KAAK6H,UAChC,EAJkB,IAKf7H,KAAKuK,QAAQ1I,aAEjB7B,KAAKmV,kBAAiB,KAClB,IAAIlH,EAAIjO,KAAKwT,wBAAyBwQ,EAAKxZ,SAASiJ,cAAc,MAClEuQ,EAAGlP,aAAa,kBAAmB,SACnC9U,KAAK2d,QAAQqG,EAAI/V,GAAG,EAAM,IAGlC,IAAK,QAED,YADAjO,KAAKqU,SAAS4P,QAElB,IAAK,YACL,IAAK,cACL,IAAK,aACD,IAAKjkB,KAAKkK,MACN,OAuDJ,YArDAlK,KAAKmV,kBAAiB,KAClB,IAAIvF,EAAY5P,KAAKkK,MAAM0F,UACvBC,EAAU7P,KAAKkK,MAAM2F,QAErBqU,EAAe,GAGnB,IAFAA,EAAajjB,KAAK2O,GAEXsU,EAAaA,EAAavjB,OAAS,KAAOkP,GAAS,CACtD,IAAIsU,EAAWD,EAAaA,EAAavjB,OAAS,GAAGsR,YAErD,KAAOkS,IAAankB,KAAKyW,oBAAoB0N,IAAW,CACpD,GAAInkB,KAAKia,kBAAkBkK,IAAaA,EAAS7V,YAActO,KAAKyW,oBAAoB0N,EAAS7V,YAAa,CAC1G6V,EAAWA,EAAS7V,WACpB,KACJ,CACA6V,EAAWA,EAASlS,WACxB,CAKA,IAHKkS,GAAYnkB,KAAKia,kBAAkBiK,EAAaA,EAAavjB,OAAS,GAAG+N,cAC1EyV,EAAWD,EAAaA,EAAavjB,OAAS,GAAG+N,WAAWuD,cAE5DkS,EAGA,MAFAD,EAAajjB,KAAKkjB,EAG1B,CAEA,IAAIla,EAAiBtU,OAAOoN,OAAO,CAAC,EAAG/C,KAAKiK,gBAE5C,IAAK,IAAIlF,KAAKmf,EAAc,CACxB,IAAK,IAAI/c,KAAKnH,KAAK6J,WACX9E,EAAEmG,UAAUC,SAAShE,IACrBpC,EAAEmG,UAAU2L,OAAO1P,GACvB8C,EAAe9C,EAAE6B,UAAU,EAAG7B,EAAExG,OAAS,KAAM,EAGnD,GAAe,cAAXijB,IAA2B5jB,KAAKiK,eAAe2Z,GAAS,CACxD,IAAK,IAAIzc,KAAKnH,KAAK6J,WACX1C,EAAErF,SAAS8hB,IACX7e,EAAEmG,UAAUjG,IAAIkC,GAExB8C,EAAe2Z,IAAU,CAC7B,CACJ,CAEA5jB,KAAKiK,eAAiBA,EAEtBjK,KAAKiW,UAAU,CACXhM,iBACAC,MAAOlK,KAAKkK,QACbmD,OAAMxM,GAAOA,GAAI,IAShC,IAAIujB,EACJ,IACIA,EAAU,IAAIxkB,EAAYgkB,GAAQ1f,MAClC0f,EAAS,OACb,CAAE,MACF,CAGI5jB,KAAK4M,kBAAkBgX,GACvB5jB,KAAKmV,kBAAiB,KAClB,IAAI/C,EACAiS,EAAQrkB,KAAK4M,kBAAkBgX,GAC/BU,GAAc,EAEdvJ,EAAW/a,KAAK6M,aAAawX,GAASrkB,KAAK6M,aAAawX,GAAO9e,KAAI4B,GAAKnH,KAAKuT,kBAAkBpM,KAAM,GAOzG,GANI4T,EAAQpa,SACRoa,EAAUA,EAAQnF,OAAOmF,EAAQxV,KAAI4B,GAAKA,EAAI,YAGlDkd,EAAQrkB,KAAKuT,kBAAkB8Q,GAE3BrkB,KAAKiK,eAAe2Z,GAAS,CAC7B,IAAIW,EAGAA,EADW,UAAXX,GACOQ,IAAYpkB,KAAKiK,eAAe2Z,SACvBY,IAAZJ,GAAyBpkB,KAAKiK,eAAe2Z,KAAY5jB,KAAK2K,YAAY,mBAI9E4Z,IACAF,EAAQrkB,KAAKuT,kBAAkB8Q,EAAQ,SACvCC,GAAc,EAEtB,CAGiB,MAAbD,EAAM,IACNjS,EAAU5H,SAASiJ,cAAc,QACjCrB,EAAQlH,UAAUjG,IAAIof,EAAMrb,UAAU,KAEtCoJ,EAAU5H,SAASiJ,cAAc4Q,GAEjCD,IAAYE,IACZlS,EAAQxH,MAAM9K,MAAQskB,GAE1B,IAAIK,EAAkBzkB,KAAKqT,oCAC3B,GAAIrT,KAAKkK,MAAMuL,UAAW,CACtB,GAAIgP,EACA,OAEJ,IAAI7V,EAAOpE,SAASqE,eAAe,IAEnCuD,EAAQK,OAAO7D,GAE4B,OAAvC5O,KAAKkK,MAAMmF,eAAeL,SAC1BhP,KAAKkK,MAAMmF,eAAeX,WAAWI,aAAasD,EAASpS,KAAKkK,MAAMmF,gBAEtErP,KAAKkK,MAAMqN,WAAWnF,GAE1BpS,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAAEK,KAAMiB,EAAMhB,UAAU,GAE/D,KAAO,CACH,GAAI6W,EAKA,YAJAzkB,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM3N,KAAKkK,MAAMqF,aACjB3B,SAAU5N,KAAKkK,MAAMsF,aAK7B,IAAIpO,EAAUpB,KAAKkK,MAAM+N,kBACrByM,EAAOla,SAASiJ,cAAc,QAElC,KAAOrS,EAAQ2N,WAAW,IACtB2V,EAAKjS,OAAOrR,EAAQ2N,WAAW,IAanC,IAXA/O,KAAKwO,cAAa7I,IACd,IAAI8Y,EAAMgG,EAAkBzkB,KAAKuT,kBAAkBkR,GAAmB,KAClEtD,EAAqB,IAAfxb,EAAEyI,SAAiBzI,EAAE+I,WAAa/I,EACxCwY,KAAaM,IAAO0C,EAAIjrB,eAAe,aAAairB,EAAInR,QAAQyO,GAKpE,OAHmB,IAAf9Y,EAAEyI,UAAmB+P,IACrBxY,EAAE8I,YAAc9I,EAAE8I,YAAYkW,WAAW,KAAM,KAE5Chf,CAAC,GACT,CAAEgI,KAAM+W,EAAMxT,sBAAsB,EAAMxC,WAAY1O,KAAKuK,UAEvDma,EAAK3V,WAAW,IACnB3N,EAAQqR,OAAOiS,EAAK3V,WAAW,IAGnC,IAAI6V,EAAe,CAACP,GAGpB,GAAIC,EAAa,CACb,IAAIO,EAAMR,EAAMtM,QAAQ,QAAS,IAAI/O,UAAU,GAC/C6b,EAAiB,MAAXA,EAAI,GAAa,IAAMA,EAAMA,EACnCD,EAAa3jB,KAAK4jB,EACtB,KAAO,CACH,IAAIA,EAAMR,EAAQ,QAClBQ,EAAiB,MAAXA,EAAI,GAAaA,EAAM,IAAMA,EACnCD,EAAa3jB,KAAK4jB,EACtB,CAEAD,EAAeA,EAAahP,OAAOmF,GACnC,IAAI+J,EAAM1jB,EAAQ2jB,iBAAiBH,EAAaI,QAC5CpL,EAAMkL,EAAInkB,OACd,GAAIiZ,EACA,KAAOA,KACH5Z,KAAKmS,UAAU2S,EAAIlL,IAG3B,IAAIqL,EAAe,CAAC7S,EAAQsG,WAAU,IAEtC,KAAOtX,EAAQ2N,WAAW,IAAI,CAC1B,IAAI2D,EAAQtR,EAAQ2N,WAAW,GAE/B,GAAuB,IAAnB2D,EAAMtE,UAAkBpO,KAAKya,gBAAgB/H,GAAQ,CAGrD,GAFW1S,KAAK0jB,mBAAmBhR,GAEzB,CACN,IAAK,IAAIkH,EAAM,EAAGlH,EAAM3D,WAAWpO,OAASiZ,EAAKA,IAAO,CACpD,IAAIhL,EAAO8D,EAAM3D,WAAW6K,GAE5B,GAAI5Z,KAAK8T,eAAelF,GAAO,CAC3B,IAAIsW,EAAgB9S,EAAQsG,WAAU,GACtC,KAAO9J,EAAKG,WAAW,IACfH,EAAKG,WAAW,GAAGN,YACnByW,EAAczS,OAAO7D,EAAKG,WAAW,IAErCH,EAAKG,WAAW,GAAG8H,SAE3BjI,EAAK6D,OAAOyS,EAChB,CACJ,CAEA,IAAKxS,EAAMjE,YAAa,CACpBiE,EAAMmE,SACN,QACJ,CACJ,CAEA,IAAIc,EAAMnN,SAASoN,yBACnBD,EAAIlF,OAAOC,GACXuS,EAAahkB,KAAK0W,EAEtB,MAEI,GAAuB,IAAnBjF,EAAMtE,UAAkBpO,KAAKyW,oBAAoB/D,GAAQ,CACzD,IAAIwS,EAAgB9S,EAAQsG,WAAU,GAEtC,KAAOhG,EAAM3D,WAAW,IACpBmW,EAAczS,OAAOC,EAAM3D,WAAW,IAE1C,GACwC,IAApCmW,EAAcnW,WAAWpO,QACgB,OAAzCukB,EAAcnW,WAAW,GAAGC,WAC3BkW,EAAczW,YAAY9N,OAAQ,CACnC+R,EAAMmE,SACN,QACJ,CAEAnE,EAAMD,OAAOyS,GACb,IAAIvN,EAAMnN,SAASoN,yBACnBD,EAAIlF,OAAOC,GACXuS,EAAahkB,KAAK0W,EAEtB,MACIsN,EAAaA,EAAatkB,OAAS,GAAG8R,OAAOC,EAEzD,CAEA,IAAI1B,EAASxG,SAASoN,yBACtB,IAAK,IAAIuN,KAAMF,EACXjU,EAAOyB,OAAO0S,GAElB,IAAI7G,EAAKtN,EAAO1C,WACZ8W,EAAKpU,EAAO3C,UAEhB,GAAIrO,KAAK8T,eAAewK,KAAQA,EAAG7P,YAAa,CAC5C,IAAI4W,EAAK/G,EAAGrM,YACZqM,EAAGzH,SACHyH,EAAK+G,CACT,CACA,GAAIrlB,KAAK8T,eAAesR,KAAQ9G,EAAG7P,YAAa,CAC5C,IAAI6W,EAAKF,EAAGnT,YACZmT,EAAGvO,SACHuO,EAAKE,CACT,CAEAtlB,KAAKkK,MAAMqN,WAAWvG,GACtBhR,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM,CAAC2Q,EAAI8G,GACXxX,SAAU,EAAC,GAAM,KAIrB0Q,EAAqB,IAAhBA,EAAGlQ,SAAiBkQ,EAAG5P,WAAa4P,EACzC8G,EAAqB,IAAhBA,EAAGhX,SAAiBgX,EAAG1W,WAAa0W,EAEzC,IAAInH,EAAOmH,EAAGnT,aACVjS,KAAK8T,eAAemK,IAAWA,EAAKxP,aAAoC,MAArBwP,EAAKxP,aACxDwP,EAAKpH,SAET,IAAI0O,EAAOjH,EAAGrP,iBACVjP,KAAK8T,eAAeyR,KAAUA,EAAK9W,aAAoC,MAArB8W,EAAK9W,cACvD8W,EAAK1O,QACb,KAOc,iBAAX+M,GAUP5jB,KAAKmV,kBAAiB,KAElB,IAAIqQ,EAAShb,SAASiJ,cAAc,OAIpC,GAHA+R,EAAOta,UAAUjG,IAAI,YACrBugB,EAAO1Q,aAAa,mBAAmB,GAEnC8O,EAAOhZ,MACP,IAAK,IAAI9F,KAAK8e,EAAOhZ,MACjB4a,EAAO5a,MAAM9F,GAAK8e,EAAOhZ,MAAM9F,GAEvC8e,EAAO/b,UAAY+b,EAAO/b,WAAa7H,KAAKkQ,YAAY,UACxDsV,EAAOlU,GAAKsS,EAAO/b,UAEW,iBAAnB+b,EAAOrZ,QACdib,EAAO9a,UAAYkZ,EAAOrZ,QAErBqZ,EAAOrZ,mBAAmBkb,aAC/BD,EAAO/S,OAAOmR,EAAOrZ,SAEpBib,EAAOzS,SAASpS,SACjBijB,EAAO8B,QAAS,GAEf1lB,KAAKkK,OACNlK,KAAKuK,QAAQ1I,QAEjB7B,KAAKoJ,aAAanI,KAAK2iB,GAEvB5jB,KAAKiW,UAAU,CAAEuP,OAAQ5B,IAAUlF,MAAKtF,IAChCwK,EAAO8B,QACP1lB,KAAKkK,MAAMqN,WAAWiO,GACtBxlB,KAAKkK,MAAQlK,KAAKsN,iBAAiB,CAC/BK,KAAM6X,EACN5X,UAAU,KAGd5N,KAAK2d,QAAQ6H,EAAQxlB,KAAKwT,yBAAyB,EAAM,GAC/D,GAGd,CAKA,oBAAA0M,GACI,GAAIlgB,KAAKgK,aAAc,CACnBhK,KAAKkK,MAAQlK,KAAKsN,iBACd,CACIK,KAAM,CAAC3N,KAAKgK,aAAaqF,eAAgBrP,KAAKgK,aAAauF,cAC3D3B,SAAU,CAAC5N,KAAKgK,aAAasF,YAAatP,KAAKgK,aAAawF,aAEpE,IAAI3B,EAAM9C,OAAO+C,eACb5D,EAAQM,SAASwD,cACrB9D,EAAMkF,SAASpP,KAAKkK,MAAMmF,eAAgBrP,KAAKkK,MAAMoF,aACrDpF,EAAMgF,OAAOlP,KAAKkK,MAAMqF,aAAcvP,KAAKkK,MAAMsF,WACjD3B,EAAI6B,kBACJ7B,EAAI8B,SAASzF,EACjB,CACJ,CAOA,cAAMkD,CAASlF,EAAOlI,KAAKkI,KAAMJ,GAAW,GACxC9H,KAAK2lB,aAAY,GACjB3lB,KAAKkI,KAAOA,GAAQ,GACpB,MAAM0d,EAAMpb,SAASiJ,cAAc,OACnCmS,EAAIlb,UAAYxC,EAGhB,MAAMqX,EAAMqG,EAAIb,iBAAiB,OAC3Bc,EAAc,GACpB,GAAItG,EAAI5e,OACJ,IAAK,IAAItL,KAAKkqB,EAAK,CAGf,GAFoBlqB,EAAE2a,QAAQ,YAEb,CACb,MAAMsP,EAASjqB,EAAEsZ,aAAa,OAC9B,IAAImX,EAAQzwB,EAAEic,IAAMtR,KAAKkQ,YAAY,OACrC7a,EAAEyf,aAAa,KAAMgR,GAErBD,EAAY5kB,KAAK,CACbqe,SACAzX,UAAWie,EACXvb,QAASlV,GAEjB,CAEA2K,KAAKiJ,YAAc8c,KAAKC,MAAMD,KAAKE,UAAUJ,GACjD,CAGJ,MAAMpd,EAAUmd,EAAIb,iBAAiB,cAC/BmB,EAAkB,GACxB,GAAIzd,EAAQ9H,OACR,IAAK,IAAItL,KAAKoT,EAAS,CACnB,IACIyE,EADAiZ,EAAQ9wB,EAAE6V,UAAUvK,OACfkH,EAAYxS,EAAEic,IAAMtR,KAAKkQ,YAAY,WAC9C,KAAOiW,KAAS,CACZ,IAAIxS,EAAMte,EAAE6V,UAAUib,GACkB,MAApCxS,EAAIoE,QAAQ,YAAa,IAAI,KAC7B7K,EAAMyG,EAAIoE,QAAQ,YAAa,IAEvC,CACA7K,EAAmB,MAAbA,IAAM,GAAaA,EAAIlE,UAAU,GAAKkE,EACxCA,GACAgZ,EAAgBjlB,KAAK,CAAEiM,MAAKrF,YAAW0C,QAASlV,GACxD,CAGJ,MAAMqT,EAAUkd,EAAIb,iBAAiB,cAC/BqB,EAAkB,GACxB,GAAI1d,EAAQ/H,OACR,IAAK,IAAItL,KAAKqT,EAAS,CACnB,IACI4a,EADAzb,EAAYxS,EAAEic,IAAMtR,KAAKkQ,YAAY,WAGrCiW,EAAQ9wB,EAAE6V,UAAUvK,OACxB,KAAOwlB,KAAS,CACZ,IAAIxS,EAAMte,EAAE6V,UAAUib,GAClBxS,EAAI7R,SAAS,aAAanB,SAC1B2iB,EAAM3P,EAAIoE,QAAQ,YAAa,IAEvC,CACIuL,GACA8C,EAAgBnlB,KAAK,CAAEqiB,MAAKzb,YAAW0C,QAASlV,GACxD,CAEJ,MAAMmwB,EAASI,EAAIb,iBAAiB,aAC9BsB,EAAiB,GACvB,GAAIb,EAAO7kB,OACP,IAAK,IAAItL,KAAKmwB,EAAQ,CAClB,IAAI3d,EAAYxS,EAAEic,IAAMtR,KAAKkQ,YAAY,UACzCmW,EAAeplB,KAAK,CAAE4G,YAAW0C,QAASlV,GAC9C,CAEJ,IAAIixB,QAAWtmB,KAAKiW,UAAU,CAC1B4I,MAAOgH,EACPpd,QAASyd,EACTxd,QAAS0d,EACTZ,OAAQa,IAIZ,IAAK,IAAIlH,KAAKmH,EACV,GAAU,UAANnH,EAAe,CACf,IAAII,EAAM+G,EAAGnH,GACb,IAAK,IAAI9pB,KAAKkqB,EAAK,CAEf,MAAMgH,EADMX,EAAIY,cAAc,IAAMnxB,EAAEwS,WACZmI,QAAQ,YAClChQ,KAAKogB,WAAW/qB,EAAGkxB,EACvB,CACJ,MACIvmB,KAAKmf,EAAI,UAAYmH,EAAGnH,GAKhC,IAFAnf,KAAKuK,QAAQG,UAAY,GAElBkb,EAAI7W,WAAW,IAClB/O,KAAKuK,QAAQkI,OAAOmT,EAAI7W,WAAW,IAEnCjH,GACA9H,KAAK2lB,aAAY,EACzB,CAOA,YAAM,CAAOc,GACTzmB,KAAKyX,oBAAmB,GACxB,MAAM4L,EAAMrjB,KAAKuK,QAAQmO,WAAU,IAE7B,cAAExP,EAAa,YAAED,EAAW,cAAEE,EAAa,aAAEC,GAAiBpJ,KACpE,IAAI0mB,EAAQ,GACR9X,EAAO,GAEP+X,EAAQ,CACRtD,MACA3a,QAAS1I,KAAK0I,QAAUS,OAAgBqb,EACxC/b,QAASzI,KAAKyI,QAAUS,OAAgBsb,EACxC3F,MAAO5V,EACPuc,OAAQpc,GAGZ,GAAmB,mBAARqd,EAAoB,CAC3B,IAAIG,EAAeH,EAAIE,GAGnBA,EADAC,aAAwBpI,cACVoI,GAAgBD,EACrBC,GAAgBD,EAEzB3mB,KAAKyI,UACLzI,KAAKkJ,cAAgByd,EAAMle,SAC3BzI,KAAK0I,UACL1I,KAAKmJ,cAAgBwd,EAAMje,SAE/B1I,KAAKiJ,YAAc0d,EAAM9H,MACzB7e,KAAKoJ,aAAeud,EAAMnB,OAC1BkB,EAAQC,EAAMD,OAAS,EAC3B,CAEA,MAAMG,EAAQF,EAAMtD,IAAI0B,iBAAiB,cAGzC,IAAK,IAAI+B,EAAM,EAAGA,EAAMD,EAAMlmB,OAAQmmB,IAAO,CACzC,IAAIpU,EAAQmU,EAAMC,GAClB,GAAIpU,EAAMjE,YAAY9N,OAAQ,CAE1B,IAAIomB,EAAYrU,EAAMjE,YACtB,GAAKiY,EAmCD9X,GAAQ,GAAGmY,UAnCH,CACR,IAOIhW,EAPAiW,EAAmB,qCACnBC,EAAWF,EAAUvmB,MAAMwmB,GAO/B,GAAIC,EAAU,CACV,IAAK,IAAI5xB,EAAI,EAAGA,EAAI4xB,EAAStmB,OAAQtL,IACjC0xB,EAAYA,EAAUhP,QAAQkP,EAAS5xB,GAAG0iB,QAAQ,OAAQ,IAAK,UAAY1iB,EAAI,YAGnF0b,EAAQgW,EAAUhW,MAAM,KAExB,IAAK,IAAI1b,EAAI,EAAGA,EAAI0b,EAAMpQ,OAAQtL,IAC9B,IAAK,IAAI6xB,EAAI,EAAGA,EAAID,EAAStmB,OAAQumB,IACjCnW,EAAM1b,GAAK0b,EAAM1b,GAAG0iB,QAAQ,UAAYmP,EAAI,WAAYD,EAASC,GAAGnP,QAAQ,OAAQ,IAIhG,MACIhH,EAAQgW,EAAUhW,MAAM,KAE5B2V,EAAQ3V,EAAM,GACV2V,EAAM/lB,OAAS,MACfiO,GAAQ8X,EAAM1d,UAAU,KAAO,IAC/B0d,EAAQA,EAAM1d,UAAU,EAAG,MAG/B+H,EAAMqF,QACN2Q,EAAYhW,EAAMiU,KAAK,KAAKjN,QAAQ,SAAU,KAC9CnJ,GAAQmY,EAAY,GACxB,CAEJ,CAEA,GAAIrU,EAAMxH,UAAUC,SAAS,WAAY,CACrC,IAAIyO,EAAMlH,EAAM3D,WAAWpO,OAC3B,KAAOiZ,KAAO,CACV,IAAIzS,EAAIuL,EAAM3D,WAAW6K,GACzB,GAAmB,QAAfzS,EAAE6H,SACF,IAAK,MAAMmQ,KAAKnf,KAAKiJ,YACjB,GAAIkW,EAAEtX,YAAcV,EAAEmK,IAAM6N,EAAEG,SAAWnY,EAAEwH,aAAa,OAAQ,CAC5DxH,EAAE2N,aAAa,MAAOqK,EAAEG,QACxB,IAAIrE,EAAO9T,EAAE+D,UAAUvK,OACvB,KAAOsa,KACH,GAAI9T,EAAE+D,UAAU+P,GAAMnZ,SAAS,UAAYqF,EAAE+D,UAAU+P,GAAMta,OAAS,EAAG,CACrEwG,EAAE+D,UAAU2L,OAAO1P,EAAE+D,UAAU+P,IAC/B,IAAIkM,EAAWhI,EAAEG,OAAOvO,MAAM,KAC1BqW,EAAYD,EAASA,EAASxmB,OAAS,GACvC0mB,EAAmBD,EAAUzmB,OAAS,GAC1C,MAAM2mB,EAAaH,EAASA,EAASxmB,OAAS,GAAGqI,UAAUqe,EAAmB,EAAID,EAAY,GAC9FjgB,EAAE+D,UAAUjG,IAAI,QAAUqiB,EAC9B,CAER,CAGZ,CACJ,CACJ,CAEA,MAAO,CACHpf,KAAMye,EAAMtD,IAAI3Y,UAChBgc,MAAOA,EAAMa,OACb3Y,KAAMA,EAAK2Y,OACX7e,QAAS1I,KAAK0I,QAAU1I,KAAKmJ,mBAAgBqb,EAC7C/b,QAASzI,KAAKyI,QAAUzI,KAAKkJ,mBAAgBsb,EAC7C3F,MAAO7e,KAAKiJ,YACZuc,OAAQxlB,KAAKoJ,aAErB,CAMA,cAAAgC,CAAe6C,GACPjO,KAAKuK,UACD0D,GAAkB,iBAANA,EAAgBjO,KAAKuK,QAAQuK,aAAa,cAAe7G,GACpEjO,KAAKuK,QAAQ2H,gBAAgB,eAE1C,CAMA,aAAA7G,CAAcmc,GACNxnB,KAAKuK,SACLvK,KAAKuK,QAAQuK,aAAa,aAAc0S,EAAO,KAAO,MAC9D,CAMA,WAAA7B,CAAY6B,GACRA,IAAOxnB,KAAKuK,SAAUid,EAElBxnB,KAAKuK,SACLvK,KAAKuK,QAAQuK,aAAa,kBAAmBiR,KAAKE,UAAUuB,IAEhExnB,KAAKiU,kBAAkBuT,GACvBxnB,KAAKmY,iBAAiBqP,EAC1B,YNvmGJ","sources":["webpack://wysiwyg4all/webpack/universalModuleDefinition","webpack://wysiwyg4all/webpack/bootstrap","webpack://wysiwyg4all/webpack/runtime/define property getters","webpack://wysiwyg4all/webpack/runtime/hasOwnProperty shorthand","webpack://wysiwyg4all/webpack/runtime/make namespace object","webpack://wysiwyg4all/./node_modules/colormangle/colormangle.js","webpack://wysiwyg4all/./wysiwyg4all.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const colorNames = {\n    aliceblue: \"#f0f8ff\",\n    antiquewhite: \"#faebd7\",\n    aqua: \"#00ffff\",\n    aquamarine: \"#7fffd4\",\n    azure: \"#f0ffff\",\n    beige: \"#f5f5dc\",\n    bisque: \"#ffe4c4\",\n    black: \"#000000\",\n    blanchedalmond: \"#ffebcd\",\n    blue: \"#0000ff\",\n    blueviolet: \"#8a2be2\",\n    brown: \"#a52a2a\",\n    burlywood: \"#deb887\",\n    cadetblue: \"#5f9ea0\",\n    chartreuse: \"#7fff00\",\n    chocolate: \"#d2691e\",\n    coral: \"#ff7f50\",\n    cornflowerblue: \"#6495ed\",\n    cornsilk: \"#fff8dc\",\n    crimson: \"#dc143c\",\n    cyan: \"#00ffff\",\n    darkblue: \"#00008b\",\n    darkcyan: \"#008b8b\",\n    darkgoldenrod: \"#b8860b\",\n    darkgray: \"#a9a9a9\",\n    darkgreen: \"#006400\",\n    darkgrey: \"#a9a9a9\",\n    darkkhaki: \"#bdb76b\",\n    darkmagenta: \"#8b008b\",\n    darkolivegreen: \"#556b2f\",\n    darkorange: \"#ff8c00\",\n    darkorchid: \"#9932cc\",\n    darkred: \"#8b0000\",\n    darksalmon: \"#e9967a\",\n    darkseagreen: \"#8fbc8f\",\n    darkslateblue: \"#483d8b\",\n    darkslategray: \"#2f4f4f\",\n    darkslategrey: \"#2f4f4f\",\n    darkturquoise: \"#00ced1\",\n    darkviolet: \"#9400d3\",\n    deeppink: \"#ff1493\",\n    deepskyblue: \"#00bfff\",\n    dimgray: \"#696969\",\n    dimgrey: \"#696969\",\n    dodgerblue: \"#1e90ff\",\n    firebrick: \"#b22222\",\n    floralwhite: \"#fffaf0\",\n    forestgreen: \"#228b22\",\n    fuchsia: \"#ff00ff\",\n    gainsboro: \"#dcdcdc\",\n    ghostwhite: \"#f8f8ff\",\n    goldenrod: \"#daa520\",\n    gold: \"#ffd700\",\n    gray: \"#808080\",\n    green: \"#008000\",\n    greenyellow: \"#adff2f\",\n    grey: \"#808080\",\n    honeydew: \"#f0fff0\",\n    hotpink: \"#ff69b4\",\n    indianred: \"#cd5c5c\",\n    indigo: \"#4b0082\",\n    ivory: \"#fffff0\",\n    khaki: \"#f0e68c\",\n    lavenderblush: \"#fff0f5\",\n    lavender: \"#e6e6fa\",\n    lawngreen: \"#7cfc00\",\n    lemonchiffon: \"#fffacd\",\n    lightblue: \"#add8e6\",\n    lightcoral: \"#f08080\",\n    lightcyan: \"#e0ffff\",\n    lightgoldenrodyellow: \"#fafad2\",\n    lightgray: \"#d3d3d3\",\n    lightgreen: \"#90ee90\",\n    lightgrey: \"#d3d3d3\",\n    lightpink: \"#ffb6c1\",\n    lightsalmon: \"#ffa07a\",\n    lightseagreen: \"#20b2aa\",\n    lightskyblue: \"#87cefa\",\n    lightslategray: \"#778899\",\n    lightslategrey: \"#778899\",\n    lightsteelblue: \"#b0c4de\",\n    lightyellow: \"#ffffe0\",\n    lime: \"#00ff00\",\n    limegreen: \"#32cd32\",\n    linen: \"#faf0e6\",\n    magenta: \"#ff00ff\",\n    maroon: \"#800000\",\n    mediumaquamarine: \"#66cdaa\",\n    mediumblue: \"#0000cd\",\n    mediumorchid: \"#ba55d3\",\n    mediumpurple: \"#9370db\",\n    mediumseagreen: \"#3cb371\",\n    mediumslateblue: \"#7b68ee\",\n    mediumspringgreen: \"#00fa9a\",\n    mediumturquoise: \"#48d1cc\",\n    mediumvioletred: \"#c71585\",\n    midnightblue: \"#191970\",\n    mintcream: \"#f5fffa\",\n    mistyrose: \"#ffe4e1\",\n    moccasin: \"#ffe4b5\",\n    navajowhite: \"#ffdead\",\n    navy: \"#000080\",\n    oldlace: \"#fdf5e6\",\n    olive: \"#808000\",\n    olivedrab: \"#6b8e23\",\n    orange: \"#ffa500\",\n    orangered: \"#ff4500\",\n    orchid: \"#da70d6\",\n    palegoldenrod: \"#eee8aa\",\n    palegreen: \"#98fb98\",\n    paleturquoise: \"#afeeee\",\n    palevioletred: \"#db7093\",\n    papayawhip: \"#ffefd5\",\n    peachpuff: \"#ffdab9\",\n    peru: \"#cd853f\",\n    pink: \"#ffc0cb\",\n    plum: \"#dda0dd\",\n    powderblue: \"#b0e0e6\",\n    purple: \"#800080\",\n    rebeccapurple: \"#663399\",\n    red: \"#ff0000\",\n    rosybrown: \"#bc8f8f\",\n    royalblue: \"#4169e1\",\n    saddlebrown: \"#8b4513\",\n    salmon: \"#fa8072\",\n    sandybrown: \"#f4a460\",\n    seagreen: \"#2e8b57\",\n    seashell: \"#fff5ee\",\n    sienna: \"#a0522d\",\n    silver: \"#c0c0c0\",\n    skyblue: \"#87ceeb\",\n    slateblue: \"#6a5acd\",\n    slategray: \"#708090\",\n    slategrey: \"#708090\",\n    snow: \"#fffafa\",\n    springgreen: \"#00ff7f\",\n    steelblue: \"#4682b4\",\n    tan: \"#d2b48c\",\n    teal: \"#008080\",\n    thistle: \"#d8bfd8\",\n    tomato: \"#ff6347\",\n    turquoise: \"#40e0d0\",\n    violet: \"#ee82ee\",\n    wheat: \"#f5deb3\",\n    white: \"#ffffff\",\n    whitesmoke: \"#f5f5f5\",\n    yellow: \"#ffff00\",\n    yellowgreen: \"#9acd32\",\n};\n\nclass ColorMangle {\n    /**\n     * @param {string} [color='#4848db'] - Argument string can be either color name string or any type of HTML color codes (hex, rgb, hsl).\n     */\n    constructor(color = '#4848db', fineTuned = true) {\n        this.fineTuned = fineTuned;\n\n        let format = this._colorType(color);\n        this.type = format.type;\n        this.color = format.color;\n    }\n\n    _colorType(color = this.color, throwErr = true) {\n        let chkType, type;\n\n        try {\n            if (!color)\n                throw 'invalid color';\n\n            if (typeof color === 'object' && color.string)\n                color = color.string;\n\n            if (typeof color === 'string')\n                color = color.toLowerCase();\n            else\n                throw 'invalid color';\n\n            if (color === this.color)\n                return { type: this.type, color: this.color };\n\n            if (colorNames[color])\n                return { type: 'hex', color: colorNames[color] };\n\n            chkType = color.match(/^(rgba?|rgb?|hsla?|#)/g);\n\n            if (Array.isArray(chkType)) {\n\n                if (chkType[0] === '#') {\n\n                    if (color.length === 4)\n                        // convert shorthand hex\n                        color = color[0] + color[1] + color[1] + color[2] + color[2] + color[3] + color[3];\n\n                    if (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(color))\n                        // is valid hex\n                        type = 'hex';\n\n                    else\n                        throw 'invalid hex';\n\n                } else if (color[color.length - 1] === ')')\n                    // hex, rgb, rgba, hsl, hsla\n                    type = chkType[0];\n\n                return { type, color };\n\n            }\n\n        } catch (err) {\n            if (throwErr)\n                throw err + ':' + color;\n        }\n\n        return {};\n    }\n\n    _extractDigit(color_arg = this.color) {\n        let { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type === 'hex')\n            color = this.rgba(1, color).string;\n\n        const value = [];\n\n        for (const i of color.match(/\\d+(\\.\\d+)?/g))\n            value.push(parseFloat(i));\n\n        if (value.length < 4) value.push(1);\n\n        return value;\n    }\n\n    /**\n     * @return {number} - Retrieves color alpha value (range 0 ~ 1)\n     */\n    getAlpha(color_arg = this.color) {\n        let extract = this._extractDigit(color_arg);\n        return extract ? extract[3] || 1 : 1;\n    }\n\n    /**\n     * Generates color scheme object.\n     * @typedef {Object} colorScheme\n     * @property {string} --alert\n     * @property {string} --alert-text\n     * @property {string} --analogous\n     * @property {string} --analogous-text\n     * @property {string} --background\n     * @property {string} --background-focus\n     * @property {string} --background-focus-text\n     * @property {string} --background-text\n     * @property {string} --background-text_focus\n     * @property {string} --button\n     * @property {string} --button-text\n     * @property {string} --complementary\n     * @property {string} --complementary-text\n     * @property {string} --content\n     * @property {string} --content-focus\n     * @property {string} --content-focus-text\n     * @property {string} --content-text\n     * @property {string} --content-text_focus\n     * @property {string} --focus\n     * @property {string} --focus-text\n     * @property {string} --placeholder\n     * @property {string} --saturate\n     * @property {string} --saturate-text\n     * @property {string} --success\n     * @property {string} --success-text\n     * @property {string} --text-button\n     * @param {string} [color=this.color] - Focus color for color scheme\n     * @param {boolean} [darkMode=false] - Dark mode when true\n     * @return {colorScheme} - { [&lt;CSS Variable names&gt;] : &lt;string | HTML color string&gt; }\n     */\n    colorScheme(color = this.color, darkMode = false) {\n\n        let opacity = {\n            text: { black: 0.88, white: 1 },\n            // soft: { black: 0.66, white: 0.88 },\n            placeholder: { black: 0.44, white: 0.55 },\n            // transparent: { black: 0.22, white: 0.33 },\n            // shade: { black: 0.066, white: 0.11 },\n            // shadow: { black: 0.033, white: 0.066 }\n        };\n\n        let template = {\n            '--background': darkMode ? '#121212' : '#f7f7f7',\n            '--content': darkMode ? '#2b2b2b' : '#ffffff',\n            // '--toolbar': darkMode ? '#2b2b2b' : '#ffffff'\n        };\n\n        let focusOriginal;\n        let focusSat;\n        let content_isHighLuminance = this.isHighLuminance(template['--content']);\n        let focus = (() => {\n            if (color && typeof color === 'object') {\n                if (color['--button']) {\n                    focusOriginal = color['--button'];\n                    return focusOriginal;\n                }\n                for (let key of color)\n                    if (key.includes('focus')) {\n                        focusOriginal = color[key];\n                        return focusOriginal;\n                    }\n            }\n\n            focusOriginal = color;\n            focusSat = this.matchLuminance(color, template['--content'], content_isHighLuminance ? 1.5 : 4.5);\n            return darkMode ? focusSat : color;\n        })();\n\n        let compDir = 1;\n        let analogous = (() => {\n            let deg = 30;\n            let analogous = this.analogous(focusOriginal, deg);\n            let focusHSL = this.hsla(1, focusOriginal).h;\n            let an1HSL = this.hsla(1, analogous[0]).h;\n            let an2HSL = this.hsla(1, analogous[1]).h;\n\n            if (focusHSL + deg > 360)\n                an1HSL = an1HSL + 360;\n            if (focusHSL - deg < 0)\n                an2HSL = 360 - an2HSL;\n\n            if (Math.abs(focusHSL - an1HSL) > Math.abs(focusHSL - an2HSL)) {\n                compDir = -1;\n                return analogous[1];\n            }\n\n            return analogous[0];\n        })();\n\n        let complementary = this.matchLuminance(this.complementary(focus, 60 * compDir), template['--background'], 3.1);\n        let fixedValue = {\n            // '--shadow': 'rgba(0, 0, 0, 0.033)',\n            // '--shade': 'rgba(0, 0, 0, 0.066)',\n            // '--transparent': 'rgba(0, 0, 0, 0.22)',\n            '--placeholder': darkMode ? 'rgba(255, 255, 255, 0.55)' : 'rgba(0, 0, 0, 0.44)'\n        };\n\n        let darkModeAnalogous = darkMode ? this.matchLuminance(analogous, template['--background'], 4.5) : analogous;\n        let analogousNude = this.matchLuminance(analogous, template['--background'], 4.5);\n\n        for (let k in template) {\n            template[k + '-text'] = this.textColor(opacity.text, template[k]);\n            template[k + '-focus'] = k.includes('--background') ? darkModeAnalogous : focus;\n            template[k + '-text_focus'] = k.includes('--background') ? analogousNude : this.matchLuminance(darkMode ? focus : focusSat, template[k], 1.66);\n            template[k + '-focus-text'] = this.textColor(1, k.includes('--background') ? darkModeAnalogous : focus);\n        }\n\n        template['--focus'] = focusOriginal;\n        template['--focus-text'] = this.textColor(1, focusOriginal);\n        template['--saturate'] = focusSat;\n        template['--saturate-text'] = this.textColor(1, focusSat);\n\n        Object.assign(template, {\n            '--complementary': complementary,\n            '--complementary-text': this.textColor(1, complementary),\n            '--analogous': analogous,\n            '--analogous-text': this.textColor(1, analogous),\n            '--alert': 'tomato',\n            // '--alert-text': 'white',\n            '--success': 'limegreen',\n            // '--success-text': 'black',\n            '--button': focus,\n            '--text-button': darkMode ? this.matchLuminance(focusSat, template[\"--content\"], 7) : this.contrastRatio(template[\"--content\"], focusSat) < 4.5 ? \"inherit\" : focusSat,\n            '--button-text': this.textColor(1, focus)\n        });\n\n        // for (let k in template) {\n        //     if (!template[k] || template[k] === \"\")\n        //         continue;\n\n        //     let highLum = this.isHighLuminance(template[k]);\n        //     for (let op of ['soft', 'placeholder', 'transparent', 'shadow', 'shade']) {\n\n        //         template[k + '_' + op] = this.rgba(opacity[op][highLum ? 'white' : 'black'], template[k]).string;\n        //     }\n        // }\n\n        // template['--button-border'] = (() => {\n        //     let focus_isHighLuminance = this.isHighLuminance(focus);\n        //     let border = this.matchLuminance(this.adjustLuminance(-1, template['--button']), template['--button'], 1.15, -1, focus_isHighLuminance ? 'luminance' : 'brightness');\n        //     return focus_isHighLuminance ? this.rgba(0.5, border).string : border;\n        // })();\n\n        if (color && typeof color === 'object') {\n            for (let key of color)\n                if (key[0] !== '-')\n                    throw 'invalid color scheme';\n            Object.assign(template, color);\n        }\n\n        let unordered = Object.assign(template, fixedValue);\n        return Object.keys(unordered).sort().reduce(\n            (obj, key) => {\n                obj[key] = unordered[key];\n                return obj;\n            },\n            {}\n        );\n    }\n\n    /**\n     * Match luminance of target_color with base color\n     * @param {string} target_color - Target color\n     * @param {string} [color_arg=this.color] - Base color\n     * @param {number} [target_ratio] - Set contrast ratio difference\n     * @param {number} [direction] - Adjust direction. Adjust to darker luminance when -1. Brighter when 1, otherwise auto.\n     * @param {string} [method] - Luminance adjustment mode: 'brightness | luminance | saturation'\n     * @return {string} - HTML color string\n     */\n    matchLuminance(target_color, color_arg = this.color, target_ratio, direction, method) {\n        let { color } = this._colorType(color_arg);\n        let target = this._colorType(target_color).color;\n\n        if (target_ratio) {\n            let adj = target;\n            let m = this.contrastRatio(adj, color);\n            if (m < target_ratio) {\n                let dir = direction || this.isHighLuminance(color) ? -1 : 1;\n                let count = 100;\n                while (m < target_ratio && count--) {\n                    let adj_set;\n\n                    switch (method) {\n                        case 'brightness':\n                            adj_set = this.adjustBrightness(1 * dir, adj);\n                            break;\n                        case 'luminance':\n                            adj_set = this.adjustLuminance(1 * dir, adj);\n                            break;\n                        default:\n                            adj_set = this.adjustBrightness(1 * dir, { legacy: true, color: adj });\n                    }\n\n                    if (adj === adj_set)\n                        break;\n                    adj = adj_set;\n\n                    m = this.contrastRatio(adj, color);\n                }\n            }\n            return this.hex(adj);\n        } else {\n            let main_lum = this._luminance(color);\n            let lum = this._luminance(target);\n\n            if (Math.abs(lum - main_lum) < 0.01)\n                return target;\n\n            let adj = this.hex(target);\n\n            let dir = (lum, main_lum) => {\n                return lum < main_lum ? 1 : -1;\n            };\n\n            let currDir = dir(lum, main_lum);\n            while (Math.abs(lum - main_lum) > 0.01 && currDir === dir(lum, main_lum)) {\n                let adj_set;\n                switch (method) {\n                    case 'saturation':\n                        adj_set = this.adjustBrightness(currDir, { color: adj, legacy: true });\n                        break;\n                    case 'luminance':\n                        adj_set = this.adjustLuminance(currDir, adj);\n                        break;\n                    default:\n                        adj_set = this.adjustBrightness(currDir, adj);\n                }\n                let lum_pre = this._luminance(adj_set);\n                if (lum_pre === lum || currDir !== dir(lum_pre, main_lum))\n                    break;\n                lum = lum_pre;\n                adj = adj_set;\n            }\n            return this.hex(adj);\n        }\n    }\n\n    /**\n     * Generate analogous color\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {number} [deg=30] - Amount of hue separation\n     * @return {Array} - 2 analogous color is returned. [&lt;hsla color&gt;, ... ]\n     */\n    analogous(color_arg = this.color, deg = 30) {\n        let { color } = this._colorType(color_arg);\n\n        let spin = (h, v) => {\n            let val = h + v;\n            return val < 0 ? 360 + val : val > 360 ? val - 360 : val;\n        };\n\n        let hsl = this.hsla(this.getAlpha(color), color);\n        let plus = 'hsla(' + spin(hsl.h, deg) + ', ' + hsl.s + '%, ' + hsl.l + '%, ' + hsl.a + ')';\n        let minus = 'hsla(' + spin(hsl.h, -deg) + ', ' + hsl.s + '%, ' + hsl.l + '%, ' + hsl.a + ')';\n\n        return [this.matchLuminance(plus, color), this.matchLuminance(minus, color)];\n    }\n\n    /**\n     * Generate complementary color\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {number} [add=0] - Add or subtract hue from complementary color\n     * @return {string} - HEX color string\n     */\n    complementary(color_arg = this.color, add = 0) {\n        let { color } = this._colorType(color_arg);\n\n        let hsl = this.hsla(this.getAlpha(color), color);\n\n        if (hsl.h < 180)\n            hsl.h += 180;\n        else\n            hsl.h -= 180;\n\n        hsl.h += add;\n        hsl.h = hsl.h > 360 ? hsl.h - 360 : hsl.h < 0 ? 360 - hsl.h : hsl.h;\n\n        return this.hex(this._toString(hsl));\n    }\n\n    /**\n     * @param {string} [color_arg=this.color] - Target color\n     * @param {boolean} [fineTuned=false] - Custom Color space is applied when true\n     * @return {boolean} - True if color has high luminance\n     */\n    isHighLuminance(color_arg = this.color, fineTuned = this.fineTuned) {\n        const { r, g, b } = this.rgba(1, this._colorType(color_arg).color);\n\n        let yiq =\n            fineTuned ?\n                ((r * (299 - 64)) + (g * (587 * 1.25)) + (b * 114)) / 1000 : // Fine tuned\n                ((r * 299) + (g * 587) + (b * 114)) / 1000; // Standard color space formula\n\n        // Web standard of color space threshold is 128\n        return (yiq >= (fineTuned ? 188 : 128));\n    }\n\n    _luminance(color_arg = this.color) {\n        let rgb = this.rgba(1, color_arg);\n        let a = [rgb.r, rgb.g, rgb.b].map(function (v) {\n            v /= 255;\n            return v <= 0.03928\n                ? v / 12.92\n                : Math.pow((v + 0.055) / 1.055, 2.4);\n        });\n\n        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;\n    }\n\n    _toString(col) {\n        let numberOrNot = (n, def = 100) => {\n            return typeof n === 'number' ? n : def;\n        };\n        if (typeof col === 'string')\n            return col;\n\n        if (col.hasOwnProperty('h'))\n            return 'hsla(' + (col.h || 0) + ', ' + numberOrNot(col.s) + '%, ' + numberOrNot(col.l) + '%, ' + numberOrNot(col.a, 1) + ')';\n\n        if (col.hasOwnProperty('r'))\n            return 'rgba(' + numberOrNot(col.r) + ', ' + numberOrNot(col.g) + ', ' + numberOrNot(col.b) + ', ' + numberOrNot(col.a, 1) + ')';\n        throw col;\n    }\n\n    /**\n     * Returns contrast ratio between the given color.\n     * Useful to determine if the given color is suitable for text with the constructed color as a background.\n     * @param {string} color_arg1 - Color string you want to compare luminance ratio.\n     * @param {string} [color_arg2=this.color] - Color string you want to compare with color_arg1\n     * @return {number} - Contrast ratio\n     */\n    contrastRatio(color_arg1, color_arg2 = this.color) {\n        let lum1 = this._luminance(color_arg2) + 0.05;\n        let lum2 = this._luminance(color_arg1) + 0.05;\n\n        return lum1 > lum2 ? lum1 / lum2 : lum2 / lum1;\n    }\n\n    /**\n     * Returns suitable text color (Black / White).\n     * @param {(number | Object)} opacity - Can set returning color values opacity.\n     * @param {number} opacity.black - Set returning color values opacity when the result color is black.\n     * @param {number} opacity.white - Set returning color values opacity when the result color is white.\n     * @param {(string|Object)} [option=this.color] - Background color of text\n     * @param {(string|Object)} [option.color=this.color] - Background color of text\n     * @param {(string|Object)} [option.fineTuned=true] - Follows standard color space calculation when false\n     * @return {string | null} - HTML color string\n     */\n    textColor(opacity = 1, option = this.color) {\n\n        if (typeof option === 'string')\n            option = { color: option };\n\n        let { color = this.color, fineTuned = true } = option;\n\n        color = this._colorType(color).color;\n\n        // returns null if color opacity is below 0.5\n        if (this.getAlpha(color) < 0.5)\n            return \"\";\n\n        let blackOpacity, whiteOpacity;\n\n        if (typeof opacity === 'number' && opacity < 1) {\n            blackOpacity = opacity;\n            whiteOpacity = opacity;\n        } else if (opacity && typeof opacity === 'object') {\n            for (let k of ['black', 'white']) {\n                let opa = opacity[k];\n                if (typeof opa === 'number' && opa < 1) {\n                    if (k === 'black')\n                        blackOpacity = opa;\n                    else if (k === 'white')\n                        whiteOpacity = opa;\n                }\n            }\n        }\n\n        const opa = (v) => {\n            if (typeof v === 'number') {\n                if (v < 1 && v > 0) return v;\n                else if (v > 1) return 1;\n                else return 0;\n            } else return 1;\n        };\n\n        if (this.isHighLuminance(color, fineTuned))\n            return blackOpacity ? `rgba(0, 0, 0, ${opa(blackOpacity)})` : 'black';\n\n        return whiteOpacity ? `rgba(255, 255, 255, ${opa(whiteOpacity)})` : 'white';\n    }\n\n    /**\n     * Returns hsla color\n     * @param {number} [opacity] - Set opacity for returning color value.\n     * @param {string} [color_arg=this.color] - Color to convert to hsla string\n     * @return {Object} - { h: &lt;number&gt;, s: &lt;number&gt;, l: &lt;number&gt;, r: &lt;number&gt;, g: &lt;number&gt;, b: &lt;number&gt;, a: &lt;number&gt;, string: &lt;string | rgba color string&gt; }\n     */\n    hsla(opacity, color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        const hsl = (r, g, b) => {\n            r /= 255;\n            g /= 255;\n            b /= 255;\n\n            let c_min = Math.min(r, g, b),\n                c_max = Math.max(r, g, b),\n                delta = c_max - c_min,\n                h = 0,\n                s = 0,\n                l = 0;\n\n            if (delta === 0)\n                h = 0;\n            else if (c_max === r)\n                h = ((g - b) / delta) % 6;\n            else if (c_max === g)\n                h = (b - r) / delta + 2;\n            else\n                h = (r - g) / delta + 4;\n\n            h = Math.round(h * 60);\n\n            if (h < 0) h += 360;\n\n            l = (c_max + c_min) / 2;\n            s = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));\n            s = +(s * 100).toFixed(1);\n            l = +(l * 100).toFixed(1);\n            return { h, s, l };\n        };\n\n        if (type === 'hex') {\n            opacity = typeof opacity === 'number' ? opacity : 1;\n            const rgba = this.rgba(opacity, color);\n            const { r, g, b, a } = rgba;\n            const { h, s, l } = hsl(r, g, b);\n\n            return {\n                r, g, b, a,\n                h: h,\n                s: s,\n                l: l,\n                string: this._toString({ h, s, l, a: opacity })\n            };\n\n        } else {\n\n            const digit = this._extractDigit(color);\n            opacity = typeof opacity === 'number' ? opacity : digit[3] || 1;\n\n            if (type.includes('hsl')) {\n                const { r, g, b, a } = this.rgba(opacity, color);\n\n                return {\n                    r, g, b, a,\n                    h: digit[0],\n                    s: digit[1],\n                    l: digit[2],\n                    string: this._toString({\n                        h: digit[0],\n                        s: digit[1],\n                        l: digit[2],\n                        a\n                    })\n                };\n\n            } else if (type.includes('rgb')) {\n                const value = {\n                    r: digit[0],\n                    g: digit[1],\n                    b: digit[2],\n                    a: opacity\n                };\n                const { h, s, l } = hsl(value.r, value.g, value.b);\n\n                return Object.assign(value, {\n                    r: value.r,\n                    g: value.g,\n                    b: value.b,\n                    h: h,\n                    s: s,\n                    l: l,\n                    a: value.a,\n                    string: this._toString({ h, s, l, a: value.a })\n                });\n\n            }\n        }\n    }\n\n    /**\n     * Returns hex color string\n     * @param {string} [color_arg=this.color] - Color to convert to hex string\n     * @return {string} - HEX color string\n     */\n    hex(color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type.includes('rgb') || type.includes('hsl')) {\n            const rgba = this.rgba(1, color);\n            return '#' + ((1 << 24) + (rgba.r << 16) + (rgba.g << 8) + rgba.b).toString(16).slice(1);\n        }\n\n        return color;\n    }\n\n    /**\n     * Returns rgba color\n     * @param {number} [opacity] - Set opacity of returning color\n     * @param {string} [color_arg=this.color] - Color to convert to rgba string\n     * @return {Object} - { r: &lt;number&gt;, g: &lt;number&gt;, b: &lt;number&gt;, a: &lt;number&gt;, string: &lt;string | HTML color string&gt; }\n     */\n    rgba(opacity, color_arg = this.color) {\n        const { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (type === 'hex') {\n            const hex = color;\n            let rgbObject = { r: null, g: null, b: null };\n            let hexValues = hex.match(/[a-fA-F0-9]{2}/g);\n\n            if (hex.length === 4) {\n                hexValues = hex.match(/[a-fA-F0-9]{1}/g);\n                hexValues = hexValues.map(hex => \"\" + hex + hex);\n            }\n            let count = 0;\n            for (const key in rgbObject) {\n                rgbObject[key] = parseInt(hexValues[count], 16);\n                count++;\n            }\n\n            const opacity_value = typeof opacity === 'number' ? opacity : 1;\n            let { r, g, b } = rgbObject;\n\n            return {\n                ...rgbObject,\n                a: opacity_value,\n                string: this._toString({\n                    r: +r, g: +g, b: +b, a: opacity_value\n                })\n            };\n\n        } else {\n            const digit = this._extractDigit(color);\n            const a = typeof opacity === 'number' ? opacity : digit[3] || 1;\n\n            if (type.includes('rgb')) {\n\n                let value = {\n                    r: digit[0],\n                    g: digit[1],\n                    b: digit[2],\n                    a\n                };\n\n                return Object.assign({\n                    string: this._toString(value)\n                }, value);\n\n            } else if (type.includes('hsl')) {\n\n                let h = digit[0];\n                let s = digit[1];\n                let l = digit[2];\n\n                s /= 100;\n                l /= 100;\n\n                let c = (1 - Math.abs(2 * l - 1)) * s,\n                    x = c * (1 - Math.abs((h / 60) % 2 - 1)),\n                    m = l - c / 2,\n                    r = 0,\n                    g = 0,\n                    b = 0;\n                if (0 <= h && h < 60) {\n                    r = c;\n                    g = x;\n                    b = 0;\n                } else if (60 <= h && h < 120) {\n                    r = x;\n                    g = c;\n                    b = 0;\n                } else if (120 <= h && h < 180) {\n                    r = 0;\n                    g = c;\n                    b = x;\n                } else if (180 <= h && h < 240) {\n                    r = 0;\n                    g = x;\n                    b = c;\n                } else if (240 <= h && h < 300) {\n                    r = x;\n                    g = 0;\n                    b = c;\n                } else if (300 <= h && h < 360) {\n                    r = c;\n                    g = 0;\n                    b = x;\n                }\n                r = Math.round((r + m) * 255);\n                g = Math.round((g + m) * 255);\n                b = Math.round((b + m) * 255);\n\n                return {\n                    r, g, b, a,\n                    string: this._toString({ r, g, b, a })\n                };\n\n            }\n        }\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {(string|Object)} [option=this.color] - Color to adjust || additional option.\n     * @param {(string|Object)} [option.color_arg=this.color] - Color to adjust.\n     * @param {(string|Object)} [option.legacy=false] - Legacy adjust mode. Adjust brightness by saturation and luminance.\n     * @return {string} - Brightness adjusted HTML color string\n     */\n    adjustBrightness(value = 0, option = this.color) {\n        let color_arg, legacy = false;\n        if (typeof option === 'string')\n            color_arg = option || this.color;\n        else {\n            color_arg = option.color || this.color;\n            legacy = option.legacy || false;\n        }\n\n        if (legacy) {\n            let { color } = this._colorType(color_arg);\n            let col = this.hsla(this.getAlpha(color), color);\n\n            let limit = (v, limit = 100) => {\n                return v > limit ? limit : v < 0 ? 0 : v;\n            };\n\n            col.s += ((value > 0 ? (100 - col.s) : col.s) / 100) * value;\n            col.s = limit(col.s);\n            col.l += ((value > 0 ? (100 - col.l) : col.l) / 100) * value;\n            col.l = limit(col.l);\n\n            return this._toString(col);\n        }\n\n        let { type = this.type, color = this.color } = this._colorType(color_arg);\n\n        if (value === 0)\n            return color;\n\n        const opacity = type === 'hex' ? 1 : this._extractDigit(color)[3] || 1;\n        const rgb = this.rgba(opacity, color);\n\n        let rgbRange = {\n            r: 0 - rgb['r'],\n            g: 0 - rgb['g'],\n            b: 0 - rgb['b']\n        };\n\n        if (value > 0) {\n            Object.keys(rgbRange).map(function (key) {\n                rgbRange[key] = 255 - rgb[key];\n            });\n        }\n\n        ['r', 'g', 'b'].map(function (key) {\n            rgb[key] += parseInt(rgbRange[key] / 100 * Math.abs(value));\n        });\n\n        const result = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';\n\n        if (type === 'hex')\n            return this.hex(result);\n\n        else if (type.includes('rgb'))\n            return this.rgba(rgb.a, result).string;\n\n        else if (type.includes('hsl'))\n            return this.hsla(rgb.a, result).string;\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {string} [color_arg=this.color] - Color to adjust.\n     * @return {string} - Luminance adjusted hsla color string\n     */\n    adjustLuminance(value = 0, color_arg = this.color) {\n        let { color } = this._colorType(color_arg);\n        let col = this.hsla(this.getAlpha(color), color);\n\n        let limit = (v, limit = 100) => {\n            return v > limit ? limit : v < 0 ? 0 : v;\n        };\n\n        col.l += ((value > 0 ? (100 - col.l) : col.l) / 100) * value;\n        col.l = limit(col.l);\n\n        return this._toString(col);\n    }\n\n    /**\n     * @param {number} value - Adjust value by percent. range: -100 ~ 100\n     * @param {string} [color_arg=this.color] - Color to adjust.\n     * @return {string} - Saturation adjusted hsla color string\n     */\n    adjustSaturation(value = 0, color_arg = this.color) {\n        let { color } = this._colorType(color_arg);\n        let col = this.hsla(this.getAlpha(color), color);\n\n        let limit = (v, limit = 100) => {\n            return v > limit ? limit : v < 0 ? 0 : v;\n        };\n\n        col.s += ((value > 0 ? (100 - col.s) : col.s) / 100) * value;\n        col.s = limit(col.s);\n\n        return this._toString(col);\n    }\n}\n\nexport { ColorMangle };","import {ColorMangle} from 'colormangle';\n\nexport class Wysiwyg4All {\n    /**\n     * Wysiwyg4All is a simple framework for building a text editor for your website.\n     * Focused on expandability and customizations.\n     * Additional library ColorMangle is required for text colors.\n     * @param {{}} option - Options\n     * @param {string} option.elementId - ID of target <DIV>.\n     * @param {boolean} [option.editable=true] - When set to false, Wysiwyg will not be editable. By doing this, it can be used as readonly.\n     * @param {string} [option.placeholder=''] - Add placeholder string.\n     * @param {boolean} [option.spellcheck=false] - Set spellcheck to true/false.\n     * @param {string | object} [option.highlightColor='teal'] - Sets the highlight color of the wysiwyg (web color name | hex | rgb | hsl). Or can provide custom color scheme object (more details in api doc).\n     * @param {string} [option.html=''] - HTML string to load on initialization.\n     * @param {function} [option.callback=(cb)=>{return cb}] - Setup callback function. Callback argument contains array of information such as current text style, added images, hashtags, urllinks, selected range... etc.\n     * @param {{} | number} [option.fontSize={desktop:18, tablet: 16, phone: 14}] - Set default font size of each screen size in px. If number is given all screen size will share the same give font size.\n     * @param {boolean} [option.lastLineBlank=false] - When set to true, Blank line will always be added on the last line of wysiwyg.\n     * @param {boolean} [option.hashtag=false] - When set to true, wysiwyg will auto detect hashtag strings.\n     * @param {boolean} [option.urllink=false] - When set to true, wysiwyg will auto detect url strings.\n     * @param {boolean} [option.logMutation=false] - When set to true, wysiwyg will output dom mutation data via callback function.\n     */\n    constructor(option) {\n        if (typeof ColorMangle === 'undefined')\n            throw \"Can't find colormangle.js library\";\n\n        this.hashtag_regex = /#[\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC\\w-]+(?:\\+[\\w-]+)*/g;\n        this.hashtag_stopper_regex = /[^\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC\\w-]/g;\n        this.urllink_regex = /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})/gi;\n\n        let {\n            elementId = '',\n            editable = true,\n            placeholder = '',\n            spellcheck = false,\n            highlightColor = 'teal',\n            html = '',\n            callback,\n            fontSize = {\n                desktop: 18,\n                tablet: 16,\n                phone: 14\n            },\n            lastLineBlank = false,\n            hashtag = false,\n            urllink = false,\n            logMutation = false\n        } = option;\n\n        this.hashtag = hashtag;\n        this.urllink = urllink;\n        this.logMutation = logMutation;\n        this.fontSizeCssVariable = {};\n\n        if (typeof fontSize === 'number')\n            this.fontSizeCssVariable = {\n                '--wysiwyg-font-desktop': `${fontSize}px`,\n                '--wysiwyg-font-tablet': `${fontSize}px`,\n                '--wysiwyg-font-phone': `${fontSize}px`,\n            };\n        else if (typeof fontSize === 'object' && Object.keys(fontSize).length) {\n            let hold;\n            let keyArr = ['desktop', 'tablet', 'phone'];\n\n            for (let k of keyArr) {\n                if (fontSize[k]) {\n                    hold = fontSize[k];\n                    break;\n                }\n            }\n\n            if (!hold)\n                throw 'invalid fontSize';\n\n            for (let k of keyArr) {\n                if (fontSize[k])\n                    hold = fontSize[k];\n                this.fontSizeCssVariable[`--wysiwyg-font-${k}`] = `${hold}px`;\n            }\n        }\n\n        if (!elementId || typeof elementId !== 'string') throw new Error('The wysiwyg element should have an ID');\n        elementId = elementId[0] === '#' ? elementId.substring(1) : elementId;\n\n        this.html = html;\n        this.elementId = elementId[0] === '#' ? elementId.substring(1) : elementId;\n        this.placeholder = placeholder;\n        this.spellcheck = spellcheck;\n        this.lastLineBlank = lastLineBlank;\n\n        if (typeof highlightColor === 'string')\n            highlightColor = new ColorMangle(highlightColor).color;\n\n        this.colorScheme = highlightColor;\n        this.callback = callback || null;\n\n        this.image_array = [];\n        this.hashtag_array = [];\n        this.urllink_array = [];\n        this.custom_array = [];\n\n        this.blockElement_queryArray = ['HR', 'BLOCKQUOTE', 'UL', 'OL', '._media_', '._custom_'];\n        this.specialTextElement_queryArray = ['._hashtag_', '._urllink_'];\n        this.restrictedElement_queryArray = ['._media_', '._custom_'];\n        this.textAreaElement_queryArray = ['BLOCKQUOTE', 'LI'];\n        this.textBlockElement_queryArray = ['P', 'LI'];\n        this.ceilingElement_queryArray = ['UL', 'OL', 'BLOCKQUOTE', `#${elementId}`];\n        this.unSelectable_queryArray = ['._media_', '._custom_', '._hashtag_', '._urllink_', 'HR'];\n        this.styleAllowedElement_queryArray = ['._color', `#${elementId}`, '._hashtag_', '._urllink_'];\n        this.alignClass = ['_alignCenter_', '_alignRight_'];\n\n        this.hashtag_flag = false;\n        this.urllink_flag = false;\n        this.range_backup = null;\n\n        this.commandTracker = {};\n        this.range = null;\n        this.isRangeDirectionForward = true;\n        this.insertTabPending_tabString = '';\n        this.removeSandwichedLine_array = [];\n        this.lastKey = null;\n\n        //  setup div\n        this.element = document.getElementById(this.elementId);\n        if (!this.element)\n            throw `element #${this.elementId} is null`;\n\n        this.element.innerHTML = '';\n\n        this.cssVariable = new ColorMangle().colorScheme(this.colorScheme);\n        Object.assign(this.cssVariable, this.fontSizeCssVariable);\n\n        for (const v in this.cssVariable)\n            this.element.style.setProperty(v, this.cssVariable[v]);\n\n        this.elementComputedStyle = window.getComputedStyle(this.element);\n        this.defaultFontColor = new ColorMangle(this.cssVariable['--content-text']).hex();\n        this.highlightColor = new ColorMangle(this.cssVariable['--content-focus']).hex();\n\n        if (!this.element.classList.contains('_wysiwyg4all'))\n            this.element.classList.add('_wysiwyg4all');\n\n        this.setPlaceholder(this.placeholder);\n        this.setSpellcheck(this.spellcheck);\n\n        //  re-adjust min-height depending on padding\n        let paddingB = this.elementComputedStyle.paddingBottom;\n        let paddingT = this.elementComputedStyle.paddingTop;\n        let borderT = this.elementComputedStyle.borderTopWidth;\n        let borderB = this.elementComputedStyle.borderBottomWidth;\n\n        this.element.style.minHeight = `calc(${paddingB} + ${paddingT} + ${borderT} + ${borderB} + 1.6em)`;\n\n        //  command style tag\n        const command = {\n            //  [<targetClassName>, <cssProperty>, [<string: counter tag | class name>]]\n            h1: ['_h1', 'fontSize', ['_small', '_h2', '_h3', '_h4', '_h5', '_h6']],\n            h2: ['_h2', 'fontSize', ['_small', '_h1', '_h3', '_h4', '_h5', '_h6']],\n            h3: ['_h3', 'fontSize', ['_small', '_h1', '_h2', '_h4', '_h5', '_h6']],\n            h4: ['_h4', 'fontSize', ['_small', '_h1', '_h2', '_h3', '_h5', '_h6']],\n            h5: ['_h5', 'fontSize', ['_small', '_h1', '_h2', '_h3', '_h4', '_h6']],\n            h6: ['_h6', 'fontSize', ['_small', '_h1', '_h2', '_h3', '_h4', '_h5']],\n            italic: ['_i', 'fontStyle'],\n            small: ['_small', 'fontSize', ['_h1', '_h2', '_h3', '_h4', '_h5', '_h6', '_b']],\n            bold: ['_b', 'fontWeight', ['_small']],\n            underline: ['_u', 'textDecoration', ['_del']],\n            strike: ['_del', 'textDecoration', ['_u']],\n            color: ['_color', 'color']\n        };\n\n        const fontSizeRatio = {\n            //  should always be the same em value as css\n            h1: 4.2,\n            h2: 3.56,\n            h3: 2.92,\n            h4: 2.28,\n            h5: 1.64,\n            h6: 1.15,\n            small: 0.8,\n        };\n\n        this.styleTagOfCommand = {};\n        this.counterTagOf = {};\n        this.cssPropertyOf = {};\n        this.cssPropertyChecker = {\n            'textDecoration': (v) => {\n                //  v = <string: value from computedStyle>\n                if (v.includes('underline')) return 'underline';\n                else if (v.includes('line-through')) return 'strike';\n\n                return false;\n            },\n            'fontSize': (v) => {\n                //  v = <string: value from computedStyle>\n                let documentFontSize = parseFloat(this.elementComputedStyle.fontSize);\n                let nodeFontSize = parseFloat(v);\n                for (let tag in fontSizeRatio) {\n                    let f_size = fontSizeRatio[tag];\n\n                    //  precision\n                    let compare_size = documentFontSize * f_size;\n                    let f_size_high = compare_size + 0.01;\n                    let f_size_low = compare_size - 0.01;\n                    if (f_size_high > nodeFontSize && f_size_low < nodeFontSize) return tag;\n                }\n                return false;\n            },\n            'fontStyle': (v) => {\n                //  v = <string: value from computedStyle>\n                if (v.includes('italic'))\n                    return 'italic';\n                return false;\n            }\n        };\n\n        for (let c in command) {\n            this.commandTracker[c] = false;\n            this.styleTagOfCommand[c] = command[c][0];\n            this.cssPropertyOf[command[c][0]] = command[c][1];\n            if (!this.cssPropertyChecker.hasOwnProperty(command[c][1]))\n                this.cssPropertyChecker[command[c][1]] = c;\n            if (command[c][2])\n                this.counterTagOf[command[c][0]] = command[c][2];\n        }\n\n        /**\n         this.styleTagOfCommand = {\n            [commandKey]: <targetClassName>\n         };\n\n         this.cssPropertyChecker = {\n            [cssPropertyKey]: <commandKey | function(<cssValue>)>\n         };\n\n         this.cssPropertyOf = {\n            [targetClassName]: <cssPropertyKey>\n         };\n\n         this.counterTagOf = {\n            [targetClassName]: [<counterClassName>]\n         };\n\n         this.commandTracker = {\n            [commandKey]: <boolean>\n         };\n\n         console.log({\n            styleTagOfCommand: this.styleTagOfCommand,\n            cssPropertyChecker: this.cssPropertyChecker,\n            cssPropertyOf: this.cssPropertyOf,\n            counterTagOf: this.counterTagOf,\n            commandTracker: this.commandTracker\n         });\n         */\n\n        this.loadHTML(this.html, editable).catch(err => {\n            throw err;\n        });\n    }\n\n    _adjustSelection(target, ceilingElement_query = this.ceilingElement_queryArray) {\n        let toArray = (v, allowObject = false) => {\n            if (Array.isArray(v)) return v;\n            else if (\n                typeof v === 'string' && v ||\n                typeof v === 'number' ||\n                typeof v === 'boolean' ||\n                allowObject && typeof v === 'object')\n                return [v];\n            else return [];\n        };\n\n        let setRange = !!target;\n\n        let { node = null, position = true } = target || {};\n\n        let sel = window.getSelection();\n        if (!sel)\n            return null;\n\n        let range;\n        try {\n            range = sel.getRangeAt(0);\n        } catch (err) {\n            if (setRange)\n                range = document.createRange();\n        }\n\n        if (setRange) {\n            node = toArray(node, true);\n            position = toArray(position, true);\n\n            for (let p of position)\n                if (typeof p !== 'number' && typeof p !== 'boolean' && p !== null) throw 'INVALID_POSITION';\n\n            for (let n of node)\n                if (!(n instanceof Node) && n !== null) throw 'INVALID_NODE';\n\n\n            const setTarget = (node, position) => {\n                if (node instanceof Node) {\n                    if (node.nodeType === 1) {\n                        if (typeof position === 'boolean')\n                            while (position === false ? node.lastChild : node.firstChild)\n                                node = position === false ? node.lastChild : node.firstChild;\n\n                        else if (typeof position === 'number') {\n                            let textLength = 0;\n                            this._nodeCrawler(n => {\n                                if (n.nodeType === 3 && n.textContent.length) {\n                                    let length = n.textContent.length;\n                                    if (n.parentNode.getAttribute('contenteditable') === 'false') {\n\n                                        if ((position - (textLength + length)) >= 0)\n                                            textLength += length;\n                                        else {\n                                            position = length;\n                                            return 'BREAK';\n                                        }\n                                        return n;\n                                    } else {\n                                        node = n;\n\n                                        if ((position - (textLength + length)) >= 0) {\n                                            textLength += length;\n                                        } else {\n                                            position -= textLength;\n                                            return 'BREAK';\n                                        }\n                                    }\n                                }\n                                return n;\n                            }, {\n                                node,\n                            });\n                            if (node.nodeType === 1) {\n                                let text = document.createTextNode('\\u200B');\n                                node.insertBefore(text, node.childNodes[0]);\n                                node = text;\n                                position = 0;\n                            }\n                        }\n\n                        if (node.nodeName === 'BR' && node.parentNode.childNodes.length > 1)\n                            node = node.previousSibling || node;\n                    }\n                    if (typeof position === 'boolean')\n                        position = position ? 0 : node.textContent.length;\n                    else position = position > node.textContent.length ? node.textContent.length : position;\n\n                    return { node, position };\n                }\n            };\n\n            let doCollapse = false, setEnd, setStart = (() => {\n                node[0] = node[0] === null ? range.startContainer : node[0];\n                position[0] = position[0] === null ? range.startOffset : position[0];\n                return setTarget(node[0], position[0]);\n            })();\n            range.setStart(setStart.node, setStart.position);\n\n            if (position.length > 1)\n                setEnd = setTarget(\n                    (node[1] === null ? range.endContainer : node[1]) || node[0],\n                    position[1] === null ? range.endOffset : position[1]);\n            else {\n                setEnd = setStart;\n                doCollapse = true;\n            }\n\n            range.setEnd(setEnd.node, setEnd.position);\n\n            if (doCollapse)\n                range.collapse(true);\n\n            sel.removeAllRanges();\n            sel.addRange(range);\n        }\n\n        if (ceilingElement_query && range) {\n            let startLine, endLine;\n            for (let q of ceilingElement_query) {\n                let e = range.endContainer.nodeType === 3 ?\n                    range.endContainer.parentNode : range.endContainer;\n                let s = range.startContainer.nodeType === 3 ?\n                    range.startContainer.parentNode : range.startContainer;\n\n                if (!startLine && s.closest(q))\n                    startLine = this._climbUpToEldestParent(s, s.closest(q));\n                if (!endLine && e.closest(q))\n                    endLine = this._climbUpToEldestParent(e, e.closest(q));\n            }\n\n            range.startLine = startLine;\n            range.endLine = endLine;\n        }\n\n        return range;\n    }\n\n    _generateId(option) {\n        let limit = 12;\n        let prefix = '';\n\n        if (typeof option === 'number') limit = option;\n        else if (typeof option === 'string') prefix = `${option}_`;\n\n        const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n\n        let text = '';\n        for (let i = 0; i < limit - 6; i++) text += possible.charAt(Math.floor(Math.random() * (possible.length - 1)));\n\n        const numb = new Date()\n            .getTime()\n            .toString()\n            .substring(7, 13); // SECOND, MILLISECOND\n\n        const shuffleArray = (array) => {\n            let currentIndex = array.length;\n            let temporaryValue, randomIndex;\n            while (0 !== currentIndex) {\n                randomIndex = Math.floor(Math.random() * currentIndex);\n                currentIndex -= 1;\n                temporaryValue = array[currentIndex];\n                array[currentIndex] = array[randomIndex];\n                array[randomIndex] = temporaryValue;\n            }\n            return array;\n        };\n\n        const letter_array = shuffleArray((text + numb).split(''));\n\n        let output = '';\n        for (let i = 0; i < limit; i++) output += letter_array[i];\n\n        return prefix + output;\n    }\n\n    _nodeCrawler(run, option) {\n        const { parentNode, node, startFromEldestChild, startNode } = option;\n\n        if (startFromEldestChild && !parentNode)\n            throw new Error('Need parentNode to crawl up single child');\n\n        if (!node || !(node instanceof Node || node?.commonAncestorContainer))\n            throw new Error('No node to crawl');\n\n        let\n            outputNodes = [],\n            nodeIsRange = !!(node.commonAncestorContainer),\n            commonContainer = null,\n            parentAnchor;\n\n        if (parentNode && parentNode instanceof Node && parentNode?.nodeType === 1)\n            parentAnchor = parentNode;\n\n        if (nodeIsRange) {\n            commonContainer = node.commonAncestorContainer;\n            commonContainer = commonContainer.nodeType === 3 ? commonContainer.parentNode || commonContainer : commonContainer;\n        } else\n            commonContainer = node;\n\n        if (startFromEldestChild)\n            commonContainer = this._climbUpToEldestParent(commonContainer, parentNode, true);\n\n        if (parentAnchor) {\n            while (\n                commonContainer.nodeType === 3 ||\n                commonContainer !== parentAnchor &&\n                commonContainer.parentNode &&\n                commonContainer.parentNode !== parentAnchor\n            ) commonContainer = commonContainer.parentNode;\n        }\n\n        /** crawl order below (outputs node on the way)\n         *  If 'BREAK' is returned, the node is not saved in outputNode\n         *\n         *  start   ->  [                   end\n         *                  |               ^ (finish)\n         *                  v               | (outputNode)\n         *              outputNode  ->  outputNode\n         *\n         *  NOTE: Will not crawl when node is textNode\n         */\n\n        if (commonContainer.nodeType === 3) {\n            outputNodes.push(run(commonContainer));\n\n            return { nodes: outputNodes, commonContainer };\n        }\n\n        let id, uniqueId;\n        if (commonContainer.nodeType === 1) {\n            uniqueId = commonContainer.id || (() => {\n                id = this._generateId('crawl');\n                commonContainer.id = id;\n                return id;\n            })();\n        }\n\n        let crawl = ((startNode instanceof Node) ? startNode : null) || (nodeIsRange ? node.startContainer : commonContainer.childNodes[0]);\n        let endNode = nodeIsRange ? node.endContainer : commonContainer.childNodes[commonContainer.childNodes.length ? commonContainer.childNodes.length - 1 : 0];\n\n        let withInRange = (cwl) => {\n            if (!cwl || !(cwl instanceof Node)) return false;\n            if (cwl.nodeType === 1)\n                return cwl.id !== uniqueId && cwl.parentNode?.closest('#' + uniqueId);\n            else return true;\n        };\n\n        while (withInRange(crawl)) {\n            if (crawl.nodeType === 1 && crawl.childNodes.length) {\n                // dive down to deepest child's first crawl\n                crawl = crawl.childNodes[0];\n            } else if (crawl) {\n                // entering the deepest elements first child.\n\n                if (typeof run === 'function') crawl = run(crawl);\n                if (crawl === 'BREAK' || !withInRange(crawl)) break;\n\n                outputNodes.push(crawl);\n\n                // break out if the crawl hits the end\n                if (crawl === endNode) break;\n\n                /**\n                 * Climb up the node if the node doesn't have any next siblings\n                 * Stop when it hits the commonContainer\n                 */\n                let breakOut = false;\n                while (!crawl.nextSibling && crawl.parentNode && withInRange(crawl.parentNode)) {\n                    crawl = crawl.parentNode;\n                    if (crawl) {\n                        if (typeof run === 'function')\n                            crawl = run(crawl);\n\n                        if (crawl === 'BREAK' || !withInRange(crawl)) {\n                            breakOut = true;\n                            break;\n                        }\n\n                        if (crawl)\n                            outputNodes.push(crawl);\n                    }\n                }\n\n                if (breakOut) break;\n\n                // move on to next crawl\n                crawl = crawl.nextSibling;\n            }\n        }\n\n        if (id)\n            commonContainer.removeAttribute('id');\n\n        return { node: outputNodes, commonContainer };\n    }\n\n    _wrapNode(node, wrapper, appendWhole = false) {\n        if (!(node instanceof Node)) return;\n\n        if (!node.parentNode)\n            throw new Error(\"can't unwrap document fragment\");\n\n        // save current range\n        let sel = window.getSelection();\n        let range = sel.getRangeAt(0);\n        let start = null;\n        let startOffset = range.startOffset;\n        let end = null;\n        let endOffset = range.endOffset;\n\n        const withinRange = (n) => {\n            if (range.startContainer === n) {\n                start = n;\n            }\n            if (range.endContainer === n) {\n                end = n;\n            }\n        };\n\n        if (node.nodeType === 1) {\n            this._nodeCrawler(n => {\n                withinRange(n);\n                return n;\n            }, { node });\n        } else withinRange(node);\n\n        if (wrapper) {\n            // place the wrapper\n            node.parentNode.insertBefore(wrapper, node);\n        }\n\n        // append node\n        if (node.nodeType === 3) {\n            if (wrapper)\n                wrapper.append(node);\n            else throw new Error('no wrapper for text content');\n        } else if (appendWhole)\n            wrapper.append(node);\n        else\n            while (node.childNodes[0]) {\n                let child = node.childNodes[0];\n                if (wrapper) wrapper.append(child);\n                else node.parentNode.insertBefore(child, node);\n            }\n\n        let stripped;\n        if (node.nodeType === 1 && !appendWhole) {\n            let n = wrapper || node;\n            let p = n.parentNode;\n            stripped = node.previousSibling;\n            p.removeChild(node);\n        }\n\n        // restore range\n        if ((stripped || node).textContent && (start || end)) {\n            if (start && start === end && startOffset === endOffset)\n                range = this._adjustSelection({ node: stripped || node, position: startOffset });\n            else\n                range = this._adjustSelection({\n                    node: [start, end],\n                    position: [startOffset, endOffset]\n                });\n        }\n\n        this.range = range;\n        return { node: stripped || node, range };\n    }\n\n    _isSingleChildParent(n) {\n\n        if (!n || n.nodeType === 3)\n            return false;\n\n        let childrenCount = n?.children?.length;\n        return (\n            childrenCount === 0 ||\n            (() => {\n                let sweep = n.childNodes.length;\n                let divCount = 0;\n                let iHaveText = false;\n\n                while (sweep--) {\n                    let s = n.childNodes[sweep];\n\n                    if (s.nodeType === 3 && s.textContent.length > 0 && s.textContent !== '\\u200B')\n                        iHaveText = true;\n\n                    else if (s.nodeType === 1 && s.nodeName !== 'BR')\n                        divCount++;\n\n                    if (divCount > 1 || divCount && iHaveText)\n                        return false;\n                }\n\n                return true;\n            })()\n        );\n\n    }\n\n    _climbUpToEldestParent(node, wrapper, singleChildParent = false, callback) {\n        callback = callback || ((n) => {\n            return n;\n        });\n\n        if (!(wrapper instanceof Node) || wrapper?.nodeType === 3)\n            throw new Error('invalid wrapper node');\n\n        let id;\n        let uniqueId = wrapper.id || (() => {\n            id = this._generateId('eldest');\n            wrapper.id = id;\n            return id;\n        })();\n        // on single parent mode climb up if parent has only 1 child or 2 child with zero space text\n\n        while (\n            node?.id !== uniqueId &&\n            node.parentNode &&\n            node.parentNode.closest('#' + uniqueId) &&\n            node.parentNode.id !== uniqueId &&\n            (singleChildParent ? this._isSingleChildParent(node?.parentNode) : true)\n        ) {\n\n            let cb = callback(node.parentNode);\n\n            if (!cb || cb === 'BREAK')\n                break;\n\n            node = cb;\n        }\n\n        if (id)\n            wrapper.removeAttribute('id');\n\n        return node;\n    }\n\n    _isSelectionWithinRestrictedRange(range = this.range, element = this.element) {\n        if (!range)\n            return true;\n\n        let { commonAncestorContainer, startContainer, endContainer } = range;\n        let restrict = this.restrictedElement_queryArray;\n        let startLine = this._climbUpToEldestParent(startContainer, element);\n        let endLine = this._climbUpToEldestParent(endContainer, element);\n\n        if (startLine === endLine) {\n            commonAncestorContainer = commonAncestorContainer.nodeType === 3 ? commonAncestorContainer.parentNode : commonAncestorContainer;\n            for (let r of restrict) {\n                let cl = commonAncestorContainer.closest(this._classNameToQuery(r));\n                if (cl)\n                    return r;\n            }\n        } else {\n            while (startLine && startLine !== endLine) {\n                startLine = startLine.nextSibling;\n                if (startLine) {\n                    if (startLine.nodeType === 1)\n                        for (let r of restrict) {\n                            if (startLine.classList.contains(r))\n                                return r;\n                        }\n                } else\n                    break;\n            }\n        }\n\n        return false;\n    }\n\n    _classNameToQuery(q) {\n        if (q.includes('_stop') && q[0] !== '.')\n            return '.' + q;\n        return q[0] === '_' ? '.' + q : q;\n    }\n\n    _createEmptyParagraph(append) {\n        let p = document.createElement('p');\n\n        if (append && typeof append === 'string')\n            append = document.createTextNode(append);\n\n        p.append(append || document.createTextNode(''));\n\n        if (!append)\n            p.append(document.createElement('br'));\n\n        return p;\n    }\n\n    _trackStyle(n, cls) {\n        let commandTracker = {};\n        let style = window.getComputedStyle(n);\n\n        for (let c of this.alignClass) {\n            if (n.closest('.' + c))\n                commandTracker[c.substring(1, c.length - 1)] = true;\n        }\n\n        let checker = (sp) => {\n            let key = this.cssPropertyChecker[sp];\n            if (typeof key === 'function') {\n                key = key(style[sp]);\n                if (key) {\n                    if (cls)\n                        return key;\n                    commandTracker[key] = true;\n                }\n            } else if (sp === 'color' && style[sp]) {\n\n                let col = style[sp][0] === '#' ? style[sp] : new ColorMangle(style[sp]).hex();\n\n                if (col !== this.defaultFontColor) {\n                    if (cls)\n                        return col;\n                    commandTracker[key] = col;\n                }\n\n            } else if (style[sp] !== this.elementComputedStyle[sp] && this._isTextElement(n)) {\n                if (cls)\n                    return true;\n                commandTracker[key] = true;\n            }\n            return false;\n        };\n\n        if (cls)\n            return checker(this.cssPropertyOf[cls.toLowerCase()]);\n\n        for (let sp in this.cssPropertyChecker) {\n            checker(sp);\n        }\n\n        return commandTracker;\n    }\n\n    _lastLineBlank() {\n        if (this.lastLineBlank) {\n            let lastLine = this.element.lastChild;\n            if (lastLine.nodeName !== 'P' ||\n                lastLine.nodeName === 'P' && lastLine.textContent && lastLine.textContent !== '\\u200B') {\n                this.element.append(this._createEmptyParagraph());\n            }\n        }\n    }\n\n    _setEventListener(listen) {\n        /**\n         * keydown -> observer(dom change) -> selection change -> click | keyup\n         */\n\n        document.removeEventListener('selectionchange', this._selectionchange);\n        this.imgInput = null;\n        if (this.element) {\n            this.element.removeEventListener('keydown', this._keydown);\n            this.element.removeEventListener('mousedown', this._normalize);\n            window.removeEventListener('mousedown', this._normalize);\n            this.element.removeEventListener('paste', this._paste);\n            this.element.removeEventListener('keyup', this._keyup);\n        }\n\n        if (!listen)\n            return;\n\n        //  image selector\n        let imgInput = document.createElement('input');\n        for (const [key, value] of Object.entries({\n            id: this._generateId('imageInput'),\n            type: 'file',\n            accept: 'image/gif,image/png,image/jpeg,image/webp',\n            hidden: true,\n            multiple: true\n        })) {\n            imgInput.setAttribute(key, value);\n        }\n\n        this.imgInput = imgInput;\n        this.imgInput.addEventListener('change', e => {\n            this._imageSelected(e).catch(err => {\n                console.error(err);\n            });\n        });\n\n        this._selectionchange = (function () {\n            this._modifySelection(() => {\n                let isForward = !(this.lastKey === 'DELETE' || this.lastKey === 'BACKSPACE') || this.isRangeDirectionForward;\n\n                let rangeHeader = isForward ? this.range.endContainer : this.range.startContainer;\n                this.lastKey = null;\n\n                //  nudge range in-case carat is within non selectables\n                let unSel = this._isUnSelectableElement(rangeHeader);\n                if (unSel) {\n                    let selNext = isForward ? unSel.nextSibling : unSel.previousSibling;\n\n                    if (!selNext && !isForward) {\n                        selNext = document.createTextNode('\\u200B');\n                        unSel.parentNode.insertBefore(selNext, isForward ? unSel.nextSibling : unSel);\n                    }\n                    if (selNext)\n                        this.range = this._adjustSelection({\n                            node: this.range.collapsed ? selNext : isForward ? [null, selNext] : [selNext, null],\n                            position: this.range.collapsed ? isForward ? 0 : selNext.textContent.length : isForward ? [null, 0] : [0, null],\n                        });\n                }\n\n                //  track commandTracker\n                let commandTracker = {};\n                for (let style in this.styleTagOfCommand) {\n                    commandTracker[style] = false;\n                }\n\n                if (this._isSelectionWithinRestrictedRange()) {\n                    this.commandTracker = commandTracker;\n                    return;\n                }\n\n                let skipTrack = this.restrictedElement_queryArray.concat(this.specialTextElement_queryArray);\n                let crawlResult = this._nodeCrawler((node) => {\n                    if (node.nodeType === 1 && node.closest('blockquote') || node.nodeType === 3 && node.parentNode.closest('blockquote'))\n                        commandTracker.quote = true;\n\n                    let styleRestrictedParents = (c) => {\n                        return node.nodeType === 3 ? node.parentNode.closest(c) : node.nodeType === 1 ? node.closest(c) : !(node instanceof Node);\n                    };\n\n                    for (let p of skipTrack) {\n                        let chk = styleRestrictedParents(p);\n                        if (chk)\n                            return node;\n                    }\n\n                    if (\n                        node.nodeType === 3 ||\n                        node.nodeName === 'BR' ||\n                        node.nodeType === 1 &&\n                        node.childNodes.length === 1 &&\n                        (\n                            node.childNodes[0].nodeName === 'BR' ||\n                            node.childNodes[0].nodeType === 3\n                        )\n                    ) {\n\n                        let n = node.nodeType === 3 || node.nodeName === 'BR' ? node.parentNode : node;\n\n                        let comm = this._trackStyle(n);\n                        for (let c in comm)\n                            commandTracker[c] = comm[c];\n\n                    }\n                    return node;\n                }, { node: this.range, parentNode: this.element });\n\n                if (!crawlResult.node.length) {\n                    let comm = this._trackStyle(this.range.startContainer);\n                    for (let c in comm)\n                        commandTracker[c] = comm[c];\n                }\n\n                this.commandTracker = commandTracker;\n                let caratPosition;\n                let caratEl = this.isRangeDirectionForward ? this.range.endContainer : this.range.startContainer;\n\n                if (caratEl.nodeType === 3)\n                    caratPosition = this.range.getBoundingClientRect();\n                else if (caratEl.nodeType === 1)\n                    caratPosition = caratEl.getBoundingClientRect();\n\n                this._callback({ commandTracker, range: this.range, caratPosition }).catch(err => err);\n                this._lastLineBlank();\n            });\n        }).bind(this);\n\n        this._keydown = (function (e) {\n            if (this._isSelectionWithinRestrictedRange())\n                return;\n\n            this._modifySelection(() => {\n                if (!this.range)\n                    return;\n                let {\n                    startContainer,\n                    startOffset,\n                    collapsed,\n                    startLine,\n                    endLine\n                } = this.range;\n\n                let key = e.key.toUpperCase();\n                let shift = e.shiftKey;\n\n                this.lastKey = key;\n\n                if (key === 'ENTER' && e.shiftKey) {\n                    // prevent shift+enter\n                    if (!this.range.endLine.closest('LI'))\n                        e.preventDefault();\n                    return;\n                }\n\n                // delete key\n                if (['BACKSPACE', 'DELETE'].includes(key)) {\n                    this.isRangeDirectionForward = true;\n\n                    if (\n                        !this.element.textContent &&\n                        this.element.childNodes.length <= 1 &&\n                        this._isTextElement(this.element.childNodes[0]) &&\n                        this.element.childNodes[0] === startLine\n                    )\n                        // there is nothing to delete\n                        e.preventDefault();\n                    else if (this.range.collapsed) {\n                        let stc = this.range.startContainer;\n\n                        let block = (stc.nodeType === 3 ? stc.parentNode : stc).closest('blockquote');\n                        if (block && block.childNodes[0] === this._climbUpToEldestParent(stc, block) && this.range.startOffset === 0) {\n                            // cursor is on the first offset position within the blockquote\n                            e.preventDefault();\n                            this.command('quote');\n                        } else if (stc.nodeType === 1 && this._isTextBlockElement(stc) && !this.range.startOffset) {\n                            let t = document.createTextNode('\\u200B');\n                            stc.insertBefore(t, stc.childNodes[0]);\n                            this.range = this._adjustSelection({\n                                node: t,\n                                position: 0\n                            });\n                        }\n                    }\n                    return;\n                }\n\n                //  hashtag flag\n                if (key === '#' && !this.hashtag_flag) {\n                    this.hashtag_flag = true;\n                    return;\n                }\n\n                //  url flag\n                if ([':', '/', '.'].includes(key) && !this.urllink_flag) {\n                    this.urllink_flag = true;\n                    return;\n                }\n\n                // insert hashtag | urllink\n                if ((this.hashtag_flag || this.urllink_flag) && ([' ', 'ENTER', 'TAB'].includes(key) || key.includes('ARROW'))) {\n                    this._replaceText();\n                    // return;\n                }\n\n                // when user press shift + arrows to expand the selection range,\n                // this.isRangeDirectionForward is responsible of setting direction to expand\n                // when set to true, the endOffset will change when using shift + arrow\n                if (shift) {\n                    if (key === 'PAGEUP' || key === 'HOME') {\n                        this.isRangeDirectionForward = false;\n                        return;\n                    }\n\n                    if (key === 'PAGEDOWN' || key === 'END') {\n                        this.isRangeDirectionForward = true;\n                        return;\n                    }\n                }\n\n                if (key.includes('ARROW')) {\n                    this._setArrow(e);\n                    return;\n                }\n\n                if (key === 'TAB') {\n                    this.isRangeDirectionForward = true;\n\n                    e.preventDefault();\n                    let sweep_array = [];\n\n                    if (!collapsed) {\n                        let sweep = startLine;\n                        while (sweep && sweep !== endLine) {\n                            sweep_array.push(sweep);\n                            sweep = sweep.nextSibling;\n                        }\n                        sweep_array.push(endLine);\n                    }\n\n                    if (shift) {\n                        // delete indent\n                        let hasIndent = false;\n                        let diveAndRemoveTab = (n) => {\n                            while (n.childNodes[0]) {\n                                n = n.childNodes[0];\n\n                                while (n.nodeType === 3 && !n.textContent)\n                                    n = n.nextSibling;\n\n                                if (n.nodeType === 3 && n.textContent[0] === '\\t') {\n                                    hasIndent = true;\n                                    n.textContent = n.textContent.substring(1);\n                                    break;\n                                }\n                            }\n                        };\n                        if (sweep_array.length) {\n\n                            for (let n of sweep_array) {\n                                if (n.textContent[0] === '\\t')\n                                    diveAndRemoveTab(n);\n                            }\n                            if (hasIndent)\n                                this._adjustSelection({\n                                    node: [startLine, endLine],\n                                    position: [true, false]\n                                });\n                        } else if (startLine.textContent[0] === '\\t') {\n\n                            let lineOffset = (line, container, containerOffset) => {\n                                if (line === container)\n                                    return containerOffset;\n\n                                this._nodeCrawler(n => {\n                                    if (container === n)\n                                        return 'BREAK';\n\n                                    if (n.nodeType === 3 && n.textContent.length)\n                                        containerOffset += n.textContent.length;\n\n                                    return n;\n                                }, { node: line });\n                                return containerOffset;\n                            };\n\n                            let offset = lineOffset(startLine, startContainer, startOffset) - 1;\n                            offset = offset < 0 ? 0 : offset;\n\n                            diveAndRemoveTab(startLine);\n                            if (hasIndent)\n                                this._adjustSelection({ node: startLine, position: offset });\n                        }\n                    } else {\n                        // indent\n                        if (sweep_array.length) {\n                            let hasIndent = false;\n                            for (let n of sweep_array) {\n                                hasIndent = true;\n                                let tab = document.createTextNode('\\t');\n                                n.insertBefore(tab, n.childNodes[0]);\n                            }\n                            if (hasIndent)\n                                this._adjustSelection({\n                                    node: [startLine, endLine],\n                                    position: [true, false]\n                                });\n\n                        } else {\n                            let tab = document.createTextNode('\\t');\n                            this.range.insertNode(tab);\n                            this._adjustSelection({ node: tab, position: false });\n                        }\n                    }\n                    return;\n                }\n\n                if (key === 'ENTER') {\n                    //  remove zero space\n                    if (collapsed && (startContainer.textContent.includes('\\u200B') || !startContainer.textContent)) {\n\n                        this._nodeCrawler(n => {\n                            if (n.nodeType === 3 && (n.textContent === '\\u200B' || !n.textContent)) {\n                                n.remove();\n                            }\n\n                            return n;\n                        }, { node: startContainer.nodeType === 3 ? startContainer.parentNode : startContainer });\n                    }\n\n                    if (endLine.textContent[0] === '\\t') {\n                        for (let s of endLine.textContent) {\n                            if (s === '\\t')\n                                this.insertTabPending_tabString += '\\t';\n                            else break;\n                        }\n                    }\n                }\n\n                this.isRangeDirectionForward = true;\n            });\n\n        }).bind(this);\n        this._normalize = (function (e) {\n            e.stopPropagation();\n            this._modifySelection(() => {\n                if (this._isSelectionWithinRestrictedRange())\n                    return;\n                this._normalizeDocument(true);\n                this.range_backup = this.range.cloneRange();\n                this._replaceText(true);\n            });\n        }).bind(this);\n        this._paste = (function (e) {\n            e.preventDefault();\n            if (this._isSelectionWithinRestrictedRange())\n                return;\n            this._modifySelection(() => {\n                if (this.range) {\n                    if (this._isSelectionWithinRestrictedRange())\n                        return;\n                    let doc = document.createDocumentFragment();\n                    doc.textContent = e.clipboardData.getData('text/plain').replace(/\\n\\n/g, '\\n');\n\n                    if (doc.textContent.includes('#')) {\n                        this.hashtag_flag = true;\n                    }\n\n                    //  url flag\n                    for (let u of [':', '/', '.']) {\n                        doc.textContent.includes(u);\n                        this.urllink_flag = true;\n                    }\n\n                    if (!this.range.collapsed)\n                        this.range.extractContents();\n                    this.range.insertNode(doc);\n\n                }\n            });\n        }).bind(this);\n        this._keyup = (function () {\n            if (this.removeSandwichedLine_array.length)\n                while (this.removeSandwichedLine_array.length)\n                    this.removeSandwichedLine_array.pop().remove();\n        }).bind(this);\n\n        document.addEventListener('selectionchange', this._selectionchange);\n        this.element.addEventListener('keydown', this._keydown);\n        this.element.addEventListener('mousedown', this._normalize);\n        // this.element.addEventListener('blur', this._normalize);\n        // fuck safari, firefox\n        window.addEventListener('mousedown', this._normalize);\n        this.element.addEventListener('paste', this._paste);\n        this.element.addEventListener('keyup', this._keyup);\n    }\n\n    _observeMutation(track) {\n        if (this.observer)\n            this.observer.disconnect();\n\n        this.observer = null;\n\n        if (!track)\n            return;\n\n        this.observer = new MutationObserver(mutation_array => {\n\n            if (this.logMutation) {\n                let monitor = mutation_array.map(m => {\n                    return {\n                        target: m.target.cloneNode(true),\n                        type: m.type,\n                        name: m.attributeName,\n                        added: (() => {\n                            let clones = [];\n                            for (let a of m.addedNodes) {\n                                if (a.nodeType === 3)\n                                    clones.push(a.textContent);\n                                else\n                                    clones.push(a.cloneNode(true));\n                            }\n                            return clones;\n                        })(),\n                        removed: (() => {\n                            let clones = [];\n                            for (let r of m.removedNodes) {\n                                if (r.nodeType === 3)\n                                    clones.push(r.textContent);\n                                else\n                                    clones.push(r.cloneNode(true));\n                            }\n                            return clones;\n                        })()\n                    };\n                });\n\n                let mutate = [];\n                for (let m of monitor) {\n                    if (m.type === 'childList' || m.attributeName === 'class')\n                        mutate.push(m);\n                }\n\n                if (mutate.length)\n                    this._callback({ mutation: mutate }).catch(_ => {\n                    });\n            }\n\n            for (const mutation of mutation_array) {\n\n                /** changes in attributes */\n                if (mutation.type === 'attributes') {\n                    const { target, attributeName } = mutation;\n                    if (attributeName === 'class') {\n                        if (target.parentNode && !target.classList.length && !(this._isTextBlockElement(target) || this._isBlockElement(target) || target.nodeName === 'P')) {\n                            // this._unwrapElement(target);\n                            this._wrapNode(target);\n                        }\n                        if (!target.classList.length)\n                            target.removeAttribute('class');\n                    }\n                    //  prevent style attributes\n                    if (attributeName === 'style' && !this._isStyleAllowedElement(target))\n                        target.removeAttribute('style');\n                    continue;\n                }\n\n                /** changes in node */\n                if (mutation.type === 'childList') {\n                    let mutationTarget = mutation.target;\n\n                    /** removed nodes */\n                    if (mutation.removedNodes.length) {\n                        for (let m of mutation.removedNodes) {\n\n                            /**\n                             *  CAUTION!\n                             *  changing the order of if statements below can lead to critical flaw\n                             *  _custom_ class should always be checked after _urllink_ and _hashtag_\n                             */\n\n                            let callbackRemoved = (what, m) => {\n                                if (!m.id)\n                                    return;\n\n                                let arrIdx = this[`${what}_array`].length;\n                                let removed;\n\n                                while (arrIdx--) {\n                                    let got = this[`${what}_array`][arrIdx];\n                                    if (got.elementId === m.id) {\n                                        removed = this[`${what}_array`].splice(arrIdx, 1);\n                                        break;\n                                    }\n                                }\n\n                                if (removed) {\n                                    this._callback({ removed: { [what]: removed } }).catch(err => {\n                                        throw err;\n                                    });\n                                }\n                            };\n\n                            if (m?.classList?.contains('_media_')) {\n                                let child = m.childNodes;\n                                let childIdx = child.length;\n                                while (childIdx--) {\n                                    let c = child[childIdx];\n                                    switch (c.nodeName) {\n                                        case 'IMG':\n                                            callbackRemoved('image', c);\n                                            break;\n                                    }\n                                }\n                                continue;\n                            }\n\n                            let toBreak = false;\n                            for (let t of ['hashtag', 'urllink', 'custom']) {\n                                if (m?.id?.includes(t)) {\n                                    callbackRemoved(t, m);\n                                    toBreak = true;\n                                    break;\n                                }\n                            }\n\n                            toBreak = false;\n\n                            //this._isCeilingElement(mutationTarget) &&\n                            if ((() => {\n                                let idx = mutationTarget.childNodes.length;\n                                if (idx)\n                                    while (idx--) {\n                                        let node = mutationTarget.childNodes[idx];\n                                        if (node.nodeType === 1 || node.textContent) {\n                                            return false;\n                                        }\n                                    }\n                                return true;\n                            })()) {\n                                mutationTarget.remove();\n                                continue;\n                            }\n\n                            if (this._isTextBlockElement(mutationTarget) && mutationTarget.childNodes.length === 1\n                                && this._isUnSelectableElement(mutationTarget.childNodes[0]))\n                                mutationTarget.append(document.createTextNode(''));\n                        }\n                    }\n\n                    /** added nodes */\n                    if (mutation.addedNodes.length)\n                        for (let i of mutation.addedNodes) {\n\n                            let getBr = (n) => {\n                                let idx = n?.childNodes?.length;\n                                let br = [];\n                                while (idx--) {\n                                    let c = n.childNodes[idx];\n                                    if (c.nodeName === 'BR')\n                                        br.push(c);\n                                }\n                                return br;\n                            };\n\n                            if (i.nodeType === 3) {\n                                // wrap all eldest text node\n                                if (this._isCeilingElement(mutationTarget))\n                                    this._wrapNode(i, document.createElement('p'));\n\n                                // remove <br> when there is text\n                                else if (i.textContent && i.textContent !== '\\u200B') {\n                                    // prevent br added to line\n                                    let br = getBr(mutationTarget);\n                                    if (br.length)\n                                        for (let b of br)\n                                            b.remove();\n                                }\n\n                                continue;\n                            }\n\n                            if (i.nodeType === 1) {\n\n                                let node = (() => {\n                                    let isWysiwygChild = i.closest(`#${this.elementId}`) && i.id !== this.elementId;\n                                    let isWysiwygEldestChild = (() => {\n                                        if (!isWysiwygChild)\n                                            return false;\n\n                                        return this._isCeilingElement(mutationTarget);\n                                    })();\n\n                                    let ceiling = (() => {\n                                        for (let c of this.ceilingElement_queryArray) {\n                                            let clo = i.closest(c);\n                                            if (clo)\n                                                return clo;\n                                        }\n                                        return null;\n                                    })();\n\n                                    let line = isWysiwygEldestChild ? i : isWysiwygChild && (() => {\n                                        let m = i;\n                                        while (m && !this._isCeilingElement(m.parentNode)) {\n                                            m = m.parentNode;\n                                        }\n                                        return m;\n                                    })();\n\n                                    return {\n                                        isWysiwygChild,\n                                        isWysiwygEldestChild,\n                                        isMediaElement: i.closest('._media_'),\n                                        isBlockQuoteElement: i.closest('blockquote'),\n                                        isCustomElement: i.closest('._custom_'),\n                                        isHashtagElement: i.closest('._hashtag_'),\n                                        isUrlLinkElement: i.closest('._urllink_'),\n                                        ceiling,\n                                        line\n                                    };\n                                })();\n\n                                if (!node.isWysiwygChild)\n                                    continue; // bypass\n\n                                if (\n                                    node.isCustomElement ||\n                                    node.isMediaElement ||\n                                    node.isHashtagElement ||\n                                    node.isUrlLinkElement\n                                ) {\n                                    // make sure un-editable element is secure\n                                    (node.isCustomElement ||\n                                        node.isMediaElement ||\n                                        node.isHashtagElement ||\n                                        node.isUrlLinkElement).setAttribute('contenteditable', 'false');\n                                    continue;\n                                }\n\n                                if (!(node.isWysiwygEldestChild && (this._isBlockElement(i) || this._isTextBlockElement(i))) &&\n                                    i.nodeName !== 'BR' &&\n                                    !i.classList.length) {\n                                    // unwrap anything that does not have class and is not block level text\n                                    this._wrapNode(i);\n                                    continue;\n                                }\n\n                                if ((() => {\n                                    if (this._isStyleAllowedElement(i))\n                                        return false;\n\n                                    for (let sa of this.restrictedElement_queryArray) {\n                                        if (i.closest(sa))\n                                            return false;\n                                    }\n\n                                    return true;\n                                })())\n                                    //  remove style attribute if not allowed\n                                    i.removeAttribute('style');\n\n                                if (node.isWysiwygEldestChild && !(this._isBlockElement(i) || this._isTextBlockElement(i))) {\n                                    //  wrap eldest non text block element to p\n                                    if (i.nodeName === 'BR')\n                                        i.remove();\n                                    else\n                                        this._wrapNode(i, document.createElement('p'), true);\n                                    continue;\n                                }\n\n                                if (mutationTarget.textContent && mutationTarget.textContent !== '\\u200B') {\n                                    // prevent br added to line\n                                    let br = getBr(mutationTarget);\n                                    let doContinue = false;\n                                    if (br.length)\n                                        for (let b of br) {\n                                            if (b === i)\n                                                doContinue = true;\n                                            b.remove();\n                                        }\n                                    if (doContinue)\n                                        continue;\n                                }\n\n                                if (node.isWysiwygEldestChild && !this._isCeilingElement(i)) {\n                                    // add tab on new line created by pressing enter\n                                    if (this.insertTabPending_tabString) {\n                                        let tab = document.createTextNode(this.insertTabPending_tabString);\n                                        node.line.insertBefore(tab, node.line.childNodes[0]);\n                                        this.insertTabPending_tabString = '';\n                                        this._adjustSelection({ node: tab, position: false });\n                                    }\n\n                                    // if empty text block is added add br\n                                    if (!node.line.textContent || node.line.textContent === '\\u200B') {\n                                        let addBr = true;\n                                        this._nodeCrawler(n => {\n                                            if (n.nodeName === 'BR') {\n                                                addBr = false;\n                                                return 'BREAK';\n                                            }\n                                            return n;\n                                        }, { node: node.line });\n\n                                        if (addBr)\n                                            node.line.append(document.createElement('br'));\n                                    }\n\n                                    continue;\n                                }\n\n                                let classSet = (c) => {\n                                    let counter = this.counterTagOf[c] || [];\n\n                                    if (counter.length)\n                                        counter = counter.concat(counter.map(m => {\n                                            return m + '_stop';\n                                        }));\n\n                                    return [\n                                        c,\n                                        c.includes('_stop') ? c.replace('_stop', '') : c + '_stop'\n                                    ].concat(counter);\n                                };\n\n                                let toUnwrap = [];\n\n                                if (i.classList.length) {\n\n                                    this._climbUpToEldestParent(i, node.ceiling, true, n => {\n\n                                        let cIdx = i.classList.length;\n                                        while (cIdx--) {\n                                            if (\n                                                (() => {\n                                                    let set = classSet(i.classList[cIdx]);\n                                                    for (let s of set) {\n                                                        if (n.classList.contains(s))\n                                                            return true;\n                                                    }\n                                                    return false;\n                                                })()\n                                            )\n                                                toUnwrap.push(n);\n                                        }\n\n                                        return n;\n                                    });\n\n                                }\n\n                                let idx = toUnwrap.length;\n\n                                while (idx--) {\n                                    // unwrap unnecessary counter parents\n                                    this._wrapNode(toUnwrap[idx]);\n                                }\n\n                                let class_idx = i.classList.length;\n                                while (class_idx--) {\n                                    let className = i.classList[class_idx];\n                                    let curSt = this._trackStyle(i, className.replace('_stop', ''));\n                                    let parSt = this._trackStyle(i.parentNode, className.replace('_stop', ''));\n\n                                    if (curSt === parSt)\n                                        // remove style class if parent shares the same style\n                                        i.classList.remove(className);\n                                }\n\n                                if (!i.classList.length) {\n                                    // remove style attribute if there is no class\n                                    i.removeAttribute('class');\n                                }\n\n                                if (this._isTextBlockElement(mutationTarget) && mutationTarget.childNodes.length === 1\n                                    && this._isUnSelectableElement(mutationTarget.childNodes[0]))\n                                    mutationTarget.append(document.createTextNode(''));\n                            }\n                        }\n                }\n            }\n        });\n        this.observer.observe(this.element, {\n            attributes: true,\n            childList: true,\n            subtree: true\n        });\n\n    }\n\n    _setArrow(e) {\n        if (!this.range || !e?.key)\n            return;\n\n        let\n            endContainer,\n            endOffset,\n            startContainer,\n            startOffset,\n            collapsed,\n            startLine,\n            endLine,\n            isAllRangeOnSameLine,\n            currentLine,\n            caratElement,\n            arrowDirection;\n\n        let key = e.key.toUpperCase();\n        let shift = e?.shiftKey || false;\n        let metaKey = e?.ctrlKey || e?.metaKey || false;\n        let rangeSetup = () => {\n            endContainer = this.range.endContainer;\n            endOffset = this.range.endOffset;\n            startContainer = this.range.startContainer;\n            startOffset = this.range.startOffset;\n            collapsed = this.range.collapsed;\n            startLine = this.range.startLine;\n            endLine = this.range.endLine;\n            isAllRangeOnSameLine = startLine === endLine;\n            currentLine = this.isRangeDirectionForward ? endLine : startLine;\n            caratElement = this.isRangeDirectionForward ? endContainer : startContainer;\n            caratElement = caratElement.nodeType === 3 ? caratElement.parentNode : caratElement;\n        };\n\n\n        let preventDefault = () => {\n            try {\n                e.preventDefault();\n            } catch (err) {\n            }\n        };\n\n        let removeZeroSpace = () => {\n            let targetContainer = this.isRangeDirectionForward ? endContainer : startContainer;\n            let nudged = false;\n\n            if (collapsed && (targetContainer.textContent.includes('\\u200B') || !targetContainer.textContent)) {\n\n                this._nodeCrawler(n => {\n                    if (n.nodeType === 3 && (n.textContent === '\\u200B' || !n.textContent)) {\n\n                        let r = n.nextSibling || n.parentNode;\n                        let siblingDirection = this.isRangeDirectionForward ? 'nextSibling' : 'previousSibling';\n\n                        if (n === targetContainer || (() => {\n                            // fuck safari\n                            if (targetContainer.nodeType === 1) {\n                                let idx = targetContainer.childNodes.length;\n                                while (idx--) {\n                                    if (targetContainer.childNodes[idx] === n)\n                                        return true;\n                                }\n                                return false;\n                            }\n                        })()) {\n\n                            let run = r;\n                            if (run.nodeType === 1 && n.parentNode === run) {\n                                if (run[siblingDirection])\n                                    nudged = run[siblingDirection];\n                            } else\n                                nudged = r;\n\n                            n.remove();\n\n                            this.range = this._adjustSelection({\n                                node: !collapsed ? this.isRangeDirectionForward ? [null, nudged || r] : [nudged || r, null] : nudged,\n                                position: !collapsed ? this.isRangeDirectionForward ? [null, nudged] : [!nudged, null] : this.isRangeDirectionForward,\n                            });\n\n                            rangeSetup();\n                            preventDefault();\n                            return 'BREAK';\n                        }\n                    }\n                    return n;\n                }, { node: targetContainer });\n\n            }\n            return !!nudged;\n        };\n\n        let isCaratOnMultiLine = (el) => {\n            // check if carat is on the first / last line of multi wrapped line\n\n            let posTarget = arrowDirection === 'DOWN' ? 'bottom' : 'top';\n            let caratViewPortPosition = this.range.getBoundingClientRect();\n            let elPosition = el.getBoundingClientRect()[posTarget];\n            let phoneTextSize = parseInt(this.fontSizeCssVariable['--wysiwyg-font-phone']);\n\n            if (caratViewPortPosition.height) {\n                let isLastLine = ((posTarget === 'bottom' ? elPosition - caratViewPortPosition[posTarget] : caratViewPortPosition[posTarget] - elPosition) < phoneTextSize);\n                return !isLastLine;\n            }\n\n            return false;\n        };\n\n        let nudgeRangeToInlineElement = () => {\n\n            let rem = removeZeroSpace();\n\n            if (!rem && window.getComputedStyle(caratElement).display === 'inline-block') {\n\n                let _caratElement = caratElement.nodeType === 3 ? caratElement.parentNode : caratElement;\n                while (window.getComputedStyle(_caratElement).display === 'inline-block') {\n                    _caratElement = _caratElement.parentNode;\n                }\n\n                let siblingDirection = arrowDirection === 'UP' ? 'previousSibling' : 'nextSibling';\n                let nextEl = _caratElement[siblingDirection];\n\n                if (!nextEl) {\n                    let t = document.createTextNode('');\n                    _caratElement.parentNode.insertBefore(t, siblingDirection === 'previousSibling' ? _caratElement : nextEl);\n                }\n\n                _caratElement = _caratElement[siblingDirection];\n\n                if (_caratElement) {\n                    let setDirection = (() => {\n                        return arrowDirection === 'DOWN';\n                    })();\n\n                    this.range = this._adjustSelection({\n                        node: shift ? (this.isRangeDirectionForward ? [null, _caratElement] : [_caratElement, null]) : _caratElement,\n                        position: shift ? (this.isRangeDirectionForward ? [null, setDirection] : [setDirection, null]) : setDirection\n                    });\n\n                    rangeSetup();\n\n                    return true;\n                }\n            }\n            return false;\n        };\n\n        rangeSetup();\n\n        switch (key) {\n            case 'ARROWLEFT':\n                arrowDirection = 'LEFT';\n            case 'ARROWRIGHT':\n                arrowDirection = arrowDirection || 'RIGHT';\n\n                if (metaKey || collapsed && shift) {\n                    this.isRangeDirectionForward = arrowDirection === 'RIGHT';\n                    rangeSetup();\n                }\n\n                let caratOnSingleLine = !isCaratOnMultiLine(caratElement);\n\n                let nudged;\n                if (caratOnSingleLine) {\n\n                    if (metaKey && arrowDirection === 'RIGHT')\n                        nudged = nudgeRangeToInlineElement();\n                }\n\n                if (!nudged)\n                    removeZeroSpace();\n\n                break;\n\n            case 'ARROWUP':\n                arrowDirection = 'UP';\n            case 'ARROWDOWN':\n                arrowDirection = arrowDirection || 'DOWN';\n\n                if (!collapsed && !shift) {\n                    preventDefault();\n                    let adj = arrowDirection === 'UP' ? [startContainer, startOffset] : [endContainer, endOffset];\n                    this.range = this._adjustSelection({ node: adj[0], position: adj[1] });\n                    break;\n                }\n\n                if (collapsed || isAllRangeOnSameLine) {\n                    this.isRangeDirectionForward = arrowDirection === 'DOWN';\n                    rangeSetup();\n                }\n\n                if (isCaratOnMultiLine(caratElement))\n                    break;\n\n                let iNudged = nudgeRangeToInlineElement();\n\n                if (iNudged)\n                    break;\n                else\n                    removeZeroSpace();\n\n                let isMultiLine = isCaratOnMultiLine(currentLine);\n                if (isMultiLine)\n                    break;\n\n\n                let eldestParentOfCurrentLine = this._climbUpToEldestParent(currentLine, this.element);\n\n                let isCurrentLineInsideSubCeiling =\n                    eldestParentOfCurrentLine.id !== this.elementId && this._isCeilingElement(eldestParentOfCurrentLine);\n\n                // break out if current line is inside the sub ceiling and it's not on the last line\n                if (\n                    isCurrentLineInsideSubCeiling &&\n                    (\n                        arrowDirection === 'UP' && eldestParentOfCurrentLine.firstChild !== currentLine ||\n                        arrowDirection === 'DOWN' && eldestParentOfCurrentLine.lastChild !== currentLine\n                    )\n                )\n                    break;\n\n\n                let siblingSet = [\n                    isCurrentLineInsideSubCeiling ? eldestParentOfCurrentLine.previousSibling : currentLine.previousSibling,\n                    isCurrentLineInsideSubCeiling ? eldestParentOfCurrentLine.nextSibling : currentLine.nextSibling\n                ];\n\n                if (arrowDirection === 'UP')\n                    siblingSet.reverse();\n\n                let [backwardNode, forwardNode] = siblingSet;\n\n                // if current line is on last line of sub ceiling set forward node to sub ceiling\n                let _forwardNode = isCurrentLineInsideSubCeiling ? eldestParentOfCurrentLine : forwardNode;\n                if (_forwardNode) {\n                    if (this._isBlockElement(_forwardNode) && !shift) {\n                        preventDefault();\n\n                        let leap = arrowDirection === 'UP' ? _forwardNode.previousSibling : _forwardNode.nextSibling;\n\n                        if (!leap || this._isBlockElement(leap)) {\n                            let p = this._createEmptyParagraph();\n                            _forwardNode.parentNode.insertBefore(p, arrowDirection === 'UP' ? _forwardNode : leap);\n                            _forwardNode = p;\n                        } else\n                            _forwardNode = leap;\n\n                        this.range = this._adjustSelection({\n                            node: _forwardNode,\n                            position: arrowDirection === 'DOWN',\n                        });\n\n                        if (\n                            !shift && !currentLine.textContent &&\n                            (this._isBlockElement(backwardNode) || !backwardNode && currentLine === this.element.firstChild)\n                        )\n                            this.removeSandwichedLine_array.push(currentLine);\n                    } else if (!isMultiLine && arrowDirection === 'DOWN') {\n                        preventDefault();\n                        let collectOffset = 0;\n                        let currentOffset = this.isRangeDirectionForward ? endOffset : startOffset;\n                        this._nodeCrawler(n => {\n                            if (n === endContainer)\n                                return 'BREAK';\n                            else if (n.nodeType === 3 && n.textContent)\n                                collectOffset += n.textContent.length;\n                            return n;\n                        }, {\n                            node: currentLine\n                        });\n                        collectOffset += currentOffset;\n                        this.range = this._adjustSelection({\n                            node: collapsed ? forwardNode : this.isRangeDirectionForward ? [null, forwardNode] : [forwardNode, null],\n                            position: collapsed ? collectOffset : this.isRangeDirectionForward ? [null, collectOffset] : [collectOffset, null]\n                        });\n                    }\n                } else\n                    preventDefault();\n        }\n    }\n\n    _append(i, insertAfter, wrap = false, focusElement) {\n        let common = this._climbUpToEldestParent(this.range.commonAncestorContainer, this.element);\n        let startLine = this._climbUpToEldestParent(this.range.startContainer, this.element);\n        let endLine = this._climbUpToEldestParent(this.range.endContainer, this.element);\n        let insertRestricted = ['HR', 'UL', 'LI', '._media_', '._custom_'];\n\n        let append = (node) => {\n            if (node === this.element)\n                node = this.element.childNodes[this.element.childNodes.length - 1];\n\n            let next = node.nextSibling;\n            if (insertAfter)\n                node.parentNode.insertBefore(insertAfter, next);\n\n            node.parentNode.insertBefore(i, insertAfter || next);\n            if (this._isTextElement(node) && !node.textContent && this.element.lastChild !== node)\n                node.remove();\n        };\n\n        if (wrap) {\n            let nodeToUnwrap = {};\n            let restricted = false;\n\n            let checker = (tag, el) => {\n                if (el && (!nodeToUnwrap[tag] || (() => {\n                    for (let u in nodeToUnwrap) {\n                        if (nodeToUnwrap[u] === el)\n                            return false;\n                    }\n                    return true;\n                })()))\n                    nodeToUnwrap[tag] = el;\n            };\n\n            if (this.range.collapsed) {\n                checker(i.nodeName, startLine.closest(i.nodeName));\n\n                let idx = i.classList.length;\n                while (idx--) {\n                    let className = i.classList[idx];\n                    checker(className, startLine.closest('.' + className));\n                }\n            } else\n                this._nodeCrawler(n => {\n                    let chk = n.nodeType === 3 ? n.parentNode : n;\n                    if (chk.nodeType !== 1) {\n                        restricted = true;\n                        return 'BREAK';\n                    }\n\n                    if (n.nodeType === 1) {\n                        for (let notAllowed of insertRestricted)\n                            if (n.nodeName === notAllowed || n.closest(notAllowed)) {\n                                restricted = true;\n                                return 'BREAK';\n                            }\n                    }\n\n                    checker(i.nodeName, chk.closest(i.nodeName));\n\n                    let idx = i.classList.length;\n                    while (idx--) {\n                        let className = i.classList[idx];\n                        checker(className, chk.closest('.' + className));\n                    }\n\n                    if (n === this.range.endContainer)\n                        return 'BREAK';\n\n                    return n;\n                }, { node: common, startNode: this.range.startContainer });\n\n            if (restricted)\n                return;\n\n            if (Object.keys(nodeToUnwrap).length) {\n                for (let u in nodeToUnwrap)\n                    this._wrapNode(nodeToUnwrap[u]);\n\n            } else {\n\n                append(endLine);\n\n                let extract = this.range.extractContents();\n\n                if (extract.childNodes[0]) {\n                    while (extract.childNodes[0]) {\n                        let t = extract.childNodes[0];\n                        if (!t.textContent)\n                            t.remove();\n                        else\n                            i.append(t);\n                    }\n                } else i.append(this._createEmptyParagraph());\n\n                this.range = this._adjustSelection({\n                    node: focusElement || i,\n                    position: false\n                });\n\n                //  remove garbage node\n                let fc = i.previousSibling;\n                // let lc = i.nextSibling;\n\n                if (fc) {\n                    fc = fc.nodeType === 3 ? fc.parentNode : fc;\n\n                    if (this._isTextElement(fc) && (!fc.textContent || fc.textContent === '\\u200B'))\n                        fc.remove();\n                }\n            }\n\n            return;\n        }\n\n        for (let r of insertRestricted) {\n            if (endLine.closest(r))\n                endLine = endLine.closest(r);\n        }\n\n        append(endLine);\n\n        if (insertAfter)\n            this.range = this._adjustSelection({ node: focusElement || insertAfter });\n\n    }\n\n    _callback(data) {\n        return new Promise(res => {\n            if (typeof this.callback === 'function') {\n                let cb = this.callback(data) || data;\n                if (cb instanceof Promise)\n                    cb.then(r => {\n                        res(r);\n                    });\n\n                res(cb || data);\n            }\n            res(data);\n        });\n    }\n\n    async _imageSelected(e) {\n        let files = e.target.files;\n\n        const prepareForCallback = { image: [] };\n        let readFile = new FileReader();\n\n        const load = (file) => {\n            return new Promise(res => {\n                readFile.onload = f => {\n                    const { lastModified, name, size, type } = file;\n                    const source = f.target.result;\n\n                    let img = new Image;\n                    img.onload = () => {\n                        res({\n                            dimension: {\n                                width: img.width,\n                                height: img.height\n                            },\n                            lastModified,\n                            filename: name,\n                            fileSize: size,\n                            fileType: type,\n                            source,\n                            elementId: this._generateId('img')\n                        });\n                    };\n                    img.src = source;\n                };\n                readFile.readAsDataURL(file);\n            });\n        };\n\n        this.callback({ loading: true });\n        for (let idx = 0; files.length > idx; idx++) {\n            prepareForCallback.image[idx] = await load(files[idx]);\n        }\n        this.callback({ loading: false });\n\n        //  reset image input\n        this.imgInput.value = '';\n\n        let feedback = await this._callback(prepareForCallback);\n\n        if (!this.range) {\n            this.restoreLastSelection();\n        }\n        if (!this.range || (() => {\n            let c = this.range.commonAncestorContainer;\n            c = c.nodeType === 3 ? c.parentNode : c;\n            return !c.closest('#' + this.elementId);\n        })())\n            this.element.focus();\n\n        this._modifySelection(() => {\n            for (let img of feedback.image) {\n                let media = this._loadImage(img, document.createElement('div'));\n                this._append(media, this._createEmptyParagraph());\n            }\n        });\n\n    }\n\n    _loadImage(imageObject, wrapper) {\n        /**\n         elementId: \"img_uniqueId\"\n         element: HTML\n         fileSize: 0\n         fileType: \"image/jpeg\"\n         source: \"file.jpg | http://url.com/file.jpg | s3 filename | base 64 string\"\n         lastModified: 0000000000000\n         filename: \"selectedLocalFilename.jpg\"\n         */\n\n        if (wrapper instanceof Node) {\n            if (!wrapper.classList.contains('_media_'))\n                wrapper.classList.add('_media_');\n\n            if (wrapper.getAttribute('contenteditable') !== 'false')\n                wrapper.setAttribute('contenteditable', 'false');\n\n        } else\n            throw 'image needs _media_ wrapper';\n\n        let process = (i) => {\n\n            let image = i?.element instanceof Node ? i.element : null;\n\n            if (image) {\n                if (image.id)\n                    i.elementId = image.id;\n                else\n                    image.id = i.elementId;\n            }\n\n            if (!image) {\n                image = document.createElement('img');\n                i.element = image;\n\n                let classname = '_img_' + i.source.substring(i.source.length - 128).replace(/[/:.\"'\\\\@#$%\\?= \\{\\}\\|&*`!<>+]/g, '');\n                if (image.classList.contains(classname))\n                    image.classList.add(classname);\n\n                if (Array.isArray(i.class)) {\n                    for (let cl of i.class)\n                        image.classList.add(cl);\n                }\n\n                if (image.tagName === 'IMG')\n                    image.setAttribute('src', i.source);\n\n                if (typeof i.onclick === 'function') {\n                    image.addEventListener('click', i.onclick);\n                    image.classList.add('_hover_');\n                }\n\n                if (i.style && typeof i.style === 'object' && Object.keys(i.style).length) {\n                    for (let st in i.style) {\n                        wrapper.style.setProperty(st, i.style[st]);\n                    }\n                }\n            }\n\n            wrapper.setAttribute('contenteditable', 'false');\n            wrapper.append(image);\n\n            let pushArray = true;\n\n            for (let chk of this.image_array)\n                if (chk.elementId === i.elementId) {\n                    pushArray = false;\n                    break;\n                }\n\n            if (pushArray)\n                this.image_array.push(i);\n        };\n\n        process(imageObject);\n\n        return wrapper;\n    }\n\n    _modifySelection(run) {\n        let sel = window.getSelection();\n        if (sel) {\n            let anchorElement = sel.anchorNode?.nodeType === 3 ? sel.anchorNode.parentNode : sel.anchorNode;\n            if (anchorElement && anchorElement.closest(`#${this.elementId}`)) {\n                if (anchorElement.id === this.elementId) {\n                    // if (this._isCeilingElement(anchorElement)) {\n                    // In case selection is the wysiwyg element itself\n                    let lastChild = this.element.lastChild;\n                    if (!lastChild) {\n                        // Wysiwyg is empty\n                        lastChild = this._createEmptyParagraph();\n                        this.element.appendChild(lastChild);\n\n                        // Adjust selection\n                        this.range = this._adjustSelection({ node: lastChild, position: true });\n                    }\n\n                } else\n                    this.range = this._adjustSelection(null);\n\n                if (typeof run === 'function') run();\n                return;\n            }\n        }\n\n        this.range = null;\n        this.commandTracker = {};\n    }\n\n    _normalizeDocument(normalize) {\n        if (!normalize) return;\n\n        this._nodeCrawler(n => {\n            if (n.nodeType === 3 && (n.textContent.includes('\\u200B'))) { //!n.textContent ||\n                n.textContent = n.textContent.replace('\\u200B', '');\n\n                if (!n.textContent) {\n                    let cel;\n                    for (let c of this.ceilingElement_queryArray)\n                        if (n.parentNode.closest(c)) {\n                            cel = n.parentNode.closest(c);\n                            break;\n                        }\n\n                    let el = this._climbUpToEldestParent(n, cel, true);\n\n                    let par = el.parentNode;\n                    if (!this._isCeilingElement(par) && !el.textContent && this.element.lastChild !== el) {\n                        par.removeChild(el);\n                        n = par;\n                    }\n                    return n;\n                }\n            } else if (n.nodeType === 1) n.normalize();\n\n            return n;\n        }, { node: this.element });\n    }\n\n    _replaceText(wholeDocument = false) {\n\n        const process = (typeName, setData) => {\n            if (!this[typeName])\n                return;\n\n            let regex = this[`${typeName}_regex`] || null;\n\n            if (regex === null)\n                throw new Error('no regex to process');\n\n            if (typeof setData !== 'function')\n                throw new Error('setData should be returning function');\n\n            let node = wholeDocument ? this.element : this.range?.commonAncestorContainer;\n\n            if (!node)\n                return;\n\n            if (node.nodeType === 3)\n                node = node.parentNode;\n\n            let res = (() => {\n                let className = `_${typeName}_`;\n                let element = [];\n                let collected = [];\n\n                let textNodes = [];\n                this._nodeCrawler(n => {\n                    if (n.nodeType === 3 && n.textContent) {\n                        if (\n                            n.nextSibling?.nodeType === 3 &&\n                            n.nextSibling.textContent &&\n                            n.nextSibling.textContent !== '\\u200B') {\n                            let par = n.parentNode;\n                            par.normalize();\n                            n = par;\n                        } else if (\n                            n.textContent !== '\\u200B' &&\n                            !n.parentNode.closest('.' + className)\n                        )\n                            textNodes.push(n);\n                    }\n\n                    return n;\n                }, { node });\n\n                textNodes.forEach((node) => {\n                    replaceTextNode(node, regex, function (matched) {\n                        if (matched.length > 1) {\n                            return {\n                                name: 'span',\n                                attrs: { 'class': `${className} ${className}${matched}` },\n                                content: matched\n                            };\n                        }\n                    });\n                });\n\n                function replaceTextNode(node, regex, handler) {\n                    let par = node.parentNode, nxt = node.nextSibling,\n                        doc = node.ownerDocument, hits;\n\n                    if (regex.global) {\n                        while (node && (hits = regex.exec(node.nodeValue))) {\n                            regex.lastIndex = 0;\n                            node = handleResult(node, hits, handler.apply(this, hits));\n                        }\n                    } else if ((hits = regex.exec(node.nodeValue)))\n                        handleResult(node, hits, handler.apply(this, hits));\n\n                    function handleResult(node, hits, results) {\n                        let orig = node.nodeValue;\n                        node.nodeValue = orig.slice(0, hits.index);\n                        [].concat(create(par, results)).forEach(function (n) {\n                            let res = par.insertBefore(n, nxt);\n                            element.push(res);\n                        });\n                        let rest = orig.slice(hits.index + hits[0].length);\n                        if (rest) {\n                            let text = doc.createTextNode(rest);\n                            return par.insertBefore(text, nxt);\n                        }\n                    }\n\n                    function create(el, o) {\n                        if (o.map) return o.map(function (v) {\n                            return create(el, v);\n                        });\n                        else if (typeof o === 'object') {\n                            let e = doc.createElementNS(o.namespaceURI || el.namespaceURI, o.name);\n                            if (o.attrs) for (let a in o.attrs) e.setAttribute(a, o.attrs[a]);\n                            if (o.content) [].concat(create(e, o.content)).forEach(e.appendChild, e);\n                            if (typeof o.content === 'string') collected.push(o.content);\n                            e.contentEditable = 'false';\n                            return e;\n                        } else return doc.createTextNode(o + '');\n                    }\n                }\n\n                let anchorText;\n                if (element.length) {\n                    for (let el of element) {\n                        anchorText = node.ownerDocument.createTextNode('');\n                        el.parentNode.insertBefore(anchorText, el.nextSibling);\n                    }\n                }\n                return { collected, element, anchorText };\n            })();\n\n            let textEl = res.element;\n\n            if (!wholeDocument) {\n                this.range = this._adjustSelection({\n                    node: res.anchorText,\n                    position: false\n                });\n            }\n\n            let toCallback = [];\n            let collectId = [];\n\n            if (textEl[0])\n                for (let el of textEl) {\n                    let elementId = this._generateId(typeName);\n                    el.setAttribute('id', elementId);\n                    let tc = setData(el) || {};\n                    tc.elementId = el.id;\n                    tc.element = el;\n\n                    el.removeAttribute('style');\n                    collectId.push(el.id);\n                    toCallback.push(tc);\n                }\n\n            if (toCallback.length) {\n                this._callback({ [typeName]: toCallback }).then(e => {\n                    for (let idx = 0; collectId.length > idx; idx++) {\n                        //  elementId is read only\n                        e[typeName][idx].elementId = collectId[idx];\n                    }\n\n                    if (Array.isArray(e[typeName]) && e[typeName].length)\n                        for (let h of e[typeName]) {\n                            let dom = document.getElementById(h.elementId);\n\n                            dom.setAttribute('id', h.elementId);\n                            dom.setAttribute('contenteditable', 'false');\n\n                            if (typeof h.onclick === 'function') {\n                                dom.addEventListener('click', h.onclick);\n                                dom.classList.add('_hover_');\n                            }\n\n                            if (h.style && typeof h.style === 'object' && Object.keys(h.style).length) {\n                                for (let s in h.style)\n                                    dom.style.setProperty(s, h.style[s]);\n                            }\n\n                            this[`${typeName}_array`].push(h);\n                        }\n                }).catch(err => {\n                    console.error(err);\n                });\n            }\n        };\n\n        if (this.urllink_flag) {\n            process('urllink', url => {\n\n                let u = url.textContent;\n                url.addEventListener('click', function () {\n                    if (!u.match(/^https?:\\/\\//i)) {\n                        u = 'http://' + u;\n                    }\n                    window.open(u, \"_blank\");\n                });\n\n                return { url: u };\n            });\n        }\n\n        if (this.hashtag_flag) {\n            process('hashtag', tag => {\n\n                let t = tag.textContent;\n                return { tag: t[0] === '#' ? t.substring(1) : t };\n\n            });\n        }\n\n        this.hashtag_flag = false;\n        this.urllink_flag = false;\n    }\n\n    _checkElement(node, chkArr, closest) {\n        if (node && node.nodeType === 1)\n            for (let c of chkArr) {\n                if (closest) {\n                    let clo = node.closest(c);\n                    if (node.closest(c))\n                        return clo;\n                } else if (\n                    c[0] === '#' ? node.id === c.substring(1) :\n                        c[0] === '.' ? node.classList.contains(c.substring(1)) :\n                            node.nodeName === c\n                )\n                    return true;\n            }\n        return false;\n    }\n\n    _isUnSelectableElement(node) {\n        node = node?.nodeType === 3 ? node.parentNode : node;\n        return this._checkElement(node, this.unSelectable_queryArray, true);\n    }\n\n    _isStyleAllowedElement(node) {\n        return this._checkElement(node, this.styleAllowedElement_queryArray);\n    }\n\n    _isCeilingElement(node) {\n        return this._checkElement(node, this.ceilingElement_queryArray);\n    }\n\n    _isBlockElement(node) {\n        return this._checkElement(node, this.blockElement_queryArray);\n    }\n\n    _isTextAreaElement(node) {\n        return this._checkElement(node, this.textAreaElement_queryArray);\n    }\n\n    _isTextBlockElement(node) {\n        node = node?.nodeType === 3 ? node.parentNode : node;\n        return this._checkElement(node, this.textBlockElement_queryArray);\n    }\n\n    _isSpecialTextElement(node) {\n        node = node?.nodeType === 3 ? node.parentNode : node;\n        return this._checkElement(node, this.specialTextElement_queryArray);\n    }\n\n    _isTextElement(node) {\n        node = node?.nodeType === 3 ? node.parentNode : node;\n        return (this._isTextBlockElement(node) || node.nodeName === 'SPAN') && !this._isSpecialTextElement(node);\n    }\n\n    /**\n     * List of command for editing wysiwyg text.\n     * @param {'quote'} action - Add blockquote below selected line.\n     * @also\n     * @param {'unorderedList'} action - Add unordered list below selected line.\n     * @also\n     * @param {'orderedList'} action - Add ordered list below selected line.\n     * @also\n     * @param {'divider'} action - Add HR below selected line.\n     * @also\n     * @param {'image'} action - Add image below selected line.\n     * @also\n     * @param {'alignLeft'} action - Align selected line to left.\n     * @also\n     * @param {'alignCenter'} action - Align selected line to center.\n     * @also\n     * @param {'alignRight'} action - Align selected line to right.\n     * @also\n     * @param {'color' | 'hex | rgb string | hsl string'} action - Apply color to selected text. If 'color' is given, the default focus color is applied to the text.\n     * @also\n     * @param {'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' | 'small' | 'bold' | 'italic' | 'underline' | 'strike'} action - Apply style to selection.\n     * @also\n     * @param {object} action - Custom element object\n     * @param {object | string} action.element - Custom element can be node objects | html string | string\n     * @param {string} action.elementId - Set custom elements parent id. Otherwise auto generated\n     * @param {object} action.style - Set custom elements parent css style\n     * @param {boolean} action.insert - Set custom element insert mode. If true, inserts element at carat position, otherwise appends on next line\n     */\n    command(action) {\n\n        if (!action)\n            return;\n\n        if (!this.range)\n            this.restoreLastSelection();\n\n        switch (action) {\n            case 'quote':\n                if (!this.range || (() => {\n                    let c = this.range.commonAncestorContainer;\n                    c = c.nodeType === 3 ? c.parentNode : c;\n                    return !c.closest('#' + this.elementId);\n                })())\n                    this.element.focus();\n\n                this._modifySelection(() => {\n                    let p = this._createEmptyParagraph(),\n                        bq = document.createElement('blockquote');\n                    this._append(bq, p, true);\n                });\n                return;\n            case 'unorderedList':\n                if (!this.range || (() => {\n                    let c = this.range.commonAncestorContainer;\n                    c = c.nodeType === 3 ? c.parentNode : c;\n                    return !c.closest('#' + this.elementId);\n                })())\n                    this.element.focus();\n\n                this._modifySelection(() => {\n                    let p = this._createEmptyParagraph(),\n                        li = document.createElement('li'),\n                        ul = document.createElement('ul');\n                    ul.append(li);\n                    this._append(ul, p, false, li);\n                });\n\n                return;\n            case 'orderedList':\n                if (!this.range || (() => {\n                    let c = this.range.commonAncestorContainer;\n                    c = c.nodeType === 3 ? c.parentNode : c;\n                    return !c.closest('#' + this.elementId);\n                })())\n                    this.element.focus();\n\n                this._modifySelection(() => {\n                    let p = this._createEmptyParagraph(),\n                        li = document.createElement('li'),\n                        ul = document.createElement('ol');\n                    ul.append(li);\n                    this._append(ul, p, false, li);\n                });\n\n                return;\n            case 'divider':\n                if (!this.range || (() => {\n                    let c = this.range.commonAncestorContainer;\n                    c = c.nodeType === 3 ? c.parentNode : c;\n                    return !c.closest('#' + this.elementId);\n                })())\n                    this.element.focus();\n\n                this._modifySelection(() => {\n                    let p = this._createEmptyParagraph(), hr = document.createElement('hr');\n                    hr.setAttribute('contenteditable', 'false');\n                    this._append(hr, p, false);\n                });\n                return;\n            case 'image':\n                this.imgInput.click();\n                return;\n            case 'alignLeft':\n            case 'alignCenter':\n            case 'alignRight':\n                if (!this.range)\n                    return;\n\n                this._modifySelection(() => {\n                    let startLine = this.range.startLine;\n                    let endLine = this.range.endLine;\n\n                    let collectLines = [];\n                    collectLines.push(startLine);\n\n                    while (collectLines[collectLines.length - 1] !== endLine) {\n                        let nextLine = collectLines[collectLines.length - 1].nextSibling;\n\n                        while (nextLine && !this._isTextBlockElement(nextLine)) {\n                            if (this._isCeilingElement(nextLine) && nextLine.firstChild && this._isTextBlockElement(nextLine.firstChild)) {\n                                nextLine = nextLine.firstChild;\n                                break;\n                            }\n                            nextLine = nextLine.nextSibling;\n                        }\n\n                        if (!nextLine && this._isCeilingElement(collectLines[collectLines.length - 1].parentNode))\n                            nextLine = collectLines[collectLines.length - 1].parentNode.nextSibling;\n\n                        if (nextLine)\n                            collectLines.push(nextLine);\n                        else\n                            break;\n                    }\n\n                    let commandTracker = Object.assign({}, this.commandTracker);\n\n                    for (let l of collectLines) {\n                        for (let c of this.alignClass) {\n                            if (l.classList.contains(c))\n                                l.classList.remove(c);\n                            commandTracker[c.substring(1, c.length - 1)] = false;\n                        }\n\n                        if (action !== 'alignLeft' && !this.commandTracker[action]) {\n                            for (let c of this.alignClass) {\n                                if (c.includes(action))\n                                    l.classList.add(c);\n                            }\n                            commandTracker[action] = true;\n                        }\n                    }\n\n                    this.commandTracker = commandTracker;\n\n                    this._callback({\n                        commandTracker,\n                        range: this.range\n                    }).catch(err => err);\n\n                });\n                return;\n\n            default:\n                break;\n        }\n\n        let isColor;\n        try {\n            isColor = new ColorMangle(action).hex();\n            action = 'color';\n        } catch {\n        }\n\n        //  style command\n        if (this.styleTagOfCommand[action]) {\n            this._modifySelection(() => {\n                let wrapper,\n                    query = this.styleTagOfCommand[action],\n                    stopperMode = false;\n\n                let counter = (this.counterTagOf[query] ? this.counterTagOf[query].map(c => this._classNameToQuery(c)) : []);\n                if (counter.length)\n                    counter = counter.concat(counter.map(c => c + '_stop'));\n\n                //  setup query\n                query = this._classNameToQuery(query);\n\n                if (this.commandTracker[action]) {\n                    let pass;\n\n                    if (action === 'color') {\n                        pass = isColor === this.commandTracker[action] ||\n                            isColor === undefined && this.commandTracker[action] === this.cssVariable['--content-focus'];\n                    } else\n                        pass = true;\n\n                    if (pass) {\n                        query = this._classNameToQuery(query + '_stop');\n                        stopperMode = true;\n                    }\n                }\n\n                //  setup wrapper element\n                if (query[0] === '.') {\n                    wrapper = document.createElement('SPAN');\n                    wrapper.classList.add(query.substring(1));\n                } else\n                    wrapper = document.createElement(query);\n\n                if (isColor && !stopperMode)\n                    wrapper.style.color = isColor;\n\n                let restrictedClass = this._isSelectionWithinRestrictedRange();\n                if (this.range.collapsed) {\n                    if (restrictedClass)\n                        return;\n\n                    let text = document.createTextNode(\"\");\n                    // let text = document.createTextNode(\"\\u200B\");\n                    wrapper.append(text);\n\n                    if (this.range.startContainer.nodeName === 'BR')\n                        this.range.startContainer.parentNode.insertBefore(wrapper, this.range.startContainer);\n                    else\n                        this.range.insertNode(wrapper);\n\n                    this.range = this._adjustSelection({ node: text, position: false });\n\n                } else {\n                    if (restrictedClass) {\n                        this.range = this._adjustSelection({\n                            node: this.range.endContainer,\n                            position: this.range.endOffset\n                        });\n                        return;\n                    }\n                    //  selection has range\n                    let extract = this.range.extractContents();\n                    let span = document.createElement('span');\n\n                    while (extract.childNodes[0])\n                        span.append(extract.childNodes[0]);\n\n                    this._nodeCrawler(n => {\n                        let res = restrictedClass ? this._classNameToQuery(restrictedClass) : null;\n                        let par = n.nodeType === 3 ? n.parentNode : n;\n                        let restricted = res && par.hasOwnProperty('closest') ? par.closest(res) : false;\n\n                        if (n.nodeType === 3 && !restricted)\n                            n.textContent = n.textContent.replaceAll('\\t', '');\n\n                        return n;\n                    }, { node: span, startFromEldestChild: true, parentNode: this.element });\n\n                    while (span.childNodes[0])\n                        extract.append(span.childNodes[0]);\n\n                    //  unwrap duplicates and stopper | counter\n                    let unwrapTarget = [query];\n\n                    //  add countering | opposite tag to unwrap\n                    if (stopperMode) {\n                        let rev = query.replace('_stop', '').substring(1);\n                        rev = rev[0] === '_' ? '.' + rev : rev;\n                        unwrapTarget.push(rev);\n                    } else {\n                        let rev = query + '_stop';\n                        rev = rev[0] === '.' ? rev : '.' + rev;\n                        unwrapTarget.push(rev);\n                    }\n\n                    unwrapTarget = unwrapTarget.concat(counter);\n                    let del = extract.querySelectorAll(unwrapTarget.join());\n                    let idx = del.length;\n                    if (idx)\n                        while (idx--)\n                            this._wrapNode(del[idx]);\n\n                    //  split wrapper\n                    let wrapperSplit = [wrapper.cloneNode(true)];\n\n                    while (extract.childNodes[0]) {\n                        let child = extract.childNodes[0];\n\n                        if (child.nodeType === 1 && this._isBlockElement(child)) {\n                            let nest = this._isTextAreaElement(child);\n\n                            if (nest) {\n                                for (let idx = 0; child.childNodes.length > idx; idx++) {\n                                    let text = child.childNodes[idx];\n\n                                    if (this._isTextElement(text)) {\n                                        let nestedWrapper = wrapper.cloneNode(true);\n                                        while (text.childNodes[0]) {\n                                            if (text.childNodes[0].textContent)\n                                                nestedWrapper.append(text.childNodes[0]);\n                                            else\n                                                text.childNodes[0].remove();\n                                        }\n                                        text.append(nestedWrapper);\n                                    }\n                                }\n\n                                if (!child.textContent) {\n                                    child.remove();\n                                    continue;\n                                }\n                            }\n\n                            let doc = document.createDocumentFragment();\n                            doc.append(child);\n                            wrapperSplit.push(doc);\n\n                        } else {\n\n                            if (child.nodeType === 1 && this._isTextBlockElement(child)) {\n                                let nestedWrapper = wrapper.cloneNode(true);\n\n                                while (child.childNodes[0])\n                                    nestedWrapper.append(child.childNodes[0]);\n\n                                if (\n                                    nestedWrapper.childNodes.length === 1 &&\n                                    nestedWrapper.childNodes[0].nodeName !== 'BR' &&\n                                    !nestedWrapper.textContent.length) {\n                                    child.remove();\n                                    continue;\n                                }\n\n                                child.append(nestedWrapper);\n                                let doc = document.createDocumentFragment();\n                                doc.append(child);\n                                wrapperSplit.push(doc);\n\n                            } else\n                                wrapperSplit[wrapperSplit.length - 1].append(child);\n                        }\n                    }\n\n                    let output = document.createDocumentFragment();\n                    for (let ws of wrapperSplit)\n                        output.append(ws);\n\n                    let fc = output.firstChild;\n                    let lc = output.lastChild;\n\n                    if (this._isTextElement(fc) && !fc.textContent) {\n                        let fn = fc.nextSibling;\n                        fc.remove();\n                        fc = fn;\n                    }\n                    if (this._isTextElement(lc) && !fc.textContent) {\n                        let lp = lc.nextSibling;\n                        lc.remove();\n                        lc = lp;\n                    }\n\n                    this.range.insertNode(output);\n                    this.range = this._adjustSelection({\n                        node: [fc, lc],\n                        position: [true, false]\n                    });\n\n                    //  remove garbage node\n                    fc = fc.nodeType === 3 ? fc.parentNode : fc;\n                    lc = lc.nodeType === 3 ? lc.parentNode : lc;\n\n                    let next = lc.nextSibling;\n                    if (this._isTextElement(next) && (!next.textContent || next.textContent === '\\u200B'))\n                        next.remove();\n\n                    let prev = fc.previousSibling;\n                    if (this._isTextElement(prev) && !prev.textContent || prev.textContent === '\\u200B')\n                        prev.remove();\n                }\n            });\n\n            return;\n        }\n\n        //  custom component\n        if (typeof action === 'object') {\n            /**\n             action = {\n                   elementId: <string: generated parent element id>,\n                   element: <HTMLElement>,\n                   style: {<css style object for parent element>},\n                   insert: true | false\n                }\n             */\n\n            this._modifySelection(() => {\n                //  setup wrapper\n                let custom = document.createElement('div');\n                custom.classList.add('_custom_');\n                custom.setAttribute('contenteditable', false);\n\n                if (action.style)\n                    for (let s in action.style)\n                        custom.style[s] = action.style[s];\n\n                action.elementId = action.elementId || this._generateId('custom');\n                custom.id = action.elementId;\n\n                if (typeof action.element === 'string')\n                    custom.innerHTML = action.element;\n\n                else if (action.element instanceof HTMLElement)\n                    custom.append(action.element);\n\n                if (!custom.children.length)\n                    action.insert = true;\n\n                if (!this.range)\n                    this.element.focus();\n\n                this.custom_array.push(action);\n\n                this._callback({ custom: action }).then(_ => {\n                    if (action.insert) {\n                        this.range.insertNode(custom);\n                        this.range = this._adjustSelection({\n                            node: custom,\n                            position: false\n                        });\n                    } else\n                        this._append(custom, this._createEmptyParagraph(), false);\n                });\n            });\n        }\n    }\n\n    /**\n     * Restores the last selection range\n     */\n    restoreLastSelection() {\n        if (this.range_backup) {\n            this.range = this._adjustSelection(\n                {\n                    node: [this.range_backup.startContainer, this.range_backup.endContainer],\n                    position: [this.range_backup.startOffset, this.range_backup.endOffset]\n                });\n            let sel = window.getSelection();\n            let range = document.createRange();\n            range.setStart(this.range.startContainer, this.range.startOffset);\n            range.setEnd(this.range.endContainer, this.range.endOffset);\n            sel.removeAllRanges();\n            sel.addRange(range);\n        }\n    }\n\n    /**\n     * Load html string to wysiwyg\n     * @param {string} html - HTML string to load.\n     * @param {boolean} [editable=false] - Set editable mode.\n     */\n    async loadHTML(html = this.html, editable = false) {\n        this.setEditable(false);\n        this.html = html || '';\n        const div = document.createElement('div');\n        div.innerHTML = html;\n\n        // image\n        const img = div.querySelectorAll('img');\n        const imgCallback = [];\n        if (img.length)\n            for (let i of img) {\n                const imageParent = i.closest('._media_');\n\n                if (imageParent) {\n                    const source = i.getAttribute('src');\n                    let imgId = i.id || this._generateId('img');\n                    i.setAttribute('id', imgId);\n\n                    imgCallback.push({\n                        source,\n                        elementId: imgId,\n                        element: i\n                    });\n                }\n\n                this.image_array = JSON.parse(JSON.stringify(imgCallback));\n            }\n\n        // hashtag\n        const hashtag = div.querySelectorAll('._hashtag_');\n        const hashtagCallback = [];\n        if (hashtag.length)\n            for (let i of hashtag) {\n                let clIdx = i.classList.length;\n                let tag, elementId = i.id || this._generateId('hashtag');\n                while (clIdx--) {\n                    let cls = i.classList[clIdx];\n                    if (cls.replace('_hashtag_', '')[0] === '#') {\n                        tag = cls.replace('_hashtag_', '');\n                    }\n                }\n                tag = tag?.[0] === '#' ? tag.substring(1) : tag;\n                if (tag)\n                    hashtagCallback.push({ tag, elementId, element: i });\n            }\n\n        // urllink\n        const urllink = div.querySelectorAll('._urllink_');\n        const urllinkCallback = [];\n        if (urllink.length)\n            for (let i of urllink) {\n                let elementId = i.id || this._generateId('urllink');\n                let url;\n\n                let clIdx = i.classList.length;\n                while (clIdx--) {\n                    let cls = i.classList[clIdx];\n                    if (cls.includes('_urllink_').length) {\n                        url = cls.replace('_urllink_', '');\n                    }\n                }\n                if (url)\n                    urllinkCallback.push({ url, elementId, element: i });\n            }\n\n        const custom = div.querySelectorAll('._custom_');\n        const customCallback = [];\n        if (custom.length)\n            for (let i of custom) {\n                let elementId = i.id || this._generateId('custom');\n                customCallback.push({ elementId, element: i });\n            }\n\n        let fb = await this._callback({\n            image: imgCallback,\n            hashtag: hashtagCallback,\n            urllink: urllinkCallback,\n            custom: customCallback\n        });\n\n        // callback\n        for (let f in fb) {\n            if (f === 'image') {\n                let img = fb[f];\n                for (let i of img) {\n                    let imgEl = div.querySelector('#' + i.elementId);\n                    const imageParent = imgEl.closest('._media_');\n                    this._loadImage(i, imageParent);\n                }\n            } else\n                this[f + '_array'] = fb[f];\n        }\n\n        this.element.innerHTML = '';\n\n        while (div.childNodes[0])\n            this.element.append(div.childNodes[0]);\n\n        if (editable)\n            this.setEditable(true);\n    }\n\n    /**\n     * Load html string to wysiwyg\n     * @param {function} [pre=(p)=>{return p}] - Pre processing callback before export.\n     * @return {object} - Exported wysiwyg data object\n     */\n    async export(pre) {\n        this._normalizeDocument(true);\n        const dom = this.element.cloneNode(true);\n\n        const { hashtag_array, image_array, urllink_array, custom_array } = this;\n        let title = '';\n        let text = '';\n\n        let setup = {\n            dom,\n            urllink: this.urllink ? urllink_array : undefined,\n            hashtag: this.hashtag ? hashtag_array : undefined,\n            image: image_array,\n            custom: custom_array\n        };\n\n        if (typeof pre === 'function') {\n            let promiseOrNot = pre(setup);\n\n            if (promiseOrNot instanceof Promise)\n                setup = await promiseOrNot || setup;\n            else setup = promiseOrNot || setup;\n\n            if (this.hashtag)\n                this.hashtag_array = setup.hashtag;\n            if (this.urllink)\n                this.urllink_array = setup.urllink;\n\n            this.image_array = setup.image;\n            this.custom_array = setup.custom;\n            title = setup.title || '';\n        }\n\n        const strip = setup.dom.querySelectorAll(':scope > *');\n\n        //  Loop through eldest child element in document\n        for (let sid = 0; sid < strip.length; sid++) {\n            let child = strip[sid];\n            if (child.textContent.length) {\n                //  set title and text information\n                let inputText = child.textContent;\n                if (!title) {\n                    let titleSearchRegex = /([^\\s^.]{2,}[^\\s]+[.][^\\s^.]{2,})/g;\n                    let urlArray = inputText.match(titleSearchRegex);\n\n                    // We are replacing the urls with a special text here.\n                    // Then we split the sentences by the dots.\n                    // Then we replace the url with the special text and identify the title and body text\n\n                    let split;\n                    if (urlArray) {\n                        for (let i = 0; i < urlArray.length; i++) {\n                            inputText = inputText.replace(urlArray[i].replace(/\\.+$/, \"\"), '[§url§]' + i + '[/§url§]');\n                        }\n\n                        split = inputText.split('.');\n\n                        for (let i = 0; i < split.length; i++) {\n                            for (let j = 0; j < urlArray.length; j++) {\n                                split[i] = split[i].replace('[§url§]' + j + '[/§url§]', urlArray[j].replace(/\\.+$/, \"\"));\n                            }\n                        }\n\n                    } else\n                        split = inputText.split('.');\n\n                    title = split[0];\n                    if (title.length > 200) {\n                        text += title.substring(200) + '.';\n                        title = title.substring(0, 200);\n                    }\n\n                    split.shift();\n                    inputText = split.join('.').replace(/\\s\\s+/g, ' ');\n                    text += inputText + ' ';\n                } else\n                    text += `${inputText}\\n`;\n            }\n\n            if (child.classList.contains('_media_')) {\n                let idx = child.childNodes.length;\n                while (idx--) {\n                    let c = child.childNodes[idx];\n                    if (c.nodeName === 'IMG') {\n                        for (const f of this.image_array) {\n                            if (f.elementId === c.id && f.source !== c.getAttribute('src')) {\n                                c.setAttribute('src', f.source);\n                                let cIdx = c.classList.length;\n                                while (cIdx--) {\n                                    if (c.classList[cIdx].includes('_img_') && c.classList[cIdx].length > 5) {\n                                        c.classList.remove(c.classList[cIdx]);\n                                        let splitUrl = f.source.split('/');\n                                        let splitTail = splitUrl[splitUrl.length - 1];\n                                        let splitTail_length = splitTail.length - 64;\n                                        const sourceClip = splitUrl[splitUrl.length - 1].substring(splitTail_length > 0 ? splitTail : 0);\n                                        c.classList.add('_img_' + sourceClip);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        return {\n            html: setup.dom.innerHTML,\n            title: title.trim(),\n            text: text.trim(),\n            urllink: this.urllink ? this.urllink_array : undefined,\n            hashtag: this.hashtag ? this.hashtag_array : undefined,\n            image: this.image_array,\n            custom: this.custom_array\n        };\n    }\n\n    /**\n     * Set placeholder string\n     * @param {string} p - Set placeholder string.\n     */\n    setPlaceholder(p) {\n        if (this.element) {\n            if (p && typeof p === 'string') this.element.setAttribute(\"placeholder\", p);\n            else this.element.removeAttribute(\"placeholder\");\n        }\n    }\n\n    /**\n     * Set spellcheck mode\n     * @param {boolean} bool - Set spellcheck mode.\n     */\n    setSpellcheck(bool) {\n        if (this.element)\n            this.element.setAttribute(\"spellcheck\", bool ? 'on' : 'off');\n    }\n\n    /**\n     * Set edit mode\n     * @param {boolean} bool - Set wysiwyg to editable when true.\n     */\n    setEditable(bool) {\n        bool = this.element ? bool : false;\n\n        if (this.element)\n            this.element.setAttribute(\"contenteditable\", JSON.stringify(bool));\n\n        this._setEventListener(bool);\n        this._observeMutation(bool);\n    }\n}\n"],"names":["root","factory","exports","module","define","amd","a","i","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","colorNames","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","goldenrod","gold","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavenderblush","lavender","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ColorMangle","constructor","color","fineTuned","this","format","_colorType","type","throwErr","chkType","string","toLowerCase","match","Array","isArray","length","exec","err","_extractDigit","color_arg","rgba","push","parseFloat","getAlpha","extract","colorScheme","darkMode","focusOriginal","focusSat","opacity","template","content_isHighLuminance","isHighLuminance","focus","includes","matchLuminance","compDir","analogous","focusHSL","hsla","h","an1HSL","an2HSL","Math","abs","complementary","fixedValue","darkModeAnalogous","analogousNude","k","textColor","assign","contrastRatio","unordered","keys","sort","reduce","target_color","target_ratio","direction","method","target","adj","m","dir","count","adj_set","adjustBrightness","adjustLuminance","legacy","hex","main_lum","_luminance","lum","currDir","lum_pre","deg","spin","v","val","hsl","plus","s","l","minus","add","_toString","r","g","b","rgb","map","pow","col","numberOrNot","n","def","color_arg1","color_arg2","lum1","lum2","option","blackOpacity","whiteOpacity","opa","c_min","min","c_max","max","delta","round","toFixed","digit","toString","slice","rgbObject","hexValues","parseInt","opacity_value","c","x","limit","rgbRange","result","adjustSaturation","Wysiwyg4All","hashtag_regex","hashtag_stopper_regex","urllink_regex","elementId","editable","placeholder","spellcheck","highlightColor","html","callback","fontSize","desktop","tablet","phone","lastLineBlank","hashtag","urllink","logMutation","fontSizeCssVariable","hold","keyArr","Error","substring","image_array","hashtag_array","urllink_array","custom_array","blockElement_queryArray","specialTextElement_queryArray","restrictedElement_queryArray","textAreaElement_queryArray","textBlockElement_queryArray","ceilingElement_queryArray","unSelectable_queryArray","styleAllowedElement_queryArray","alignClass","hashtag_flag","urllink_flag","range_backup","commandTracker","range","isRangeDirectionForward","insertTabPending_tabString","removeSandwichedLine_array","lastKey","element","document","getElementById","innerHTML","cssVariable","style","setProperty","elementComputedStyle","window","getComputedStyle","defaultFontColor","classList","contains","setPlaceholder","setSpellcheck","paddingB","paddingBottom","paddingT","paddingTop","borderT","borderTopWidth","borderB","borderBottomWidth","minHeight","command","h1","h2","h3","h4","h5","h6","italic","small","bold","underline","strike","fontSizeRatio","styleTagOfCommand","counterTagOf","cssPropertyOf","cssPropertyChecker","documentFontSize","nodeFontSize","tag","compare_size","loadHTML","catch","_adjustSelection","ceilingElement_query","toArray","allowObject","setRange","node","position","sel","getSelection","getRangeAt","createRange","p","Node","setTarget","nodeType","lastChild","firstChild","textLength","_nodeCrawler","textContent","parentNode","getAttribute","text","createTextNode","insertBefore","childNodes","nodeName","previousSibling","setEnd","doCollapse","setStart","startContainer","startOffset","endContainer","endOffset","collapse","removeAllRanges","addRange","startLine","endLine","q","e","closest","_climbUpToEldestParent","_generateId","prefix","charAt","floor","random","letter_array","array","temporaryValue","randomIndex","currentIndex","shuffleArray","Date","getTime","split","output","run","startFromEldestChild","startNode","commonAncestorContainer","parentAnchor","id","uniqueId","outputNodes","nodeIsRange","commonContainer","nodes","crawl","endNode","withInRange","cwl","breakOut","nextSibling","removeAttribute","_wrapNode","wrapper","appendWhole","start","end","withinRange","append","child","stripped","removeChild","_isSingleChildParent","childrenCount","children","sweep","divCount","iHaveText","singleChildParent","cb","_isSelectionWithinRestrictedRange","restrict","_classNameToQuery","_createEmptyParagraph","createElement","_trackStyle","cls","checker","sp","_isTextElement","_lastLineBlank","lastLine","_setEventListener","listen","removeEventListener","_selectionchange","imgInput","_keydown","_normalize","_paste","_keyup","entries","accept","hidden","multiple","setAttribute","addEventListener","_imageSelected","console","error","_modifySelection","isForward","rangeHeader","unSel","_isUnSelectableElement","selNext","collapsed","caratPosition","skipTrack","concat","quote","comm","caratEl","getBoundingClientRect","_callback","bind","toUpperCase","shift","shiftKey","preventDefault","stc","block","_isTextBlockElement","t","_replaceText","_setArrow","remove","sweep_array","hasIndent","diveAndRemoveTab","offset","line","container","containerOffset","lineOffset","tab","insertNode","stopPropagation","_normalizeDocument","cloneRange","doc","createDocumentFragment","clipboardData","getData","replace","u","extractContents","pop","_observeMutation","track","observer","disconnect","MutationObserver","mutation_array","monitor","cloneNode","name","attributeName","added","clones","addedNodes","removed","removedNodes","mutate","mutation","_","mutationTarget","callbackRemoved","what","arrIdx","splice","childIdx","toBreak","idx","getBr","br","isWysiwygChild","isWysiwygEldestChild","_isCeilingElement","ceiling","clo","isMediaElement","isBlockQuoteElement","isCustomElement","isHashtagElement","isUrlLinkElement","_isBlockElement","_isStyleAllowedElement","sa","doContinue","addBr","classSet","counter","toUnwrap","cIdx","set","class_idx","className","observe","attributes","childList","subtree","isAllRangeOnSameLine","currentLine","caratElement","arrowDirection","metaKey","ctrlKey","rangeSetup","removeZeroSpace","targetContainer","nudged","siblingDirection","isCaratOnMultiLine","el","posTarget","caratViewPortPosition","elPosition","phoneTextSize","height","nudgeRangeToInlineElement","display","_caratElement","nextEl","setDirection","isMultiLine","eldestParentOfCurrentLine","isCurrentLineInsideSubCeiling","siblingSet","reverse","backwardNode","forwardNode","_forwardNode","leap","collectOffset","currentOffset","_append","insertAfter","wrap","focusElement","common","insertRestricted","next","nodeToUnwrap","restricted","chk","notAllowed","fc","data","Promise","res","then","files","prepareForCallback","image","readFile","FileReader","load","file","onload","f","lastModified","size","source","img","Image","dimension","width","filename","fileSize","fileType","src","readAsDataURL","loading","feedback","restoreLastSelection","media","_loadImage","imageObject","classname","class","cl","tagName","onclick","st","pushArray","process","anchorElement","anchorNode","appendChild","normalize","cel","par","wholeDocument","typeName","setData","regex","anchorText","collected","textNodes","forEach","handler","hits","nxt","ownerDocument","global","nodeValue","lastIndex","handleResult","apply","results","orig","index","create","rest","createElementNS","namespaceURI","attrs","content","contentEditable","replaceTextNode","matched","textEl","toCallback","collectId","tc","dom","url","open","_checkElement","chkArr","_isTextAreaElement","_isSpecialTextElement","action","bq","li","ul","hr","click","collectLines","nextLine","isColor","query","stopperMode","pass","undefined","restrictedClass","span","replaceAll","unwrapTarget","rev","del","querySelectorAll","join","wrapperSplit","nestedWrapper","ws","lc","fn","lp","prev","custom","HTMLElement","insert","setEditable","div","imgCallback","imgId","JSON","parse","stringify","hashtagCallback","clIdx","urllinkCallback","customCallback","fb","imageParent","querySelector","pre","title","setup","promiseOrNot","strip","sid","inputText","titleSearchRegex","urlArray","j","splitUrl","splitTail","splitTail_length","sourceClip","trim","bool"],"sourceRoot":""}